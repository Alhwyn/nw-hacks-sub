(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();function mT(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Zu={exports:{}},lr={};var Mg;function pT(){if(Mg)return lr;Mg=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,l){var h=null;if(l!==void 0&&(h=""+l),o.key!==void 0&&(h=""+o.key),"key"in o){l={};for(var u in o)u!=="key"&&(l[u]=o[u])}else l=o;return o=l.ref,{$$typeof:r,type:a,key:h,ref:o!==void 0?o:null,props:l}}return lr.Fragment=t,lr.jsx=i,lr.jsxs=i,lr}var wg;function gT(){return wg||(wg=1,Zu.exports=pT()),Zu.exports}var Te=gT(),Wu={exports:{}},ge={};var xg;function vT(){if(xg)return ge;xg=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),h=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),S=Symbol.iterator;function k(_){return _===null||typeof _!="object"?null:(_=S&&_[S]||_["@@iterator"],typeof _=="function"?_:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R=Object.assign,G={};function I(_,q,te){this.props=_,this.context=q,this.refs=G,this.updater=te||A}I.prototype.isReactComponent={},I.prototype.setState=function(_,q){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,q,"setState")},I.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function Z(){}Z.prototype=I.prototype;function X(_,q,te){this.props=_,this.context=q,this.refs=G,this.updater=te||A}var M=X.prototype=new Z;M.constructor=X,R(M,I.prototype),M.isPureReactComponent=!0;var D=Array.isArray;function z(){}var K={H:null,A:null,T:null,S:null},se=Object.prototype.hasOwnProperty;function ne(_,q,te){var ce=te.ref;return{$$typeof:r,type:_,key:q,ref:ce!==void 0?ce:null,props:te}}function ie(_,q){return ne(_.type,q,_.props)}function re(_){return typeof _=="object"&&_!==null&&_.$$typeof===r}function ae(_){var q={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(te){return q[te]})}var fe=/\/+/g;function Fe(_,q){return typeof _=="object"&&_!==null&&_.key!=null?ae(""+_.key):q.toString(36)}function Qe(_){switch(_.status){case"fulfilled":return _.value;case"rejected":throw _.reason;default:switch(typeof _.status=="string"?_.then(z,z):(_.status="pending",_.then(function(q){_.status==="pending"&&(_.status="fulfilled",_.value=q)},function(q){_.status==="pending"&&(_.status="rejected",_.reason=q)})),_.status){case"fulfilled":return _.value;case"rejected":throw _.reason}}throw _}function L(_,q,te,ce,pe){var be=typeof _;(be==="undefined"||be==="boolean")&&(_=null);var Ue=!1;if(_===null)Ue=!0;else switch(be){case"bigint":case"string":case"number":Ue=!0;break;case"object":switch(_.$$typeof){case r:case t:Ue=!0;break;case g:return Ue=_._init,L(Ue(_._payload),q,te,ce,pe)}}if(Ue)return pe=pe(_),Ue=ce===""?"."+Fe(_,0):ce,D(pe)?(te="",Ue!=null&&(te=Ue.replace(fe,"$&/")+"/"),L(pe,q,te,"",function(gs){return gs})):pe!=null&&(re(pe)&&(pe=ie(pe,te+(pe.key==null||_&&_.key===pe.key?"":(""+pe.key).replace(fe,"$&/")+"/")+Ue)),q.push(pe)),1;Ue=0;var Dt=ce===""?".":ce+":";if(D(_))for(var at=0;at<_.length;at++)ce=_[at],be=Dt+Fe(ce,at),Ue+=L(ce,q,te,be,pe);else if(at=k(_),typeof at=="function")for(_=at.call(_),at=0;!(ce=_.next()).done;)ce=ce.value,be=Dt+Fe(ce,at++),Ue+=L(ce,q,te,be,pe);else if(be==="object"){if(typeof _.then=="function")return L(Qe(_),q,te,ce,pe);throw q=String(_),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Ue}function J(_,q,te){if(_==null)return _;var ce=[],pe=0;return L(_,ce,"","",function(be){return q.call(te,be,pe++)}),ce}function $(_){if(_._status===-1){var q=_._result;q=q(),q.then(function(te){(_._status===0||_._status===-1)&&(_._status=1,_._result=te)},function(te){(_._status===0||_._status===-1)&&(_._status=2,_._result=te)}),_._status===-1&&(_._status=0,_._result=q)}if(_._status===1)return _._result.default;throw _._result}var me=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)},ve={map:J,forEach:function(_,q,te){J(_,function(){q.apply(this,arguments)},te)},count:function(_){var q=0;return J(_,function(){q++}),q},toArray:function(_){return J(_,function(q){return q})||[]},only:function(_){if(!re(_))throw Error("React.Children.only expected to receive a single React element child.");return _}};return ge.Activity=y,ge.Children=ve,ge.Component=I,ge.Fragment=i,ge.Profiler=o,ge.PureComponent=X,ge.StrictMode=a,ge.Suspense=m,ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=K,ge.__COMPILER_RUNTIME={__proto__:null,c:function(_){return K.H.useMemoCache(_)}},ge.cache=function(_){return function(){return _.apply(null,arguments)}},ge.cacheSignal=function(){return null},ge.cloneElement=function(_,q,te){if(_==null)throw Error("The argument must be a React element, but you passed "+_+".");var ce=R({},_.props),pe=_.key;if(q!=null)for(be in q.key!==void 0&&(pe=""+q.key),q)!se.call(q,be)||be==="key"||be==="__self"||be==="__source"||be==="ref"&&q.ref===void 0||(ce[be]=q[be]);var be=arguments.length-2;if(be===1)ce.children=te;else if(1<be){for(var Ue=Array(be),Dt=0;Dt<be;Dt++)Ue[Dt]=arguments[Dt+2];ce.children=Ue}return ne(_.type,pe,ce)},ge.createContext=function(_){return _={$$typeof:h,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null},_.Provider=_,_.Consumer={$$typeof:l,_context:_},_},ge.createElement=function(_,q,te){var ce,pe={},be=null;if(q!=null)for(ce in q.key!==void 0&&(be=""+q.key),q)se.call(q,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(pe[ce]=q[ce]);var Ue=arguments.length-2;if(Ue===1)pe.children=te;else if(1<Ue){for(var Dt=Array(Ue),at=0;at<Ue;at++)Dt[at]=arguments[at+2];pe.children=Dt}if(_&&_.defaultProps)for(ce in Ue=_.defaultProps,Ue)pe[ce]===void 0&&(pe[ce]=Ue[ce]);return ne(_,be,pe)},ge.createRef=function(){return{current:null}},ge.forwardRef=function(_){return{$$typeof:u,render:_}},ge.isValidElement=re,ge.lazy=function(_){return{$$typeof:g,_payload:{_status:-1,_result:_},_init:$}},ge.memo=function(_,q){return{$$typeof:p,type:_,compare:q===void 0?null:q}},ge.startTransition=function(_){var q=K.T,te={};K.T=te;try{var ce=_(),pe=K.S;pe!==null&&pe(te,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(z,me)}catch(be){me(be)}finally{q!==null&&te.types!==null&&(q.types=te.types),K.T=q}},ge.unstable_useCacheRefresh=function(){return K.H.useCacheRefresh()},ge.use=function(_){return K.H.use(_)},ge.useActionState=function(_,q,te){return K.H.useActionState(_,q,te)},ge.useCallback=function(_,q){return K.H.useCallback(_,q)},ge.useContext=function(_){return K.H.useContext(_)},ge.useDebugValue=function(){},ge.useDeferredValue=function(_,q){return K.H.useDeferredValue(_,q)},ge.useEffect=function(_,q){return K.H.useEffect(_,q)},ge.useEffectEvent=function(_){return K.H.useEffectEvent(_)},ge.useId=function(){return K.H.useId()},ge.useImperativeHandle=function(_,q,te){return K.H.useImperativeHandle(_,q,te)},ge.useInsertionEffect=function(_,q){return K.H.useInsertionEffect(_,q)},ge.useLayoutEffect=function(_,q){return K.H.useLayoutEffect(_,q)},ge.useMemo=function(_,q){return K.H.useMemo(_,q)},ge.useOptimistic=function(_,q){return K.H.useOptimistic(_,q)},ge.useReducer=function(_,q,te){return K.H.useReducer(_,q,te)},ge.useRef=function(_){return K.H.useRef(_)},ge.useState=function(_){return K.H.useState(_)},ge.useSyncExternalStore=function(_,q,te){return K.H.useSyncExternalStore(_,q,te)},ge.useTransition=function(){return K.H.useTransition()},ge.version="19.2.3",ge}var Ng;function Qd(){return Ng||(Ng=1,Wu.exports=vT()),Wu.exports}var Ze=Qd();const yT=mT(Ze);var $u={exports:{}},ur={},ed={exports:{}},td={};var Pg;function bT(){return Pg||(Pg=1,(function(r){function t(L,J){var $=L.length;L.push(J);e:for(;0<$;){var me=$-1>>>1,ve=L[me];if(0<o(ve,J))L[me]=J,L[$]=ve,$=me;else break e}}function i(L){return L.length===0?null:L[0]}function a(L){if(L.length===0)return null;var J=L[0],$=L.pop();if($!==J){L[0]=$;e:for(var me=0,ve=L.length,_=ve>>>1;me<_;){var q=2*(me+1)-1,te=L[q],ce=q+1,pe=L[ce];if(0>o(te,$))ce<ve&&0>o(pe,te)?(L[me]=pe,L[ce]=$,me=ce):(L[me]=te,L[q]=$,me=q);else if(ce<ve&&0>o(pe,$))L[me]=pe,L[ce]=$,me=ce;else break e}}return J}function o(L,J){var $=L.sortIndex-J.sortIndex;return $!==0?$:L.id-J.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var h=Date,u=h.now();r.unstable_now=function(){return h.now()-u}}var m=[],p=[],g=1,y=null,S=3,k=!1,A=!1,R=!1,G=!1,I=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;function M(L){for(var J=i(p);J!==null;){if(J.callback===null)a(p);else if(J.startTime<=L)a(p),J.sortIndex=J.expirationTime,t(m,J);else break;J=i(p)}}function D(L){if(R=!1,M(L),!A)if(i(m)!==null)A=!0,z||(z=!0,ae());else{var J=i(p);J!==null&&Qe(D,J.startTime-L)}}var z=!1,K=-1,se=5,ne=-1;function ie(){return G?!0:!(r.unstable_now()-ne<se)}function re(){if(G=!1,z){var L=r.unstable_now();ne=L;var J=!0;try{e:{A=!1,R&&(R=!1,Z(K),K=-1),k=!0;var $=S;try{t:{for(M(L),y=i(m);y!==null&&!(y.expirationTime>L&&ie());){var me=y.callback;if(typeof me=="function"){y.callback=null,S=y.priorityLevel;var ve=me(y.expirationTime<=L);if(L=r.unstable_now(),typeof ve=="function"){y.callback=ve,M(L),J=!0;break t}y===i(m)&&a(m),M(L)}else a(m);y=i(m)}if(y!==null)J=!0;else{var _=i(p);_!==null&&Qe(D,_.startTime-L),J=!1}}break e}finally{y=null,S=$,k=!1}J=void 0}}finally{J?ae():z=!1}}}var ae;if(typeof X=="function")ae=function(){X(re)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,Fe=fe.port2;fe.port1.onmessage=re,ae=function(){Fe.postMessage(null)}}else ae=function(){I(re,0)};function Qe(L,J){K=I(function(){L(r.unstable_now())},J)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return S},r.unstable_next=function(L){switch(S){case 1:case 2:case 3:var J=3;break;default:J=S}var $=S;S=J;try{return L()}finally{S=$}},r.unstable_requestPaint=function(){G=!0},r.unstable_runWithPriority=function(L,J){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var $=S;S=L;try{return J()}finally{S=$}},r.unstable_scheduleCallback=function(L,J,$){var me=r.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?me+$:me):$=me,L){case 1:var ve=-1;break;case 2:ve=250;break;case 5:ve=1073741823;break;case 4:ve=1e4;break;default:ve=5e3}return ve=$+ve,L={id:g++,callback:J,priorityLevel:L,startTime:$,expirationTime:ve,sortIndex:-1},$>me?(L.sortIndex=$,t(p,L),i(m)===null&&L===i(p)&&(R?(Z(K),K=-1):R=!0,Qe(D,$-me))):(L.sortIndex=ve,t(m,L),A||k||(A=!0,z||(z=!0,ae()))),L},r.unstable_shouldYield=ie,r.unstable_wrapCallback=function(L){var J=S;return function(){var $=S;S=J;try{return L.apply(this,arguments)}finally{S=$}}}})(td)),td}var Lg;function ST(){return Lg||(Lg=1,ed.exports=bT()),ed.exports}var nd={exports:{}},Ot={};var Ug;function TT(){if(Ug)return Ot;Ug=1;var r=Qd();function t(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(m,p,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:y==null?null:""+y,children:m,containerInfo:p,implementation:g}}var h=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Ot.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Ot.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return l(m,p,null,g)},Ot.flushSync=function(m){var p=h.T,g=a.p;try{if(h.T=null,a.p=2,m)return m()}finally{h.T=p,a.p=g,a.d.f()}},Ot.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(m,p))},Ot.prefetchDNS=function(m){typeof m=="string"&&a.d.D(m)},Ot.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,y=u(g,p.crossOrigin),S=typeof p.integrity=="string"?p.integrity:void 0,k=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?a.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:y,integrity:S,fetchPriority:k}):g==="script"&&a.d.X(m,{crossOrigin:y,integrity:S,fetchPriority:k,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Ot.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=u(p.as,p.crossOrigin);a.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(m)},Ot.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,y=u(g,p.crossOrigin);a.d.L(m,g,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Ot.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=u(p.as,p.crossOrigin);a.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(m)},Ot.requestFormReset=function(m){a.d.r(m)},Ot.unstable_batchedUpdates=function(m,p){return m(p)},Ot.useFormState=function(m,p,g){return h.H.useFormState(m,p,g)},Ot.useFormStatus=function(){return h.H.useHostTransitionStatus()},Ot.version="19.2.3",Ot}var Ig;function CT(){if(Ig)return nd.exports;Ig=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),nd.exports=TT(),nd.exports}var jg;function kT(){if(jg)return ur;jg=1;var r=ST(),t=Qd(),i=CT();function a(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function l(e){var n=e,s=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(s=n.return),e=n.return;while(e)}return n.tag===3?s:null}function h(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function u(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function m(e){if(l(e)!==e)throw Error(a(188))}function p(e){var n=e.alternate;if(!n){if(n=l(e),n===null)throw Error(a(188));return n!==e?null:e}for(var s=e,c=n;;){var d=s.return;if(d===null)break;var f=d.alternate;if(f===null){if(c=d.return,c!==null){s=c;continue}break}if(d.child===f.child){for(f=d.child;f;){if(f===s)return m(d),e;if(f===c)return m(d),n;f=f.sibling}throw Error(a(188))}if(s.return!==c.return)s=d,c=f;else{for(var v=!1,b=d.child;b;){if(b===s){v=!0,s=d,c=f;break}if(b===c){v=!0,c=d,s=f;break}b=b.sibling}if(!v){for(b=f.child;b;){if(b===s){v=!0,s=f,c=d;break}if(b===c){v=!0,c=f,s=d;break}b=b.sibling}if(!v)throw Error(a(189))}}if(s.alternate!==c)throw Error(a(190))}if(s.tag!==3)throw Error(a(188));return s.stateNode.current===s?e:n}function g(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=g(e),n!==null)return n;e=e.sibling}return null}var y=Object.assign,S=Symbol.for("react.element"),k=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),Z=Symbol.for("react.consumer"),X=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),ie=Symbol.for("react.memo_cache_sentinel"),re=Symbol.iterator;function ae(e){return e===null||typeof e!="object"?null:(e=re&&e[re]||e["@@iterator"],typeof e=="function"?e:null)}var fe=Symbol.for("react.client.reference");function Fe(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===fe?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case R:return"Fragment";case I:return"Profiler";case G:return"StrictMode";case D:return"Suspense";case z:return"SuspenseList";case ne:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case A:return"Portal";case X:return e.displayName||"Context";case Z:return(e._context.displayName||"Context")+".Consumer";case M:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case K:return n=e.displayName||null,n!==null?n:Fe(e.type)||"Memo";case se:n=e._payload,e=e._init;try{return Fe(e(n))}catch{}}return null}var Qe=Array.isArray,L=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},me=[],ve=-1;function _(e){return{current:e}}function q(e){0>ve||(e.current=me[ve],me[ve]=null,ve--)}function te(e,n){ve++,me[ve]=e.current,e.current=n}var ce=_(null),pe=_(null),be=_(null),Ue=_(null);function Dt(e,n){switch(te(be,n),te(pe,e),te(ce,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?$p(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=$p(n),e=eg(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}q(ce),te(ce,e)}function at(){q(ce),q(pe),q(be)}function gs(e){e.memoizedState!==null&&te(Ue,e);var n=ce.current,s=eg(n,e.type);n!==s&&(te(pe,e),te(ce,s))}function wr(e){pe.current===e&&(q(ce),q(pe)),Ue.current===e&&(q(Ue),sr._currentValue=$)}var Nc,Dh;function Gi(e){if(Nc===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);Nc=n&&n[1]||"",Dh=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Nc+e+Dh}var Pc=!1;function Lc(e,n){if(!e||Pc)return"";Pc=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var V=function(){throw Error()};if(Object.defineProperty(V.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(V,[])}catch(U){var P=U}Reflect.construct(e,[],V)}else{try{V.call()}catch(U){P=U}e.call(V.prototype)}}else{try{throw Error()}catch(U){P=U}(V=e())&&typeof V.catch=="function"&&V.catch(function(){})}}catch(U){if(U&&P&&typeof U.stack=="string")return[U.stack,P.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=c.DetermineComponentFrameRoot(),v=f[0],b=f[1];if(v&&b){var C=v.split(`
`),x=b.split(`
`);for(d=c=0;c<C.length&&!C[c].includes("DetermineComponentFrameRoot");)c++;for(;d<x.length&&!x[d].includes("DetermineComponentFrameRoot");)d++;if(c===C.length||d===x.length)for(c=C.length-1,d=x.length-1;1<=c&&0<=d&&C[c]!==x[d];)d--;for(;1<=c&&0<=d;c--,d--)if(C[c]!==x[d]){if(c!==1||d!==1)do if(c--,d--,0>d||C[c]!==x[d]){var j=`
`+C[c].replace(" at new "," at ");return e.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",e.displayName)),j}while(1<=c&&0<=d);break}}}finally{Pc=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Gi(s):""}function G0(e,n){switch(e.tag){case 26:case 27:case 5:return Gi(e.type);case 16:return Gi("Lazy");case 13:return e.child!==n&&n!==null?Gi("Suspense Fallback"):Gi("Suspense");case 19:return Gi("SuspenseList");case 0:case 15:return Lc(e.type,!1);case 11:return Lc(e.type.render,!1);case 1:return Lc(e.type,!0);case 31:return Gi("Activity");default:return""}}function Ah(e){try{var n="",s=null;do n+=G0(e,s),s=e,e=e.return;while(e);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Uc=Object.prototype.hasOwnProperty,Ic=r.unstable_scheduleCallback,jc=r.unstable_cancelCallback,K0=r.unstable_shouldYield,Y0=r.unstable_requestPaint,Gt=r.unstable_now,J0=r.unstable_getCurrentPriorityLevel,Mh=r.unstable_ImmediatePriority,wh=r.unstable_UserBlockingPriority,xr=r.unstable_NormalPriority,Q0=r.unstable_LowPriority,xh=r.unstable_IdlePriority,X0=r.log,Z0=r.unstable_setDisableYieldValue,vs=null,Kt=null;function ci(e){if(typeof X0=="function"&&Z0(e),Kt&&typeof Kt.setStrictMode=="function")try{Kt.setStrictMode(vs,e)}catch{}}var Yt=Math.clz32?Math.clz32:eb,W0=Math.log,$0=Math.LN2;function eb(e){return e>>>=0,e===0?32:31-(W0(e)/$0|0)|0}var Nr=256,Pr=262144,Lr=4194304;function Ki(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ur(e,n,s){var c=e.pendingLanes;if(c===0)return 0;var d=0,f=e.suspendedLanes,v=e.pingedLanes;e=e.warmLanes;var b=c&134217727;return b!==0?(c=b&~f,c!==0?d=Ki(c):(v&=b,v!==0?d=Ki(v):s||(s=b&~e,s!==0&&(d=Ki(s))))):(b=c&~f,b!==0?d=Ki(b):v!==0?d=Ki(v):s||(s=c&~e,s!==0&&(d=Ki(s)))),d===0?0:n!==0&&n!==d&&(n&f)===0&&(f=d&-d,s=n&-n,f>=s||f===32&&(s&4194048)!==0)?n:d}function ys(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function tb(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nh(){var e=Lr;return Lr<<=1,(Lr&62914560)===0&&(Lr=4194304),e}function Bc(e){for(var n=[],s=0;31>s;s++)n.push(e);return n}function bs(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function nb(e,n,s,c,d,f){var v=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var b=e.entanglements,C=e.expirationTimes,x=e.hiddenUpdates;for(s=v&~s;0<s;){var j=31-Yt(s),V=1<<j;b[j]=0,C[j]=-1;var P=x[j];if(P!==null)for(x[j]=null,j=0;j<P.length;j++){var U=P[j];U!==null&&(U.lane&=-536870913)}s&=~V}c!==0&&Ph(e,c,0),f!==0&&d===0&&e.tag!==0&&(e.suspendedLanes|=f&~(v&~n))}function Ph(e,n,s){e.pendingLanes|=n,e.suspendedLanes&=~n;var c=31-Yt(n);e.entangledLanes|=n,e.entanglements[c]=e.entanglements[c]|1073741824|s&261930}function Lh(e,n){var s=e.entangledLanes|=n;for(e=e.entanglements;s;){var c=31-Yt(s),d=1<<c;d&n|e[c]&n&&(e[c]|=n),s&=~d}}function Uh(e,n){var s=n&-n;return s=(s&42)!==0?1:zc(s),(s&(e.suspendedLanes|n))!==0?0:s}function zc(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function qc(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ih(){var e=J.p;return e!==0?e:(e=window.event,e===void 0?32:kg(e.type))}function jh(e,n){var s=J.p;try{return J.p=e,n()}finally{J.p=s}}var li=Math.random().toString(36).slice(2),St="__reactFiber$"+li,Pt="__reactProps$"+li,ga="__reactContainer$"+li,Vc="__reactEvents$"+li,ib="__reactListeners$"+li,ab="__reactHandles$"+li,Bh="__reactResources$"+li,Ss="__reactMarker$"+li;function Fc(e){delete e[St],delete e[Pt],delete e[Vc],delete e[ib],delete e[ab]}function va(e){var n=e[St];if(n)return n;for(var s=e.parentNode;s;){if(n=s[ga]||s[St]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(e=og(e);e!==null;){if(s=e[St])return s;e=og(e)}return n}e=s,s=e.parentNode}return null}function ya(e){if(e=e[St]||e[ga]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function Ts(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(a(33))}function ba(e){var n=e[Bh];return n||(n=e[Bh]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function gt(e){e[Ss]=!0}var zh=new Set,qh={};function Yi(e,n){Sa(e,n),Sa(e+"Capture",n)}function Sa(e,n){for(qh[e]=n,e=0;e<n.length;e++)zh.add(n[e])}var sb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vh={},Fh={};function rb(e){return Uc.call(Fh,e)?!0:Uc.call(Vh,e)?!1:sb.test(e)?Fh[e]=!0:(Vh[e]=!0,!1)}function Ir(e,n,s){if(rb(n))if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+s)}}function jr(e,n,s){if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+s)}}function In(e,n,s,c){if(c===null)e.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(n,s,""+c)}}function nn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Hh(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function ob(e,n,s){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var d=c.get,f=c.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(v){s=""+v,f.call(this,v)}}),Object.defineProperty(e,n,{enumerable:c.enumerable}),{getValue:function(){return s},setValue:function(v){s=""+v},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Hc(e){if(!e._valueTracker){var n=Hh(e)?"checked":"value";e._valueTracker=ob(e,n,""+e[n])}}function Gh(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var s=n.getValue(),c="";return e&&(c=Hh(e)?e.checked?"true":"false":e.value),e=c,e!==s?(n.setValue(e),!0):!1}function Br(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var cb=/[\n"\\]/g;function an(e){return e.replace(cb,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Gc(e,n,s,c,d,f,v,b){e.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.type=v:e.removeAttribute("type"),n!=null?v==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+nn(n)):e.value!==""+nn(n)&&(e.value=""+nn(n)):v!=="submit"&&v!=="reset"||e.removeAttribute("value"),n!=null?Kc(e,v,nn(n)):s!=null?Kc(e,v,nn(s)):c!=null&&e.removeAttribute("value"),d==null&&f!=null&&(e.defaultChecked=!!f),d!=null&&(e.checked=d&&typeof d!="function"&&typeof d!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.name=""+nn(b):e.removeAttribute("name")}function Kh(e,n,s,c,d,f,v,b){if(f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.type=f),n!=null||s!=null){if(!(f!=="submit"&&f!=="reset"||n!=null)){Hc(e);return}s=s!=null?""+nn(s):"",n=n!=null?""+nn(n):s,b||n===e.value||(e.value=n),e.defaultValue=n}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=b?e.checked:!!c,e.defaultChecked=!!c,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.name=v),Hc(e)}function Kc(e,n,s){n==="number"&&Br(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function Ta(e,n,s,c){if(e=e.options,n){n={};for(var d=0;d<s.length;d++)n["$"+s[d]]=!0;for(s=0;s<e.length;s++)d=n.hasOwnProperty("$"+e[s].value),e[s].selected!==d&&(e[s].selected=d),d&&c&&(e[s].defaultSelected=!0)}else{for(s=""+nn(s),n=null,d=0;d<e.length;d++){if(e[d].value===s){e[d].selected=!0,c&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function Yh(e,n,s){if(n!=null&&(n=""+nn(n),n!==e.value&&(e.value=n),s==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=s!=null?""+nn(s):""}function Jh(e,n,s,c){if(n==null){if(c!=null){if(s!=null)throw Error(a(92));if(Qe(c)){if(1<c.length)throw Error(a(93));c=c[0]}s=c}s==null&&(s=""),n=s}s=nn(n),e.defaultValue=s,c=e.textContent,c===s&&c!==""&&c!==null&&(e.value=c),Hc(e)}function Ca(e,n){if(n){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=n;return}}e.textContent=n}var lb=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qh(e,n,s){var c=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?c?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":c?e.setProperty(n,s):typeof s!="number"||s===0||lb.has(n)?n==="float"?e.cssFloat=s:e[n]=(""+s).trim():e[n]=s+"px"}function Xh(e,n,s){if(n!=null&&typeof n!="object")throw Error(a(62));if(e=e.style,s!=null){for(var c in s)!s.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var d in n)c=n[d],n.hasOwnProperty(d)&&s[d]!==c&&Qh(e,d,c)}else for(var f in n)n.hasOwnProperty(f)&&Qh(e,f,n[f])}function Yc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ub=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),db=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zr(e){return db.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function jn(){}var Jc=null;function Qc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ka=null,Ea=null;function Zh(e){var n=ya(e);if(n&&(e=n.stateNode)){var s=e[Pt]||null;e:switch(e=n.stateNode,n.type){case"input":if(Gc(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+an(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var c=s[n];if(c!==e&&c.form===e.form){var d=c[Pt]||null;if(!d)throw Error(a(90));Gc(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(n=0;n<s.length;n++)c=s[n],c.form===e.form&&Gh(c)}break e;case"textarea":Yh(e,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&Ta(e,!!s.multiple,n,!1)}}}var Xc=!1;function Wh(e,n,s){if(Xc)return e(n,s);Xc=!0;try{var c=e(n);return c}finally{if(Xc=!1,(ka!==null||Ea!==null)&&(Do(),ka&&(n=ka,e=Ea,Ea=ka=null,Zh(n),e)))for(n=0;n<e.length;n++)Zh(e[n])}}function Cs(e,n){var s=e.stateNode;if(s===null)return null;var c=s[Pt]||null;if(c===null)return null;s=c[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(a(231,n,typeof s));return s}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zc=!1;if(Bn)try{var ks={};Object.defineProperty(ks,"passive",{get:function(){Zc=!0}}),window.addEventListener("test",ks,ks),window.removeEventListener("test",ks,ks)}catch{Zc=!1}var ui=null,Wc=null,qr=null;function $h(){if(qr)return qr;var e,n=Wc,s=n.length,c,d="value"in ui?ui.value:ui.textContent,f=d.length;for(e=0;e<s&&n[e]===d[e];e++);var v=s-e;for(c=1;c<=v&&n[s-c]===d[f-c];c++);return qr=d.slice(e,1<c?1-c:void 0)}function Vr(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Fr(){return!0}function ef(){return!1}function Lt(e){function n(s,c,d,f,v){this._reactName=s,this._targetInst=d,this.type=c,this.nativeEvent=f,this.target=v,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(s=e[b],this[b]=s?s(f):f[b]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?Fr:ef,this.isPropagationStopped=ef,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Fr)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Fr)},persist:function(){},isPersistent:Fr}),n}var Ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hr=Lt(Ji),Es=y({},Ji,{view:0,detail:0}),hb=Lt(Es),$c,el,_s,Gr=y({},Es,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nl,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==_s&&(_s&&e.type==="mousemove"?($c=e.screenX-_s.screenX,el=e.screenY-_s.screenY):el=$c=0,_s=e),$c)},movementY:function(e){return"movementY"in e?e.movementY:el}}),tf=Lt(Gr),fb=y({},Gr,{dataTransfer:0}),mb=Lt(fb),pb=y({},Es,{relatedTarget:0}),tl=Lt(pb),gb=y({},Ji,{animationName:0,elapsedTime:0,pseudoElement:0}),vb=Lt(gb),yb=y({},Ji,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bb=Lt(yb),Sb=y({},Ji,{data:0}),nf=Lt(Sb),Tb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eb(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=kb[e])?!!n[e]:!1}function nl(){return Eb}var _b=y({},Es,{key:function(e){if(e.key){var n=Tb[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=Vr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Cb[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nl,charCode:function(e){return e.type==="keypress"?Vr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Vr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rb=Lt(_b),Ob=y({},Gr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),af=Lt(Ob),Db=y({},Es,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nl}),Ab=Lt(Db),Mb=y({},Ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),wb=Lt(Mb),xb=y({},Gr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nb=Lt(xb),Pb=y({},Ji,{newState:0,oldState:0}),Lb=Lt(Pb),Ub=[9,13,27,32],il=Bn&&"CompositionEvent"in window,Rs=null;Bn&&"documentMode"in document&&(Rs=document.documentMode);var Ib=Bn&&"TextEvent"in window&&!Rs,sf=Bn&&(!il||Rs&&8<Rs&&11>=Rs),rf=" ",of=!1;function cf(e,n){switch(e){case"keyup":return Ub.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var _a=!1;function jb(e,n){switch(e){case"compositionend":return lf(n);case"keypress":return n.which!==32?null:(of=!0,rf);case"textInput":return e=n.data,e===rf&&of?null:e;default:return null}}function Bb(e,n){if(_a)return e==="compositionend"||!il&&cf(e,n)?(e=$h(),qr=Wc=ui=null,_a=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return sf&&n.locale!=="ko"?null:n.data;default:return null}}var zb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uf(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!zb[e.type]:n==="textarea"}function df(e,n,s,c){ka?Ea?Ea.push(c):Ea=[c]:ka=c,n=Lo(n,"onChange"),0<n.length&&(s=new Hr("onChange","change",null,s,c),e.push({event:s,listeners:n}))}var Os=null,Ds=null;function qb(e){Yp(e,0)}function Kr(e){var n=Ts(e);if(Gh(n))return e}function hf(e,n){if(e==="change")return n}var ff=!1;if(Bn){var al;if(Bn){var sl="oninput"in document;if(!sl){var mf=document.createElement("div");mf.setAttribute("oninput","return;"),sl=typeof mf.oninput=="function"}al=sl}else al=!1;ff=al&&(!document.documentMode||9<document.documentMode)}function pf(){Os&&(Os.detachEvent("onpropertychange",gf),Ds=Os=null)}function gf(e){if(e.propertyName==="value"&&Kr(Ds)){var n=[];df(n,Ds,e,Qc(e)),Wh(qb,n)}}function Vb(e,n,s){e==="focusin"?(pf(),Os=n,Ds=s,Os.attachEvent("onpropertychange",gf)):e==="focusout"&&pf()}function Fb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Kr(Ds)}function Hb(e,n){if(e==="click")return Kr(n)}function Gb(e,n){if(e==="input"||e==="change")return Kr(n)}function Kb(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Jt=typeof Object.is=="function"?Object.is:Kb;function As(e,n){if(Jt(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var s=Object.keys(e),c=Object.keys(n);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var d=s[c];if(!Uc.call(n,d)||!Jt(e[d],n[d]))return!1}return!0}function vf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function yf(e,n){var s=vf(e);e=0;for(var c;s;){if(s.nodeType===3){if(c=e+s.textContent.length,e<=n&&c>=n)return{node:s,offset:n-e};e=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=vf(s)}}function bf(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?bf(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Sf(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=Br(e.document);n instanceof e.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)e=n.contentWindow;else break;n=Br(e.document)}return n}function rl(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var Yb=Bn&&"documentMode"in document&&11>=document.documentMode,Ra=null,ol=null,Ms=null,cl=!1;function Tf(e,n,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;cl||Ra==null||Ra!==Br(c)||(c=Ra,"selectionStart"in c&&rl(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Ms&&As(Ms,c)||(Ms=c,c=Lo(ol,"onSelect"),0<c.length&&(n=new Hr("onSelect","select",null,n,s),e.push({event:n,listeners:c}),n.target=Ra)))}function Qi(e,n){var s={};return s[e.toLowerCase()]=n.toLowerCase(),s["Webkit"+e]="webkit"+n,s["Moz"+e]="moz"+n,s}var Oa={animationend:Qi("Animation","AnimationEnd"),animationiteration:Qi("Animation","AnimationIteration"),animationstart:Qi("Animation","AnimationStart"),transitionrun:Qi("Transition","TransitionRun"),transitionstart:Qi("Transition","TransitionStart"),transitioncancel:Qi("Transition","TransitionCancel"),transitionend:Qi("Transition","TransitionEnd")},ll={},Cf={};Bn&&(Cf=document.createElement("div").style,"AnimationEvent"in window||(delete Oa.animationend.animation,delete Oa.animationiteration.animation,delete Oa.animationstart.animation),"TransitionEvent"in window||delete Oa.transitionend.transition);function Xi(e){if(ll[e])return ll[e];if(!Oa[e])return e;var n=Oa[e],s;for(s in n)if(n.hasOwnProperty(s)&&s in Cf)return ll[e]=n[s];return e}var kf=Xi("animationend"),Ef=Xi("animationiteration"),_f=Xi("animationstart"),Jb=Xi("transitionrun"),Qb=Xi("transitionstart"),Xb=Xi("transitioncancel"),Rf=Xi("transitionend"),Of=new Map,ul="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ul.push("scrollEnd");function gn(e,n){Of.set(e,n),Yi(n,[e])}var Yr=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},sn=[],Da=0,dl=0;function Jr(){for(var e=Da,n=dl=Da=0;n<e;){var s=sn[n];sn[n++]=null;var c=sn[n];sn[n++]=null;var d=sn[n];sn[n++]=null;var f=sn[n];if(sn[n++]=null,c!==null&&d!==null){var v=c.pending;v===null?d.next=d:(d.next=v.next,v.next=d),c.pending=d}f!==0&&Df(s,d,f)}}function Qr(e,n,s,c){sn[Da++]=e,sn[Da++]=n,sn[Da++]=s,sn[Da++]=c,dl|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function hl(e,n,s,c){return Qr(e,n,s,c),Xr(e)}function Zi(e,n){return Qr(e,null,null,n),Xr(e)}function Df(e,n,s){e.lanes|=s;var c=e.alternate;c!==null&&(c.lanes|=s);for(var d=!1,f=e.return;f!==null;)f.childLanes|=s,c=f.alternate,c!==null&&(c.childLanes|=s),f.tag===22&&(e=f.stateNode,e===null||e._visibility&1||(d=!0)),e=f,f=f.return;return e.tag===3?(f=e.stateNode,d&&n!==null&&(d=31-Yt(s),e=f.hiddenUpdates,c=e[d],c===null?e[d]=[n]:c.push(n),n.lane=s|536870912),f):null}function Xr(e){if(50<Ws)throw Ws=0,Tu=null,Error(a(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Aa={};function Zb(e,n,s,c){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(e,n,s,c){return new Zb(e,n,s,c)}function fl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zn(e,n){var s=e.alternate;return s===null?(s=Qt(e.tag,n,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=n,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,n=e.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function Af(e,n){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,n=s.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function Zr(e,n,s,c,d,f){var v=0;if(c=e,typeof e=="function")fl(e)&&(v=1);else if(typeof e=="string")v=nT(e,s,ce.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ne:return e=Qt(31,s,n,d),e.elementType=ne,e.lanes=f,e;case R:return Wi(s.children,d,f,n);case G:v=8,d|=24;break;case I:return e=Qt(12,s,n,d|2),e.elementType=I,e.lanes=f,e;case D:return e=Qt(13,s,n,d),e.elementType=D,e.lanes=f,e;case z:return e=Qt(19,s,n,d),e.elementType=z,e.lanes=f,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case X:v=10;break e;case Z:v=9;break e;case M:v=11;break e;case K:v=14;break e;case se:v=16,c=null;break e}v=29,s=Error(a(130,e===null?"null":typeof e,"")),c=null}return n=Qt(v,s,n,d),n.elementType=e,n.type=c,n.lanes=f,n}function Wi(e,n,s,c){return e=Qt(7,e,c,n),e.lanes=s,e}function ml(e,n,s){return e=Qt(6,e,null,n),e.lanes=s,e}function Mf(e){var n=Qt(18,null,null,0);return n.stateNode=e,n}function pl(e,n,s){return n=Qt(4,e.children!==null?e.children:[],e.key,n),n.lanes=s,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var wf=new WeakMap;function rn(e,n){if(typeof e=="object"&&e!==null){var s=wf.get(e);return s!==void 0?s:(n={value:e,source:n,stack:Ah(n)},wf.set(e,n),n)}return{value:e,source:n,stack:Ah(n)}}var Ma=[],wa=0,Wr=null,ws=0,on=[],cn=0,di=null,Rn=1,On="";function qn(e,n){Ma[wa++]=ws,Ma[wa++]=Wr,Wr=e,ws=n}function xf(e,n,s){on[cn++]=Rn,on[cn++]=On,on[cn++]=di,di=e;var c=Rn;e=On;var d=32-Yt(c)-1;c&=~(1<<d),s+=1;var f=32-Yt(n)+d;if(30<f){var v=d-d%5;f=(c&(1<<v)-1).toString(32),c>>=v,d-=v,Rn=1<<32-Yt(n)+d|s<<d|c,On=f+e}else Rn=1<<f|s<<d|c,On=e}function gl(e){e.return!==null&&(qn(e,1),xf(e,1,0))}function vl(e){for(;e===Wr;)Wr=Ma[--wa],Ma[wa]=null,ws=Ma[--wa],Ma[wa]=null;for(;e===di;)di=on[--cn],on[cn]=null,On=on[--cn],on[cn]=null,Rn=on[--cn],on[cn]=null}function Nf(e,n){on[cn++]=Rn,on[cn++]=On,on[cn++]=di,Rn=n.id,On=n.overflow,di=e}var Tt=null,Ye=null,Me=!1,hi=null,ln=!1,yl=Error(a(519));function fi(e){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw xs(rn(n,e)),yl}function Pf(e){var n=e.stateNode,s=e.type,c=e.memoizedProps;switch(n[St]=e,n[Pt]=c,s){case"dialog":_e("cancel",n),_e("close",n);break;case"iframe":case"object":case"embed":_e("load",n);break;case"video":case"audio":for(s=0;s<er.length;s++)_e(er[s],n);break;case"source":_e("error",n);break;case"img":case"image":case"link":_e("error",n),_e("load",n);break;case"details":_e("toggle",n);break;case"input":_e("invalid",n),Kh(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":_e("invalid",n);break;case"textarea":_e("invalid",n),Jh(n,c.value,c.defaultValue,c.children)}s=c.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||c.suppressHydrationWarning===!0||Zp(n.textContent,s)?(c.popover!=null&&(_e("beforetoggle",n),_e("toggle",n)),c.onScroll!=null&&_e("scroll",n),c.onScrollEnd!=null&&_e("scrollend",n),c.onClick!=null&&(n.onclick=jn),n=!0):n=!1,n||fi(e,!0)}function Lf(e){for(Tt=e.return;Tt;)switch(Tt.tag){case 5:case 31:case 13:ln=!1;return;case 27:case 3:ln=!0;return;default:Tt=Tt.return}}function xa(e){if(e!==Tt)return!1;if(!Me)return Lf(e),Me=!0,!1;var n=e.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||Uu(e.type,e.memoizedProps)),s=!s),s&&Ye&&fi(e),Lf(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Ye=rg(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Ye=rg(e)}else n===27?(n=Ye,Oi(e.type)?(e=qu,qu=null,Ye=e):Ye=n):Ye=Tt?dn(e.stateNode.nextSibling):null;return!0}function $i(){Ye=Tt=null,Me=!1}function bl(){var e=hi;return e!==null&&(Bt===null?Bt=e:Bt.push.apply(Bt,e),hi=null),e}function xs(e){hi===null?hi=[e]:hi.push(e)}var Sl=_(null),ea=null,Vn=null;function mi(e,n,s){te(Sl,n._currentValue),n._currentValue=s}function Fn(e){e._currentValue=Sl.current,q(Sl)}function Tl(e,n,s){for(;e!==null;){var c=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),e===s)break;e=e.return}}function Cl(e,n,s,c){var d=e.child;for(d!==null&&(d.return=e);d!==null;){var f=d.dependencies;if(f!==null){var v=d.child;f=f.firstContext;e:for(;f!==null;){var b=f;f=d;for(var C=0;C<n.length;C++)if(b.context===n[C]){f.lanes|=s,b=f.alternate,b!==null&&(b.lanes|=s),Tl(f.return,s,e),c||(v=null);break e}f=b.next}}else if(d.tag===18){if(v=d.return,v===null)throw Error(a(341));v.lanes|=s,f=v.alternate,f!==null&&(f.lanes|=s),Tl(v,s,e),v=null}else v=d.child;if(v!==null)v.return=d;else for(v=d;v!==null;){if(v===e){v=null;break}if(d=v.sibling,d!==null){d.return=v.return,v=d;break}v=v.return}d=v}}function Na(e,n,s,c){e=null;for(var d=n,f=!1;d!==null;){if(!f){if((d.flags&524288)!==0)f=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var v=d.alternate;if(v===null)throw Error(a(387));if(v=v.memoizedProps,v!==null){var b=d.type;Jt(d.pendingProps.value,v.value)||(e!==null?e.push(b):e=[b])}}else if(d===Ue.current){if(v=d.alternate,v===null)throw Error(a(387));v.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(e!==null?e.push(sr):e=[sr])}d=d.return}e!==null&&Cl(n,e,s,c),n.flags|=262144}function $r(e){for(e=e.firstContext;e!==null;){if(!Jt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ta(e){ea=e,Vn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ct(e){return Uf(ea,e)}function eo(e,n){return ea===null&&ta(e),Uf(e,n)}function Uf(e,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},Vn===null){if(e===null)throw Error(a(308));Vn=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Vn=Vn.next=n;return s}var Wb=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(s,c){e.push(c)}};this.abort=function(){n.aborted=!0,e.forEach(function(s){return s()})}},$b=r.unstable_scheduleCallback,eS=r.unstable_NormalPriority,lt={$$typeof:X,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function kl(){return{controller:new Wb,data:new Map,refCount:0}}function Ns(e){e.refCount--,e.refCount===0&&$b(eS,function(){e.controller.abort()})}var Ps=null,El=0,Pa=0,La=null;function tS(e,n){if(Ps===null){var s=Ps=[];El=0,Pa=Ou(),La={status:"pending",value:void 0,then:function(c){s.push(c)}}}return El++,n.then(If,If),n}function If(){if(--El===0&&Ps!==null){La!==null&&(La.status="fulfilled");var e=Ps;Ps=null,Pa=0,La=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function nS(e,n){var s=[],c={status:"pending",value:null,reason:null,then:function(d){s.push(d)}};return e.then(function(){c.status="fulfilled",c.value=n;for(var d=0;d<s.length;d++)(0,s[d])(n)},function(d){for(c.status="rejected",c.reason=d,d=0;d<s.length;d++)(0,s[d])(void 0)}),c}var jf=L.S;L.S=function(e,n){Tp=Gt(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&tS(e,n),jf!==null&&jf(e,n)};var na=_(null);function _l(){var e=na.current;return e!==null?e:He.pooledCache}function to(e,n){n===null?te(na,na.current):te(na,n.pool)}function Bf(){var e=_l();return e===null?null:{parent:lt._currentValue,pool:e}}var Ua=Error(a(460)),Rl=Error(a(474)),no=Error(a(542)),io={then:function(){}};function zf(e){return e=e.status,e==="fulfilled"||e==="rejected"}function qf(e,n,s){switch(s=e[s],s===void 0?e.push(n):s!==n&&(n.then(jn,jn),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ff(e),e;default:if(typeof n.status=="string")n.then(jn,jn);else{if(e=He,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=n,e.status="pending",e.then(function(c){if(n.status==="pending"){var d=n;d.status="fulfilled",d.value=c}},function(c){if(n.status==="pending"){var d=n;d.status="rejected",d.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ff(e),e}throw aa=n,Ua}}function ia(e){try{var n=e._init;return n(e._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(aa=s,Ua):s}}var aa=null;function Vf(){if(aa===null)throw Error(a(459));var e=aa;return aa=null,e}function Ff(e){if(e===Ua||e===no)throw Error(a(483))}var Ia=null,Ls=0;function ao(e){var n=Ls;return Ls+=1,Ia===null&&(Ia=[]),qf(Ia,e,n)}function Us(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function so(e,n){throw n.$$typeof===S?Error(a(525)):(e=Object.prototype.toString.call(n),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Hf(e){function n(O,E){if(e){var w=O.deletions;w===null?(O.deletions=[E],O.flags|=16):w.push(E)}}function s(O,E){if(!e)return null;for(;E!==null;)n(O,E),E=E.sibling;return null}function c(O){for(var E=new Map;O!==null;)O.key!==null?E.set(O.key,O):E.set(O.index,O),O=O.sibling;return E}function d(O,E){return O=zn(O,E),O.index=0,O.sibling=null,O}function f(O,E,w){return O.index=w,e?(w=O.alternate,w!==null?(w=w.index,w<E?(O.flags|=67108866,E):w):(O.flags|=67108866,E)):(O.flags|=1048576,E)}function v(O){return e&&O.alternate===null&&(O.flags|=67108866),O}function b(O,E,w,B){return E===null||E.tag!==6?(E=ml(w,O.mode,B),E.return=O,E):(E=d(E,w),E.return=O,E)}function C(O,E,w,B){var ue=w.type;return ue===R?j(O,E,w.props.children,B,w.key):E!==null&&(E.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===se&&ia(ue)===E.type)?(E=d(E,w.props),Us(E,w),E.return=O,E):(E=Zr(w.type,w.key,w.props,null,O.mode,B),Us(E,w),E.return=O,E)}function x(O,E,w,B){return E===null||E.tag!==4||E.stateNode.containerInfo!==w.containerInfo||E.stateNode.implementation!==w.implementation?(E=pl(w,O.mode,B),E.return=O,E):(E=d(E,w.children||[]),E.return=O,E)}function j(O,E,w,B,ue){return E===null||E.tag!==7?(E=Wi(w,O.mode,B,ue),E.return=O,E):(E=d(E,w),E.return=O,E)}function V(O,E,w){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return E=ml(""+E,O.mode,w),E.return=O,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case k:return w=Zr(E.type,E.key,E.props,null,O.mode,w),Us(w,E),w.return=O,w;case A:return E=pl(E,O.mode,w),E.return=O,E;case se:return E=ia(E),V(O,E,w)}if(Qe(E)||ae(E))return E=Wi(E,O.mode,w,null),E.return=O,E;if(typeof E.then=="function")return V(O,ao(E),w);if(E.$$typeof===X)return V(O,eo(O,E),w);so(O,E)}return null}function P(O,E,w,B){var ue=E!==null?E.key:null;if(typeof w=="string"&&w!==""||typeof w=="number"||typeof w=="bigint")return ue!==null?null:b(O,E,""+w,B);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case k:return w.key===ue?C(O,E,w,B):null;case A:return w.key===ue?x(O,E,w,B):null;case se:return w=ia(w),P(O,E,w,B)}if(Qe(w)||ae(w))return ue!==null?null:j(O,E,w,B,null);if(typeof w.then=="function")return P(O,E,ao(w),B);if(w.$$typeof===X)return P(O,E,eo(O,w),B);so(O,w)}return null}function U(O,E,w,B,ue){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return O=O.get(w)||null,b(E,O,""+B,ue);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case k:return O=O.get(B.key===null?w:B.key)||null,C(E,O,B,ue);case A:return O=O.get(B.key===null?w:B.key)||null,x(E,O,B,ue);case se:return B=ia(B),U(O,E,w,B,ue)}if(Qe(B)||ae(B))return O=O.get(w)||null,j(E,O,B,ue,null);if(typeof B.then=="function")return U(O,E,w,ao(B),ue);if(B.$$typeof===X)return U(O,E,w,eo(E,B),ue);so(E,B)}return null}function oe(O,E,w,B){for(var ue=null,xe=null,le=E,Se=E=0,Ae=null;le!==null&&Se<w.length;Se++){le.index>Se?(Ae=le,le=null):Ae=le.sibling;var Ne=P(O,le,w[Se],B);if(Ne===null){le===null&&(le=Ae);break}e&&le&&Ne.alternate===null&&n(O,le),E=f(Ne,E,Se),xe===null?ue=Ne:xe.sibling=Ne,xe=Ne,le=Ae}if(Se===w.length)return s(O,le),Me&&qn(O,Se),ue;if(le===null){for(;Se<w.length;Se++)le=V(O,w[Se],B),le!==null&&(E=f(le,E,Se),xe===null?ue=le:xe.sibling=le,xe=le);return Me&&qn(O,Se),ue}for(le=c(le);Se<w.length;Se++)Ae=U(le,O,Se,w[Se],B),Ae!==null&&(e&&Ae.alternate!==null&&le.delete(Ae.key===null?Se:Ae.key),E=f(Ae,E,Se),xe===null?ue=Ae:xe.sibling=Ae,xe=Ae);return e&&le.forEach(function(xi){return n(O,xi)}),Me&&qn(O,Se),ue}function de(O,E,w,B){if(w==null)throw Error(a(151));for(var ue=null,xe=null,le=E,Se=E=0,Ae=null,Ne=w.next();le!==null&&!Ne.done;Se++,Ne=w.next()){le.index>Se?(Ae=le,le=null):Ae=le.sibling;var xi=P(O,le,Ne.value,B);if(xi===null){le===null&&(le=Ae);break}e&&le&&xi.alternate===null&&n(O,le),E=f(xi,E,Se),xe===null?ue=xi:xe.sibling=xi,xe=xi,le=Ae}if(Ne.done)return s(O,le),Me&&qn(O,Se),ue;if(le===null){for(;!Ne.done;Se++,Ne=w.next())Ne=V(O,Ne.value,B),Ne!==null&&(E=f(Ne,E,Se),xe===null?ue=Ne:xe.sibling=Ne,xe=Ne);return Me&&qn(O,Se),ue}for(le=c(le);!Ne.done;Se++,Ne=w.next())Ne=U(le,O,Se,Ne.value,B),Ne!==null&&(e&&Ne.alternate!==null&&le.delete(Ne.key===null?Se:Ne.key),E=f(Ne,E,Se),xe===null?ue=Ne:xe.sibling=Ne,xe=Ne);return e&&le.forEach(function(fT){return n(O,fT)}),Me&&qn(O,Se),ue}function qe(O,E,w,B){if(typeof w=="object"&&w!==null&&w.type===R&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case k:e:{for(var ue=w.key;E!==null;){if(E.key===ue){if(ue=w.type,ue===R){if(E.tag===7){s(O,E.sibling),B=d(E,w.props.children),B.return=O,O=B;break e}}else if(E.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===se&&ia(ue)===E.type){s(O,E.sibling),B=d(E,w.props),Us(B,w),B.return=O,O=B;break e}s(O,E);break}else n(O,E);E=E.sibling}w.type===R?(B=Wi(w.props.children,O.mode,B,w.key),B.return=O,O=B):(B=Zr(w.type,w.key,w.props,null,O.mode,B),Us(B,w),B.return=O,O=B)}return v(O);case A:e:{for(ue=w.key;E!==null;){if(E.key===ue)if(E.tag===4&&E.stateNode.containerInfo===w.containerInfo&&E.stateNode.implementation===w.implementation){s(O,E.sibling),B=d(E,w.children||[]),B.return=O,O=B;break e}else{s(O,E);break}else n(O,E);E=E.sibling}B=pl(w,O.mode,B),B.return=O,O=B}return v(O);case se:return w=ia(w),qe(O,E,w,B)}if(Qe(w))return oe(O,E,w,B);if(ae(w)){if(ue=ae(w),typeof ue!="function")throw Error(a(150));return w=ue.call(w),de(O,E,w,B)}if(typeof w.then=="function")return qe(O,E,ao(w),B);if(w.$$typeof===X)return qe(O,E,eo(O,w),B);so(O,w)}return typeof w=="string"&&w!==""||typeof w=="number"||typeof w=="bigint"?(w=""+w,E!==null&&E.tag===6?(s(O,E.sibling),B=d(E,w),B.return=O,O=B):(s(O,E),B=ml(w,O.mode,B),B.return=O,O=B),v(O)):s(O,E)}return function(O,E,w,B){try{Ls=0;var ue=qe(O,E,w,B);return Ia=null,ue}catch(le){if(le===Ua||le===no)throw le;var xe=Qt(29,le,null,O.mode);return xe.lanes=B,xe.return=O,xe}}}var sa=Hf(!0),Gf=Hf(!1),pi=!1;function Ol(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Dl(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function gi(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function vi(e,n,s){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Le&2)!==0){var d=c.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),c.pending=n,n=Xr(e),Df(e,null,s),n}return Qr(e,c,n,s),Xr(e)}function Is(e,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Lh(e,s)}}function Al(e,n){var s=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var d=null,f=null;if(s=s.firstBaseUpdate,s!==null){do{var v={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};f===null?d=f=v:f=f.next=v,s=s.next}while(s!==null);f===null?d=f=n:f=f.next=n}else d=f=n;s={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:f,shared:c.shared,callbacks:c.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=n:e.next=n,s.lastBaseUpdate=n}var Ml=!1;function js(){if(Ml){var e=La;if(e!==null)throw e}}function Bs(e,n,s,c){Ml=!1;var d=e.updateQueue;pi=!1;var f=d.firstBaseUpdate,v=d.lastBaseUpdate,b=d.shared.pending;if(b!==null){d.shared.pending=null;var C=b,x=C.next;C.next=null,v===null?f=x:v.next=x,v=C;var j=e.alternate;j!==null&&(j=j.updateQueue,b=j.lastBaseUpdate,b!==v&&(b===null?j.firstBaseUpdate=x:b.next=x,j.lastBaseUpdate=C))}if(f!==null){var V=d.baseState;v=0,j=x=C=null,b=f;do{var P=b.lane&-536870913,U=P!==b.lane;if(U?(De&P)===P:(c&P)===P){P!==0&&P===Pa&&(Ml=!0),j!==null&&(j=j.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var oe=e,de=b;P=n;var qe=s;switch(de.tag){case 1:if(oe=de.payload,typeof oe=="function"){V=oe.call(qe,V,P);break e}V=oe;break e;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=de.payload,P=typeof oe=="function"?oe.call(qe,V,P):oe,P==null)break e;V=y({},V,P);break e;case 2:pi=!0}}P=b.callback,P!==null&&(e.flags|=64,U&&(e.flags|=8192),U=d.callbacks,U===null?d.callbacks=[P]:U.push(P))}else U={lane:P,tag:b.tag,payload:b.payload,callback:b.callback,next:null},j===null?(x=j=U,C=V):j=j.next=U,v|=P;if(b=b.next,b===null){if(b=d.shared.pending,b===null)break;U=b,b=U.next,U.next=null,d.lastBaseUpdate=U,d.shared.pending=null}}while(!0);j===null&&(C=V),d.baseState=C,d.firstBaseUpdate=x,d.lastBaseUpdate=j,f===null&&(d.shared.lanes=0),Ci|=v,e.lanes=v,e.memoizedState=V}}function Kf(e,n){if(typeof e!="function")throw Error(a(191,e));e.call(n)}function Yf(e,n){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)Kf(s[e],n)}var ja=_(null),ro=_(0);function Jf(e,n){e=Wn,te(ro,e),te(ja,n),Wn=e|n.baseLanes}function wl(){te(ro,Wn),te(ja,ja.current)}function xl(){Wn=ro.current,q(ja),q(ro)}var Xt=_(null),un=null;function yi(e){var n=e.alternate;te(st,st.current&1),te(Xt,e),un===null&&(n===null||ja.current!==null||n.memoizedState!==null)&&(un=e)}function Nl(e){te(st,st.current),te(Xt,e),un===null&&(un=e)}function Qf(e){e.tag===22?(te(st,st.current),te(Xt,e),un===null&&(un=e)):bi()}function bi(){te(st,st.current),te(Xt,Xt.current)}function Zt(e){q(Xt),un===e&&(un=null),q(st)}var st=_(0);function oo(e){for(var n=e;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Bu(s)||zu(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Hn=0,ye=null,Be=null,ut=null,co=!1,Ba=!1,ra=!1,lo=0,zs=0,za=null,iS=0;function $e(){throw Error(a(321))}function Pl(e,n){if(n===null)return!1;for(var s=0;s<n.length&&s<e.length;s++)if(!Jt(e[s],n[s]))return!1;return!0}function Ll(e,n,s,c,d,f){return Hn=f,ye=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,L.H=e===null||e.memoizedState===null?xm:Xl,ra=!1,f=s(c,d),ra=!1,Ba&&(f=Zf(n,s,c,d)),Xf(e),f}function Xf(e){L.H=Fs;var n=Be!==null&&Be.next!==null;if(Hn=0,ut=Be=ye=null,co=!1,zs=0,za=null,n)throw Error(a(300));e===null||dt||(e=e.dependencies,e!==null&&$r(e)&&(dt=!0))}function Zf(e,n,s,c){ye=e;var d=0;do{if(Ba&&(za=null),zs=0,Ba=!1,25<=d)throw Error(a(301));if(d+=1,ut=Be=null,e.updateQueue!=null){var f=e.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,f.memoCache!=null&&(f.memoCache.index=0)}L.H=Nm,f=n(s,c)}while(Ba);return f}function aS(){var e=L.H,n=e.useState()[0];return n=typeof n.then=="function"?qs(n):n,e=e.useState()[0],(Be!==null?Be.memoizedState:null)!==e&&(ye.flags|=1024),n}function Ul(){var e=lo!==0;return lo=0,e}function Il(e,n,s){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~s}function jl(e){if(co){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}co=!1}Hn=0,ut=Be=ye=null,Ba=!1,zs=lo=0,za=null}function At(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?ye.memoizedState=ut=e:ut=ut.next=e,ut}function rt(){if(Be===null){var e=ye.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var n=ut===null?ye.memoizedState:ut.next;if(n!==null)ut=n,Be=e;else{if(e===null)throw ye.alternate===null?Error(a(467)):Error(a(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},ut===null?ye.memoizedState=ut=e:ut=ut.next=e}return ut}function uo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function qs(e){var n=zs;return zs+=1,za===null&&(za=[]),e=qf(za,e,n),n=ye,(ut===null?n.memoizedState:ut.next)===null&&(n=n.alternate,L.H=n===null||n.memoizedState===null?xm:Xl),e}function ho(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return qs(e);if(e.$$typeof===X)return Ct(e)}throw Error(a(438,String(e)))}function Bl(e){var n=null,s=ye.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var c=ye.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(d){return d.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=uo(),ye.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(e),c=0;c<e;c++)s[c]=ie;return n.index++,s}function Gn(e,n){return typeof n=="function"?n(e):n}function fo(e){var n=rt();return zl(n,Be,e)}function zl(e,n,s){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=s;var d=e.baseQueue,f=c.pending;if(f!==null){if(d!==null){var v=d.next;d.next=f.next,f.next=v}n.baseQueue=d=f,c.pending=null}if(f=e.baseState,d===null)e.memoizedState=f;else{n=d.next;var b=v=null,C=null,x=n,j=!1;do{var V=x.lane&-536870913;if(V!==x.lane?(De&V)===V:(Hn&V)===V){var P=x.revertLane;if(P===0)C!==null&&(C=C.next={lane:0,revertLane:0,gesture:null,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),V===Pa&&(j=!0);else if((Hn&P)===P){x=x.next,P===Pa&&(j=!0);continue}else V={lane:0,revertLane:x.revertLane,gesture:null,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null},C===null?(b=C=V,v=f):C=C.next=V,ye.lanes|=P,Ci|=P;V=x.action,ra&&s(f,V),f=x.hasEagerState?x.eagerState:s(f,V)}else P={lane:V,revertLane:x.revertLane,gesture:x.gesture,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null},C===null?(b=C=P,v=f):C=C.next=P,ye.lanes|=V,Ci|=V;x=x.next}while(x!==null&&x!==n);if(C===null?v=f:C.next=b,!Jt(f,e.memoizedState)&&(dt=!0,j&&(s=La,s!==null)))throw s;e.memoizedState=f,e.baseState=v,e.baseQueue=C,c.lastRenderedState=f}return d===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function ql(e){var n=rt(),s=n.queue;if(s===null)throw Error(a(311));s.lastRenderedReducer=e;var c=s.dispatch,d=s.pending,f=n.memoizedState;if(d!==null){s.pending=null;var v=d=d.next;do f=e(f,v.action),v=v.next;while(v!==d);Jt(f,n.memoizedState)||(dt=!0),n.memoizedState=f,n.baseQueue===null&&(n.baseState=f),s.lastRenderedState=f}return[f,c]}function Wf(e,n,s){var c=ye,d=rt(),f=Me;if(f){if(s===void 0)throw Error(a(407));s=s()}else s=n();var v=!Jt((Be||d).memoizedState,s);if(v&&(d.memoizedState=s,dt=!0),d=d.queue,Hl(tm.bind(null,c,d,e),[e]),d.getSnapshot!==n||v||ut!==null&&ut.memoizedState.tag&1){if(c.flags|=2048,qa(9,{destroy:void 0},em.bind(null,c,d,s,n),null),He===null)throw Error(a(349));f||(Hn&127)!==0||$f(c,n,s)}return s}function $f(e,n,s){e.flags|=16384,e={getSnapshot:n,value:s},n=ye.updateQueue,n===null?(n=uo(),ye.updateQueue=n,n.stores=[e]):(s=n.stores,s===null?n.stores=[e]:s.push(e))}function em(e,n,s,c){n.value=s,n.getSnapshot=c,nm(n)&&im(e)}function tm(e,n,s){return s(function(){nm(n)&&im(e)})}function nm(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!Jt(e,s)}catch{return!0}}function im(e){var n=Zi(e,2);n!==null&&zt(n,e,2)}function Vl(e){var n=At();if(typeof e=="function"){var s=e;if(e=s(),ra){ci(!0);try{s()}finally{ci(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gn,lastRenderedState:e},n}function am(e,n,s,c){return e.baseState=s,zl(e,Be,typeof c=="function"?c:Gn)}function sS(e,n,s,c,d){if(go(e))throw Error(a(485));if(e=n.action,e!==null){var f={payload:d,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){f.listeners.push(v)}};L.T!==null?s(!0):f.isTransition=!1,c(f),s=n.pending,s===null?(f.next=n.pending=f,sm(n,f)):(f.next=s.next,n.pending=s.next=f)}}function sm(e,n){var s=n.action,c=n.payload,d=e.state;if(n.isTransition){var f=L.T,v={};L.T=v;try{var b=s(d,c),C=L.S;C!==null&&C(v,b),rm(e,n,b)}catch(x){Fl(e,n,x)}finally{f!==null&&v.types!==null&&(f.types=v.types),L.T=f}}else try{f=s(d,c),rm(e,n,f)}catch(x){Fl(e,n,x)}}function rm(e,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(c){om(e,n,c)},function(c){return Fl(e,n,c)}):om(e,n,s)}function om(e,n,s){n.status="fulfilled",n.value=s,cm(n),e.state=s,n=e.pending,n!==null&&(s=n.next,s===n?e.pending=null:(s=s.next,n.next=s,sm(e,s)))}function Fl(e,n,s){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=s,cm(n),n=n.next;while(n!==c)}e.action=null}function cm(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function lm(e,n){return n}function um(e,n){if(Me){var s=He.formState;if(s!==null){e:{var c=ye;if(Me){if(Ye){t:{for(var d=Ye,f=ln;d.nodeType!==8;){if(!f){d=null;break t}if(d=dn(d.nextSibling),d===null){d=null;break t}}f=d.data,d=f==="F!"||f==="F"?d:null}if(d){Ye=dn(d.nextSibling),c=d.data==="F!";break e}}fi(c)}c=!1}c&&(n=s[0])}}return s=At(),s.memoizedState=s.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lm,lastRenderedState:n},s.queue=c,s=Am.bind(null,ye,c),c.dispatch=s,c=Vl(!1),f=Ql.bind(null,ye,!1,c.queue),c=At(),d={state:n,dispatch:null,action:e,pending:null},c.queue=d,s=sS.bind(null,ye,d,f,s),d.dispatch=s,c.memoizedState=e,[n,s,!1]}function dm(e){var n=rt();return hm(n,Be,e)}function hm(e,n,s){if(n=zl(e,n,lm)[0],e=fo(Gn)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=qs(n)}catch(v){throw v===Ua?no:v}else c=n;n=rt();var d=n.queue,f=d.dispatch;return s!==n.memoizedState&&(ye.flags|=2048,qa(9,{destroy:void 0},rS.bind(null,d,s),null)),[c,f,e]}function rS(e,n){e.action=n}function fm(e){var n=rt(),s=Be;if(s!==null)return hm(n,s,e);rt(),n=n.memoizedState,s=rt();var c=s.queue.dispatch;return s.memoizedState=e,[n,c,!1]}function qa(e,n,s,c){return e={tag:e,create:s,deps:c,inst:n,next:null},n=ye.updateQueue,n===null&&(n=uo(),ye.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=e.next=e:(c=s.next,s.next=e,e.next=c,n.lastEffect=e),e}function mm(){return rt().memoizedState}function mo(e,n,s,c){var d=At();ye.flags|=e,d.memoizedState=qa(1|n,{destroy:void 0},s,c===void 0?null:c)}function po(e,n,s,c){var d=rt();c=c===void 0?null:c;var f=d.memoizedState.inst;Be!==null&&c!==null&&Pl(c,Be.memoizedState.deps)?d.memoizedState=qa(n,f,s,c):(ye.flags|=e,d.memoizedState=qa(1|n,f,s,c))}function pm(e,n){mo(8390656,8,e,n)}function Hl(e,n){po(2048,8,e,n)}function oS(e){ye.flags|=4;var n=ye.updateQueue;if(n===null)n=uo(),ye.updateQueue=n,n.events=[e];else{var s=n.events;s===null?n.events=[e]:s.push(e)}}function gm(e){var n=rt().memoizedState;return oS({ref:n,nextImpl:e}),function(){if((Le&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function vm(e,n){return po(4,2,e,n)}function ym(e,n){return po(4,4,e,n)}function bm(e,n){if(typeof n=="function"){e=e();var s=n(e);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function Sm(e,n,s){s=s!=null?s.concat([e]):null,po(4,4,bm.bind(null,n,e),s)}function Gl(){}function Tm(e,n){var s=rt();n=n===void 0?null:n;var c=s.memoizedState;return n!==null&&Pl(n,c[1])?c[0]:(s.memoizedState=[e,n],e)}function Cm(e,n){var s=rt();n=n===void 0?null:n;var c=s.memoizedState;if(n!==null&&Pl(n,c[1]))return c[0];if(c=e(),ra){ci(!0);try{e()}finally{ci(!1)}}return s.memoizedState=[c,n],c}function Kl(e,n,s){return s===void 0||(Hn&1073741824)!==0&&(De&261930)===0?e.memoizedState=n:(e.memoizedState=s,e=kp(),ye.lanes|=e,Ci|=e,s)}function km(e,n,s,c){return Jt(s,n)?s:ja.current!==null?(e=Kl(e,s,c),Jt(e,n)||(dt=!0),e):(Hn&42)===0||(Hn&1073741824)!==0&&(De&261930)===0?(dt=!0,e.memoizedState=s):(e=kp(),ye.lanes|=e,Ci|=e,n)}function Em(e,n,s,c,d){var f=J.p;J.p=f!==0&&8>f?f:8;var v=L.T,b={};L.T=b,Ql(e,!1,n,s);try{var C=d(),x=L.S;if(x!==null&&x(b,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var j=nS(C,c);Vs(e,n,j,en(e))}else Vs(e,n,c,en(e))}catch(V){Vs(e,n,{then:function(){},status:"rejected",reason:V},en())}finally{J.p=f,v!==null&&b.types!==null&&(v.types=b.types),L.T=v}}function cS(){}function Yl(e,n,s,c){if(e.tag!==5)throw Error(a(476));var d=_m(e).queue;Em(e,d,n,$,s===null?cS:function(){return Rm(e),s(c)})}function _m(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gn,lastRenderedState:$},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gn,lastRenderedState:s},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Rm(e){var n=_m(e);n.next===null&&(n=e.alternate.memoizedState),Vs(e,n.next.queue,{},en())}function Jl(){return Ct(sr)}function Om(){return rt().memoizedState}function Dm(){return rt().memoizedState}function lS(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var s=en();e=gi(s);var c=vi(n,e,s);c!==null&&(zt(c,n,s),Is(c,n,s)),n={cache:kl()},e.payload=n;return}n=n.return}}function uS(e,n,s){var c=en();s={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},go(e)?Mm(n,s):(s=hl(e,n,s,c),s!==null&&(zt(s,e,c),wm(s,n,c)))}function Am(e,n,s){var c=en();Vs(e,n,s,c)}function Vs(e,n,s,c){var d={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(go(e))Mm(n,d);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=n.lastRenderedReducer,f!==null))try{var v=n.lastRenderedState,b=f(v,s);if(d.hasEagerState=!0,d.eagerState=b,Jt(b,v))return Qr(e,n,d,0),He===null&&Jr(),!1}catch{}if(s=hl(e,n,d,c),s!==null)return zt(s,e,c),wm(s,n,c),!0}return!1}function Ql(e,n,s,c){if(c={lane:2,revertLane:Ou(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},go(e)){if(n)throw Error(a(479))}else n=hl(e,s,c,2),n!==null&&zt(n,e,2)}function go(e){var n=e.alternate;return e===ye||n!==null&&n===ye}function Mm(e,n){Ba=co=!0;var s=e.pending;s===null?n.next=n:(n.next=s.next,s.next=n),e.pending=n}function wm(e,n,s){if((s&4194048)!==0){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Lh(e,s)}}var Fs={readContext:Ct,use:ho,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useLayoutEffect:$e,useInsertionEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useSyncExternalStore:$e,useId:$e,useHostTransitionStatus:$e,useFormState:$e,useActionState:$e,useOptimistic:$e,useMemoCache:$e,useCacheRefresh:$e};Fs.useEffectEvent=$e;var xm={readContext:Ct,use:ho,useCallback:function(e,n){return At().memoizedState=[e,n===void 0?null:n],e},useContext:Ct,useEffect:pm,useImperativeHandle:function(e,n,s){s=s!=null?s.concat([e]):null,mo(4194308,4,bm.bind(null,n,e),s)},useLayoutEffect:function(e,n){return mo(4194308,4,e,n)},useInsertionEffect:function(e,n){mo(4,2,e,n)},useMemo:function(e,n){var s=At();n=n===void 0?null:n;var c=e();if(ra){ci(!0);try{e()}finally{ci(!1)}}return s.memoizedState=[c,n],c},useReducer:function(e,n,s){var c=At();if(s!==void 0){var d=s(n);if(ra){ci(!0);try{s(n)}finally{ci(!1)}}}else d=n;return c.memoizedState=c.baseState=d,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:d},c.queue=e,e=e.dispatch=uS.bind(null,ye,e),[c.memoizedState,e]},useRef:function(e){var n=At();return e={current:e},n.memoizedState=e},useState:function(e){e=Vl(e);var n=e.queue,s=Am.bind(null,ye,n);return n.dispatch=s,[e.memoizedState,s]},useDebugValue:Gl,useDeferredValue:function(e,n){var s=At();return Kl(s,e,n)},useTransition:function(){var e=Vl(!1);return e=Em.bind(null,ye,e.queue,!0,!1),At().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,s){var c=ye,d=At();if(Me){if(s===void 0)throw Error(a(407));s=s()}else{if(s=n(),He===null)throw Error(a(349));(De&127)!==0||$f(c,n,s)}d.memoizedState=s;var f={value:s,getSnapshot:n};return d.queue=f,pm(tm.bind(null,c,f,e),[e]),c.flags|=2048,qa(9,{destroy:void 0},em.bind(null,c,f,s,n),null),s},useId:function(){var e=At(),n=He.identifierPrefix;if(Me){var s=On,c=Rn;s=(c&~(1<<32-Yt(c)-1)).toString(32)+s,n="_"+n+"R_"+s,s=lo++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=iS++,n="_"+n+"r_"+s.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:Jl,useFormState:um,useActionState:um,useOptimistic:function(e){var n=At();n.memoizedState=n.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=Ql.bind(null,ye,!0,s),s.dispatch=n,[e,n]},useMemoCache:Bl,useCacheRefresh:function(){return At().memoizedState=lS.bind(null,ye)},useEffectEvent:function(e){var n=At(),s={impl:e};return n.memoizedState=s,function(){if((Le&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}},Xl={readContext:Ct,use:ho,useCallback:Tm,useContext:Ct,useEffect:Hl,useImperativeHandle:Sm,useInsertionEffect:vm,useLayoutEffect:ym,useMemo:Cm,useReducer:fo,useRef:mm,useState:function(){return fo(Gn)},useDebugValue:Gl,useDeferredValue:function(e,n){var s=rt();return km(s,Be.memoizedState,e,n)},useTransition:function(){var e=fo(Gn)[0],n=rt().memoizedState;return[typeof e=="boolean"?e:qs(e),n]},useSyncExternalStore:Wf,useId:Om,useHostTransitionStatus:Jl,useFormState:dm,useActionState:dm,useOptimistic:function(e,n){var s=rt();return am(s,Be,e,n)},useMemoCache:Bl,useCacheRefresh:Dm};Xl.useEffectEvent=gm;var Nm={readContext:Ct,use:ho,useCallback:Tm,useContext:Ct,useEffect:Hl,useImperativeHandle:Sm,useInsertionEffect:vm,useLayoutEffect:ym,useMemo:Cm,useReducer:ql,useRef:mm,useState:function(){return ql(Gn)},useDebugValue:Gl,useDeferredValue:function(e,n){var s=rt();return Be===null?Kl(s,e,n):km(s,Be.memoizedState,e,n)},useTransition:function(){var e=ql(Gn)[0],n=rt().memoizedState;return[typeof e=="boolean"?e:qs(e),n]},useSyncExternalStore:Wf,useId:Om,useHostTransitionStatus:Jl,useFormState:fm,useActionState:fm,useOptimistic:function(e,n){var s=rt();return Be!==null?am(s,Be,e,n):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:Bl,useCacheRefresh:Dm};Nm.useEffectEvent=gm;function Zl(e,n,s,c){n=e.memoizedState,s=s(c,n),s=s==null?n:y({},n,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Wl={enqueueSetState:function(e,n,s){e=e._reactInternals;var c=en(),d=gi(c);d.payload=n,s!=null&&(d.callback=s),n=vi(e,d,c),n!==null&&(zt(n,e,c),Is(n,e,c))},enqueueReplaceState:function(e,n,s){e=e._reactInternals;var c=en(),d=gi(c);d.tag=1,d.payload=n,s!=null&&(d.callback=s),n=vi(e,d,c),n!==null&&(zt(n,e,c),Is(n,e,c))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var s=en(),c=gi(s);c.tag=2,n!=null&&(c.callback=n),n=vi(e,c,s),n!==null&&(zt(n,e,s),Is(n,e,s))}};function Pm(e,n,s,c,d,f,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,f,v):n.prototype&&n.prototype.isPureReactComponent?!As(s,c)||!As(d,f):!0}function Lm(e,n,s,c){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,c),n.state!==e&&Wl.enqueueReplaceState(n,n.state,null)}function oa(e,n){var s=n;if("ref"in n){s={};for(var c in n)c!=="ref"&&(s[c]=n[c])}if(e=e.defaultProps){s===n&&(s=y({},s));for(var d in e)s[d]===void 0&&(s[d]=e[d])}return s}function Um(e){Yr(e)}function Im(e){console.error(e)}function jm(e){Yr(e)}function vo(e,n){try{var s=e.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function Bm(e,n,s){try{var c=e.onCaughtError;c(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function $l(e,n,s){return s=gi(s),s.tag=3,s.payload={element:null},s.callback=function(){vo(e,n)},s}function zm(e){return e=gi(e),e.tag=3,e}function qm(e,n,s,c){var d=s.type.getDerivedStateFromError;if(typeof d=="function"){var f=c.value;e.payload=function(){return d(f)},e.callback=function(){Bm(n,s,c)}}var v=s.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(e.callback=function(){Bm(n,s,c),typeof d!="function"&&(ki===null?ki=new Set([this]):ki.add(this));var b=c.stack;this.componentDidCatch(c.value,{componentStack:b!==null?b:""})})}function dS(e,n,s,c,d){if(s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=s.alternate,n!==null&&Na(n,s,d,!0),s=Xt.current,s!==null){switch(s.tag){case 31:case 13:return un===null?Ao():s.alternate===null&&et===0&&(et=3),s.flags&=-257,s.flags|=65536,s.lanes=d,c===io?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([c]):n.add(c),Eu(e,c,d)),!1;case 22:return s.flags|=65536,c===io?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([c]):s.add(c)),Eu(e,c,d)),!1}throw Error(a(435,s.tag))}return Eu(e,c,d),Ao(),!1}if(Me)return n=Xt.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=d,c!==yl&&(e=Error(a(422),{cause:c}),xs(rn(e,s)))):(c!==yl&&(n=Error(a(423),{cause:c}),xs(rn(n,s))),e=e.current.alternate,e.flags|=65536,d&=-d,e.lanes|=d,c=rn(c,s),d=$l(e.stateNode,c,d),Al(e,d),et!==4&&(et=2)),!1;var f=Error(a(520),{cause:c});if(f=rn(f,s),Zs===null?Zs=[f]:Zs.push(f),et!==4&&(et=2),n===null)return!0;c=rn(c,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,e=d&-d,s.lanes|=e,e=$l(s.stateNode,c,e),Al(s,e),!1;case 1:if(n=s.type,f=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(ki===null||!ki.has(f))))return s.flags|=65536,d&=-d,s.lanes|=d,d=zm(d),qm(d,e,s,c),Al(s,d),!1}s=s.return}while(s!==null);return!1}var eu=Error(a(461)),dt=!1;function kt(e,n,s,c){n.child=e===null?Gf(n,null,s,c):sa(n,e.child,s,c)}function Vm(e,n,s,c,d){s=s.render;var f=n.ref;if("ref"in c){var v={};for(var b in c)b!=="ref"&&(v[b]=c[b])}else v=c;return ta(n),c=Ll(e,n,s,v,f,d),b=Ul(),e!==null&&!dt?(Il(e,n,d),Kn(e,n,d)):(Me&&b&&gl(n),n.flags|=1,kt(e,n,c,d),n.child)}function Fm(e,n,s,c,d){if(e===null){var f=s.type;return typeof f=="function"&&!fl(f)&&f.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=f,Hm(e,n,f,c,d)):(e=Zr(s.type,null,c,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(f=e.child,!cu(e,d)){var v=f.memoizedProps;if(s=s.compare,s=s!==null?s:As,s(v,c)&&e.ref===n.ref)return Kn(e,n,d)}return n.flags|=1,e=zn(f,c),e.ref=n.ref,e.return=n,n.child=e}function Hm(e,n,s,c,d){if(e!==null){var f=e.memoizedProps;if(As(f,c)&&e.ref===n.ref)if(dt=!1,n.pendingProps=c=f,cu(e,d))(e.flags&131072)!==0&&(dt=!0);else return n.lanes=e.lanes,Kn(e,n,d)}return tu(e,n,s,c,d)}function Gm(e,n,s,c){var d=c.children,f=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(f=f!==null?f.baseLanes|s:s,e!==null){for(c=n.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;c=d&~f}else c=0,n.child=null;return Km(e,n,f,s,c)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&to(n,f!==null?f.cachePool:null),f!==null?Jf(n,f):wl(),Qf(n);else return c=n.lanes=536870912,Km(e,n,f!==null?f.baseLanes|s:s,s,c)}else f!==null?(to(n,f.cachePool),Jf(n,f),bi(),n.memoizedState=null):(e!==null&&to(n,null),wl(),bi());return kt(e,n,d,s),n.child}function Hs(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Km(e,n,s,c,d){var f=_l();return f=f===null?null:{parent:lt._currentValue,pool:f},n.memoizedState={baseLanes:s,cachePool:f},e!==null&&to(n,null),wl(),Qf(n),e!==null&&Na(e,n,c,!0),n.childLanes=d,null}function yo(e,n){return n=So({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function Ym(e,n,s){return sa(n,e.child,null,s),e=yo(n,n.pendingProps),e.flags|=2,Zt(n),n.memoizedState=null,e}function hS(e,n,s){var c=n.pendingProps,d=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Me){if(c.mode==="hidden")return e=yo(n,c),n.lanes=536870912,Hs(null,e);if(Nl(n),(e=Ye)?(e=sg(e,ln),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:di!==null?{id:Rn,overflow:On}:null,retryLane:536870912,hydrationErrors:null},s=Mf(e),s.return=n,n.child=s,Tt=n,Ye=null)):e=null,e===null)throw fi(n);return n.lanes=536870912,null}return yo(n,c)}var f=e.memoizedState;if(f!==null){var v=f.dehydrated;if(Nl(n),d)if(n.flags&256)n.flags&=-257,n=Ym(e,n,s);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(a(558));else if(dt||Na(e,n,s,!1),d=(s&e.childLanes)!==0,dt||d){if(c=He,c!==null&&(v=Uh(c,s),v!==0&&v!==f.retryLane))throw f.retryLane=v,Zi(e,v),zt(c,e,v),eu;Ao(),n=Ym(e,n,s)}else e=f.treeContext,Ye=dn(v.nextSibling),Tt=n,Me=!0,hi=null,ln=!1,e!==null&&Nf(n,e),n=yo(n,c),n.flags|=4096;return n}return e=zn(e.child,{mode:c.mode,children:c.children}),e.ref=n.ref,n.child=e,e.return=n,e}function bo(e,n){var s=n.ref;if(s===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(a(284));(e===null||e.ref!==s)&&(n.flags|=4194816)}}function tu(e,n,s,c,d){return ta(n),s=Ll(e,n,s,c,void 0,d),c=Ul(),e!==null&&!dt?(Il(e,n,d),Kn(e,n,d)):(Me&&c&&gl(n),n.flags|=1,kt(e,n,s,d),n.child)}function Jm(e,n,s,c,d,f){return ta(n),n.updateQueue=null,s=Zf(n,c,s,d),Xf(e),c=Ul(),e!==null&&!dt?(Il(e,n,f),Kn(e,n,f)):(Me&&c&&gl(n),n.flags|=1,kt(e,n,s,f),n.child)}function Qm(e,n,s,c,d){if(ta(n),n.stateNode===null){var f=Aa,v=s.contextType;typeof v=="object"&&v!==null&&(f=Ct(v)),f=new s(c,f),n.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=Wl,n.stateNode=f,f._reactInternals=n,f=n.stateNode,f.props=c,f.state=n.memoizedState,f.refs={},Ol(n),v=s.contextType,f.context=typeof v=="object"&&v!==null?Ct(v):Aa,f.state=n.memoizedState,v=s.getDerivedStateFromProps,typeof v=="function"&&(Zl(n,s,v,c),f.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(v=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),v!==f.state&&Wl.enqueueReplaceState(f,f.state,null),Bs(n,c,f,d),js(),f.state=n.memoizedState),typeof f.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(e===null){f=n.stateNode;var b=n.memoizedProps,C=oa(s,b);f.props=C;var x=f.context,j=s.contextType;v=Aa,typeof j=="object"&&j!==null&&(v=Ct(j));var V=s.getDerivedStateFromProps;j=typeof V=="function"||typeof f.getSnapshotBeforeUpdate=="function",b=n.pendingProps!==b,j||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(b||x!==v)&&Lm(n,f,c,v),pi=!1;var P=n.memoizedState;f.state=P,Bs(n,c,f,d),js(),x=n.memoizedState,b||P!==x||pi?(typeof V=="function"&&(Zl(n,s,V,c),x=n.memoizedState),(C=pi||Pm(n,s,C,c,P,x,v))?(j||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(n.flags|=4194308)):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=x),f.props=c,f.state=x,f.context=v,c=C):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{f=n.stateNode,Dl(e,n),v=n.memoizedProps,j=oa(s,v),f.props=j,V=n.pendingProps,P=f.context,x=s.contextType,C=Aa,typeof x=="object"&&x!==null&&(C=Ct(x)),b=s.getDerivedStateFromProps,(x=typeof b=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(v!==V||P!==C)&&Lm(n,f,c,C),pi=!1,P=n.memoizedState,f.state=P,Bs(n,c,f,d),js();var U=n.memoizedState;v!==V||P!==U||pi||e!==null&&e.dependencies!==null&&$r(e.dependencies)?(typeof b=="function"&&(Zl(n,s,b,c),U=n.memoizedState),(j=pi||Pm(n,s,j,c,P,U,C)||e!==null&&e.dependencies!==null&&$r(e.dependencies))?(x||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(c,U,C),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(c,U,C)),typeof f.componentDidUpdate=="function"&&(n.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof f.componentDidUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=U),f.props=c,f.state=U,f.context=C,c=j):(typeof f.componentDidUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),c=!1)}return f=c,bo(e,n),c=(n.flags&128)!==0,f||c?(f=n.stateNode,s=c&&typeof s.getDerivedStateFromError!="function"?null:f.render(),n.flags|=1,e!==null&&c?(n.child=sa(n,e.child,null,d),n.child=sa(n,null,s,d)):kt(e,n,s,d),n.memoizedState=f.state,e=n.child):e=Kn(e,n,d),e}function Xm(e,n,s,c){return $i(),n.flags|=256,kt(e,n,s,c),n.child}var nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function iu(e){return{baseLanes:e,cachePool:Bf()}}function au(e,n,s){return e=e!==null?e.childLanes&~s:0,n&&(e|=$t),e}function Zm(e,n,s){var c=n.pendingProps,d=!1,f=(n.flags&128)!==0,v;if((v=f)||(v=e!==null&&e.memoizedState===null?!1:(st.current&2)!==0),v&&(d=!0,n.flags&=-129),v=(n.flags&32)!==0,n.flags&=-33,e===null){if(Me){if(d?yi(n):bi(),(e=Ye)?(e=sg(e,ln),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:di!==null?{id:Rn,overflow:On}:null,retryLane:536870912,hydrationErrors:null},s=Mf(e),s.return=n,n.child=s,Tt=n,Ye=null)):e=null,e===null)throw fi(n);return zu(e)?n.lanes=32:n.lanes=536870912,null}var b=c.children;return c=c.fallback,d?(bi(),d=n.mode,b=So({mode:"hidden",children:b},d),c=Wi(c,d,s,null),b.return=n,c.return=n,b.sibling=c,n.child=b,c=n.child,c.memoizedState=iu(s),c.childLanes=au(e,v,s),n.memoizedState=nu,Hs(null,c)):(yi(n),su(n,b))}var C=e.memoizedState;if(C!==null&&(b=C.dehydrated,b!==null)){if(f)n.flags&256?(yi(n),n.flags&=-257,n=ru(e,n,s)):n.memoizedState!==null?(bi(),n.child=e.child,n.flags|=128,n=null):(bi(),b=c.fallback,d=n.mode,c=So({mode:"visible",children:c.children},d),b=Wi(b,d,s,null),b.flags|=2,c.return=n,b.return=n,c.sibling=b,n.child=c,sa(n,e.child,null,s),c=n.child,c.memoizedState=iu(s),c.childLanes=au(e,v,s),n.memoizedState=nu,n=Hs(null,c));else if(yi(n),zu(b)){if(v=b.nextSibling&&b.nextSibling.dataset,v)var x=v.dgst;v=x,c=Error(a(419)),c.stack="",c.digest=v,xs({value:c,source:null,stack:null}),n=ru(e,n,s)}else if(dt||Na(e,n,s,!1),v=(s&e.childLanes)!==0,dt||v){if(v=He,v!==null&&(c=Uh(v,s),c!==0&&c!==C.retryLane))throw C.retryLane=c,Zi(e,c),zt(v,e,c),eu;Bu(b)||Ao(),n=ru(e,n,s)}else Bu(b)?(n.flags|=192,n.child=e.child,n=null):(e=C.treeContext,Ye=dn(b.nextSibling),Tt=n,Me=!0,hi=null,ln=!1,e!==null&&Nf(n,e),n=su(n,c.children),n.flags|=4096);return n}return d?(bi(),b=c.fallback,d=n.mode,C=e.child,x=C.sibling,c=zn(C,{mode:"hidden",children:c.children}),c.subtreeFlags=C.subtreeFlags&65011712,x!==null?b=zn(x,b):(b=Wi(b,d,s,null),b.flags|=2),b.return=n,c.return=n,c.sibling=b,n.child=c,Hs(null,c),c=n.child,b=e.child.memoizedState,b===null?b=iu(s):(d=b.cachePool,d!==null?(C=lt._currentValue,d=d.parent!==C?{parent:C,pool:C}:d):d=Bf(),b={baseLanes:b.baseLanes|s,cachePool:d}),c.memoizedState=b,c.childLanes=au(e,v,s),n.memoizedState=nu,Hs(e.child,c)):(yi(n),s=e.child,e=s.sibling,s=zn(s,{mode:"visible",children:c.children}),s.return=n,s.sibling=null,e!==null&&(v=n.deletions,v===null?(n.deletions=[e],n.flags|=16):v.push(e)),n.child=s,n.memoizedState=null,s)}function su(e,n){return n=So({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function So(e,n){return e=Qt(22,e,null,n),e.lanes=0,e}function ru(e,n,s){return sa(n,e.child,null,s),e=su(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function Wm(e,n,s){e.lanes|=n;var c=e.alternate;c!==null&&(c.lanes|=n),Tl(e.return,n,s)}function ou(e,n,s,c,d,f){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:d,treeForkCount:f}:(v.isBackwards=n,v.rendering=null,v.renderingStartTime=0,v.last=c,v.tail=s,v.tailMode=d,v.treeForkCount=f)}function $m(e,n,s){var c=n.pendingProps,d=c.revealOrder,f=c.tail;c=c.children;var v=st.current,b=(v&2)!==0;if(b?(v=v&1|2,n.flags|=128):v&=1,te(st,v),kt(e,n,c,s),c=Me?ws:0,!b&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Wm(e,s,n);else if(e.tag===19)Wm(e,s,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(d){case"forwards":for(s=n.child,d=null;s!==null;)e=s.alternate,e!==null&&oo(e)===null&&(d=s),s=s.sibling;s=d,s===null?(d=n.child,n.child=null):(d=s.sibling,s.sibling=null),ou(n,!1,d,s,f,c);break;case"backwards":case"unstable_legacy-backwards":for(s=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&oo(e)===null){n.child=d;break}e=d.sibling,d.sibling=s,s=d,d=e}ou(n,!0,s,null,f,c);break;case"together":ou(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Kn(e,n,s){if(e!==null&&(n.dependencies=e.dependencies),Ci|=n.lanes,(s&n.childLanes)===0)if(e!==null){if(Na(e,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(a(153));if(n.child!==null){for(e=n.child,s=zn(e,e.pendingProps),n.child=s,s.return=n;e.sibling!==null;)e=e.sibling,s=s.sibling=zn(e,e.pendingProps),s.return=n;s.sibling=null}return n.child}function cu(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&$r(e)))}function fS(e,n,s){switch(n.tag){case 3:Dt(n,n.stateNode.containerInfo),mi(n,lt,e.memoizedState.cache),$i();break;case 27:case 5:gs(n);break;case 4:Dt(n,n.stateNode.containerInfo);break;case 10:mi(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Nl(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(yi(n),n.flags|=128,null):(s&n.child.childLanes)!==0?Zm(e,n,s):(yi(n),e=Kn(e,n,s),e!==null?e.sibling:null);yi(n);break;case 19:var d=(e.flags&128)!==0;if(c=(s&n.childLanes)!==0,c||(Na(e,n,s,!1),c=(s&n.childLanes)!==0),d){if(c)return $m(e,n,s);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),te(st,st.current),c)break;return null;case 22:return n.lanes=0,Gm(e,n,s,n.pendingProps);case 24:mi(n,lt,e.memoizedState.cache)}return Kn(e,n,s)}function ep(e,n,s){if(e!==null)if(e.memoizedProps!==n.pendingProps)dt=!0;else{if(!cu(e,s)&&(n.flags&128)===0)return dt=!1,fS(e,n,s);dt=(e.flags&131072)!==0}else dt=!1,Me&&(n.flags&1048576)!==0&&xf(n,ws,n.index);switch(n.lanes=0,n.tag){case 16:e:{var c=n.pendingProps;if(e=ia(n.elementType),n.type=e,typeof e=="function")fl(e)?(c=oa(e,c),n.tag=1,n=Qm(null,n,e,c,s)):(n.tag=0,n=tu(null,n,e,c,s));else{if(e!=null){var d=e.$$typeof;if(d===M){n.tag=11,n=Vm(null,n,e,c,s);break e}else if(d===K){n.tag=14,n=Fm(null,n,e,c,s);break e}}throw n=Fe(e)||e,Error(a(306,n,""))}}return n;case 0:return tu(e,n,n.type,n.pendingProps,s);case 1:return c=n.type,d=oa(c,n.pendingProps),Qm(e,n,c,d,s);case 3:e:{if(Dt(n,n.stateNode.containerInfo),e===null)throw Error(a(387));c=n.pendingProps;var f=n.memoizedState;d=f.element,Dl(e,n),Bs(n,c,null,s);var v=n.memoizedState;if(c=v.cache,mi(n,lt,c),c!==f.cache&&Cl(n,[lt],s,!0),js(),c=v.element,f.isDehydrated)if(f={element:c,isDehydrated:!1,cache:v.cache},n.updateQueue.baseState=f,n.memoizedState=f,n.flags&256){n=Xm(e,n,c,s);break e}else if(c!==d){d=rn(Error(a(424)),n),xs(d),n=Xm(e,n,c,s);break e}else for(e=n.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,Ye=dn(e.firstChild),Tt=n,Me=!0,hi=null,ln=!0,s=Gf(n,null,c,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if($i(),c===d){n=Kn(e,n,s);break e}kt(e,n,c,s)}n=n.child}return n;case 26:return bo(e,n),e===null?(s=dg(n.type,null,n.pendingProps,null))?n.memoizedState=s:Me||(s=n.type,e=n.pendingProps,c=Uo(be.current).createElement(s),c[St]=n,c[Pt]=e,Et(c,s,e),gt(c),n.stateNode=c):n.memoizedState=dg(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return gs(n),e===null&&Me&&(c=n.stateNode=cg(n.type,n.pendingProps,be.current),Tt=n,ln=!0,d=Ye,Oi(n.type)?(qu=d,Ye=dn(c.firstChild)):Ye=d),kt(e,n,n.pendingProps.children,s),bo(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Me&&((d=c=Ye)&&(c=FS(c,n.type,n.pendingProps,ln),c!==null?(n.stateNode=c,Tt=n,Ye=dn(c.firstChild),ln=!1,d=!0):d=!1),d||fi(n)),gs(n),d=n.type,f=n.pendingProps,v=e!==null?e.memoizedProps:null,c=f.children,Uu(d,f)?c=null:v!==null&&Uu(d,v)&&(n.flags|=32),n.memoizedState!==null&&(d=Ll(e,n,aS,null,null,s),sr._currentValue=d),bo(e,n),kt(e,n,c,s),n.child;case 6:return e===null&&Me&&((e=s=Ye)&&(s=HS(s,n.pendingProps,ln),s!==null?(n.stateNode=s,Tt=n,Ye=null,e=!0):e=!1),e||fi(n)),null;case 13:return Zm(e,n,s);case 4:return Dt(n,n.stateNode.containerInfo),c=n.pendingProps,e===null?n.child=sa(n,null,c,s):kt(e,n,c,s),n.child;case 11:return Vm(e,n,n.type,n.pendingProps,s);case 7:return kt(e,n,n.pendingProps,s),n.child;case 8:return kt(e,n,n.pendingProps.children,s),n.child;case 12:return kt(e,n,n.pendingProps.children,s),n.child;case 10:return c=n.pendingProps,mi(n,n.type,c.value),kt(e,n,c.children,s),n.child;case 9:return d=n.type._context,c=n.pendingProps.children,ta(n),d=Ct(d),c=c(d),n.flags|=1,kt(e,n,c,s),n.child;case 14:return Fm(e,n,n.type,n.pendingProps,s);case 15:return Hm(e,n,n.type,n.pendingProps,s);case 19:return $m(e,n,s);case 31:return hS(e,n,s);case 22:return Gm(e,n,s,n.pendingProps);case 24:return ta(n),c=Ct(lt),e===null?(d=_l(),d===null&&(d=He,f=kl(),d.pooledCache=f,f.refCount++,f!==null&&(d.pooledCacheLanes|=s),d=f),n.memoizedState={parent:c,cache:d},Ol(n),mi(n,lt,d)):((e.lanes&s)!==0&&(Dl(e,n),Bs(n,null,null,s),js()),d=e.memoizedState,f=n.memoizedState,d.parent!==c?(d={parent:c,cache:c},n.memoizedState=d,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=d),mi(n,lt,c)):(c=f.cache,mi(n,lt,c),c!==d.cache&&Cl(n,[lt],s,!0))),kt(e,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function Yn(e){e.flags|=4}function lu(e,n,s,c,d){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(d&335544128)===d)if(e.stateNode.complete)e.flags|=8192;else if(Op())e.flags|=8192;else throw aa=io,Rl}else e.flags&=-16777217}function tp(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!gg(n))if(Op())e.flags|=8192;else throw aa=io,Rl}function To(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Nh():536870912,e.lanes|=n,Ga|=n)}function Gs(e,n){if(!Me)switch(e.tailMode){case"hidden":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Je(e){var n=e.alternate!==null&&e.alternate.child===e.child,s=0,c=0;if(n)for(var d=e.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=c,e.childLanes=s,n}function mS(e,n,s){var c=n.pendingProps;switch(vl(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Je(n),null;case 1:return Je(n),null;case 3:return s=n.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),Fn(lt),at(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(xa(n)?Yn(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,bl())),Je(n),null;case 26:var d=n.type,f=n.memoizedState;return e===null?(Yn(n),f!==null?(Je(n),tp(n,f)):(Je(n),lu(n,d,null,c,s))):f?f!==e.memoizedState?(Yn(n),Je(n),tp(n,f)):(Je(n),n.flags&=-16777217):(e=e.memoizedProps,e!==c&&Yn(n),Je(n),lu(n,d,e,c,s)),null;case 27:if(wr(n),s=be.current,d=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Yn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Je(n),null}e=ce.current,xa(n)?Pf(n):(e=cg(d,c,s),n.stateNode=e,Yn(n))}return Je(n),null;case 5:if(wr(n),d=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Yn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Je(n),null}if(f=ce.current,xa(n))Pf(n);else{var v=Uo(be.current);switch(f){case 1:f=v.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:f=v.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":f=v.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":f=v.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":f=v.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof c.is=="string"?v.createElement("select",{is:c.is}):v.createElement("select"),c.multiple?f.multiple=!0:c.size&&(f.size=c.size);break;default:f=typeof c.is=="string"?v.createElement(d,{is:c.is}):v.createElement(d)}}f[St]=n,f[Pt]=c;e:for(v=n.child;v!==null;){if(v.tag===5||v.tag===6)f.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===n)break e;for(;v.sibling===null;){if(v.return===null||v.return===n)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}n.stateNode=f;e:switch(Et(f,d,c),d){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Yn(n)}}return Je(n),lu(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,s),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==c&&Yn(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(a(166));if(e=be.current,xa(n)){if(e=n.stateNode,s=n.memoizedProps,c=null,d=Tt,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}e[St]=n,e=!!(e.nodeValue===s||c!==null&&c.suppressHydrationWarning===!0||Zp(e.nodeValue,s)),e||fi(n,!0)}else e=Uo(e).createTextNode(c),e[St]=n,n.stateNode=e}return Je(n),null;case 31:if(s=n.memoizedState,e===null||e.memoizedState!==null){if(c=xa(n),s!==null){if(e===null){if(!c)throw Error(a(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[St]=n}else $i(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Je(n),e=!1}else s=bl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=s),e=!0;if(!e)return n.flags&256?(Zt(n),n):(Zt(n),null);if((n.flags&128)!==0)throw Error(a(558))}return Je(n),null;case 13:if(c=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(d=xa(n),c!==null&&c.dehydrated!==null){if(e===null){if(!d)throw Error(a(318));if(d=n.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));d[St]=n}else $i(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Je(n),d=!1}else d=bl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=d),d=!0;if(!d)return n.flags&256?(Zt(n),n):(Zt(n),null)}return Zt(n),(n.flags&128)!==0?(n.lanes=s,n):(s=c!==null,e=e!==null&&e.memoizedState!==null,s&&(c=n.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool),f=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(f=c.memoizedState.cachePool.pool),f!==d&&(c.flags|=2048)),s!==e&&s&&(n.child.flags|=8192),To(n,n.updateQueue),Je(n),null);case 4:return at(),e===null&&wu(n.stateNode.containerInfo),Je(n),null;case 10:return Fn(n.type),Je(n),null;case 19:if(q(st),c=n.memoizedState,c===null)return Je(n),null;if(d=(n.flags&128)!==0,f=c.rendering,f===null)if(d)Gs(c,!1);else{if(et!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(f=oo(e),f!==null){for(n.flags|=128,Gs(c,!1),e=f.updateQueue,n.updateQueue=e,To(n,e),n.subtreeFlags=0,e=s,s=n.child;s!==null;)Af(s,e),s=s.sibling;return te(st,st.current&1|2),Me&&qn(n,c.treeForkCount),n.child}e=e.sibling}c.tail!==null&&Gt()>Ro&&(n.flags|=128,d=!0,Gs(c,!1),n.lanes=4194304)}else{if(!d)if(e=oo(f),e!==null){if(n.flags|=128,d=!0,e=e.updateQueue,n.updateQueue=e,To(n,e),Gs(c,!0),c.tail===null&&c.tailMode==="hidden"&&!f.alternate&&!Me)return Je(n),null}else 2*Gt()-c.renderingStartTime>Ro&&s!==536870912&&(n.flags|=128,d=!0,Gs(c,!1),n.lanes=4194304);c.isBackwards?(f.sibling=n.child,n.child=f):(e=c.last,e!==null?e.sibling=f:n.child=f,c.last=f)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Gt(),e.sibling=null,s=st.current,te(st,d?s&1|2:s&1),Me&&qn(n,c.treeForkCount),e):(Je(n),null);case 22:case 23:return Zt(n),xl(),c=n.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(s&536870912)!==0&&(n.flags&128)===0&&(Je(n),n.subtreeFlags&6&&(n.flags|=8192)):Je(n),s=n.updateQueue,s!==null&&To(n,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==s&&(n.flags|=2048),e!==null&&q(na),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),Fn(lt),Je(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function pS(e,n){switch(vl(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Fn(lt),at(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return wr(n),null;case 31:if(n.memoizedState!==null){if(Zt(n),n.alternate===null)throw Error(a(340));$i()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(Zt(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(a(340));$i()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return q(st),null;case 4:return at(),null;case 10:return Fn(n.type),null;case 22:case 23:return Zt(n),xl(),e!==null&&q(na),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Fn(lt),null;case 25:return null;default:return null}}function np(e,n){switch(vl(n),n.tag){case 3:Fn(lt),at();break;case 26:case 27:case 5:wr(n);break;case 4:at();break;case 31:n.memoizedState!==null&&Zt(n);break;case 13:Zt(n);break;case 19:q(st);break;case 10:Fn(n.type);break;case 22:case 23:Zt(n),xl(),e!==null&&q(na);break;case 24:Fn(lt)}}function Ks(e,n){try{var s=n.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var d=c.next;s=d;do{if((s.tag&e)===e){c=void 0;var f=s.create,v=s.inst;c=f(),v.destroy=c}s=s.next}while(s!==d)}}catch(b){je(n,n.return,b)}}function Si(e,n,s){try{var c=n.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var f=d.next;c=f;do{if((c.tag&e)===e){var v=c.inst,b=v.destroy;if(b!==void 0){v.destroy=void 0,d=n;var C=s,x=b;try{x()}catch(j){je(d,C,j)}}}c=c.next}while(c!==f)}}catch(j){je(n,n.return,j)}}function ip(e){var n=e.updateQueue;if(n!==null){var s=e.stateNode;try{Yf(n,s)}catch(c){je(e,e.return,c)}}}function ap(e,n,s){s.props=oa(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(c){je(e,n,c)}}function Ys(e,n){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof s=="function"?e.refCleanup=s(c):s.current=c}}catch(d){je(e,n,d)}}function Dn(e,n){var s=e.ref,c=e.refCleanup;if(s!==null)if(typeof c=="function")try{c()}catch(d){je(e,n,d)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(d){je(e,n,d)}else s.current=null}function sp(e){var n=e.type,s=e.memoizedProps,c=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&c.focus();break e;case"img":s.src?c.src=s.src:s.srcSet&&(c.srcset=s.srcSet)}}catch(d){je(e,e.return,d)}}function uu(e,n,s){try{var c=e.stateNode;IS(c,e.type,s,n),c[Pt]=n}catch(d){je(e,e.return,d)}}function rp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Oi(e.type)||e.tag===4}function du(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||rp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Oi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function hu(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(e),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=jn));else if(c!==4&&(c===27&&Oi(e.type)&&(s=e.stateNode,n=null),e=e.child,e!==null))for(hu(e,n,s),e=e.sibling;e!==null;)hu(e,n,s),e=e.sibling}function Co(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?s.insertBefore(e,n):s.appendChild(e);else if(c!==4&&(c===27&&Oi(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(Co(e,n,s),e=e.sibling;e!==null;)Co(e,n,s),e=e.sibling}function op(e){var n=e.stateNode,s=e.memoizedProps;try{for(var c=e.type,d=n.attributes;d.length;)n.removeAttributeNode(d[0]);Et(n,c,s),n[St]=e,n[Pt]=s}catch(f){je(e,e.return,f)}}var Jn=!1,ht=!1,fu=!1,cp=typeof WeakSet=="function"?WeakSet:Set,vt=null;function gS(e,n){if(e=e.containerInfo,Pu=Fo,e=Sf(e),rl(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var d=c.anchorOffset,f=c.focusNode;c=c.focusOffset;try{s.nodeType,f.nodeType}catch{s=null;break e}var v=0,b=-1,C=-1,x=0,j=0,V=e,P=null;t:for(;;){for(var U;V!==s||d!==0&&V.nodeType!==3||(b=v+d),V!==f||c!==0&&V.nodeType!==3||(C=v+c),V.nodeType===3&&(v+=V.nodeValue.length),(U=V.firstChild)!==null;)P=V,V=U;for(;;){if(V===e)break t;if(P===s&&++x===d&&(b=v),P===f&&++j===c&&(C=v),(U=V.nextSibling)!==null)break;V=P,P=V.parentNode}V=U}s=b===-1||C===-1?null:{start:b,end:C}}else s=null}s=s||{start:0,end:0}}else s=null;for(Lu={focusedElem:e,selectionRange:s},Fo=!1,vt=n;vt!==null;)if(n=vt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,vt=e;else for(;vt!==null;){switch(n=vt,f=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(s=0;s<e.length;s++)d=e[s],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&f!==null){e=void 0,s=n,d=f.memoizedProps,f=f.memoizedState,c=s.stateNode;try{var oe=oa(s.type,d);e=c.getSnapshotBeforeUpdate(oe,f),c.__reactInternalSnapshotBeforeUpdate=e}catch(de){je(s,s.return,de)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,s=e.nodeType,s===9)ju(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ju(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=n.sibling,e!==null){e.return=n.return,vt=e;break}vt=n.return}}function lp(e,n,s){var c=s.flags;switch(s.tag){case 0:case 11:case 15:Xn(e,s),c&4&&Ks(5,s);break;case 1:if(Xn(e,s),c&4)if(e=s.stateNode,n===null)try{e.componentDidMount()}catch(v){je(s,s.return,v)}else{var d=oa(s.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(d,n,e.__reactInternalSnapshotBeforeUpdate)}catch(v){je(s,s.return,v)}}c&64&&ip(s),c&512&&Ys(s,s.return);break;case 3:if(Xn(e,s),c&64&&(e=s.updateQueue,e!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{Yf(e,n)}catch(v){je(s,s.return,v)}}break;case 27:n===null&&c&4&&op(s);case 26:case 5:Xn(e,s),n===null&&c&4&&sp(s),c&512&&Ys(s,s.return);break;case 12:Xn(e,s);break;case 31:Xn(e,s),c&4&&hp(e,s);break;case 13:Xn(e,s),c&4&&fp(e,s),c&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=_S.bind(null,s),GS(e,s))));break;case 22:if(c=s.memoizedState!==null||Jn,!c){n=n!==null&&n.memoizedState!==null||ht,d=Jn;var f=ht;Jn=c,(ht=n)&&!f?Zn(e,s,(s.subtreeFlags&8772)!==0):Xn(e,s),Jn=d,ht=f}break;case 30:break;default:Xn(e,s)}}function up(e){var n=e.alternate;n!==null&&(e.alternate=null,up(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&Fc(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Xe=null,Ut=!1;function Qn(e,n,s){for(s=s.child;s!==null;)dp(e,n,s),s=s.sibling}function dp(e,n,s){if(Kt&&typeof Kt.onCommitFiberUnmount=="function")try{Kt.onCommitFiberUnmount(vs,s)}catch{}switch(s.tag){case 26:ht||Dn(s,n),Qn(e,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:ht||Dn(s,n);var c=Xe,d=Ut;Oi(s.type)&&(Xe=s.stateNode,Ut=!1),Qn(e,n,s),nr(s.stateNode),Xe=c,Ut=d;break;case 5:ht||Dn(s,n);case 6:if(c=Xe,d=Ut,Xe=null,Qn(e,n,s),Xe=c,Ut=d,Xe!==null)if(Ut)try{(Xe.nodeType===9?Xe.body:Xe.nodeName==="HTML"?Xe.ownerDocument.body:Xe).removeChild(s.stateNode)}catch(f){je(s,n,f)}else try{Xe.removeChild(s.stateNode)}catch(f){je(s,n,f)}break;case 18:Xe!==null&&(Ut?(e=Xe,ig(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),$a(e)):ig(Xe,s.stateNode));break;case 4:c=Xe,d=Ut,Xe=s.stateNode.containerInfo,Ut=!0,Qn(e,n,s),Xe=c,Ut=d;break;case 0:case 11:case 14:case 15:Si(2,s,n),ht||Si(4,s,n),Qn(e,n,s);break;case 1:ht||(Dn(s,n),c=s.stateNode,typeof c.componentWillUnmount=="function"&&ap(s,n,c)),Qn(e,n,s);break;case 21:Qn(e,n,s);break;case 22:ht=(c=ht)||s.memoizedState!==null,Qn(e,n,s),ht=c;break;default:Qn(e,n,s)}}function hp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{$a(e)}catch(s){je(n,n.return,s)}}}function fp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{$a(e)}catch(s){je(n,n.return,s)}}function vS(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new cp),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new cp),n;default:throw Error(a(435,e.tag))}}function ko(e,n){var s=vS(e);n.forEach(function(c){if(!s.has(c)){s.add(c);var d=RS.bind(null,e,c);c.then(d,d)}})}function It(e,n){var s=n.deletions;if(s!==null)for(var c=0;c<s.length;c++){var d=s[c],f=e,v=n,b=v;e:for(;b!==null;){switch(b.tag){case 27:if(Oi(b.type)){Xe=b.stateNode,Ut=!1;break e}break;case 5:Xe=b.stateNode,Ut=!1;break e;case 3:case 4:Xe=b.stateNode.containerInfo,Ut=!0;break e}b=b.return}if(Xe===null)throw Error(a(160));dp(f,v,d),Xe=null,Ut=!1,f=d.alternate,f!==null&&(f.return=null),d.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)mp(n,e),n=n.sibling}var vn=null;function mp(e,n){var s=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:It(n,e),jt(e),c&4&&(Si(3,e,e.return),Ks(3,e),Si(5,e,e.return));break;case 1:It(n,e),jt(e),c&512&&(ht||s===null||Dn(s,s.return)),c&64&&Jn&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?c:s.concat(c))));break;case 26:var d=vn;if(It(n,e),jt(e),c&512&&(ht||s===null||Dn(s,s.return)),c&4){var f=s!==null?s.memoizedState:null;if(c=e.memoizedState,s===null)if(c===null)if(e.stateNode===null){e:{c=e.type,s=e.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":f=d.getElementsByTagName("title")[0],(!f||f[Ss]||f[St]||f.namespaceURI==="http://www.w3.org/2000/svg"||f.hasAttribute("itemprop"))&&(f=d.createElement(c),d.head.insertBefore(f,d.querySelector("head > title"))),Et(f,c,s),f[St]=e,gt(f),c=f;break e;case"link":var v=mg("link","href",d).get(c+(s.href||""));if(v){for(var b=0;b<v.length;b++)if(f=v[b],f.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&f.getAttribute("rel")===(s.rel==null?null:s.rel)&&f.getAttribute("title")===(s.title==null?null:s.title)&&f.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){v.splice(b,1);break t}}f=d.createElement(c),Et(f,c,s),d.head.appendChild(f);break;case"meta":if(v=mg("meta","content",d).get(c+(s.content||""))){for(b=0;b<v.length;b++)if(f=v[b],f.getAttribute("content")===(s.content==null?null:""+s.content)&&f.getAttribute("name")===(s.name==null?null:s.name)&&f.getAttribute("property")===(s.property==null?null:s.property)&&f.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&f.getAttribute("charset")===(s.charSet==null?null:s.charSet)){v.splice(b,1);break t}}f=d.createElement(c),Et(f,c,s),d.head.appendChild(f);break;default:throw Error(a(468,c))}f[St]=e,gt(f),c=f}e.stateNode=c}else pg(d,e.type,e.stateNode);else e.stateNode=fg(d,c,e.memoizedProps);else f!==c?(f===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):f.count--,c===null?pg(d,e.type,e.stateNode):fg(d,c,e.memoizedProps)):c===null&&e.stateNode!==null&&uu(e,e.memoizedProps,s.memoizedProps)}break;case 27:It(n,e),jt(e),c&512&&(ht||s===null||Dn(s,s.return)),s!==null&&c&4&&uu(e,e.memoizedProps,s.memoizedProps);break;case 5:if(It(n,e),jt(e),c&512&&(ht||s===null||Dn(s,s.return)),e.flags&32){d=e.stateNode;try{Ca(d,"")}catch(oe){je(e,e.return,oe)}}c&4&&e.stateNode!=null&&(d=e.memoizedProps,uu(e,d,s!==null?s.memoizedProps:d)),c&1024&&(fu=!0);break;case 6:if(It(n,e),jt(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,s=e.stateNode;try{s.nodeValue=c}catch(oe){je(e,e.return,oe)}}break;case 3:if(Bo=null,d=vn,vn=Io(n.containerInfo),It(n,e),vn=d,jt(e),c&4&&s!==null&&s.memoizedState.isDehydrated)try{$a(n.containerInfo)}catch(oe){je(e,e.return,oe)}fu&&(fu=!1,pp(e));break;case 4:c=vn,vn=Io(e.stateNode.containerInfo),It(n,e),jt(e),vn=c;break;case 12:It(n,e),jt(e);break;case 31:It(n,e),jt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,ko(e,c)));break;case 13:It(n,e),jt(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(_o=Gt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,ko(e,c)));break;case 22:d=e.memoizedState!==null;var C=s!==null&&s.memoizedState!==null,x=Jn,j=ht;if(Jn=x||d,ht=j||C,It(n,e),ht=j,Jn=x,jt(e),c&8192)e:for(n=e.stateNode,n._visibility=d?n._visibility&-2:n._visibility|1,d&&(s===null||C||Jn||ht||ca(e)),s=null,n=e;;){if(n.tag===5||n.tag===26){if(s===null){C=s=n;try{if(f=C.stateNode,d)v=f.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{b=C.stateNode;var V=C.memoizedProps.style,P=V!=null&&V.hasOwnProperty("display")?V.display:null;b.style.display=P==null||typeof P=="boolean"?"":(""+P).trim()}}catch(oe){je(C,C.return,oe)}}}else if(n.tag===6){if(s===null){C=n;try{C.stateNode.nodeValue=d?"":C.memoizedProps}catch(oe){je(C,C.return,oe)}}}else if(n.tag===18){if(s===null){C=n;try{var U=C.stateNode;d?ag(U,!0):ag(C.stateNode,!1)}catch(oe){je(C,C.return,oe)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=e.updateQueue,c!==null&&(s=c.retryQueue,s!==null&&(c.retryQueue=null,ko(e,s))));break;case 19:It(n,e),jt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,ko(e,c)));break;case 30:break;case 21:break;default:It(n,e),jt(e)}}function jt(e){var n=e.flags;if(n&2){try{for(var s,c=e.return;c!==null;){if(rp(c)){s=c;break}c=c.return}if(s==null)throw Error(a(160));switch(s.tag){case 27:var d=s.stateNode,f=du(e);Co(e,f,d);break;case 5:var v=s.stateNode;s.flags&32&&(Ca(v,""),s.flags&=-33);var b=du(e);Co(e,b,v);break;case 3:case 4:var C=s.stateNode.containerInfo,x=du(e);hu(e,x,C);break;default:throw Error(a(161))}}catch(j){je(e,e.return,j)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function pp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;pp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function Xn(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)lp(e,n.alternate,n),n=n.sibling}function ca(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Si(4,n,n.return),ca(n);break;case 1:Dn(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&ap(n,n.return,s),ca(n);break;case 27:nr(n.stateNode);case 26:case 5:Dn(n,n.return),ca(n);break;case 22:n.memoizedState===null&&ca(n);break;case 30:ca(n);break;default:ca(n)}e=e.sibling}}function Zn(e,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,d=e,f=n,v=f.flags;switch(f.tag){case 0:case 11:case 15:Zn(d,f,s),Ks(4,f);break;case 1:if(Zn(d,f,s),c=f,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(x){je(c,c.return,x)}if(c=f,d=c.updateQueue,d!==null){var b=c.stateNode;try{var C=d.shared.hiddenCallbacks;if(C!==null)for(d.shared.hiddenCallbacks=null,d=0;d<C.length;d++)Kf(C[d],b)}catch(x){je(c,c.return,x)}}s&&v&64&&ip(f),Ys(f,f.return);break;case 27:op(f);case 26:case 5:Zn(d,f,s),s&&c===null&&v&4&&sp(f),Ys(f,f.return);break;case 12:Zn(d,f,s);break;case 31:Zn(d,f,s),s&&v&4&&hp(d,f);break;case 13:Zn(d,f,s),s&&v&4&&fp(d,f);break;case 22:f.memoizedState===null&&Zn(d,f,s),Ys(f,f.return);break;case 30:break;default:Zn(d,f,s)}n=n.sibling}}function mu(e,n){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&Ns(s))}function pu(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Ns(e))}function yn(e,n,s,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)gp(e,n,s,c),n=n.sibling}function gp(e,n,s,c){var d=n.flags;switch(n.tag){case 0:case 11:case 15:yn(e,n,s,c),d&2048&&Ks(9,n);break;case 1:yn(e,n,s,c);break;case 3:yn(e,n,s,c),d&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Ns(e)));break;case 12:if(d&2048){yn(e,n,s,c),e=n.stateNode;try{var f=n.memoizedProps,v=f.id,b=f.onPostCommit;typeof b=="function"&&b(v,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(C){je(n,n.return,C)}}else yn(e,n,s,c);break;case 31:yn(e,n,s,c);break;case 13:yn(e,n,s,c);break;case 23:break;case 22:f=n.stateNode,v=n.alternate,n.memoizedState!==null?f._visibility&2?yn(e,n,s,c):Js(e,n):f._visibility&2?yn(e,n,s,c):(f._visibility|=2,Va(e,n,s,c,(n.subtreeFlags&10256)!==0||!1)),d&2048&&mu(v,n);break;case 24:yn(e,n,s,c),d&2048&&pu(n.alternate,n);break;default:yn(e,n,s,c)}}function Va(e,n,s,c,d){for(d=d&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var f=e,v=n,b=s,C=c,x=v.flags;switch(v.tag){case 0:case 11:case 15:Va(f,v,b,C,d),Ks(8,v);break;case 23:break;case 22:var j=v.stateNode;v.memoizedState!==null?j._visibility&2?Va(f,v,b,C,d):Js(f,v):(j._visibility|=2,Va(f,v,b,C,d)),d&&x&2048&&mu(v.alternate,v);break;case 24:Va(f,v,b,C,d),d&&x&2048&&pu(v.alternate,v);break;default:Va(f,v,b,C,d)}n=n.sibling}}function Js(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=e,c=n,d=c.flags;switch(c.tag){case 22:Js(s,c),d&2048&&mu(c.alternate,c);break;case 24:Js(s,c),d&2048&&pu(c.alternate,c);break;default:Js(s,c)}n=n.sibling}}var Qs=8192;function Fa(e,n,s){if(e.subtreeFlags&Qs)for(e=e.child;e!==null;)vp(e,n,s),e=e.sibling}function vp(e,n,s){switch(e.tag){case 26:Fa(e,n,s),e.flags&Qs&&e.memoizedState!==null&&iT(s,vn,e.memoizedState,e.memoizedProps);break;case 5:Fa(e,n,s);break;case 3:case 4:var c=vn;vn=Io(e.stateNode.containerInfo),Fa(e,n,s),vn=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Qs,Qs=16777216,Fa(e,n,s),Qs=c):Fa(e,n,s));break;default:Fa(e,n,s)}}function yp(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Xs(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];vt=c,Sp(c,e)}yp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)bp(e),e=e.sibling}function bp(e){switch(e.tag){case 0:case 11:case 15:Xs(e),e.flags&2048&&Si(9,e,e.return);break;case 3:Xs(e);break;case 12:Xs(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Eo(e)):Xs(e);break;default:Xs(e)}}function Eo(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];vt=c,Sp(c,e)}yp(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Si(8,n,n.return),Eo(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,Eo(n));break;default:Eo(n)}e=e.sibling}}function Sp(e,n){for(;vt!==null;){var s=vt;switch(s.tag){case 0:case 11:case 15:Si(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var c=s.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Ns(s.memoizedState.cache)}if(c=s.child,c!==null)c.return=s,vt=c;else e:for(s=e;vt!==null;){c=vt;var d=c.sibling,f=c.return;if(up(c),c===s){vt=null;break e}if(d!==null){d.return=f,vt=d;break e}vt=f}}}var yS={getCacheForType:function(e){var n=Ct(lt),s=n.data.get(e);return s===void 0&&(s=e(),n.data.set(e,s)),s},cacheSignal:function(){return Ct(lt).controller.signal}},bS=typeof WeakMap=="function"?WeakMap:Map,Le=0,He=null,Ee=null,De=0,Ie=0,Wt=null,Ti=!1,Ha=!1,gu=!1,Wn=0,et=0,Ci=0,la=0,vu=0,$t=0,Ga=0,Zs=null,Bt=null,yu=!1,_o=0,Tp=0,Ro=1/0,Oo=null,ki=null,mt=0,Ei=null,Ka=null,$n=0,bu=0,Su=null,Cp=null,Ws=0,Tu=null;function en(){return(Le&2)!==0&&De!==0?De&-De:L.T!==null?Ou():Ih()}function kp(){if($t===0)if((De&536870912)===0||Me){var e=Pr;Pr<<=1,(Pr&3932160)===0&&(Pr=262144),$t=e}else $t=536870912;return e=Xt.current,e!==null&&(e.flags|=32),$t}function zt(e,n,s){(e===He&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)&&(Ya(e,0),_i(e,De,$t,!1)),bs(e,s),((Le&2)===0||e!==He)&&(e===He&&((Le&2)===0&&(la|=s),et===4&&_i(e,De,$t,!1)),An(e))}function Ep(e,n,s){if((Le&6)!==0)throw Error(a(327));var c=!s&&(n&127)===0&&(n&e.expiredLanes)===0||ys(e,n),d=c?CS(e,n):ku(e,n,!0),f=c;do{if(d===0){Ha&&!c&&_i(e,n,0,!1);break}else{if(s=e.current.alternate,f&&!SS(s)){d=ku(e,n,!1),f=!1;continue}if(d===2){if(f=n,e.errorRecoveryDisabledLanes&f)var v=0;else v=e.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){n=v;e:{var b=e;d=Zs;var C=b.current.memoizedState.isDehydrated;if(C&&(Ya(b,v).flags|=256),v=ku(b,v,!1),v!==2){if(gu&&!C){b.errorRecoveryDisabledLanes|=f,la|=f,d=4;break e}f=Bt,Bt=d,f!==null&&(Bt===null?Bt=f:Bt.push.apply(Bt,f))}d=v}if(f=!1,d!==2)continue}}if(d===1){Ya(e,0),_i(e,n,0,!0);break}e:{switch(c=e,f=d,f){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:_i(c,n,$t,!Ti);break e;case 2:Bt=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(d=_o+300-Gt(),10<d)){if(_i(c,n,$t,!Ti),Ur(c,0,!0)!==0)break e;$n=n,c.timeoutHandle=tg(_p.bind(null,c,s,Bt,Oo,yu,n,$t,la,Ga,Ti,f,"Throttled",-0,0),d);break e}_p(c,s,Bt,Oo,yu,n,$t,la,Ga,Ti,f,null,-0,0)}}break}while(!0);An(e)}function _p(e,n,s,c,d,f,v,b,C,x,j,V,P,U){if(e.timeoutHandle=-1,V=n.subtreeFlags,V&8192||(V&16785408)===16785408){V={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:jn},vp(n,f,V);var oe=(f&62914560)===f?_o-Gt():(f&4194048)===f?Tp-Gt():0;if(oe=aT(V,oe),oe!==null){$n=f,e.cancelPendingCommit=oe(Np.bind(null,e,n,f,s,c,d,v,b,C,j,V,null,P,U)),_i(e,f,v,!x);return}}Np(e,n,f,s,c,d,v,b,C)}function SS(e){for(var n=e;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var c=0;c<s.length;c++){var d=s[c],f=d.getSnapshot;d=d.value;try{if(!Jt(f(),d))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function _i(e,n,s,c){n&=~vu,n&=~la,e.suspendedLanes|=n,e.pingedLanes&=~n,c&&(e.warmLanes|=n),c=e.expirationTimes;for(var d=n;0<d;){var f=31-Yt(d),v=1<<f;c[f]=-1,d&=~v}s!==0&&Ph(e,s,n)}function Do(){return(Le&6)===0?($s(0),!1):!0}function Cu(){if(Ee!==null){if(Ie===0)var e=Ee.return;else e=Ee,Vn=ea=null,jl(e),Ia=null,Ls=0,e=Ee;for(;e!==null;)np(e.alternate,e),e=e.return;Ee=null}}function Ya(e,n){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,zS(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),$n=0,Cu(),He=e,Ee=s=zn(e.current,null),De=n,Ie=0,Wt=null,Ti=!1,Ha=ys(e,n),gu=!1,Ga=$t=vu=la=Ci=et=0,Bt=Zs=null,yu=!1,(n&8)!==0&&(n|=n&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=n;0<c;){var d=31-Yt(c),f=1<<d;n|=e[d],c&=~f}return Wn=n,Jr(),s}function Rp(e,n){ye=null,L.H=Fs,n===Ua||n===no?(n=Vf(),Ie=3):n===Rl?(n=Vf(),Ie=4):Ie=n===eu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Wt=n,Ee===null&&(et=1,vo(e,rn(n,e.current)))}function Op(){var e=Xt.current;return e===null?!0:(De&4194048)===De?un===null:(De&62914560)===De||(De&536870912)!==0?e===un:!1}function Dp(){var e=L.H;return L.H=Fs,e===null?Fs:e}function Ap(){var e=L.A;return L.A=yS,e}function Ao(){et=4,Ti||(De&4194048)!==De&&Xt.current!==null||(Ha=!0),(Ci&134217727)===0&&(la&134217727)===0||He===null||_i(He,De,$t,!1)}function ku(e,n,s){var c=Le;Le|=2;var d=Dp(),f=Ap();(He!==e||De!==n)&&(Oo=null,Ya(e,n)),n=!1;var v=et;e:do try{if(Ie!==0&&Ee!==null){var b=Ee,C=Wt;switch(Ie){case 8:Cu(),v=6;break e;case 3:case 2:case 9:case 6:Xt.current===null&&(n=!0);var x=Ie;if(Ie=0,Wt=null,Ja(e,b,C,x),s&&Ha){v=0;break e}break;default:x=Ie,Ie=0,Wt=null,Ja(e,b,C,x)}}TS(),v=et;break}catch(j){Rp(e,j)}while(!0);return n&&e.shellSuspendCounter++,Vn=ea=null,Le=c,L.H=d,L.A=f,Ee===null&&(He=null,De=0,Jr()),v}function TS(){for(;Ee!==null;)Mp(Ee)}function CS(e,n){var s=Le;Le|=2;var c=Dp(),d=Ap();He!==e||De!==n?(Oo=null,Ro=Gt()+500,Ya(e,n)):Ha=ys(e,n);e:do try{if(Ie!==0&&Ee!==null){n=Ee;var f=Wt;t:switch(Ie){case 1:Ie=0,Wt=null,Ja(e,n,f,1);break;case 2:case 9:if(zf(f)){Ie=0,Wt=null,wp(n);break}n=function(){Ie!==2&&Ie!==9||He!==e||(Ie=7),An(e)},f.then(n,n);break e;case 3:Ie=7;break e;case 4:Ie=5;break e;case 7:zf(f)?(Ie=0,Wt=null,wp(n)):(Ie=0,Wt=null,Ja(e,n,f,7));break;case 5:var v=null;switch(Ee.tag){case 26:v=Ee.memoizedState;case 5:case 27:var b=Ee;if(v?gg(v):b.stateNode.complete){Ie=0,Wt=null;var C=b.sibling;if(C!==null)Ee=C;else{var x=b.return;x!==null?(Ee=x,Mo(x)):Ee=null}break t}}Ie=0,Wt=null,Ja(e,n,f,5);break;case 6:Ie=0,Wt=null,Ja(e,n,f,6);break;case 8:Cu(),et=6;break e;default:throw Error(a(462))}}kS();break}catch(j){Rp(e,j)}while(!0);return Vn=ea=null,L.H=c,L.A=d,Le=s,Ee!==null?0:(He=null,De=0,Jr(),et)}function kS(){for(;Ee!==null&&!K0();)Mp(Ee)}function Mp(e){var n=ep(e.alternate,e,Wn);e.memoizedProps=e.pendingProps,n===null?Mo(e):Ee=n}function wp(e){var n=e,s=n.alternate;switch(n.tag){case 15:case 0:n=Jm(s,n,n.pendingProps,n.type,void 0,De);break;case 11:n=Jm(s,n,n.pendingProps,n.type.render,n.ref,De);break;case 5:jl(n);default:np(s,n),n=Ee=Af(n,Wn),n=ep(s,n,Wn)}e.memoizedProps=e.pendingProps,n===null?Mo(e):Ee=n}function Ja(e,n,s,c){Vn=ea=null,jl(n),Ia=null,Ls=0;var d=n.return;try{if(dS(e,d,n,s,De)){et=1,vo(e,rn(s,e.current)),Ee=null;return}}catch(f){if(d!==null)throw Ee=d,f;et=1,vo(e,rn(s,e.current)),Ee=null;return}n.flags&32768?(Me||c===1?e=!0:Ha||(De&536870912)!==0?e=!1:(Ti=e=!0,(c===2||c===9||c===3||c===6)&&(c=Xt.current,c!==null&&c.tag===13&&(c.flags|=16384))),xp(n,e)):Mo(n)}function Mo(e){var n=e;do{if((n.flags&32768)!==0){xp(n,Ti);return}e=n.return;var s=mS(n.alternate,n,Wn);if(s!==null){Ee=s;return}if(n=n.sibling,n!==null){Ee=n;return}Ee=n=e}while(n!==null);et===0&&(et=5)}function xp(e,n){do{var s=pS(e.alternate,e);if(s!==null){s.flags&=32767,Ee=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(e=e.sibling,e!==null)){Ee=e;return}Ee=e=s}while(e!==null);et=6,Ee=null}function Np(e,n,s,c,d,f,v,b,C){e.cancelPendingCommit=null;do wo();while(mt!==0);if((Le&6)!==0)throw Error(a(327));if(n!==null){if(n===e.current)throw Error(a(177));if(f=n.lanes|n.childLanes,f|=dl,nb(e,s,f,v,b,C),e===He&&(Ee=He=null,De=0),Ka=n,Ei=e,$n=s,bu=f,Su=d,Cp=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,OS(xr,function(){return jp(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=L.T,L.T=null,d=J.p,J.p=2,v=Le,Le|=4;try{gS(e,n,s)}finally{Le=v,J.p=d,L.T=c}}mt=1,Pp(),Lp(),Up()}}function Pp(){if(mt===1){mt=0;var e=Ei,n=Ka,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=L.T,L.T=null;var c=J.p;J.p=2;var d=Le;Le|=4;try{mp(n,e);var f=Lu,v=Sf(e.containerInfo),b=f.focusedElem,C=f.selectionRange;if(v!==b&&b&&b.ownerDocument&&bf(b.ownerDocument.documentElement,b)){if(C!==null&&rl(b)){var x=C.start,j=C.end;if(j===void 0&&(j=x),"selectionStart"in b)b.selectionStart=x,b.selectionEnd=Math.min(j,b.value.length);else{var V=b.ownerDocument||document,P=V&&V.defaultView||window;if(P.getSelection){var U=P.getSelection(),oe=b.textContent.length,de=Math.min(C.start,oe),qe=C.end===void 0?de:Math.min(C.end,oe);!U.extend&&de>qe&&(v=qe,qe=de,de=v);var O=yf(b,de),E=yf(b,qe);if(O&&E&&(U.rangeCount!==1||U.anchorNode!==O.node||U.anchorOffset!==O.offset||U.focusNode!==E.node||U.focusOffset!==E.offset)){var w=V.createRange();w.setStart(O.node,O.offset),U.removeAllRanges(),de>qe?(U.addRange(w),U.extend(E.node,E.offset)):(w.setEnd(E.node,E.offset),U.addRange(w))}}}}for(V=[],U=b;U=U.parentNode;)U.nodeType===1&&V.push({element:U,left:U.scrollLeft,top:U.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<V.length;b++){var B=V[b];B.element.scrollLeft=B.left,B.element.scrollTop=B.top}}Fo=!!Pu,Lu=Pu=null}finally{Le=d,J.p=c,L.T=s}}e.current=n,mt=2}}function Lp(){if(mt===2){mt=0;var e=Ei,n=Ka,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=L.T,L.T=null;var c=J.p;J.p=2;var d=Le;Le|=4;try{lp(e,n.alternate,n)}finally{Le=d,J.p=c,L.T=s}}mt=3}}function Up(){if(mt===4||mt===3){mt=0,Y0();var e=Ei,n=Ka,s=$n,c=Cp;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?mt=5:(mt=0,Ka=Ei=null,Ip(e,e.pendingLanes));var d=e.pendingLanes;if(d===0&&(ki=null),qc(s),n=n.stateNode,Kt&&typeof Kt.onCommitFiberRoot=="function")try{Kt.onCommitFiberRoot(vs,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=L.T,d=J.p,J.p=2,L.T=null;try{for(var f=e.onRecoverableError,v=0;v<c.length;v++){var b=c[v];f(b.value,{componentStack:b.stack})}}finally{L.T=n,J.p=d}}($n&3)!==0&&wo(),An(e),d=e.pendingLanes,(s&261930)!==0&&(d&42)!==0?e===Tu?Ws++:(Ws=0,Tu=e):Ws=0,$s(0)}}function Ip(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Ns(n)))}function wo(){return Pp(),Lp(),Up(),jp()}function jp(){if(mt!==5)return!1;var e=Ei,n=bu;bu=0;var s=qc($n),c=L.T,d=J.p;try{J.p=32>s?32:s,L.T=null,s=Su,Su=null;var f=Ei,v=$n;if(mt=0,Ka=Ei=null,$n=0,(Le&6)!==0)throw Error(a(331));var b=Le;if(Le|=4,bp(f.current),gp(f,f.current,v,s),Le=b,$s(0,!1),Kt&&typeof Kt.onPostCommitFiberRoot=="function")try{Kt.onPostCommitFiberRoot(vs,f)}catch{}return!0}finally{J.p=d,L.T=c,Ip(e,n)}}function Bp(e,n,s){n=rn(s,n),n=$l(e.stateNode,n,2),e=vi(e,n,2),e!==null&&(bs(e,2),An(e))}function je(e,n,s){if(e.tag===3)Bp(e,e,s);else for(;n!==null;){if(n.tag===3){Bp(n,e,s);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ki===null||!ki.has(c))){e=rn(s,e),s=zm(2),c=vi(n,s,2),c!==null&&(qm(s,c,n,e),bs(c,2),An(c));break}}n=n.return}}function Eu(e,n,s){var c=e.pingCache;if(c===null){c=e.pingCache=new bS;var d=new Set;c.set(n,d)}else d=c.get(n),d===void 0&&(d=new Set,c.set(n,d));d.has(s)||(gu=!0,d.add(s),e=ES.bind(null,e,n,s),n.then(e,e))}function ES(e,n,s){var c=e.pingCache;c!==null&&c.delete(n),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,He===e&&(De&s)===s&&(et===4||et===3&&(De&62914560)===De&&300>Gt()-_o?(Le&2)===0&&Ya(e,0):vu|=s,Ga===De&&(Ga=0)),An(e)}function zp(e,n){n===0&&(n=Nh()),e=Zi(e,n),e!==null&&(bs(e,n),An(e))}function _S(e){var n=e.memoizedState,s=0;n!==null&&(s=n.retryLane),zp(e,s)}function RS(e,n){var s=0;switch(e.tag){case 31:case 13:var c=e.stateNode,d=e.memoizedState;d!==null&&(s=d.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(n),zp(e,s)}function OS(e,n){return Ic(e,n)}var xo=null,Qa=null,_u=!1,No=!1,Ru=!1,Ri=0;function An(e){e!==Qa&&e.next===null&&(Qa===null?xo=Qa=e:Qa=Qa.next=e),No=!0,_u||(_u=!0,AS())}function $s(e,n){if(!Ru&&No){Ru=!0;do for(var s=!1,c=xo;c!==null;){if(e!==0){var d=c.pendingLanes;if(d===0)var f=0;else{var v=c.suspendedLanes,b=c.pingedLanes;f=(1<<31-Yt(42|e)+1)-1,f&=d&~(v&~b),f=f&201326741?f&201326741|1:f?f|2:0}f!==0&&(s=!0,Hp(c,f))}else f=De,f=Ur(c,c===He?f:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(f&3)===0||ys(c,f)||(s=!0,Hp(c,f));c=c.next}while(s);Ru=!1}}function DS(){qp()}function qp(){No=_u=!1;var e=0;Ri!==0&&BS()&&(e=Ri);for(var n=Gt(),s=null,c=xo;c!==null;){var d=c.next,f=Vp(c,n);f===0?(c.next=null,s===null?xo=d:s.next=d,d===null&&(Qa=s)):(s=c,(e!==0||(f&3)!==0)&&(No=!0)),c=d}mt!==0&&mt!==5||$s(e),Ri!==0&&(Ri=0)}function Vp(e,n){for(var s=e.suspendedLanes,c=e.pingedLanes,d=e.expirationTimes,f=e.pendingLanes&-62914561;0<f;){var v=31-Yt(f),b=1<<v,C=d[v];C===-1?((b&s)===0||(b&c)!==0)&&(d[v]=tb(b,n)):C<=n&&(e.expiredLanes|=b),f&=~b}if(n=He,s=De,s=Ur(e,e===n?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,s===0||e===n&&(Ie===2||Ie===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&jc(c),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||ys(e,s)){if(n=s&-s,n===e.callbackPriority)return n;switch(c!==null&&jc(c),qc(s)){case 2:case 8:s=wh;break;case 32:s=xr;break;case 268435456:s=xh;break;default:s=xr}return c=Fp.bind(null,e),s=Ic(s,c),e.callbackPriority=n,e.callbackNode=s,n}return c!==null&&c!==null&&jc(c),e.callbackPriority=2,e.callbackNode=null,2}function Fp(e,n){if(mt!==0&&mt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(wo()&&e.callbackNode!==s)return null;var c=De;return c=Ur(e,e===He?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Ep(e,c,n),Vp(e,Gt()),e.callbackNode!=null&&e.callbackNode===s?Fp.bind(null,e):null)}function Hp(e,n){if(wo())return null;Ep(e,n,!0)}function AS(){qS(function(){(Le&6)!==0?Ic(Mh,DS):qp()})}function Ou(){if(Ri===0){var e=Pa;e===0&&(e=Nr,Nr<<=1,(Nr&261888)===0&&(Nr=256)),Ri=e}return Ri}function Gp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:zr(""+e)}function Kp(e,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,e.id&&s.setAttribute("form",e.id),n.parentNode.insertBefore(s,n),e=new FormData(e),s.parentNode.removeChild(s),e}function MS(e,n,s,c,d){if(n==="submit"&&s&&s.stateNode===d){var f=Gp((d[Pt]||null).action),v=c.submitter;v&&(n=(n=v[Pt]||null)?Gp(n.formAction):v.getAttribute("formAction"),n!==null&&(f=n,v=null));var b=new Hr("action","action",null,c,d);e.push({event:b,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Ri!==0){var C=v?Kp(d,v):new FormData(d);Yl(s,{pending:!0,data:C,method:d.method,action:f},null,C)}}else typeof f=="function"&&(b.preventDefault(),C=v?Kp(d,v):new FormData(d),Yl(s,{pending:!0,data:C,method:d.method,action:f},f,C))},currentTarget:d}]})}}for(var Du=0;Du<ul.length;Du++){var Au=ul[Du],wS=Au.toLowerCase(),xS=Au[0].toUpperCase()+Au.slice(1);gn(wS,"on"+xS)}gn(kf,"onAnimationEnd"),gn(Ef,"onAnimationIteration"),gn(_f,"onAnimationStart"),gn("dblclick","onDoubleClick"),gn("focusin","onFocus"),gn("focusout","onBlur"),gn(Jb,"onTransitionRun"),gn(Qb,"onTransitionStart"),gn(Xb,"onTransitionCancel"),gn(Rf,"onTransitionEnd"),Sa("onMouseEnter",["mouseout","mouseover"]),Sa("onMouseLeave",["mouseout","mouseover"]),Sa("onPointerEnter",["pointerout","pointerover"]),Sa("onPointerLeave",["pointerout","pointerover"]),Yi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Yi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Yi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Yi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Yi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Yi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var er="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),NS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(er));function Yp(e,n){n=(n&4)!==0;for(var s=0;s<e.length;s++){var c=e[s],d=c.event;c=c.listeners;e:{var f=void 0;if(n)for(var v=c.length-1;0<=v;v--){var b=c[v],C=b.instance,x=b.currentTarget;if(b=b.listener,C!==f&&d.isPropagationStopped())break e;f=b,d.currentTarget=x;try{f(d)}catch(j){Yr(j)}d.currentTarget=null,f=C}else for(v=0;v<c.length;v++){if(b=c[v],C=b.instance,x=b.currentTarget,b=b.listener,C!==f&&d.isPropagationStopped())break e;f=b,d.currentTarget=x;try{f(d)}catch(j){Yr(j)}d.currentTarget=null,f=C}}}}function _e(e,n){var s=n[Vc];s===void 0&&(s=n[Vc]=new Set);var c=e+"__bubble";s.has(c)||(Jp(n,e,2,!1),s.add(c))}function Mu(e,n,s){var c=0;n&&(c|=4),Jp(s,e,c,n)}var Po="_reactListening"+Math.random().toString(36).slice(2);function wu(e){if(!e[Po]){e[Po]=!0,zh.forEach(function(s){s!=="selectionchange"&&(NS.has(s)||Mu(s,!1,e),Mu(s,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Po]||(n[Po]=!0,Mu("selectionchange",!1,n))}}function Jp(e,n,s,c){switch(kg(n)){case 2:var d=oT;break;case 8:d=cT;break;default:d=Ku}s=d.bind(null,n,s,e),d=void 0,!Zc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),c?d!==void 0?e.addEventListener(n,s,{capture:!0,passive:d}):e.addEventListener(n,s,!0):d!==void 0?e.addEventListener(n,s,{passive:d}):e.addEventListener(n,s,!1)}function xu(e,n,s,c,d){var f=c;if((n&1)===0&&(n&2)===0&&c!==null)e:for(;;){if(c===null)return;var v=c.tag;if(v===3||v===4){var b=c.stateNode.containerInfo;if(b===d)break;if(v===4)for(v=c.return;v!==null;){var C=v.tag;if((C===3||C===4)&&v.stateNode.containerInfo===d)return;v=v.return}for(;b!==null;){if(v=va(b),v===null)return;if(C=v.tag,C===5||C===6||C===26||C===27){c=f=v;continue e}b=b.parentNode}}c=c.return}Wh(function(){var x=f,j=Qc(s),V=[];e:{var P=Of.get(e);if(P!==void 0){var U=Hr,oe=e;switch(e){case"keypress":if(Vr(s)===0)break e;case"keydown":case"keyup":U=Rb;break;case"focusin":oe="focus",U=tl;break;case"focusout":oe="blur",U=tl;break;case"beforeblur":case"afterblur":U=tl;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=tf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=mb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=Ab;break;case kf:case Ef:case _f:U=vb;break;case Rf:U=wb;break;case"scroll":case"scrollend":U=hb;break;case"wheel":U=Nb;break;case"copy":case"cut":case"paste":U=bb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=af;break;case"toggle":case"beforetoggle":U=Lb}var de=(n&4)!==0,qe=!de&&(e==="scroll"||e==="scrollend"),O=de?P!==null?P+"Capture":null:P;de=[];for(var E=x,w;E!==null;){var B=E;if(w=B.stateNode,B=B.tag,B!==5&&B!==26&&B!==27||w===null||O===null||(B=Cs(E,O),B!=null&&de.push(tr(E,B,w))),qe)break;E=E.return}0<de.length&&(P=new U(P,oe,null,s,j),V.push({event:P,listeners:de}))}}if((n&7)===0){e:{if(P=e==="mouseover"||e==="pointerover",U=e==="mouseout"||e==="pointerout",P&&s!==Jc&&(oe=s.relatedTarget||s.fromElement)&&(va(oe)||oe[ga]))break e;if((U||P)&&(P=j.window===j?j:(P=j.ownerDocument)?P.defaultView||P.parentWindow:window,U?(oe=s.relatedTarget||s.toElement,U=x,oe=oe?va(oe):null,oe!==null&&(qe=l(oe),de=oe.tag,oe!==qe||de!==5&&de!==27&&de!==6)&&(oe=null)):(U=null,oe=x),U!==oe)){if(de=tf,B="onMouseLeave",O="onMouseEnter",E="mouse",(e==="pointerout"||e==="pointerover")&&(de=af,B="onPointerLeave",O="onPointerEnter",E="pointer"),qe=U==null?P:Ts(U),w=oe==null?P:Ts(oe),P=new de(B,E+"leave",U,s,j),P.target=qe,P.relatedTarget=w,B=null,va(j)===x&&(de=new de(O,E+"enter",oe,s,j),de.target=w,de.relatedTarget=qe,B=de),qe=B,U&&oe)t:{for(de=PS,O=U,E=oe,w=0,B=O;B;B=de(B))w++;B=0;for(var ue=E;ue;ue=de(ue))B++;for(;0<w-B;)O=de(O),w--;for(;0<B-w;)E=de(E),B--;for(;w--;){if(O===E||E!==null&&O===E.alternate){de=O;break t}O=de(O),E=de(E)}de=null}else de=null;U!==null&&Qp(V,P,U,de,!1),oe!==null&&qe!==null&&Qp(V,qe,oe,de,!0)}}e:{if(P=x?Ts(x):window,U=P.nodeName&&P.nodeName.toLowerCase(),U==="select"||U==="input"&&P.type==="file")var xe=hf;else if(uf(P))if(ff)xe=Gb;else{xe=Fb;var le=Vb}else U=P.nodeName,!U||U.toLowerCase()!=="input"||P.type!=="checkbox"&&P.type!=="radio"?x&&Yc(x.elementType)&&(xe=hf):xe=Hb;if(xe&&(xe=xe(e,x))){df(V,xe,s,j);break e}le&&le(e,P,x),e==="focusout"&&x&&P.type==="number"&&x.memoizedProps.value!=null&&Kc(P,"number",P.value)}switch(le=x?Ts(x):window,e){case"focusin":(uf(le)||le.contentEditable==="true")&&(Ra=le,ol=x,Ms=null);break;case"focusout":Ms=ol=Ra=null;break;case"mousedown":cl=!0;break;case"contextmenu":case"mouseup":case"dragend":cl=!1,Tf(V,s,j);break;case"selectionchange":if(Yb)break;case"keydown":case"keyup":Tf(V,s,j)}var Se;if(il)e:{switch(e){case"compositionstart":var Ae="onCompositionStart";break e;case"compositionend":Ae="onCompositionEnd";break e;case"compositionupdate":Ae="onCompositionUpdate";break e}Ae=void 0}else _a?cf(e,s)&&(Ae="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Ae="onCompositionStart");Ae&&(sf&&s.locale!=="ko"&&(_a||Ae!=="onCompositionStart"?Ae==="onCompositionEnd"&&_a&&(Se=$h()):(ui=j,Wc="value"in ui?ui.value:ui.textContent,_a=!0)),le=Lo(x,Ae),0<le.length&&(Ae=new nf(Ae,e,null,s,j),V.push({event:Ae,listeners:le}),Se?Ae.data=Se:(Se=lf(s),Se!==null&&(Ae.data=Se)))),(Se=Ib?jb(e,s):Bb(e,s))&&(Ae=Lo(x,"onBeforeInput"),0<Ae.length&&(le=new nf("onBeforeInput","beforeinput",null,s,j),V.push({event:le,listeners:Ae}),le.data=Se)),MS(V,e,x,s,j)}Yp(V,n)})}function tr(e,n,s){return{instance:e,listener:n,currentTarget:s}}function Lo(e,n){for(var s=n+"Capture",c=[];e!==null;){var d=e,f=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||f===null||(d=Cs(e,s),d!=null&&c.unshift(tr(e,d,f)),d=Cs(e,n),d!=null&&c.push(tr(e,d,f))),e.tag===3)return c;e=e.return}return[]}function PS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Qp(e,n,s,c,d){for(var f=n._reactName,v=[];s!==null&&s!==c;){var b=s,C=b.alternate,x=b.stateNode;if(b=b.tag,C!==null&&C===c)break;b!==5&&b!==26&&b!==27||x===null||(C=x,d?(x=Cs(s,f),x!=null&&v.unshift(tr(s,x,C))):d||(x=Cs(s,f),x!=null&&v.push(tr(s,x,C)))),s=s.return}v.length!==0&&e.push({event:n,listeners:v})}var LS=/\r\n?/g,US=/\u0000|\uFFFD/g;function Xp(e){return(typeof e=="string"?e:""+e).replace(LS,`
`).replace(US,"")}function Zp(e,n){return n=Xp(n),Xp(e)===n}function ze(e,n,s,c,d,f){switch(s){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||Ca(e,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&Ca(e,""+c);break;case"className":jr(e,"class",c);break;case"tabIndex":jr(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":jr(e,s,c);break;case"style":Xh(e,c,f);break;case"data":if(n!=="object"){jr(e,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||s!=="href")){e.removeAttribute(s);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=zr(""+c),e.setAttribute(s,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof f=="function"&&(s==="formAction"?(n!=="input"&&ze(e,n,"name",d.name,d,null),ze(e,n,"formEncType",d.formEncType,d,null),ze(e,n,"formMethod",d.formMethod,d,null),ze(e,n,"formTarget",d.formTarget,d,null)):(ze(e,n,"encType",d.encType,d,null),ze(e,n,"method",d.method,d,null),ze(e,n,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=zr(""+c),e.setAttribute(s,c);break;case"onClick":c!=null&&(e.onclick=jn);break;case"onScroll":c!=null&&_e("scroll",e);break;case"onScrollEnd":c!=null&&_e("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(d.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}s=zr(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""+c):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":c===!0?e.setAttribute(s,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,c):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(s,c):e.removeAttribute(s);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(s):e.setAttribute(s,c);break;case"popover":_e("beforetoggle",e),_e("toggle",e),Ir(e,"popover",c);break;case"xlinkActuate":In(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":In(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":In(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":In(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":In(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":In(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":In(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":In(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":In(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ir(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=ub.get(s)||s,Ir(e,s,c))}}function Nu(e,n,s,c,d,f){switch(s){case"style":Xh(e,c,f);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(d.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"children":typeof c=="string"?Ca(e,c):(typeof c=="number"||typeof c=="bigint")&&Ca(e,""+c);break;case"onScroll":c!=null&&_e("scroll",e);break;case"onScrollEnd":c!=null&&_e("scrollend",e);break;case"onClick":c!=null&&(e.onclick=jn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qh.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(d=s.endsWith("Capture"),n=s.slice(2,d?s.length-7:void 0),f=e[Pt]||null,f=f!=null?f[s]:null,typeof f=="function"&&e.removeEventListener(n,f,d),typeof c=="function")){typeof f!="function"&&f!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(n,c,d);break e}s in e?e[s]=c:c===!0?e.setAttribute(s,""):Ir(e,s,c)}}}function Et(e,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_e("error",e),_e("load",e);var c=!1,d=!1,f;for(f in s)if(s.hasOwnProperty(f)){var v=s[f];if(v!=null)switch(f){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ze(e,n,f,v,s,null)}}d&&ze(e,n,"srcSet",s.srcSet,s,null),c&&ze(e,n,"src",s.src,s,null);return;case"input":_e("invalid",e);var b=f=v=d=null,C=null,x=null;for(c in s)if(s.hasOwnProperty(c)){var j=s[c];if(j!=null)switch(c){case"name":d=j;break;case"type":v=j;break;case"checked":C=j;break;case"defaultChecked":x=j;break;case"value":f=j;break;case"defaultValue":b=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(a(137,n));break;default:ze(e,n,c,j,s,null)}}Kh(e,f,b,C,x,v,d,!1);return;case"select":_e("invalid",e),c=v=f=null;for(d in s)if(s.hasOwnProperty(d)&&(b=s[d],b!=null))switch(d){case"value":f=b;break;case"defaultValue":v=b;break;case"multiple":c=b;default:ze(e,n,d,b,s,null)}n=f,s=v,e.multiple=!!c,n!=null?Ta(e,!!c,n,!1):s!=null&&Ta(e,!!c,s,!0);return;case"textarea":_e("invalid",e),f=d=c=null;for(v in s)if(s.hasOwnProperty(v)&&(b=s[v],b!=null))switch(v){case"value":c=b;break;case"defaultValue":d=b;break;case"children":f=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(a(91));break;default:ze(e,n,v,b,s,null)}Jh(e,c,d,f);return;case"option":for(C in s)s.hasOwnProperty(C)&&(c=s[C],c!=null)&&(C==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":ze(e,n,C,c,s,null));return;case"dialog":_e("beforetoggle",e),_e("toggle",e),_e("cancel",e),_e("close",e);break;case"iframe":case"object":_e("load",e);break;case"video":case"audio":for(c=0;c<er.length;c++)_e(er[c],e);break;case"image":_e("error",e),_e("load",e);break;case"details":_e("toggle",e);break;case"embed":case"source":case"link":_e("error",e),_e("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(x in s)if(s.hasOwnProperty(x)&&(c=s[x],c!=null))switch(x){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ze(e,n,x,c,s,null)}return;default:if(Yc(n)){for(j in s)s.hasOwnProperty(j)&&(c=s[j],c!==void 0&&Nu(e,n,j,c,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(c=s[b],c!=null&&ze(e,n,b,c,s,null))}function IS(e,n,s,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,f=null,v=null,b=null,C=null,x=null,j=null;for(U in s){var V=s[U];if(s.hasOwnProperty(U)&&V!=null)switch(U){case"checked":break;case"value":break;case"defaultValue":C=V;default:c.hasOwnProperty(U)||ze(e,n,U,null,c,V)}}for(var P in c){var U=c[P];if(V=s[P],c.hasOwnProperty(P)&&(U!=null||V!=null))switch(P){case"type":f=U;break;case"name":d=U;break;case"checked":x=U;break;case"defaultChecked":j=U;break;case"value":v=U;break;case"defaultValue":b=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(a(137,n));break;default:U!==V&&ze(e,n,P,U,c,V)}}Gc(e,v,b,C,x,j,f,d);return;case"select":U=v=b=P=null;for(f in s)if(C=s[f],s.hasOwnProperty(f)&&C!=null)switch(f){case"value":break;case"multiple":U=C;default:c.hasOwnProperty(f)||ze(e,n,f,null,c,C)}for(d in c)if(f=c[d],C=s[d],c.hasOwnProperty(d)&&(f!=null||C!=null))switch(d){case"value":P=f;break;case"defaultValue":b=f;break;case"multiple":v=f;default:f!==C&&ze(e,n,d,f,c,C)}n=b,s=v,c=U,P!=null?Ta(e,!!s,P,!1):!!c!=!!s&&(n!=null?Ta(e,!!s,n,!0):Ta(e,!!s,s?[]:"",!1));return;case"textarea":U=P=null;for(b in s)if(d=s[b],s.hasOwnProperty(b)&&d!=null&&!c.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:ze(e,n,b,null,c,d)}for(v in c)if(d=c[v],f=s[v],c.hasOwnProperty(v)&&(d!=null||f!=null))switch(v){case"value":P=d;break;case"defaultValue":U=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(a(91));break;default:d!==f&&ze(e,n,v,d,c,f)}Yh(e,P,U);return;case"option":for(var oe in s)P=s[oe],s.hasOwnProperty(oe)&&P!=null&&!c.hasOwnProperty(oe)&&(oe==="selected"?e.selected=!1:ze(e,n,oe,null,c,P));for(C in c)P=c[C],U=s[C],c.hasOwnProperty(C)&&P!==U&&(P!=null||U!=null)&&(C==="selected"?e.selected=P&&typeof P!="function"&&typeof P!="symbol":ze(e,n,C,P,c,U));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var de in s)P=s[de],s.hasOwnProperty(de)&&P!=null&&!c.hasOwnProperty(de)&&ze(e,n,de,null,c,P);for(x in c)if(P=c[x],U=s[x],c.hasOwnProperty(x)&&P!==U&&(P!=null||U!=null))switch(x){case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(a(137,n));break;default:ze(e,n,x,P,c,U)}return;default:if(Yc(n)){for(var qe in s)P=s[qe],s.hasOwnProperty(qe)&&P!==void 0&&!c.hasOwnProperty(qe)&&Nu(e,n,qe,void 0,c,P);for(j in c)P=c[j],U=s[j],!c.hasOwnProperty(j)||P===U||P===void 0&&U===void 0||Nu(e,n,j,P,c,U);return}}for(var O in s)P=s[O],s.hasOwnProperty(O)&&P!=null&&!c.hasOwnProperty(O)&&ze(e,n,O,null,c,P);for(V in c)P=c[V],U=s[V],!c.hasOwnProperty(V)||P===U||P==null&&U==null||ze(e,n,V,P,c,U)}function Wp(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function jS(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,s=performance.getEntriesByType("resource"),c=0;c<s.length;c++){var d=s[c],f=d.transferSize,v=d.initiatorType,b=d.duration;if(f&&b&&Wp(v)){for(v=0,b=d.responseEnd,c+=1;c<s.length;c++){var C=s[c],x=C.startTime;if(x>b)break;var j=C.transferSize,V=C.initiatorType;j&&Wp(V)&&(C=C.responseEnd,v+=j*(C<b?1:(b-x)/(C-x)))}if(--c,n+=8*(f+v)/(d.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Pu=null,Lu=null;function Uo(e){return e.nodeType===9?e:e.ownerDocument}function $p(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function eg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Uu(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Iu=null;function BS(){var e=window.event;return e&&e.type==="popstate"?e===Iu?!1:(Iu=e,!0):(Iu=null,!1)}var tg=typeof setTimeout=="function"?setTimeout:void 0,zS=typeof clearTimeout=="function"?clearTimeout:void 0,ng=typeof Promise=="function"?Promise:void 0,qS=typeof queueMicrotask=="function"?queueMicrotask:typeof ng<"u"?function(e){return ng.resolve(null).then(e).catch(VS)}:tg;function VS(e){setTimeout(function(){throw e})}function Oi(e){return e==="head"}function ig(e,n){var s=n,c=0;do{var d=s.nextSibling;if(e.removeChild(s),d&&d.nodeType===8)if(s=d.data,s==="/$"||s==="/&"){if(c===0){e.removeChild(d),$a(n);return}c--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")c++;else if(s==="html")nr(e.ownerDocument.documentElement);else if(s==="head"){s=e.ownerDocument.head,nr(s);for(var f=s.firstChild;f;){var v=f.nextSibling,b=f.nodeName;f[Ss]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&f.rel.toLowerCase()==="stylesheet"||s.removeChild(f),f=v}}else s==="body"&&nr(e.ownerDocument.body);s=d}while(s);$a(n)}function ag(e,n){var s=e;e=0;do{var c=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),c&&c.nodeType===8)if(s=c.data,s==="/$"){if(e===0)break;e--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||e++;s=c}while(s)}function ju(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":ju(s),Fc(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function FS(e,n,s,c){for(;e.nodeType===1;){var d=s;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[Ss])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(f=e.getAttribute("rel"),f==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(f!==d.rel||e.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||e.getAttribute("title")!==(d.title==null?null:d.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(f=e.getAttribute("src"),(f!==(d.src==null?null:d.src)||e.getAttribute("type")!==(d.type==null?null:d.type)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&f&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var f=d.name==null?null:""+d.name;if(d.type==="hidden"&&e.getAttribute("name")===f)return e}else return e;if(e=dn(e.nextSibling),e===null)break}return null}function HS(e,n,s){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=dn(e.nextSibling),e===null))return null;return e}function sg(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=dn(e.nextSibling),e===null))return null;return e}function Bu(e){return e.data==="$?"||e.data==="$~"}function zu(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function GS(e,n){var s=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||s.readyState!=="loading")n();else{var c=function(){n(),s.removeEventListener("DOMContentLoaded",c)};s.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function dn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var qu=null;function rg(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"||s==="/&"){if(n===0)return dn(e.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}e=e.nextSibling}return null}function og(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return e;n--}else s!=="/$"&&s!=="/&"||n++}e=e.previousSibling}return null}function cg(e,n,s){switch(n=Uo(s),e){case"html":if(e=n.documentElement,!e)throw Error(a(452));return e;case"head":if(e=n.head,!e)throw Error(a(453));return e;case"body":if(e=n.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function nr(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);Fc(e)}var hn=new Map,lg=new Set;function Io(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var ei=J.d;J.d={f:KS,r:YS,D:JS,C:QS,L:XS,m:ZS,X:$S,S:WS,M:eT};function KS(){var e=ei.f(),n=Do();return e||n}function YS(e){var n=ya(e);n!==null&&n.tag===5&&n.type==="form"?Rm(n):ei.r(e)}var Xa=typeof document>"u"?null:document;function ug(e,n,s){var c=Xa;if(c&&typeof n=="string"&&n){var d=an(n);d='link[rel="'+e+'"][href="'+d+'"]',typeof s=="string"&&(d+='[crossorigin="'+s+'"]'),lg.has(d)||(lg.add(d),e={rel:e,crossOrigin:s,href:n},c.querySelector(d)===null&&(n=c.createElement("link"),Et(n,"link",e),gt(n),c.head.appendChild(n)))}}function JS(e){ei.D(e),ug("dns-prefetch",e,null)}function QS(e,n){ei.C(e,n),ug("preconnect",e,n)}function XS(e,n,s){ei.L(e,n,s);var c=Xa;if(c&&e&&n){var d='link[rel="preload"][as="'+an(n)+'"]';n==="image"&&s&&s.imageSrcSet?(d+='[imagesrcset="'+an(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(d+='[imagesizes="'+an(s.imageSizes)+'"]')):d+='[href="'+an(e)+'"]';var f=d;switch(n){case"style":f=Za(e);break;case"script":f=Wa(e)}hn.has(f)||(e=y({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:e,as:n},s),hn.set(f,e),c.querySelector(d)!==null||n==="style"&&c.querySelector(ir(f))||n==="script"&&c.querySelector(ar(f))||(n=c.createElement("link"),Et(n,"link",e),gt(n),c.head.appendChild(n)))}}function ZS(e,n){ei.m(e,n);var s=Xa;if(s&&e){var c=n&&typeof n.as=="string"?n.as:"script",d='link[rel="modulepreload"][as="'+an(c)+'"][href="'+an(e)+'"]',f=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":f=Wa(e)}if(!hn.has(f)&&(e=y({rel:"modulepreload",href:e},n),hn.set(f,e),s.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(ar(f)))return}c=s.createElement("link"),Et(c,"link",e),gt(c),s.head.appendChild(c)}}}function WS(e,n,s){ei.S(e,n,s);var c=Xa;if(c&&e){var d=ba(c).hoistableStyles,f=Za(e);n=n||"default";var v=d.get(f);if(!v){var b={loading:0,preload:null};if(v=c.querySelector(ir(f)))b.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":n},s),(s=hn.get(f))&&Vu(e,s);var C=v=c.createElement("link");gt(C),Et(C,"link",e),C._p=new Promise(function(x,j){C.onload=x,C.onerror=j}),C.addEventListener("load",function(){b.loading|=1}),C.addEventListener("error",function(){b.loading|=2}),b.loading|=4,jo(v,n,c)}v={type:"stylesheet",instance:v,count:1,state:b},d.set(f,v)}}}function $S(e,n){ei.X(e,n);var s=Xa;if(s&&e){var c=ba(s).hoistableScripts,d=Wa(e),f=c.get(d);f||(f=s.querySelector(ar(d)),f||(e=y({src:e,async:!0},n),(n=hn.get(d))&&Fu(e,n),f=s.createElement("script"),gt(f),Et(f,"link",e),s.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},c.set(d,f))}}function eT(e,n){ei.M(e,n);var s=Xa;if(s&&e){var c=ba(s).hoistableScripts,d=Wa(e),f=c.get(d);f||(f=s.querySelector(ar(d)),f||(e=y({src:e,async:!0,type:"module"},n),(n=hn.get(d))&&Fu(e,n),f=s.createElement("script"),gt(f),Et(f,"link",e),s.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},c.set(d,f))}}function dg(e,n,s,c){var d=(d=be.current)?Io(d):null;if(!d)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=Za(s.href),s=ba(d).hoistableStyles,c=s.get(n),c||(c={type:"style",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=Za(s.href);var f=ba(d).hoistableStyles,v=f.get(e);if(v||(d=d.ownerDocument||d,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},f.set(e,v),(f=d.querySelector(ir(e)))&&!f._p&&(v.instance=f,v.state.loading=5),hn.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},hn.set(e,s),f||tT(d,e,s,v.state))),n&&c===null)throw Error(a(528,""));return v}if(n&&c!==null)throw Error(a(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Wa(s),s=ba(d).hoistableScripts,c=s.get(n),c||(c={type:"script",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Za(e){return'href="'+an(e)+'"'}function ir(e){return'link[rel="stylesheet"]['+e+"]"}function hg(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function tT(e,n,s,c){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=e.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Et(n,"link",s),gt(n),e.head.appendChild(n))}function Wa(e){return'[src="'+an(e)+'"]'}function ar(e){return"script[async]"+e}function fg(e,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var c=e.querySelector('style[data-href~="'+an(s.href)+'"]');if(c)return n.instance=c,gt(c),c;var d=y({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),gt(c),Et(c,"style",d),jo(c,s.precedence,e),n.instance=c;case"stylesheet":d=Za(s.href);var f=e.querySelector(ir(d));if(f)return n.state.loading|=4,n.instance=f,gt(f),f;c=hg(s),(d=hn.get(d))&&Vu(c,d),f=(e.ownerDocument||e).createElement("link"),gt(f);var v=f;return v._p=new Promise(function(b,C){v.onload=b,v.onerror=C}),Et(f,"link",c),n.state.loading|=4,jo(f,s.precedence,e),n.instance=f;case"script":return f=Wa(s.src),(d=e.querySelector(ar(f)))?(n.instance=d,gt(d),d):(c=s,(d=hn.get(f))&&(c=y({},s),Fu(c,d)),e=e.ownerDocument||e,d=e.createElement("script"),gt(d),Et(d,"link",c),e.head.appendChild(d),n.instance=d);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,jo(c,s.precedence,e));return n.instance}function jo(e,n,s){for(var c=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,f=d,v=0;v<c.length;v++){var b=c[v];if(b.dataset.precedence===n)f=b;else if(f!==d)break}f?f.parentNode.insertBefore(e,f.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(e,n.firstChild))}function Vu(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Fu(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var Bo=null;function mg(e,n,s){if(Bo===null){var c=new Map,d=Bo=new Map;d.set(s,c)}else d=Bo,c=d.get(s),c||(c=new Map,d.set(s,c));if(c.has(e))return c;for(c.set(e,null),s=s.getElementsByTagName(e),d=0;d<s.length;d++){var f=s[d];if(!(f[Ss]||f[St]||e==="link"&&f.getAttribute("rel")==="stylesheet")&&f.namespaceURI!=="http://www.w3.org/2000/svg"){var v=f.getAttribute(n)||"";v=e+v;var b=c.get(v);b?b.push(f):c.set(v,[f])}}return c}function pg(e,n,s){e=e.ownerDocument||e,e.head.insertBefore(s,n==="title"?e.querySelector("head > title"):null)}function nT(e,n,s){if(s===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(e=n.disabled,typeof n.precedence=="string"&&e==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function gg(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function iT(e,n,s,c){if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var d=Za(c.href),f=n.querySelector(ir(d));if(f){n=f._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=zo.bind(e),n.then(e,e)),s.state.loading|=4,s.instance=f,gt(f);return}f=n.ownerDocument||n,c=hg(c),(d=hn.get(d))&&Vu(c,d),f=f.createElement("link"),gt(f);var v=f;v._p=new Promise(function(b,C){v.onload=b,v.onerror=C}),Et(f,"link",c),s.instance=f}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(e.count++,s=zo.bind(e),n.addEventListener("load",s),n.addEventListener("error",s))}}var Hu=0;function aT(e,n){return e.stylesheets&&e.count===0&&Vo(e,e.stylesheets),0<e.count||0<e.imgCount?function(s){var c=setTimeout(function(){if(e.stylesheets&&Vo(e,e.stylesheets),e.unsuspend){var f=e.unsuspend;e.unsuspend=null,f()}},6e4+n);0<e.imgBytes&&Hu===0&&(Hu=62500*jS());var d=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Vo(e,e.stylesheets),e.unsuspend)){var f=e.unsuspend;e.unsuspend=null,f()}},(e.imgBytes>Hu?50:800)+n);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(d)}}:null}function zo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Vo(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var qo=null;function Vo(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,qo=new Map,n.forEach(sT,e),qo=null,zo.call(e))}function sT(e,n){if(!(n.state.loading&4)){var s=qo.get(e);if(s)var c=s.get(null);else{s=new Map,qo.set(e,s);for(var d=e.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<d.length;f++){var v=d[f];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(s.set(v.dataset.precedence,v),c=v)}c&&s.set(null,c)}d=n.instance,v=d.getAttribute("data-precedence"),f=s.get(v)||c,f===c&&s.set(null,d),s.set(v,d),this.count++,c=zo.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),f?f.parentNode.insertBefore(d,f.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(d,e.firstChild)),n.state.loading|=4}}var sr={$$typeof:X,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function rT(e,n,s,c,d,f,v,b,C){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bc(0),this.hiddenUpdates=Bc(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=f,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=C,this.incompleteTransitions=new Map}function vg(e,n,s,c,d,f,v,b,C,x,j,V){return e=new rT(e,n,s,v,C,x,j,V,b),n=1,f===!0&&(n|=24),f=Qt(3,null,null,n),e.current=f,f.stateNode=e,n=kl(),n.refCount++,e.pooledCache=n,n.refCount++,f.memoizedState={element:c,isDehydrated:s,cache:n},Ol(f),e}function yg(e){return e?(e=Aa,e):Aa}function bg(e,n,s,c,d,f){d=yg(d),c.context===null?c.context=d:c.pendingContext=d,c=gi(n),c.payload={element:s},f=f===void 0?null:f,f!==null&&(c.callback=f),s=vi(e,c,n),s!==null&&(zt(s,e,n),Is(s,e,n))}function Sg(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<n?s:n}}function Gu(e,n){Sg(e,n),(e=e.alternate)&&Sg(e,n)}function Tg(e){if(e.tag===13||e.tag===31){var n=Zi(e,67108864);n!==null&&zt(n,e,67108864),Gu(e,67108864)}}function Cg(e){if(e.tag===13||e.tag===31){var n=en();n=zc(n);var s=Zi(e,n);s!==null&&zt(s,e,n),Gu(e,n)}}var Fo=!0;function oT(e,n,s,c){var d=L.T;L.T=null;var f=J.p;try{J.p=2,Ku(e,n,s,c)}finally{J.p=f,L.T=d}}function cT(e,n,s,c){var d=L.T;L.T=null;var f=J.p;try{J.p=8,Ku(e,n,s,c)}finally{J.p=f,L.T=d}}function Ku(e,n,s,c){if(Fo){var d=Yu(c);if(d===null)xu(e,n,c,Ho,s),Eg(e,c);else if(uT(d,e,n,s,c))c.stopPropagation();else if(Eg(e,c),n&4&&-1<lT.indexOf(e)){for(;d!==null;){var f=ya(d);if(f!==null)switch(f.tag){case 3:if(f=f.stateNode,f.current.memoizedState.isDehydrated){var v=Ki(f.pendingLanes);if(v!==0){var b=f;for(b.pendingLanes|=2,b.entangledLanes|=2;v;){var C=1<<31-Yt(v);b.entanglements[1]|=C,v&=~C}An(f),(Le&6)===0&&(Ro=Gt()+500,$s(0))}}break;case 31:case 13:b=Zi(f,2),b!==null&&zt(b,f,2),Do(),Gu(f,2)}if(f=Yu(c),f===null&&xu(e,n,c,Ho,s),f===d)break;d=f}d!==null&&c.stopPropagation()}else xu(e,n,c,null,s)}}function Yu(e){return e=Qc(e),Ju(e)}var Ho=null;function Ju(e){if(Ho=null,e=va(e),e!==null){var n=l(e);if(n===null)e=null;else{var s=n.tag;if(s===13){if(e=h(n),e!==null)return e;e=null}else if(s===31){if(e=u(n),e!==null)return e;e=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Ho=e,null}function kg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(J0()){case Mh:return 2;case wh:return 8;case xr:case Q0:return 32;case xh:return 268435456;default:return 32}default:return 32}}var Qu=!1,Di=null,Ai=null,Mi=null,rr=new Map,or=new Map,wi=[],lT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Eg(e,n){switch(e){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":Ai=null;break;case"mouseover":case"mouseout":Mi=null;break;case"pointerover":case"pointerout":rr.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":or.delete(n.pointerId)}}function cr(e,n,s,c,d,f){return e===null||e.nativeEvent!==f?(e={blockedOn:n,domEventName:s,eventSystemFlags:c,nativeEvent:f,targetContainers:[d]},n!==null&&(n=ya(n),n!==null&&Tg(n)),e):(e.eventSystemFlags|=c,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function uT(e,n,s,c,d){switch(n){case"focusin":return Di=cr(Di,e,n,s,c,d),!0;case"dragenter":return Ai=cr(Ai,e,n,s,c,d),!0;case"mouseover":return Mi=cr(Mi,e,n,s,c,d),!0;case"pointerover":var f=d.pointerId;return rr.set(f,cr(rr.get(f)||null,e,n,s,c,d)),!0;case"gotpointercapture":return f=d.pointerId,or.set(f,cr(or.get(f)||null,e,n,s,c,d)),!0}return!1}function _g(e){var n=va(e.target);if(n!==null){var s=l(n);if(s!==null){if(n=s.tag,n===13){if(n=h(s),n!==null){e.blockedOn=n,jh(e.priority,function(){Cg(s)});return}}else if(n===31){if(n=u(s),n!==null){e.blockedOn=n,jh(e.priority,function(){Cg(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Go(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var s=Yu(e.nativeEvent);if(s===null){s=e.nativeEvent;var c=new s.constructor(s.type,s);Jc=c,s.target.dispatchEvent(c),Jc=null}else return n=ya(s),n!==null&&Tg(n),e.blockedOn=s,!1;n.shift()}return!0}function Rg(e,n,s){Go(e)&&s.delete(n)}function dT(){Qu=!1,Di!==null&&Go(Di)&&(Di=null),Ai!==null&&Go(Ai)&&(Ai=null),Mi!==null&&Go(Mi)&&(Mi=null),rr.forEach(Rg),or.forEach(Rg)}function Ko(e,n){e.blockedOn===n&&(e.blockedOn=null,Qu||(Qu=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,dT)))}var Yo=null;function Og(e){Yo!==e&&(Yo=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Yo===e&&(Yo=null);for(var n=0;n<e.length;n+=3){var s=e[n],c=e[n+1],d=e[n+2];if(typeof c!="function"){if(Ju(c||s)===null)continue;break}var f=ya(s);f!==null&&(e.splice(n,3),n-=3,Yl(f,{pending:!0,data:d,method:s.method,action:c},c,d))}}))}function $a(e){function n(C){return Ko(C,e)}Di!==null&&Ko(Di,e),Ai!==null&&Ko(Ai,e),Mi!==null&&Ko(Mi,e),rr.forEach(n),or.forEach(n);for(var s=0;s<wi.length;s++){var c=wi[s];c.blockedOn===e&&(c.blockedOn=null)}for(;0<wi.length&&(s=wi[0],s.blockedOn===null);)_g(s),s.blockedOn===null&&wi.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(c=0;c<s.length;c+=3){var d=s[c],f=s[c+1],v=d[Pt]||null;if(typeof f=="function")v||Og(s);else if(v){var b=null;if(f&&f.hasAttribute("formAction")){if(d=f,v=f[Pt]||null)b=v.formAction;else if(Ju(d)!==null)continue}else b=v.action;typeof b=="function"?s[c+1]=b:(s.splice(c,3),c-=3),Og(s)}}}function Dg(){function e(f){f.canIntercept&&f.info==="react-transition"&&f.intercept({handler:function(){return new Promise(function(v){return d=v})},focusReset:"manual",scroll:"manual"})}function n(){d!==null&&(d(),d=null),c||setTimeout(s,20)}function s(){if(!c&&!navigation.transition){var f=navigation.currentEntry;f&&f.url!=null&&navigation.navigate(f.url,{state:f.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,d=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),d!==null&&(d(),d=null)}}}function Xu(e){this._internalRoot=e}Jo.prototype.render=Xu.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(a(409));var s=n.current,c=en();bg(s,c,e,n,null,null)},Jo.prototype.unmount=Xu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;bg(e.current,2,null,e,null,null),Do(),n[ga]=null}};function Jo(e){this._internalRoot=e}Jo.prototype.unstable_scheduleHydration=function(e){if(e){var n=Ih();e={blockedOn:null,target:e,priority:n};for(var s=0;s<wi.length&&n!==0&&n<wi[s].priority;s++);wi.splice(s,0,e),s===0&&_g(e)}};var Ag=t.version;if(Ag!=="19.2.3")throw Error(a(527,Ag,"19.2.3"));J.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=p(n),e=e!==null?g(e):null,e=e===null?null:e.stateNode,e};var hT={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qo.isDisabled&&Qo.supportsFiber)try{vs=Qo.inject(hT),Kt=Qo}catch{}}return ur.createRoot=function(e,n){if(!o(e))throw Error(a(299));var s=!1,c="",d=Um,f=Im,v=jm;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(d=n.onUncaughtError),n.onCaughtError!==void 0&&(f=n.onCaughtError),n.onRecoverableError!==void 0&&(v=n.onRecoverableError)),n=vg(e,1,!1,null,null,s,c,null,d,f,v,Dg),e[ga]=n.current,wu(e),new Xu(n)},ur.hydrateRoot=function(e,n,s){if(!o(e))throw Error(a(299));var c=!1,d="",f=Um,v=Im,b=jm,C=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(f=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(C=s.formState)),n=vg(e,1,!0,n,s??null,c,d,C,f,v,b,Dg),n.context=yg(null),s=n.current,c=en(),c=zc(c),d=gi(c),d.callback=null,vi(s,d,c),s=c,n.current.lanes=s,bs(n,s),An(n),e[ga]=n.current,wu(e),new Jo(n)},ur.version="19.2.3",ur}var Bg;function ET(){if(Bg)return $u.exports;Bg=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),$u.exports=kT(),$u.exports}var _T=ET(),zg={};function RT(r,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(a){if(a!=="default"&&!(a in r)){var o=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(r,a,o.get?o:{enumerable:!0,get:function(){return i[a]}})}})}),Object.freeze(r)}var OT=Object.defineProperty,DT=(r,t,i)=>t in r?OT(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,qg=(r,t,i)=>DT(r,typeof t!="symbol"?t+"":t,i);let xt=class{constructor(){qg(this,"_locking"),qg(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const i=new Promise(o=>t=()=>{this._locks-=1,o()}),a=this._locking.then(()=>t);return this._locking=this._locking.then(()=>i),a}};function nt(r,t){if(!r)throw new Error(t)}const AT=34028234663852886e22,MT=-34028234663852886e22,wT=4294967295,xT=2147483647,NT=-2147483648;function Wo(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>xT||r<NT)throw new Error("invalid int 32: "+r)}function kd(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>wT||r<0)throw new Error("invalid uint 32: "+r)}function Yv(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(Number.isFinite(r)&&(r>AT||r<MT))throw new Error("invalid float 32: "+r)}const Jv=Symbol("@bufbuild/protobuf/enum-type");function PT(r){const t=r[Jv];return nt(t,"missing enum type on enum object"),t}function Qv(r,t,i,a){r[Jv]=Xv(t,i.map(o=>({no:o.no,name:o.name,localName:r[o.no]})))}function Xv(r,t,i){const a=Object.create(null),o=Object.create(null),l=[];for(const h of t){const u=Zv(h);l.push(u),a[h.name]=u,o[h.no]=u}return{typeName:r,values:l,findName(h){return a[h]},findNumber(h){return o[h]}}}function LT(r,t,i){const a={};for(const o of t){const l=Zv(o);a[l.localName]=l.no,a[l.no]=l.localName}return Qv(a,r,t),a}function Zv(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}class Xd{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,i){const a=this.getType(),o=a.runtime.bin,l=o.makeReadOptions(i);return o.readMessage(this,l.readerFactory(t),t.byteLength,l),this}fromJson(t,i){const a=this.getType(),o=a.runtime.json,l=o.makeReadOptions(i);return o.readMessage(a,t,l,this),this}fromJsonString(t,i){let a;try{a=JSON.parse(t)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(a,i)}toBinary(t){const i=this.getType(),a=i.runtime.bin,o=a.makeWriteOptions(t),l=o.writerFactory();return a.writeMessage(this,l,o),l.finish()}toJson(t){const i=this.getType(),a=i.runtime.json,o=a.makeWriteOptions(t);return a.writeMessage(this,o)}toJsonString(t){var i;const a=this.toJson(t);return JSON.stringify(a,null,(i=t?.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function UT(r,t,i,a){var o;const l=(o=a?.localName)!==null&&o!==void 0?o:t.substring(t.lastIndexOf(".")+1),h={[l]:function(u){r.util.initFields(this),r.util.initPartial(u,this)}}[l];return Object.setPrototypeOf(h.prototype,new Xd),Object.assign(h,{runtime:r,typeName:t,fields:r.util.newFieldList(i),fromBinary(u,m){return new h().fromBinary(u,m)},fromJson(u,m){return new h().fromJson(u,m)},fromJsonString(u,m){return new h().fromJsonString(u,m)},equals(u,m){return r.util.equals(h,u,m)}}),h}function IT(){let r=0,t=0;for(let a=0;a<28;a+=7){let o=this.buf[this.pos++];if(r|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}let i=this.buf[this.pos++];if(r|=(i&15)<<28,t=(i&112)>>4,(i&128)==0)return this.assertBounds(),[r,t];for(let a=3;a<=31;a+=7){let o=this.buf[this.pos++];if(t|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function id(r,t,i){for(let l=0;l<28;l=l+7){const h=r>>>l,u=!(!(h>>>7)&&t==0),m=(u?h|128:h)&255;if(i.push(m),!u)return}const a=r>>>28&15|(t&7)<<4,o=t>>3!=0;if(i.push((o?a|128:a)&255),!!o){for(let l=3;l<31;l=l+7){const h=t>>>l,u=!!(h>>>7),m=(u?h|128:h)&255;if(i.push(m),!u)return}i.push(t>>>31&1)}}const $o=4294967296;function Vg(r){const t=r[0]==="-";t&&(r=r.slice(1));const i=1e6;let a=0,o=0;function l(h,u){const m=Number(r.slice(h,u));o*=i,a=a*i+m,a>=$o&&(o=o+(a/$o|0),a=a%$o)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),t?$v(a,o):Zd(a,o)}function jT(r,t){let i=Zd(r,t);const a=i.hi&2147483648;a&&(i=$v(i.lo,i.hi));const o=Wv(i.lo,i.hi);return a?"-"+o:o}function Wv(r,t){if({lo:r,hi:t}=BT(r,t),t<=2097151)return String($o*t+r);const i=r&16777215,a=(r>>>24|t<<8)&16777215,o=t>>16&65535;let l=i+a*6777216+o*6710656,h=a+o*8147497,u=o*2;const m=1e7;return l>=m&&(h+=Math.floor(l/m),l%=m),h>=m&&(u+=Math.floor(h/m),h%=m),u.toString()+Fg(h)+Fg(l)}function BT(r,t){return{lo:r>>>0,hi:t>>>0}}function Zd(r,t){return{lo:r|0,hi:t|0}}function $v(r,t){return t=~t,r?r=~r+1:t+=1,Zd(r,t)}const Fg=r=>{const t=String(r);return"0000000".slice(t.length)+t};function Hg(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(let i=0;i<9;i++)t.push(r&127|128),r=r>>7;t.push(1)}}function zT(){let r=this.buf[this.pos++],t=r&127;if((r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,(r&128)==0)return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(let i=5;(r&128)!==0&&i<10;i++)r=this.buf[this.pos++];if((r&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function qT(){const r=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&(typeof process!="object"||typeof zg!="object"||zg.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),h=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(m){const p=typeof m=="bigint"?m:BigInt(m);if(p>l||p<o)throw new Error("int64 invalid: ".concat(m));return p},uParse(m){const p=typeof m=="bigint"?m:BigInt(m);if(p>u||p<h)throw new Error("uint64 invalid: ".concat(m));return p},enc(m){return r.setBigInt64(0,this.parse(m),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc(m){return r.setBigInt64(0,this.uParse(m),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec(m,p){return r.setInt32(0,m,!0),r.setInt32(4,p,!0),r.getBigInt64(0,!0)},uDec(m,p){return r.setInt32(0,m,!0),r.setInt32(4,p,!0),r.getBigUint64(0,!0)}}}const i=o=>nt(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),a=o=>nt(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),i(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),a(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),i(o),Vg(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),a(o),Vg(o)},dec(o,l){return jT(o,l)},uDec(o,l){return Wv(o,l)}}}const We=qT();var H;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(H||(H={}));var qi;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(qi||(qi={}));function Ni(r,t,i){if(t===i)return!0;if(r==H.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==i[a])return!1;return!0}switch(r){case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return t==i}return!1}function fs(r,t){switch(r){case H.BOOL:return!1;case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return t==0?We.zero:"0";case H.DOUBLE:case H.FLOAT:return 0;case H.BYTES:return new Uint8Array(0);case H.STRING:return"";default:return 0}}function ey(r,t){switch(r){case H.BOOL:return t===!1;case H.STRING:return t==="";case H.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var ct;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(ct||(ct={}));class VT{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let o=0;o<this.chunks.length;o++)t+=this.chunks[o].length;let i=new Uint8Array(t),a=0;for(let o=0;o<this.chunks.length;o++)i.set(this.chunks[o],a),a+=this.chunks[o].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,i){return this.uint32((t<<3|i)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(kd(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Wo(t),Hg(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let i=this.textEncoder.encode(t);return this.uint32(i.byteLength),this.raw(i)}float(t){Yv(t);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,t,!0),this.raw(i)}double(t){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,t,!0),this.raw(i)}fixed32(t){kd(t);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t,!0),this.raw(i)}sfixed32(t){Wo(t);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,t,!0),this.raw(i)}sint32(t){return Wo(t),t=(t<<1^t>>31)>>>0,Hg(t,this.buf),this}sfixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=We.enc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}fixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=We.uEnc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}int64(t){let i=We.enc(t);return id(i.lo,i.hi,this.buf),this}sint64(t){let i=We.enc(t),a=i.hi>>31,o=i.lo<<1^a,l=(i.hi<<1|i.lo>>>31)^a;return id(o,l,this.buf),this}uint64(t){let i=We.uEnc(t);return id(i.lo,i.hi,this.buf),this}}class FT{constructor(t,i){this.varint64=IT,this.uint32=zT,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}tag(){let t=this.uint32(),i=t>>>3,a=t&7;if(i<=0||a<0||a>5)throw new Error("illegal tag: field no "+i+" wire type "+a);return[i,a]}skip(t,i){let a=this.pos;switch(t){case ct.Varint:for(;this.buf[this.pos++]&128;);break;case ct.Bit64:this.pos+=4;case ct.Bit32:this.pos+=4;break;case ct.LengthDelimited:let o=this.uint32();this.pos+=o;break;case ct.StartGroup:for(;;){const[l,h]=this.tag();if(h===ct.EndGroup){if(i!==void 0&&l!==i)throw new Error("invalid end group tag");break}this.skip(h,l)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(a,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return We.dec(...this.varint64())}uint64(){return We.uDec(...this.varint64())}sint64(){let[t,i]=this.varint64(),a=-(t&1);return t=(t>>>1|(i&1)<<31)^a,i=i>>>1^a,We.dec(t,i)}bool(){let[t,i]=this.varint64();return t!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return We.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return We.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),i=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(i,i+t)}string(){return this.textDecoder.decode(this.bytes())}}function HT(r,t,i,a){let o;return{typeName:t,extendee:i,get field(){if(!o){const l=typeof a=="function"?a():a;l.name=t.split(".").pop(),l.jsonName="[".concat(t,"]"),o=r.util.newFieldList([l]).list()[0]}return o},runtime:r}}function ty(r){const t=r.field.localName,i=Object.create(null);return i[t]=GT(r),[i,()=>i[t]]}function GT(r){const t=r.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return fs(t.T,t.L);case"message":const i=t.T,a=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(a):a;case"map":throw"map fields are not allowed to be extensions"}}function KT(r,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let i=r.length-1;i>=0;--i)if(r[i].no==t.no)return[r[i]];return[]}return r.filter(i=>i.no===t.no)}let ii="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ec=[];for(let r=0;r<ii.length;r++)Ec[ii[r].charCodeAt(0)]=r;Ec[45]=ii.indexOf("+");Ec[95]=ii.indexOf("/");const ny={dec(r){let t=r.length*3/4;r[r.length-2]=="="?t-=2:r[r.length-1]=="="&&(t-=1);let i=new Uint8Array(t),a=0,o=0,l,h=0;for(let u=0;u<r.length;u++){if(l=Ec[r.charCodeAt(u)],l===void 0)switch(r[u]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:h=l,o=1;break;case 1:i[a++]=h<<2|(l&48)>>4,h=l,o=2;break;case 2:i[a++]=(h&15)<<4|(l&60)>>2,h=l,o=3;break;case 3:i[a++]=(h&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return i.subarray(0,a)},enc(r){let t="",i=0,a,o=0;for(let l=0;l<r.length;l++)switch(a=r[l],i){case 0:t+=ii[a>>2],o=(a&3)<<4,i=1;break;case 1:t+=ii[o|a>>4],o=(a&15)<<2,i=2;break;case 2:t+=ii[o|a>>6],t+=ii[a&63],i=0;break}return i&&(t+=ii[o],t+="=",i==1&&(t+="=")),t}};function YT(r,t,i){ay(t,r);const a=t.runtime.bin.makeReadOptions(i),o=KT(r.getType().runtime.bin.listUnknownFields(r),t.field),[l,h]=ty(t);for(const u of o)t.runtime.bin.readField(l,a.readerFactory(u.data),t.field,u.wireType,a);return h()}function JT(r,t,i,a){ay(t,r);const o=t.runtime.bin.makeReadOptions(a),l=t.runtime.bin.makeWriteOptions(a);if(iy(r,t)){const p=r.getType().runtime.bin.listUnknownFields(r).filter(g=>g.no!=t.field.no);r.getType().runtime.bin.discardUnknownFields(r);for(const g of p)r.getType().runtime.bin.onUnknownField(r,g.no,g.wireType,g.data)}const h=l.writerFactory();let u=t.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(u,i,h,l);const m=o.readerFactory(h.finish());for(;m.pos<m.len;){const[p,g]=m.tag(),y=m.skip(g,p);r.getType().runtime.bin.onUnknownField(r,p,g,y)}}function iy(r,t){const i=r.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(r).find(a=>a.no==t.field.no)}function ay(r,t){nt(r.extendee.typeName==t.getType().typeName,"extension ".concat(r.typeName," can only be applied to message ").concat(r.extendee.typeName))}function sy(r,t){const i=r.localName;if(r.repeated)return t[i].length>0;if(r.oneof)return t[r.oneof.localName].case===i;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?t[i]!==void 0:r.kind=="enum"?t[i]!==r.T.values[0].no:!ey(r.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function Gg(r,t){const i=r.localName,a=!r.opt&&!r.req;if(r.repeated)t[i]=[];else if(r.oneof)t[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":t[i]={};break;case"enum":t[i]=a?r.T.values[0].no:void 0;break;case"scalar":t[i]=a?fs(r.T,r.L):void 0;break;case"message":t[i]=void 0;break}}function ai(r,t){if(r===null||typeof r!="object"||!Object.getOwnPropertyNames(Xd.prototype).every(a=>a in r&&typeof r[a]=="function"))return!1;const i=r.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function ry(r,t){return ai(t)||!r.fieldWrapper?t:r.fieldWrapper.wrapField(t)}H.DOUBLE,H.FLOAT,H.INT64,H.UINT64,H.INT32,H.UINT32,H.BOOL,H.STRING,H.BYTES;const Kg={ignoreUnknownFields:!1},Yg={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function QT(r){return r?Object.assign(Object.assign({},Kg),r):Kg}function XT(r){return r?Object.assign(Object.assign({},Yg),r):Yg}const dc=Symbol(),ec=Symbol();function ZT(){return{makeReadOptions:QT,makeWriteOptions:XT,readMessage(r,t,i,a){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(r.typeName," from JSON: ").concat(wn(t)));a=a??new r;const o=new Map,l=i.typeRegistry;for(const[h,u]of Object.entries(t)){const m=r.fields.findJsonName(h);if(m){if(m.oneof){if(u===null&&m.kind=="scalar")continue;const p=o.get(m.oneof);if(p!==void 0)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: multiple keys for oneof "').concat(m.oneof.name,'" present: "').concat(p,'", "').concat(h,'"'));o.set(m.oneof,h)}Jg(a,u,m,i,r)}else{let p=!1;if(l?.findExtension&&h.startsWith("[")&&h.endsWith("]")){const g=l.findExtension(h.substring(1,h.length-1));if(g&&g.extendee.typeName==r.typeName){p=!0;const[y,S]=ty(g);Jg(y,u,g.field,i,g),JT(a,g,S(),i)}}if(!p&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: key "').concat(h,'" is unknown'))}}return a},writeMessage(r,t){const i=r.getType(),a={};let o;try{for(o of i.fields.byNumber()){if(!sy(o,r)){if(o.req)throw"required field not set";if(!t.emitDefaultValues||!$T(o))continue}const h=o.oneof?r[o.oneof.localName].value:r[o.localName],u=Qg(o,h,t);u!==void 0&&(a[t.useProtoFieldName?o.name:o.jsonName]=u)}const l=t.typeRegistry;if(l?.findExtensionFor)for(const h of i.runtime.bin.listUnknownFields(r)){const u=l.findExtensionFor(i.typeName,h.no);if(u&&iy(r,u)){const m=YT(r,u,t),p=Qg(u.field,m,t);p!==void 0&&(a[u.field.jsonName]=p)}}}catch(l){const h=o?"cannot encode field ".concat(i.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),u=l instanceof Error?l.message:String(l);throw new Error(h+(u.length>0?": ".concat(u):""))}return a},readScalar(r,t,i){return br(r,t,i??qi.BIGINT,!0)},writeScalar(r,t,i){if(t!==void 0&&(i||ey(r,t)))return tc(r,t)},debug:wn}}function wn(r){if(r===null)return"null";switch(typeof r){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":'"'.concat(r.split('"').join('\\"'),'"');default:return String(r)}}function Jg(r,t,i,a,o){let l=i.localName;if(i.repeated){if(nt(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(t)));const h=r[l];for(const u of t){if(u===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(u)));switch(i.kind){case"message":h.push(i.T.fromJson(u,a));break;case"enum":const m=ad(i.T,u,a.ignoreUnknownFields,!0);m!==ec&&h.push(m);break;case"scalar":try{h.push(br(i.T,u,i.L,!0))}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(u));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}}else if(i.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(t)));const h=r[l];for(const[u,m]of Object.entries(t)){if(m===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: map value null"));let p;try{p=WT(i.K,u)}catch(g){let y="cannot decode map key for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(t));throw g instanceof Error&&g.message.length>0&&(y+=": ".concat(g.message)),new Error(y)}switch(i.V.kind){case"message":h[p]=i.V.T.fromJson(m,a);break;case"enum":const g=ad(i.V.T,m,a.ignoreUnknownFields,!0);g!==ec&&(h[p]=g);break;case"scalar":try{h[p]=br(i.V.T,m,qi.BIGINT,!0)}catch(y){let S="cannot decode map value for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(t));throw y instanceof Error&&y.message.length>0&&(S+=": ".concat(y.message)),new Error(S)}break}}}else switch(i.oneof&&(r=r[i.oneof.localName]={case:l},l="value"),i.kind){case"message":const h=i.T;if(t===null&&h.typeName!="google.protobuf.Value")return;let u=r[l];ai(u)?u.fromJson(t,a):(r[l]=u=h.fromJson(t,a),h.fieldWrapper&&!i.oneof&&(r[l]=h.fieldWrapper.unwrapField(u)));break;case"enum":const m=ad(i.T,t,a.ignoreUnknownFields,!1);switch(m){case dc:Gg(i,r);break;case ec:break;default:r[l]=m;break}break;case"scalar":try{const p=br(i.T,t,i.L,!1);p===dc?Gg(i,r):r[l]=p}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(wn(t));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}function WT(r,t){if(r===H.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return br(r,t,qi.BIGINT,!0).toString()}function br(r,t,i,a){if(t===null)return a?fs(r,i):dc;switch(r){case H.DOUBLE:case H.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const o=Number(t);if(Number.isNaN(o)||!Number.isFinite(o))break;return r==H.FLOAT&&Yv(o),o;case H.INT32:case H.FIXED32:case H.SFIXED32:case H.SINT32:case H.UINT32:let l;if(typeof t=="number"?l=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(l=Number(t)),l===void 0)break;return r==H.UINT32||r==H.FIXED32?kd(l):Wo(l),l;case H.INT64:case H.SFIXED64:case H.SINT64:if(typeof t!="number"&&typeof t!="string")break;const h=We.parse(t);return i?h.toString():h;case H.FIXED64:case H.UINT64:if(typeof t!="number"&&typeof t!="string")break;const u=We.uParse(t);return i?u.toString():u;case H.BOOL:if(typeof t!="boolean")break;return t;case H.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case H.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return ny.dec(t)}throw new Error}function ad(r,t,i,a){if(t===null)return r.typeName=="google.protobuf.NullValue"?0:a?r.values[0].no:dc;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const o=r.findName(t);if(o!==void 0)return o.no;if(i)return ec;break}throw new Error("cannot decode enum ".concat(r.typeName," from JSON: ").concat(wn(t)))}function $T(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function Qg(r,t,i){if(r.kind=="map"){nt(typeof t=="object"&&t!=null);const a={},o=Object.entries(t);switch(r.V.kind){case"scalar":for(const[h,u]of o)a[h.toString()]=tc(r.V.T,u);break;case"message":for(const[h,u]of o)a[h.toString()]=u.toJson(i);break;case"enum":const l=r.V.T;for(const[h,u]of o)a[h.toString()]=sd(l,u,i.enumAsInteger);break}return i.emitDefaultValues||o.length>0?a:void 0}if(r.repeated){nt(Array.isArray(t));const a=[];switch(r.kind){case"scalar":for(let o=0;o<t.length;o++)a.push(tc(r.T,t[o]));break;case"enum":for(let o=0;o<t.length;o++)a.push(sd(r.T,t[o],i.enumAsInteger));break;case"message":for(let o=0;o<t.length;o++)a.push(t[o].toJson(i));break}return i.emitDefaultValues||a.length>0?a:void 0}switch(r.kind){case"scalar":return tc(r.T,t);case"enum":return sd(r.T,t,i.enumAsInteger);case"message":return ry(r.T,t).toJson(i)}}function sd(r,t,i){var a;if(nt(typeof t=="number"),r.typeName=="google.protobuf.NullValue")return null;if(i)return t;const o=r.findNumber(t);return(a=o?.name)!==null&&a!==void 0?a:t}function tc(r,t){switch(r){case H.INT32:case H.SFIXED32:case H.SINT32:case H.FIXED32:case H.UINT32:return nt(typeof t=="number"),t;case H.FLOAT:case H.DOUBLE:return nt(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case H.STRING:return nt(typeof t=="string"),t;case H.BOOL:return nt(typeof t=="boolean"),t;case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return nt(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case H.BYTES:return nt(t instanceof Uint8Array),ny.enc(t)}}const es=Symbol("@bufbuild/protobuf/unknown-fields"),Xg={readUnknownFields:!0,readerFactory:r=>new FT(r)},Zg={writeUnknownFields:!0,writerFactory:()=>new VT};function eC(r){return r?Object.assign(Object.assign({},Xg),r):Xg}function tC(r){return r?Object.assign(Object.assign({},Zg),r):Zg}function nC(){return{makeReadOptions:eC,makeWriteOptions:tC,listUnknownFields(r){var t;return(t=r[es])!==null&&t!==void 0?t:[]},discardUnknownFields(r){delete r[es]},writeUnknownFields(r,t){const a=r[es];if(a)for(const o of a)t.tag(o.no,o.wireType).raw(o.data)},onUnknownField(r,t,i,a){const o=r;Array.isArray(o[es])||(o[es]=[]),o[es].push({no:t,wireType:i,data:a})},readMessage(r,t,i,a,o){const l=r.getType(),h=o?t.len:t.pos+i;let u,m;for(;t.pos<h&&([u,m]=t.tag(),!(o===!0&&m==ct.EndGroup));){const p=l.fields.find(u);if(!p){const g=t.skip(m,u);a.readUnknownFields&&this.onUnknownField(r,u,m,g);continue}Wg(r,t,p,m,a)}if(o&&(m!=ct.EndGroup||u!==i))throw new Error("invalid end group tag")},readField:Wg,writeMessage(r,t,i){const a=r.getType();for(const o of a.fields.byNumber()){if(!sy(o,r)){if(o.req)throw new Error("cannot encode field ".concat(a.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?r[o.oneof.localName].value:r[o.localName];$g(o,l,t,i)}return i.writeUnknownFields&&this.writeUnknownFields(r,t),t},writeField(r,t,i,a){t!==void 0&&$g(r,t,i,a)}}}function Wg(r,t,i,a,o){let{repeated:l,localName:h}=i;switch(i.oneof&&(r=r[i.oneof.localName],r.case!=h&&delete r.value,r.case=h,h="value"),i.kind){case"scalar":case"enum":const u=i.kind=="enum"?H.INT32:i.T;let m=hc;if(i.kind=="scalar"&&i.L>0&&(m=aC),l){let S=r[h];if(a==ct.LengthDelimited&&u!=H.STRING&&u!=H.BYTES){let A=t.uint32()+t.pos;for(;t.pos<A;)S.push(m(t,u))}else S.push(m(t,u))}else r[h]=m(t,u);break;case"message":const p=i.T;l?r[h].push(nc(t,new p,o,i)):ai(r[h])?nc(t,r[h],o,i):(r[h]=nc(t,new p,o,i),p.fieldWrapper&&!i.oneof&&!i.repeated&&(r[h]=p.fieldWrapper.unwrapField(r[h])));break;case"map":let[g,y]=iC(i,t,o);r[h][g]=y;break}}function nc(r,t,i,a){const o=t.getType().runtime.bin,l=a?.delimited;return o.readMessage(t,r,l?a.no:r.uint32(),i,l),t}function iC(r,t,i){const a=t.uint32(),o=t.pos+a;let l,h;for(;t.pos<o;){const[u]=t.tag();switch(u){case 1:l=hc(t,r.K);break;case 2:switch(r.V.kind){case"scalar":h=hc(t,r.V.T);break;case"enum":h=t.int32();break;case"message":h=nc(t,new r.V.T,i,void 0);break}break}}if(l===void 0&&(l=fs(r.K,qi.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),h===void 0)switch(r.V.kind){case"scalar":h=fs(r.V.T,qi.BIGINT);break;case"enum":h=r.V.T.values[0].no;break;case"message":h=new r.V.T;break}return[l,h]}function aC(r,t){const i=hc(r,t);return typeof i=="bigint"?i.toString():i}function hc(r,t){switch(t){case H.STRING:return r.string();case H.BOOL:return r.bool();case H.DOUBLE:return r.double();case H.FLOAT:return r.float();case H.INT32:return r.int32();case H.INT64:return r.int64();case H.UINT64:return r.uint64();case H.FIXED64:return r.fixed64();case H.BYTES:return r.bytes();case H.FIXED32:return r.fixed32();case H.SFIXED32:return r.sfixed32();case H.SFIXED64:return r.sfixed64();case H.SINT64:return r.sint64();case H.UINT32:return r.uint32();case H.SINT32:return r.sint32()}}function $g(r,t,i,a){nt(t!==void 0);const o=r.repeated;switch(r.kind){case"scalar":case"enum":let l=r.kind=="enum"?H.INT32:r.T;if(o)if(nt(Array.isArray(t)),r.packed)rC(i,l,r.no,t);else for(const h of t)Sr(i,l,r.no,h);else Sr(i,l,r.no,t);break;case"message":if(o){nt(Array.isArray(t));for(const h of t)ev(i,a,r,h)}else ev(i,a,r,t);break;case"map":nt(typeof t=="object"&&t!=null);for(const[h,u]of Object.entries(t))sC(i,a,r,h,u);break}}function sC(r,t,i,a,o){r.tag(i.no,ct.LengthDelimited),r.fork();let l=a;switch(i.K){case H.INT32:case H.FIXED32:case H.UINT32:case H.SFIXED32:case H.SINT32:l=Number.parseInt(a);break;case H.BOOL:nt(a=="true"||a=="false"),l=a=="true";break}switch(Sr(r,i.K,1,l),i.V.kind){case"scalar":Sr(r,i.V.T,2,o);break;case"enum":Sr(r,H.INT32,2,o);break;case"message":nt(o!==void 0),r.tag(2,ct.LengthDelimited).bytes(o.toBinary(t));break}r.join()}function ev(r,t,i,a){const o=ry(i.T,a);i.delimited?r.tag(i.no,ct.StartGroup).raw(o.toBinary(t)).tag(i.no,ct.EndGroup):r.tag(i.no,ct.LengthDelimited).bytes(o.toBinary(t))}function Sr(r,t,i,a){nt(a!==void 0);let[o,l]=oy(t);r.tag(i,o)[l](a)}function rC(r,t,i,a){if(!a.length)return;r.tag(i,ct.LengthDelimited).fork();let[,o]=oy(t);for(let l=0;l<a.length;l++)r[o](a[l]);r.join()}function oy(r){let t=ct.Varint;switch(r){case H.BYTES:case H.STRING:t=ct.LengthDelimited;break;case H.DOUBLE:case H.FIXED64:case H.SFIXED64:t=ct.Bit64;break;case H.FIXED32:case H.SFIXED32:case H.FLOAT:t=ct.Bit32;break}const i=H[r].toLowerCase();return[t,i]}function oC(){return{setEnumType:Qv,initPartial(r,t){if(r===void 0)return;const i=t.getType();for(const a of i.fields.byMember()){const o=a.localName,l=t,h=r;if(h[o]!=null)switch(a.kind){case"oneof":const u=h[o].case;if(u===void 0)continue;const m=a.findField(u);let p=h[o].value;m&&m.kind=="message"&&!ai(p,m.T)?p=new m.T(p):m&&m.kind==="scalar"&&m.T===H.BYTES&&(p=dr(p)),l[o]={case:u,value:p};break;case"scalar":case"enum":let g=h[o];a.T===H.BYTES&&(g=a.repeated?g.map(dr):dr(g)),l[o]=g;break;case"map":switch(a.V.kind){case"scalar":case"enum":if(a.V.T===H.BYTES)for(const[k,A]of Object.entries(h[o]))l[o][k]=dr(A);else Object.assign(l[o],h[o]);break;case"message":const S=a.V.T;for(const k of Object.keys(h[o])){let A=h[o][k];S.fieldWrapper||(A=new S(A)),l[o][k]=A}break}break;case"message":const y=a.T;if(a.repeated)l[o]=h[o].map(S=>ai(S,y)?S:new y(S));else{const S=h[o];y.fieldWrapper?y.typeName==="google.protobuf.BytesValue"?l[o]=dr(S):l[o]=S:l[o]=ai(S,y)?S:new y(S)}break}}},equals(r,t,i){return t===i?!0:!t||!i?!1:r.fields.byMember().every(a=>{const o=t[a.localName],l=i[a.localName];if(a.repeated){if(o.length!==l.length)return!1;switch(a.kind){case"message":return o.every((h,u)=>a.T.equals(h,l[u]));case"scalar":return o.every((h,u)=>Ni(a.T,h,l[u]));case"enum":return o.every((h,u)=>Ni(H.INT32,h,l[u]))}throw new Error("repeated cannot contain ".concat(a.kind))}switch(a.kind){case"message":let h=o,u=l;return a.T.fieldWrapper&&(h!==void 0&&!ai(h)&&(h=a.T.fieldWrapper.wrapField(h)),u!==void 0&&!ai(u)&&(u=a.T.fieldWrapper.wrapField(u))),a.T.equals(h,u);case"enum":return Ni(H.INT32,o,l);case"scalar":return Ni(a.T,o,l);case"oneof":if(o.case!==l.case)return!1;const m=a.findField(o.case);if(m===void 0)return!0;switch(m.kind){case"message":return m.T.equals(o.value,l.value);case"enum":return Ni(H.INT32,o.value,l.value);case"scalar":return Ni(m.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(m.kind));case"map":const p=Object.keys(o).concat(Object.keys(l));switch(a.V.kind){case"message":const g=a.V.T;return p.every(S=>g.equals(o[S],l[S]));case"enum":return p.every(S=>Ni(H.INT32,o[S],l[S]));case"scalar":const y=a.V.T;return p.every(S=>Ni(y,o[S],l[S]))}break}})},clone(r){const t=r.getType(),i=new t,a=i;for(const o of t.fields.byMember()){const l=r[o.localName];let h;if(o.repeated)h=l.map(Xo);else if(o.kind=="map"){h=a[o.localName];for(const[u,m]of Object.entries(l))h[u]=Xo(m)}else o.kind=="oneof"?h=o.findField(l.case)?{case:l.case,value:Xo(l.value)}:{case:void 0}:h=Xo(l);a[o.localName]=h}for(const o of t.runtime.bin.listUnknownFields(r))t.runtime.bin.onUnknownField(a,o.no,o.wireType,o.data);return i}}}function Xo(r){if(r===void 0)return r;if(ai(r))return r.clone();if(r instanceof Uint8Array){const t=new Uint8Array(r.byteLength);return t.set(r),t}return r}function dr(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function cC(r,t,i){return{syntax:r,json:ZT(),bin:nC(),util:Object.assign(Object.assign({},oC()),{newFieldList:t,initFields:i}),makeMessageType(a,o,l){return UT(this,a,o,l)},makeEnum:LT,makeEnumType:Xv,getEnumType:PT,makeExtension(a,o,l){return HT(this,a,o,l)}}}class lC{constructor(t,i){this._fields=t,this._normalizer=i}findJsonName(t){if(!this.jsonNames){const i={};for(const a of this.list())i[a.jsonName]=i[a.name]=a;this.jsonNames=i}return this.jsonNames[t]}find(t){if(!this.numbers){const i={};for(const a of this.list())i[a.no]=a;this.numbers=i}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,i)=>t.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let i;for(const a of this.list())a.oneof?a.oneof!==i&&(i=a.oneof,t.push(i)):t.push(a)}return this.members}}function cy(r,t){const i=ly(r);return t?i:pC(mC(i))}function uC(r){return cy(r,!1)}const dC=ly;function ly(r){let t=!1;const i=[];for(let a=0;a<r.length;a++){let o=r.charAt(a);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),i.push(o);break}}return i.join("")}const hC=new Set(["constructor","toString","toJSON","valueOf"]),fC=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),uy=r=>"".concat(r,"$"),mC=r=>fC.has(r)?uy(r):r,pC=r=>hC.has(r)?uy(r):r;class gC{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=uC(t)}addField(t){nt(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[t]}}function vC(r,t){var i,a,o,l,h,u;const m=[];let p;for(const g of typeof r=="function"?r():r){const y=g;if(y.localName=cy(g.name,g.oneof!==void 0),y.jsonName=(i=g.jsonName)!==null&&i!==void 0?i:dC(g.name),y.repeated=(a=g.repeated)!==null&&a!==void 0?a:!1,g.kind=="scalar"&&(y.L=(o=g.L)!==null&&o!==void 0?o:qi.BIGINT),y.delimited=(l=g.delimited)!==null&&l!==void 0?l:!1,y.req=(h=g.req)!==null&&h!==void 0?h:!1,y.opt=(u=g.opt)!==null&&u!==void 0?u:!1,g.packed===void 0&&(y.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=H.BYTES&&g.T!=H.STRING),g.oneof!==void 0){const S=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!p||p.name!=S)&&(p=new gC(S)),y.oneof=p,p.addField(y)}m.push(y)}return m}const N=cC("proto3",r=>new lC(r,t=>vC(t)),r=>{for(const t of r.getType().fields.byMember()){if(t.opt)continue;const i=t.localName,a=r;if(t.repeated){a[i]=[];continue}switch(t.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=fs(t.T,t.L);break}}});class qt extends Xd{constructor(t){super(),this.seconds=We.zero,this.nanos=0,N.util.initPartial(t,this)}fromJson(t,i){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(N.json.debug(t)));const a=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=We.parse(o/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}toJson(t){const i=Number(this.seconds)*1e3;if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let a="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?a="."+o.substring(0,3)+"Z":o.substring(6)==="000"?a="."+o.substring(0,6)+"Z":a="."+o+"Z"}return new Date(i).toISOString().replace(".000Z",a)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return qt.fromDate(new Date)}static fromDate(t){const i=t.getTime();return new qt({seconds:We.parse(Math.floor(i/1e3)),nanos:i%1e3*1e6})}static fromBinary(t,i){return new qt().fromBinary(t,i)}static fromJson(t,i){return new qt().fromJson(t,i)}static fromJsonString(t,i){return new qt().fromJsonString(t,i)}static equals(t,i){return N.util.equals(qt,t,i)}}qt.runtime=N;qt.typeName="google.protobuf.Timestamp";qt.fields=N.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const yC=N.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:bC,repeated:!0},{no:5,name:"events",kind:"message",T:TC,repeated:!0}]),bC=N.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:SC,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),SC=N.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qt},{no:3,name:"value",kind:"scalar",T:2}]),TC=N.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:qt},{no:7,name:"normalized_end_timestamp",kind:"message",T:qt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),dy=N.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Tn=N.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ft=N.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Wd=N.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),vr=N.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),kr=N.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),En=N.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ua=N.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),CC=N.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),yt=N.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),_c=N.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:fc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Ey}]),fc=N.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),kC=N.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:N.getEnumType(ft),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ha=N.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:N.getEnumType(ss)},{no:4,name:"tracks",kind:"message",T:ns,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:kC},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:N.getEnumType(Er)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:N.getEnumType(En)},{no:18,name:"kind_details",kind:"enum",T:N.getEnumType(EC),repeated:!0}]),ss=N.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Er=N.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),EC=N.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),pt=N.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),_C=N.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ji,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:N.getEnumType(hy)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),ns=N.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:N.getEnumType(Tn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:N.getEnumType(ft)},{no:10,name:"layers",kind:"message",T:ji,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:_C,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:N.getEnumType(pt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Ey},{no:19,name:"audio_features",kind:"enum",T:N.getEnumType(yt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:N.getEnumType(dy)}]),ji=N.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:N.getEnumType(Wd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),hy=N.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),wt=N.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:N.getEnumType(ke)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:$d,oneof:"value"},{no:3,name:"speaker",kind:"message",T:RC,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:gy,oneof:"value"},{no:7,name:"transcription",kind:"message",T:OC,oneof:"value"},{no:8,name:"metrics",kind:"message",T:yC,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:mc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:eh,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:th,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:nh,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:pc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:gc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:vc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:fy,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ke=N.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),fy=N.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:N.getEnumType(pt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),my=N.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:$d,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:mc,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:eh,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:th,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:nh,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:pc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:gc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:vc,oneof:"value"}]),RC=N.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:py,repeated:!0}]),py=N.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),$d=N.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),gy=N.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),OC=N.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:DC,repeated:!0}]),DC=N.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),mc=N.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),eh=N.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),th=N.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),nh=N.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:vy,oneof:"value"}]),vy=N.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),yy=N.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),by=N.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:N.getEnumType(Sy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Sy=N.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ty=N.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:N.getEnumType(Cy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Cy=N.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),ky=N.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:tv},{no:2,name:"screen",kind:"message",T:tv},{no:3,name:"resume_connection",kind:"enum",T:N.getEnumType(kr)},{no:4,name:"disabled_codecs",kind:"message",T:AC},{no:5,name:"force_relay",kind:"enum",T:N.getEnumType(kr)}]),tv=N.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:N.getEnumType(kr)}]),AC=N.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:fc,repeated:!0},{no:2,name:"publish",kind:"message",T:fc,repeated:!0}]),Ey=N.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Ed=N.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),_y=N.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:N.getEnumType(Ed)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Ry=N.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),pc=N.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:N.getEnumType(pt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:_y,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Ry,oneof:"content_header"}],{localName:"DataStream_Header"}),gc=N.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),vc=N.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),MC=N.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Cn=N.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),_d=N.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),wC=N.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),xC=N.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Vi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Vi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Rc,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_r,oneof:"message"},{no:5,name:"mute",kind:"message",T:Oc,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Dc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Oy,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ac,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Ay,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:xy,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:oh,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Mn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:sh,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ly,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:ah,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Dy,oneof:"message"}]),nv=N.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:NC,oneof:"message"},{no:2,name:"answer",kind:"message",T:Vi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Vi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Rc,oneof:"message"},{no:5,name:"update",kind:"message",T:UC,oneof:"message"},{no:6,name:"track_published",kind:"message",T:ih,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ac,oneof:"message"},{no:9,name:"mute",kind:"message",T:Oc,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:IC,oneof:"message"},{no:11,name:"room_update",kind:"message",T:jC,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:zC,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:VC,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:HC,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:KC,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:LC,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:PC,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:JC,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:ZC,oneof:"message"},{no:22,name:"request_response",kind:"message",T:WC,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:$C,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:YC,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:ik,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:GC,oneof:"message"}]),Rd=N.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ji,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:N.getEnumType(hy)}]),_r=N.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:N.getEnumType(Tn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:N.getEnumType(ft)},{no:9,name:"layers",kind:"message",T:ji,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Rd,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:N.getEnumType(pt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:N.getEnumType(dy)},{no:17,name:"audio_features",kind:"enum",T:N.getEnumType(yt),repeated:!0}]),Rc=N.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:N.getEnumType(Cn)},{no:3,name:"final",kind:"scalar",T:8}]),Oc=N.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),NC=N.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:_c},{no:2,name:"participant",kind:"message",T:ha},{no:3,name:"other_participants",kind:"message",T:ha,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:My,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ky},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:by},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:fc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),PC=N.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:My,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ky},{no:3,name:"server_info",kind:"message",T:by},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),ih=N.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ns}]),LC=N.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Vi=N.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),UC=N.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ha,repeated:!0}]),Dc=N.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:yy,repeated:!0}]),Oy=N.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:N.getEnumType(Wd)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),ah=N.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:N.getEnumType(yt),repeated:!0}]),Dy=N.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ac=N.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:N.getEnumType(En)},{no:3,name:"action",kind:"enum",T:N.getEnumType(rs)},{no:4,name:"regions",kind:"message",T:QC}]),rs=N.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Ay=N.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ji,repeated:!0}]),sh=N.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),My=N.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),IC=N.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:py,repeated:!0}]),jC=N.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:_c}]),BC=N.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:N.getEnumType(vr)},{no:3,name:"score",kind:"scalar",T:2}]),zC=N.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:BC,repeated:!0}]),qC=N.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:N.getEnumType(_d)}]),VC=N.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:qC,repeated:!0}]),rh=N.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:N.getEnumType(Wd)},{no:2,name:"enabled",kind:"scalar",T:8}]),FC=N.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:rh,repeated:!0}]),HC=N.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:rh,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:FC,repeated:!0}]),GC=N.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:MC,repeated:!0}]),wy=N.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),xy=N.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:wy,repeated:!0}]),KC=N.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),YC=N.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:_c},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:ha},{no:4,name:"other_participants",kind:"message",T:ha,repeated:!0}]),oh=N.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Vi},{no:2,name:"subscription",kind:"message",T:Dc},{no:3,name:"publish_tracks",kind:"message",T:ih,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Py,repeated:!0},{no:5,name:"offer",kind:"message",T:Vi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Ny,repeated:!0}]),Ny=N.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Py=N.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:N.getEnumType(Cn)}]),Mn=N.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:N.getEnumType(wC),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ly=N.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),JC=N.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),QC=N.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:XC,repeated:!0}]),XC=N.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),ZC=N.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:N.getEnumType(CC)}]),WC=N.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:N.getEnumType(ch)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Rc,oneof:"request"},{no:5,name:"add_track",kind:"message",T:_r,oneof:"request"},{no:6,name:"mute",kind:"message",T:Oc,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:sh,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:ah,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Dy,oneof:"request"}]),ch=N.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),$C=N.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Uy=N.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),ek=N.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Ty},{no:2,name:"connection_settings",kind:"message",T:Uy},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:_r,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Vi},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:N.getEnumType(ua)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:oh}]),tk=N.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:N.getEnumType(nk)},{no:2,name:"join_request",kind:"scalar",T:12}]),nk=N.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),ik=N.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function ak(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ic={exports:{}},sk=ic.exports,iv;function rk(){return iv||(iv=1,(function(r){(function(t,i){r.exports?r.exports=i():t.log=i()})(sk,function(){var t=function(){},i="undefined",a=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},h=null;function u(R,G){var I=R[G];if(typeof I.bind=="function")return I.bind(R);try{return Function.prototype.bind.call(I,R)}catch{return function(){return Function.prototype.apply.apply(I,[R,arguments])}}}function m(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function p(R){return R==="debug"&&(R="log"),typeof console===i?!1:R==="trace"&&a?m:console[R]!==void 0?u(console,R):console.log!==void 0?u(console,"log"):t}function g(){for(var R=this.getLevel(),G=0;G<o.length;G++){var I=o[G];this[I]=G<R?t:this.methodFactory(I,R,this.name)}if(this.log=this.debug,typeof console===i&&R<this.levels.SILENT)return"No console available for logging"}function y(R){return function(){typeof console!==i&&(g.call(this),this[R].apply(this,arguments))}}function S(R,G,I){return p(R)||y.apply(this,arguments)}function k(R,G){var I=this,Z,X,M,D="loglevel";typeof R=="string"?D+=":"+R:typeof R=="symbol"&&(D=void 0);function z(re){var ae=(o[re]||"silent").toUpperCase();if(!(typeof window===i||!D)){try{window.localStorage[D]=ae;return}catch{}try{window.document.cookie=encodeURIComponent(D)+"="+ae+";"}catch{}}}function K(){var re;if(!(typeof window===i||!D)){try{re=window.localStorage[D]}catch{}if(typeof re===i)try{var ae=window.document.cookie,fe=encodeURIComponent(D),Fe=ae.indexOf(fe+"=");Fe!==-1&&(re=/^([^;]+)/.exec(ae.slice(Fe+fe.length+1))[1])}catch{}return I.levels[re]===void 0&&(re=void 0),re}}function se(){if(!(typeof window===i||!D)){try{window.localStorage.removeItem(D)}catch{}try{window.document.cookie=encodeURIComponent(D)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ne(re){var ae=re;if(typeof ae=="string"&&I.levels[ae.toUpperCase()]!==void 0&&(ae=I.levels[ae.toUpperCase()]),typeof ae=="number"&&ae>=0&&ae<=I.levels.SILENT)return ae;throw new TypeError("log.setLevel() called with invalid level: "+re)}I.name=R,I.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},I.methodFactory=G||S,I.getLevel=function(){return M??X??Z},I.setLevel=function(re,ae){return M=ne(re),ae!==!1&&z(M),g.call(I)},I.setDefaultLevel=function(re){X=ne(re),K()||I.setLevel(re,!1)},I.resetLevel=function(){M=null,se(),g.call(I)},I.enableAll=function(re){I.setLevel(I.levels.TRACE,re)},I.disableAll=function(re){I.setLevel(I.levels.SILENT,re)},I.rebuild=function(){if(h!==I&&(Z=ne(h.getLevel())),g.call(I),h===I)for(var re in l)l[re].rebuild()},Z=ne(h?h.getLevel():"WARN");var ie=K();ie!=null&&(M=ne(ie)),g.call(I)}h=new k,h.getLogger=function(G){if(typeof G!="symbol"&&typeof G!="string"||G==="")throw new TypeError("You must supply a name when creating a logger.");var I=l[G];return I||(I=l[G]=new k(G,h.methodFactory)),I};var A=typeof window!==i?window.log:void 0;return h.noConflict=function(){return typeof window!==i&&window.log===h&&(window.log=A),h},h.getLoggers=function(){return l},h.default=h,h})})(ic)),ic.exports}var Mc=rk(),Od;(function(r){r[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent"})(Od||(Od={}));var _n;(function(r){r.Default="livekit",r.Room="livekit-room",r.TokenSource="livekit-token-source",r.Participant="livekit-participant",r.Track="livekit-track",r.Publication="livekit-track-publication",r.Engine="livekit-engine",r.Signal="livekit-signal",r.PCManager="livekit-pc-manager",r.PCTransport="livekit-pc-transport",r.E2EE="lk-e2ee"})(_n||(_n={}));let Ce=Mc.getLogger("livekit");Object.values(_n).map(r=>Mc.getLogger(r));Ce.setDefaultLevel(Od.info);function oi(r){const t=Mc.getLogger(r);return t.setDefaultLevel(Ce.getLevel()),t}const ok=Mc.getLogger("lk-e2ee"),hr=7e3,ck=[0,300,4*300,9*300,16*300,hr,hr,hr,hr,hr];class lk{constructor(t){this._retryDelays=t!==void 0?[...t]:ck}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[t.retryCount];return t.retryCount<=1?i:i+Math.random()*1e3}}function uk(r,t){var i={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(i[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(r);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(r,a[o])&&(i[a[o]]=r[a[o]]);return i}function T(r,t,i,a){function o(l){return l instanceof i?l:new i(function(h){h(l)})}return new(i||(i=Promise))(function(l,h){function u(g){try{p(a.next(g))}catch(y){h(y)}}function m(g){try{p(a.throw(g))}catch(y){h(y)}}function p(g){g.done?l(g.value):o(g.value).then(u,m)}p((a=a.apply(r,t||[])).next())})}function av(r){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&r[t],a=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function si(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],i;return t?t.call(r):(r=typeof av=="function"?av(r):r[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(l){i[l]=r[l]&&function(h){return new Promise(function(u,m){h=r[l](h),o(u,m,h.done,h.value)})}}function o(l,h,u,m){Promise.resolve(m).then(function(p){l({value:p,done:u})},h)}}var Zo={exports:{}},sv;function dk(){if(sv)return Zo.exports;sv=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(D,z,K){return Function.prototype.apply.call(D,z,K)},i;r&&typeof r.ownKeys=="function"?i=r.ownKeys:Object.getOwnPropertySymbols?i=function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:i=function(D){return Object.getOwnPropertyNames(D)};function a(M){console&&console.warn&&console.warn(M)}var o=Number.isNaN||function(D){return D!==D};function l(){l.init.call(this)}Zo.exports=l,Zo.exports.once=I,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var h=10;function u(M){if(typeof M!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(M){if(typeof M!="number"||M<0||o(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");h=M}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(D){if(typeof D!="number"||D<0||o(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this};function m(M){return M._maxListeners===void 0?l.defaultMaxListeners:M._maxListeners}l.prototype.getMaxListeners=function(){return m(this)},l.prototype.emit=function(D){for(var z=[],K=1;K<arguments.length;K++)z.push(arguments[K]);var se=D==="error",ne=this._events;if(ne!==void 0)se=se&&ne.error===void 0;else if(!se)return!1;if(se){var ie;if(z.length>0&&(ie=z[0]),ie instanceof Error)throw ie;var re=new Error("Unhandled error."+(ie?" ("+ie.message+")":""));throw re.context=ie,re}var ae=ne[D];if(ae===void 0)return!1;if(typeof ae=="function")t(ae,this,z);else for(var fe=ae.length,Fe=A(ae,fe),K=0;K<fe;++K)t(Fe[K],this,z);return!0};function p(M,D,z,K){var se,ne,ie;if(u(z),ne=M._events,ne===void 0?(ne=M._events=Object.create(null),M._eventsCount=0):(ne.newListener!==void 0&&(M.emit("newListener",D,z.listener?z.listener:z),ne=M._events),ie=ne[D]),ie===void 0)ie=ne[D]=z,++M._eventsCount;else if(typeof ie=="function"?ie=ne[D]=K?[z,ie]:[ie,z]:K?ie.unshift(z):ie.push(z),se=m(M),se>0&&ie.length>se&&!ie.warned){ie.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+ie.length+" "+String(D)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=M,re.type=D,re.count=ie.length,a(re)}return M}l.prototype.addListener=function(D,z){return p(this,D,z,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(D,z){return p(this,D,z,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(M,D,z){var K={fired:!1,wrapFn:void 0,target:M,type:D,listener:z},se=g.bind(K);return se.listener=z,K.wrapFn=se,se}l.prototype.once=function(D,z){return u(z),this.on(D,y(this,D,z)),this},l.prototype.prependOnceListener=function(D,z){return u(z),this.prependListener(D,y(this,D,z)),this},l.prototype.removeListener=function(D,z){var K,se,ne,ie,re;if(u(z),se=this._events,se===void 0)return this;if(K=se[D],K===void 0)return this;if(K===z||K.listener===z)--this._eventsCount===0?this._events=Object.create(null):(delete se[D],se.removeListener&&this.emit("removeListener",D,K.listener||z));else if(typeof K!="function"){for(ne=-1,ie=K.length-1;ie>=0;ie--)if(K[ie]===z||K[ie].listener===z){re=K[ie].listener,ne=ie;break}if(ne<0)return this;ne===0?K.shift():R(K,ne),K.length===1&&(se[D]=K[0]),se.removeListener!==void 0&&this.emit("removeListener",D,re||z)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(D){var z,K,se;if(K=this._events,K===void 0)return this;if(K.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):K[D]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete K[D]),this;if(arguments.length===0){var ne=Object.keys(K),ie;for(se=0;se<ne.length;++se)ie=ne[se],ie!=="removeListener"&&this.removeAllListeners(ie);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(z=K[D],typeof z=="function")this.removeListener(D,z);else if(z!==void 0)for(se=z.length-1;se>=0;se--)this.removeListener(D,z[se]);return this};function S(M,D,z){var K=M._events;if(K===void 0)return[];var se=K[D];return se===void 0?[]:typeof se=="function"?z?[se.listener||se]:[se]:z?G(se):A(se,se.length)}l.prototype.listeners=function(D){return S(this,D,!0)},l.prototype.rawListeners=function(D){return S(this,D,!1)},l.listenerCount=function(M,D){return typeof M.listenerCount=="function"?M.listenerCount(D):k.call(M,D)},l.prototype.listenerCount=k;function k(M){var D=this._events;if(D!==void 0){var z=D[M];if(typeof z=="function")return 1;if(z!==void 0)return z.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function A(M,D){for(var z=new Array(D),K=0;K<D;++K)z[K]=M[K];return z}function R(M,D){for(;D+1<M.length;D++)M[D]=M[D+1];M.pop()}function G(M){for(var D=new Array(M.length),z=0;z<D.length;++z)D[z]=M[z].listener||M[z];return D}function I(M,D){return new Promise(function(z,K){function se(ie){M.removeListener(D,ne),K(ie)}function ne(){typeof M.removeListener=="function"&&M.removeListener("error",se),z([].slice.call(arguments))}X(M,D,ne,{once:!0}),D!=="error"&&Z(M,se,{once:!0})})}function Z(M,D,z){typeof M.on=="function"&&X(M,"error",D,z)}function X(M,D,z,K){if(typeof M.on=="function")K.once?M.once(D,z):M.on(D,z);else if(typeof M.addEventListener=="function")M.addEventListener(D,function se(ne){K.once&&M.removeEventListener(D,se),z(ne)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M)}return Zo.exports}var Ln=dk();let Iy=!0,jy=!0;function yr(r,t,i){const a=r.match(t);return a&&a.length>=i&&parseFloat(a[i],10)}function pa(r,t,i){if(!r.RTCPeerConnection)return;const a=r.RTCPeerConnection.prototype,o=a.addEventListener;a.addEventListener=function(h,u){if(h!==t)return o.apply(this,arguments);const m=p=>{const g=i(p);g&&(u.handleEvent?u.handleEvent(g):u(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,m),o.apply(this,[h,m])};const l=a.removeEventListener;a.removeEventListener=function(h,u){if(h!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const m=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[h,m])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function hk(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(Iy=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function fk(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(jy=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function By(){if(typeof window=="object"){if(Iy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lh(r,t){jy&&console.warn(r+" is deprecated, please use "+t+" instead.")}function mk(r){const t={browser:null,version:null};if(typeof r>"u"||!r.navigator||!r.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=r;if(i.userAgentData&&i.userAgentData.brands){const a=i.userAgentData.brands.find(o=>o.brand==="Chromium");if(a)return{browser:"chrome",version:parseInt(a.version,10)}}if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(yr(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(yr(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(r.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(yr(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype,t._safariVersion=yr(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function rv(r){return Object.prototype.toString.call(r)==="[object Object]"}function zy(r){return rv(r)?Object.keys(r).reduce(function(t,i){const a=rv(r[i]),o=a?zy(r[i]):r[i],l=a&&!Object.keys(o).length;return o===void 0||l?t:Object.assign(t,{[i]:o})},{}):r}function Dd(r,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?Dd(r,r.get(t[a]),i):a.endsWith("Ids")&&t[a].forEach(o=>{Dd(r,r.get(o),i)})}))}function ov(r,t,i){const a=i?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return r.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&l.push(h)}),l.forEach(h=>{r.forEach(u=>{u.type===a&&u.trackId===h.id&&Dd(r,u,o)})}),o}const cv=By;function qy(r,t){const i=r&&r.navigator;if(!i.mediaDevices)return;const a=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const m={};return Object.keys(u).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const g=typeof u[p]=="object"?u[p]:{ideal:u[p]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const y=function(S,k){return S?S+k.charAt(0).toUpperCase()+k.slice(1):k==="deviceId"?"sourceId":k};if(g.ideal!==void 0){m.optional=m.optional||[];let S={};typeof g.ideal=="number"?(S[y("min",p)]=g.ideal,m.optional.push(S),S={},S[y("max",p)]=g.ideal,m.optional.push(S)):(S[y("",p)]=g.ideal,m.optional.push(S))}g.exact!==void 0&&typeof g.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[y("",p)]=g.exact):["min","max"].forEach(S=>{g[S]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[y(S,p)]=g[S])})}),u.advanced&&(m.optional=(m.optional||[]).concat(u.advanced)),m},o=function(u,m){if(t.version>=61)return m(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const p=function(g,y,S){y in g&&!(S in g)&&(g[S]=g[y],delete g[y])};u=JSON.parse(JSON.stringify(u)),p(u.audio,"autoGainControl","googAutoGainControl"),p(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=a(u.audio)}if(u&&typeof u.video=="object"){let p=u.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const g=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete u.video.facingMode;let y;if(p.exact==="environment"||p.ideal==="environment"?y=["back","rear"]:(p.exact==="user"||p.ideal==="user")&&(y=["front"]),y)return i.mediaDevices.enumerateDevices().then(S=>{S=S.filter(A=>A.kind==="videoinput");let k=S.find(A=>y.some(R=>A.label.toLowerCase().includes(R)));return!k&&S.length&&y.includes("back")&&(k=S[S.length-1]),k&&(u.video.deviceId=p.exact?{exact:k.deviceId}:{ideal:k.deviceId}),u.video=a(u.video),cv("chrome: "+JSON.stringify(u)),m(u)})}u.video=a(u.video)}return cv("chrome: "+JSON.stringify(u)),m(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},h=function(u,m,p){o(u,g=>{i.webkitGetUserMedia(g,m,y=>{p&&p(l(y))})})};if(i.getUserMedia=h.bind(i),i.mediaDevices.getUserMedia){const u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return o(m,p=>u(p).then(g=>{if(p.audio&&!g.getAudioTracks().length||p.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function Vy(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function Fy(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.track.id):l={track:o.track};const h=new Event("track");h.track=o.track,h.receiver=l,h.transceiver={receiver:l},h.streams=[a.stream],this.dispatchEvent(h)}),a.stream.getTracks().forEach(o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.id):l={track:o};const h=new Event("track");h.track=o,h.receiver=l,h.transceiver={receiver:l},h.streams=[a.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else pa(r,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Hy(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(u,m){let p=o.apply(this,arguments);return p||(p=t(this,u),this._senders.push(p)),p};const l=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const m=this._senders.indexOf(u);m!==-1&&this._senders.splice(m,1)}}const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],i.apply(this,[l]),l.getTracks().forEach(h=>{this._senders.push(t(this,h))})};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(h=>{const u=this._senders.find(m=>m.track===h);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Gy(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const l=i.apply(this,[]);return l.forEach(h=>h._pc=this),l});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),r.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(h=>ov(h,l.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(l=>l._pc=this),o}),pa(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>ov(l,o.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype))return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const a=arguments[0];let o,l,h;return this.getSenders().forEach(u=>{u.track===a&&(o?h=!0:o=u)}),this.getReceivers().forEach(u=>(u.track===a&&(l?h=!0:l=u),u.track===a)),h||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ky(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(h,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(m)===-1&&this._shimmedLocalStreams[u.id].push(m):this._shimmedLocalStreams[u.id]=[u,m],m};const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(p=>{if(this.getSenders().find(y=>y.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(p=>u.indexOf(p)===-1);this._shimmedLocalStreams[h.id]=[h].concat(m)};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],a.apply(this,arguments)};const o=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const m=this._shimmedLocalStreams[u].indexOf(h);m!==-1&&this._shimmedLocalStreams[u].splice(m,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function Yy(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ky(r);const i=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(k=>k.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const y=new r.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}a.apply(this,[g])};const o=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},r.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(R=>R===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[y.id];if(A)A.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new r.MediaStream([g]);this._streams[y.id]=R,this._reverseStreams[R.id]=y,this.addStream(R)}return this.getSenders().find(R=>R.track===g)};function l(p,g){let y=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(S=>{const k=p._reverseStreams[S],A=p._streams[k.id];y=y.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:g.type,sdp:y})}function h(p,g){let y=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(S=>{const k=p._reverseStreams[S],A=p._streams[k.id];y=y.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:g.type,sdp:y})}["createOffer","createAnswer"].forEach(function(p){const g=r.RTCPeerConnection.prototype[p],y={[p](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[A=>{const R=l(this,A);S[0].apply(null,[R])},A=>{S[1]&&S[1].apply(null,A)},arguments[2]]):g.apply(this,arguments).then(A=>l(this,A))}};r.RTCPeerConnection.prototype[p]=y[p]});const u=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=h(this,arguments[0]),u.apply(this,arguments))};const m=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const p=m.get.apply(this);return p.type===""?p:l(this,p)}}),r.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let S;Object.keys(this._streams).forEach(k=>{this._streams[k].getTracks().find(R=>g.track===R)&&(S=this._streams[k])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ad(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=r.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[i]=o[i]})}function Jy(r,t){pa(r,"negotiationneeded",i=>{const a=i.target;if(!((t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")&&a.signalingState!=="stable"))return i})}var lv=Object.freeze({__proto__:null,fixNegotiationNeeded:Jy,shimAddTrackRemoveTrack:Yy,shimAddTrackRemoveTrackWithNative:Ky,shimGetSendersWithDtmf:Hy,shimGetUserMedia:qy,shimMediaStream:Vy,shimOnTrack:Fy,shimPeerConnection:Ad,shimSenderReceiverGetStats:Gy});function Qy(r,t){const i=r&&r.navigator,a=r&&r.MediaStreamTrack;if(i.getUserMedia=function(o,l,h){lh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(l,h)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(h,u,m){u in h&&!(m in h)&&(h[m]=h[u],delete h[u])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),o(h.audio,"autoGainControl","mozAutoGainControl"),o(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const u=h.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[u])}}}}function pk(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(a){if(!(a&&a.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return a.video===!0?a.video={mediaSource:t}:a.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(a)})}function Xy(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Md(r,t){if(typeof r!="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=r.RTCPeerConnection.prototype[o],h={[o](){return arguments[0]=new(o==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};r.RTCPeerConnection.prototype[o]=h[o]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[l,h,u]=arguments;return a.apply(this,[l||null]).then(m=>{if(t.version<53&&!h)try{m.forEach(p=>{p.type=i[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;m.forEach((g,y)=>{m.set(y,Object.assign({},g,{type:i[g.type]||g.type}))})}return m}).then(h,u)}}function Zy(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Wy(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),pa(r,"track",i=>(i.receiver._pc=i.srcElement,i)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $y(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){lh("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function e0(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function t0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const o=a.length>0;o&&a.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(o){const{sender:h}=l,u=h.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=a,h.sendEncodings=a,this.setParametersPromises.push(h.setParameters(u).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return l})}function n0(r){if(!(typeof r=="object"&&r.RTCRtpSender))return;const t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){const a=t.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function i0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function a0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var uv=Object.freeze({__proto__:null,shimAddTransceiver:t0,shimCreateAnswer:a0,shimCreateOffer:i0,shimGetDisplayMedia:pk,shimGetParameters:n0,shimGetUserMedia:Qy,shimOnTrack:Xy,shimPeerConnection:Md,shimRTCDataChannel:e0,shimReceiverGetStats:Wy,shimRemoveStream:$y,shimSenderGetStats:Zy});function s0(r){if(!(typeof r!="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(o=>t.call(this,o,a)),a.getVideoTracks().forEach(o=>t.call(this,o,a))},r.RTCPeerConnection.prototype.addTrack=function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),h=1;h<o;h++)l[h-1]=arguments[h];return l&&l.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(i);if(a===-1)return;this._localStreams.splice(a,1);const o=i.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function r0(r){if(!(typeof r!="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(l)>=0)return;a._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,a.dispatchEvent(h)})}),t.apply(a,arguments)}}}function o0(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype,i=t.createOffer,a=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(p,g){const y=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[y]);return g?(S.then(p,g),Promise.resolve()):S},t.createAnswer=function(p,g){const y=arguments.length>=2?arguments[2]:arguments[0],S=a.apply(this,[y]);return g?(S.then(p,g),Promise.resolve()):S};let u=function(m,p,g){const y=o.apply(this,[m]);return g?(y.then(p,g),Promise.resolve()):y};t.setLocalDescription=u,u=function(m,p,g){const y=l.apply(this,[m]);return g?(y.then(p,g),Promise.resolve()):y},t.setRemoteDescription=u,u=function(m,p,g){const y=h.apply(this,[m]);return g?(y.then(p,g),Promise.resolve()):y},t.addIceCandidate=u}function c0(r){const t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,a=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=o=>a(l0(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,o,l){t.mediaDevices.getUserMedia(a).then(o,l)}).bind(t))}function l0(r){return r&&r.video!==void 0?Object.assign({},r,{video:zy(r.video)}):r}function u0(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection;r.RTCPeerConnection=function(a,o){if(a&&a.iceServers){const l=[];for(let h=0;h<a.iceServers.length;h++){let u=a.iceServers[h];u.urls===void 0&&u.url?(lh("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,l.push(u)):l.push(a.iceServers[h])}a.iceServers=l}return new t(a,o)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function d0(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function h0(r){const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(a){if(a){typeof a.offerToReceiveAudio<"u"&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const o=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):a.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof a.offerToReceiveVideo<"u"&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const l=this.getTransceivers().find(h=>h.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):a.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function f0(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var dv=Object.freeze({__proto__:null,shimAudioContext:f0,shimCallbacksAPI:o0,shimConstraints:l0,shimCreateOfferLegacy:h0,shimGetUserMedia:c0,shimLocalStreamsAPI:s0,shimRTCIceServerUrls:u0,shimRemoteStreamsAPI:r0,shimTrackEventTransceiver:d0}),rd={exports:{}},hv;function gk(){return hv||(hv=1,(function(r){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(i){return i.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(i){const a=t.splitSections(i);return a&&a[0]},t.getMediaSections=function(i){const a=t.splitSections(i);return a.shift(),a},t.matchPrefix=function(i,a){return t.splitLines(i).filter(o=>o.indexOf(a)===0)},t.parseCandidate=function(i){let a;i.indexOf("a=candidate:")===0?a=i.substring(12).split(" "):a=i.substring(10).split(" ");const o={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":o.relatedAddress=a[l+1];break;case"rport":o.relatedPort=parseInt(a[l+1],10);break;case"tcptype":o.tcpType=a[l+1];break;case"ufrag":o.ufrag=a[l+1],o.usernameFragment=a[l+1];break;default:o[a[l]]===void 0&&(o[a[l]]=a[l+1]);break}return o},t.writeCandidate=function(i){const a=[];a.push(i.foundation);const o=i.component;o==="rtp"?a.push(1):o==="rtcp"?a.push(2):a.push(o),a.push(i.protocol.toUpperCase()),a.push(i.priority),a.push(i.address||i.ip),a.push(i.port);const l=i.type;return a.push("typ"),a.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(a.push("raddr"),a.push(i.relatedAddress),a.push("rport"),a.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(a.push("ufrag"),a.push(i.usernameFragment||i.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let a=i.substring(9).split(" ");const o={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),o.name=a[0],o.clockRate=parseInt(a[1],10),o.channels=a.length===3?parseInt(a[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(i){let a=i.payloadType;i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+a+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(i){const a=i.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const a={};let o;const l=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)o=l[h].trim().split("="),a[o[0].trim()]=o[1];return a},t.writeFmtp=function(i){let a="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const l=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?l.push(h+"="+i.parameters[h]):l.push(h)}),a+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return a},t.parseRtcpFb=function(i){const a=i.substring(i.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(i){let a="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(i){const a=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,a),10)},l=i.indexOf(":",a);return l>-1?(o.attribute=i.substring(a+1,l),o.value=i.substring(l+1)):o.attribute=i.substring(a+1),o},t.parseSsrcGroup=function(i){const a=i.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(o=>parseInt(o,10))}},t.getMid=function(i){const a=t.matchPrefix(i,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(i){const a=i.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(i,a){return{role:"auto",fingerprints:t.matchPrefix(i+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,a){let o="a=setup:"+a+`\r
`;return i.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(i){const a=i.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const a=i.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,a){return t.matchPrefix(i+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,a){const o=t.matchPrefix(i+a,"a=ice-ufrag:")[0],l=t.matchPrefix(i+a,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(i){let a="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(i){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(i)[0].split(" ");a.profile=l[2];for(let u=3;u<l.length;u++){const m=l[u],p=t.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(p){const g=t.parseRtpMap(p),y=t.matchPrefix(i,"a=fmtp:"+m+" ");switch(g.parameters=y.length?t.parseFmtp(y[0]):{},g.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(t.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(u=>{a.headerExtensions.push(t.parseExtmap(u))});const h=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(u=>{h.forEach(m=>{u.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||u.rtcpFeedback.push(m)})}),a},t.writeRtpDescription=function(i,a){let o="";o+="m="+i+" ",o+=a.codecs.length>0?"9":"0",o+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{o+=t.writeRtpMap(h),o+=t.writeFmtp(h),o+=t.writeRtcpFb(h)});let l=0;return a.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{o+=t.writeExtmap(h)}),o},t.parseRtpEncodingParameters=function(i){const a=[],o=t.parseRtpParameters(i),l=o.fecMechanisms.indexOf("RED")!==-1,h=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(i,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),m=u.length>0&&u[0].ssrc;let p;const g=t.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(A=>parseInt(A,10)));g.length>0&&g[0].length>1&&g[0][0]===m&&(p=g[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let k={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&p&&(k.rtx={ssrc:p}),a.push(k),l&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(k))}}),a.length===0&&m&&a.push({ssrc:m});let y=t.matchPrefix(i,"b=");return y.length&&(y[0].indexOf("b=TIAS:")===0?y=parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?y=parseInt(y[0].substring(5),10)*1e3*.95-2e3*8:y=void 0,a.forEach(S=>{S.maxBitrate=y})),a},t.parseRtcpParameters=function(i){const a={},o=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(a.cname=o.value,a.ssrc=o.ssrc);const l=t.matchPrefix(i,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=l.length===0;const h=t.matchPrefix(i,"a=rtcp-mux");return a.mux=h.length>0,a},t.writeRtcpParameters=function(i){let a="";return i.reducedSize&&(a+=`a=rtcp-rsize\r
`),i.mux&&(a+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(a+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),a},t.parseMsid=function(i){let a;const o=t.matchPrefix(i,"a=msid:");if(o.length===1)return a=o[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=t.matchPrefix(i,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");if(l.length>0)return a=l[0].value.split(" "),{stream:a[0],track:a[1]}},t.parseSctpDescription=function(i){const a=t.parseMLine(i),o=t.matchPrefix(i,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const h=t.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const u=t.matchPrefix(i,"a=sctpmap:");if(u.length>0){const m=u[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(i,a){let o=[];return i.protocol!=="DTLS/SCTP"?o=["m="+i.kind+" 9 "+i.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:o=["m="+i.kind+" 9 "+i.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&o.push("a=max-message-size:"+a.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,a,o){let l;const h=a!==void 0?a:2;return i?l=i:l=t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,a){const o=t.splitLines(i);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const o=t.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(i){const o=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const a=t.splitLines(i);for(let o=0;o<a.length;o++)if(a[o].length<2||a[o].charAt(1)!=="=")return!1;return!0},r.exports=t})(rd)),rd.exports}var m0=gk(),os=ak(m0),vk=RT({__proto__:null,default:os},[m0]);function ac(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const t=r.RTCIceCandidate;r.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const o=new t(a),l=os.parseCandidate(a.candidate);for(const h in l)h in o||Object.defineProperty(o,h,{value:l[h]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(a)},r.RTCIceCandidate.prototype=t.prototype,pa(r,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new r.RTCIceCandidate(i.candidate),writable:"false"}),i))}function wd(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||pa(r,"icecandidate",t=>{if(t.candidate){const i=os.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function sc(r,t){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(u){if(!u||!u.sdp)return!1;const m=os.splitSections(u.sdp);return m.shift(),m.some(p=>{const g=os.parseMLine(p);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},a=function(u){const m=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const p=parseInt(m[1],10);return p!==p?-1:p},o=function(u){let m=65536;return t.browser==="firefox"&&(t.version<57?u===-1?m=16384:m=2147483637:t.version<60?m=t.version===57?65535:65536:m=2147483637),m},l=function(u,m){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const g=os.matchPrefix(u.sdp,"a=max-message-size:");return g.length>0?p=parseInt(g[0].substring(19),10):t.browser==="firefox"&&m!==-1&&(p=2147483637),p},h=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=a(arguments[0]),p=o(m),g=l(arguments[0],m);let y;p===0&&g===0?y=Number.POSITIVE_INFINITY:p===0||g===0?y=Math.max(p,g):y=Math.min(p,g);const S={};Object.defineProperty(S,"maxMessageSize",{get(){return y}}),this._sctp=S}return h.apply(this,arguments)}}function rc(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(a,o){const l=a.send;a.send=function(){const u=arguments[0],m=u.length||u.size||u.byteLength;if(a.readyState==="open"&&o.sctp&&m>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const i=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return t(o,this),o},pa(r,"datachannel",a=>(t(a.channel,a.target),a))}function xd(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const a=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",o);l.dispatchEvent(h)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Nd(r,t){if(!r.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(h=>h.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&o instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return i.apply(this,arguments)}}function oc(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function cc(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(r.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>i.apply(this,[h]))})}var yk=Object.freeze({__proto__:null,removeExtmapAllowMixed:Nd,shimAddIceCandidateNullOrEmpty:oc,shimConnectionState:xd,shimMaxMessageSize:sc,shimParameterlessSetLocalDescription:cc,shimRTCIceCandidate:ac,shimRTCIceCandidateRelayProtocol:wd,shimSendThrowTypeError:rc});function bk(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=By,a=mk(r),o={browserDetails:a,commonShim:yk,extractVersion:yr,disableLog:hk,disableWarnings:fk,sdp:vk};switch(a.browser){case"chrome":if(!lv||!Ad||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(a.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=lv,oc(r,a),cc(r),qy(r,a),Vy(r),Ad(r,a),Fy(r),Yy(r,a),Hy(r),Gy(r),Jy(r,a),ac(r),wd(r),xd(r),sc(r,a),rc(r),Nd(r,a);break;case"firefox":if(!uv||!Md||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=uv,oc(r,a),cc(r),Qy(r,a),Md(r,a),Xy(r),$y(r),Zy(r),Wy(r),e0(r),t0(r),n0(r),i0(r),a0(r),ac(r),xd(r),sc(r,a),rc(r);break;case"safari":if(!dv||!t.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=dv,oc(r,a),cc(r),u0(r),h0(r),o0(r),s0(r),r0(r),d0(r),c0(r),f0(r),ac(r),wd(r),sc(r,a),rc(r),Nd(r,a);break;default:i("Unsupported browser!");break}return o}bk({window:typeof window>"u"?void 0:window});class Vt extends Promise{constructor(t){super(t)}catch(t){return super.catch(t)}static reject(t){return super.reject(t)}static all(t){return super.all(t)}static race(t){return super.race(t)}}const Sk=/version\/(\d+(\.?_?\d+)+)/i;let od;function Ht(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const i=navigator.userAgent.toLowerCase();if(od===void 0||t){const a=Tk.find(o=>{let{test:l}=o;return l.test(i)});od=a?.describe(i)}return od}const Tk=[{test:/firefox|iceweasel|fxios/i,describe(r){return{name:"Firefox",version:lc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:cd(r)}}},{test:/chrom|crios|crmo/i,describe(r){return{name:"Chrome",version:lc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("crios")?"iOS":void 0,osVersion:cd(r)}}},{test:/safari|applewebkit/i,describe(r){return{name:"Safari",version:lc(Sk,r),os:r.includes("mobile/")?"iOS":"macOS",osVersion:cd(r)}}}];function lc(r,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const a=t.match(r);return a&&a.length>=i&&a[i]||""}function cd(r){return r.includes("mac os")?lc(/\(.+?(\d+_\d+(:?_\d+)?)/,r,1).replace(/_/g,"."):void 0}var Ck="2.17.0";const kk=Ck,Ek=16;class Un extends Error{constructor(t,i){super(i||"an error has occured"),this.name="LiveKitError",this.code=t}}var Ke;(function(r){r[r.NotAllowed=0]="NotAllowed",r[r.ServerUnreachable=1]="ServerUnreachable",r[r.InternalError=2]="InternalError",r[r.Cancelled=3]="Cancelled",r[r.LeaveRequest=4]="LeaveRequest",r[r.Timeout=5]="Timeout",r[r.WebSocket=6]="WebSocket",r[r.ServiceNotFound=7]="ServiceNotFound"})(Ke||(Ke={}));class he extends Un{constructor(t,i,a,o){super(1,t),this.name="ConnectionError",this.status=a,this.reason=i,this.context=o,this.reasonName=Ke[i]}static notAllowed(t,i,a){return new he(t,Ke.NotAllowed,i,a)}static timeout(t){return new he(t,Ke.Timeout)}static leaveRequest(t,i){return new he(t,Ke.LeaveRequest,void 0,i)}static internal(t,i){return new he(t,Ke.InternalError,void 0,i)}static cancelled(t){return new he(t,Ke.Cancelled)}static serverUnreachable(t,i){return new he(t,Ke.ServerUnreachable,i)}static websocket(t,i,a){return new he(t,Ke.WebSocket,i,a)}static serviceNotFound(t,i){return new he(t,Ke.ServiceNotFound,void 0,i)}}class uh extends Un{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class ri extends Un{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class _k extends Un{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class ot extends Un{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class cs extends Un{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class fv extends Un{constructor(t,i){super(15,t),this.name="PublishTrackError",this.status=i}}class mv extends Un{constructor(t,i){super(15,t),this.name="SignalRequestError",this.reason=i,this.reasonName=typeof i=="string"?i:ch[i]}}var Mt;(function(r){r[r.AlreadyOpened=0]="AlreadyOpened",r[r.AbnormalEnd=1]="AbnormalEnd",r[r.DecodeFailed=2]="DecodeFailed",r[r.LengthExceeded=3]="LengthExceeded",r[r.Incomplete=4]="Incomplete",r[r.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",r[r.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Mt||(Mt={}));class mn extends Un{constructor(t,i){super(16,t),this.name="DataStreamError",this.reason=i,this.reasonName=Mt[i]}}class ts extends Un{constructor(t){super(18,t),this.name="SignalReconnectError"}}var yc;(function(r){r.PermissionDenied="PermissionDenied",r.NotFound="NotFound",r.DeviceInUse="DeviceInUse",r.Other="Other"})(yc||(yc={}));(function(r){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?r.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?r.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?r.DeviceInUse:r.Other}r.getFailure=t})(yc||(yc={}));class _t{}_t.setTimeout=function(){return setTimeout(...arguments)};_t.setInterval=function(){return setInterval(...arguments)};_t.clearTimeout=function(){return clearTimeout(...arguments)};_t.clearInterval=function(){return clearInterval(...arguments)};var Y;(function(r){r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting",r.Reconnected="reconnected",r.Disconnected="disconnected",r.ConnectionStateChanged="connectionStateChanged",r.Moved="moved",r.MediaDevicesChanged="mediaDevicesChanged",r.ParticipantConnected="participantConnected",r.ParticipantDisconnected="participantDisconnected",r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalAudioSilenceDetected="localAudioSilenceDetected",r.ActiveSpeakersChanged="activeSpeakersChanged",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.ParticipantAttributesChanged="participantAttributesChanged",r.ParticipantActive="participantActive",r.RoomMetadataChanged="roomMetadataChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.AudioPlaybackStatusChanged="audioPlaybackChanged",r.VideoPlaybackStatusChanged="videoPlaybackChanged",r.MediaDevicesError="mediaDevicesError",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.SignalConnected="signalConnected",r.RecordingStatusChanged="recordingStatusChanged",r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ActiveDeviceChanged="activeDeviceChanged",r.ChatMessage="chatMessage",r.LocalTrackSubscribed="localTrackSubscribed",r.MetricsReceived="metricsReceived"})(Y||(Y={}));var ee;(function(r){r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackCpuConstrained="localTrackCpuConstrained",r.LocalSenderCreated="localSenderCreated",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.IsSpeakingChanged="isSpeakingChanged",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.TrackCpuConstrained="trackCpuConstrained",r.MediaDevicesError="mediaDevicesError",r.AudioStreamAcquired="audioStreamAcquired",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.PCTrackAdded="pcTrackAdded",r.AttributesChanged="attributesChanged",r.LocalTrackSubscribed="localTrackSubscribed",r.ChatMessage="chatMessage",r.Active="active"})(ee||(ee={}));var W;(function(r){r.TransportsCreated="transportsCreated",r.Connected="connected",r.Disconnected="disconnected",r.Resuming="resuming",r.Resumed="resumed",r.Restarting="restarting",r.Restarted="restarted",r.SignalResumed="signalResumed",r.SignalRestarted="signalRestarted",r.Closing="closing",r.MediaTrackAdded="mediaTrackAdded",r.ActiveSpeakersUpdate="activeSpeakersUpdate",r.DataPacketReceived="dataPacketReceived",r.RTPVideoMapUpdate="rtpVideoMapUpdate",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ParticipantUpdate="participantUpdate",r.RoomUpdate="roomUpdate",r.SpeakersChanged="speakersChanged",r.StreamStateChanged="streamStateChanged",r.ConnectionQualityUpdate="connectionQualityUpdate",r.SubscriptionError="subscriptionError",r.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",r.RemoteMute="remoteMute",r.SubscribedQualityUpdate="subscribedQualityUpdate",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackSubscribed="localTrackSubscribed",r.Offline="offline",r.SignalRequestResponse="signalRequestResponse",r.SignalConnected="signalConnected",r.RoomMoved="roomMoved"})(W||(W={}));var Q;(function(r){r.Message="message",r.Muted="muted",r.Unmuted="unmuted",r.Restarted="restarted",r.Ended="ended",r.Subscribed="subscribed",r.Unsubscribed="unsubscribed",r.CpuConstrained="cpuConstrained",r.UpdateSettings="updateSettings",r.UpdateSubscription="updateSubscription",r.AudioPlaybackStarted="audioPlaybackStarted",r.AudioPlaybackFailed="audioPlaybackFailed",r.AudioSilenceDetected="audioSilenceDetected",r.VisibilityChanged="visibilityChanged",r.VideoDimensionsChanged="videoDimensionsChanged",r.VideoPlaybackStarted="videoPlaybackStarted",r.VideoPlaybackFailed="videoPlaybackFailed",r.ElementAttached="elementAttached",r.ElementDetached="elementDetached",r.UpstreamPaused="upstreamPaused",r.UpstreamResumed="upstreamResumed",r.SubscriptionPermissionChanged="subscriptionPermissionChanged",r.SubscriptionStatusChanged="subscriptionStatusChanged",r.SubscriptionFailed="subscriptionFailed",r.TrackProcessorUpdate="trackProcessorUpdate",r.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",r.TranscriptionReceived="transcriptionReceived",r.TimeSyncUpdate="timeSyncUpdate",r.PreConnectBufferFlushed="preConnectBufferFlushed"})(Q||(Q={}));function Rk(r){return typeof r>"u"?r:typeof structuredClone=="function"?typeof r=="object"&&r!==null?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r))}class Ve{constructor(t,i,a,o,l){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&a!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:a,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Ok=["vp8","h264"],Dk=["vp8","h264","vp9","av1","h265"];function Ak(r){return!!Ok.find(t=>t===r)}const Mk=Ak;var pv;(function(r){r[r.PREFER_REGRESSION=0]="PREFER_REGRESSION",r[r.SIMULCAST=1]="SIMULCAST",r[r.REGRESSION=2]="REGRESSION"})(pv||(pv={}));var Pd;(function(r){r.telephone={maxBitrate:12e3},r.speech={maxBitrate:24e3},r.music={maxBitrate:48e3},r.musicStereo={maxBitrate:64e3},r.musicHighQuality={maxBitrate:96e3},r.musicHighQualityStereo={maxBitrate:128e3}})(Pd||(Pd={}));const Rr={h90:new Ve(160,90,9e4,20),h180:new Ve(320,180,16e4,20),h216:new Ve(384,216,18e4,20),h360:new Ve(640,360,45e4,20),h540:new Ve(960,540,8e5,25),h720:new Ve(1280,720,17e5,30),h1080:new Ve(1920,1080,3e6,30),h1440:new Ve(2560,1440,5e6,30),h2160:new Ve(3840,2160,8e6,30)},Ld={h120:new Ve(160,120,7e4,20),h180:new Ve(240,180,125e3,20),h240:new Ve(320,240,14e4,20),h360:new Ve(480,360,33e4,20),h480:new Ve(640,480,5e5,20),h540:new Ve(720,540,6e5,25),h720:new Ve(960,720,13e5,30),h1080:new Ve(1440,1080,23e5,30),h1440:new Ve(1920,1440,38e5,30)},dh={h360fps3:new Ve(640,360,2e5,3,"medium"),h360fps15:new Ve(640,360,4e5,15,"medium"),h720fps5:new Ve(1280,720,8e5,5,"medium"),h720fps15:new Ve(1280,720,15e5,15,"medium"),h720fps30:new Ve(1280,720,2e6,30,"medium"),h1080fps15:new Ve(1920,1080,25e5,15,"medium"),h1080fps30:new Ve(1920,1080,5e6,30,"medium"),original:new Ve(0,0,7e6,30,"medium")};function p0(r,t,i){var a,o,l,h;const{optionsWithoutProcessor:u,audioProcessor:m,videoProcessor:p}=y0(r??{}),g=t?.processor,y=i?.processor,S=u??{};return S.audio===!0&&(S.audio={}),S.video===!0&&(S.video={}),S.audio&&(Ud(S.audio,t),(a=(l=S.audio).deviceId)!==null&&a!==void 0||(l.deviceId={ideal:"default"}),(m||g)&&(S.audio.processor=m??g)),S.video&&(Ud(S.video,i),(o=(h=S.video).deviceId)!==null&&o!==void 0||(h.deviceId={ideal:"default"}),(p||y)&&(S.video.processor=p??y)),S}function Ud(r,t){return Object.keys(t).forEach(i=>{r[i]===void 0&&(r[i]=t[i])}),r}function hh(r){var t,i,a,o;const l={};if(r.video)if(typeof r.video=="object"){const h={},u=h,m=r.video;Object.keys(m).forEach(p=>{p==="resolution"?Ud(u,m.resolution):u[p]=m[p]}),l.video=h,(t=(a=l.video).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})}else l.video=r.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return r.audio?typeof r.audio=="object"?(l.audio=r.audio,(i=(o=l.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function g0(r){return T(this,arguments,void 0,function(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const a=v0();if(a){const o=a.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,h=new Uint8Array(l);a.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(o),yield Rt(i),o.getByteTimeDomainData(h);const m=h.some(p=>p!==128&&p!==0);return a.close(),!m}return!1})()})}function v0(){var r;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const i=new t({latencyHint:"interactive"});if(i.state==="suspended"&&typeof window<"u"&&(!((r=window.document)===null||r===void 0)&&r.body)){const a=()=>T(this,void 0,void 0,function*(){var o;try{i.state==="suspended"&&(yield i.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}finally{(o=window.document.body)===null||o===void 0||o.removeEventListener("click",a)}});i.addEventListener("statechange",()=>{var o;i.state==="closed"&&((o=window.document.body)===null||o===void 0||o.removeEventListener("click",a))}),window.document.body.addEventListener("click",a)}return i}}function wk(r){return r==="audioinput"?F.Source.Microphone:r==="videoinput"?F.Source.Camera:F.Source.Unknown}function Id(r){return r===F.Source.Microphone?"audioinput":r===F.Source.Camera?"videoinput":void 0}function xk(r){var t,i;let a=(t=r.video)!==null&&t!==void 0?t:!0;return r.resolution&&r.resolution.width>0&&r.resolution.height>0&&(a=typeof a=="boolean"?{}:a,ma()?a=Object.assign(Object.assign({},a),{width:{max:r.resolution.width},height:{max:r.resolution.height},frameRate:r.resolution.frameRate}):a=Object.assign(Object.assign({},a),{width:{ideal:r.resolution.width},height:{ideal:r.resolution.height},frameRate:r.resolution.frameRate})),{audio:(i=r.audio)!==null&&i!==void 0?i:!1,video:a,controller:r.controller,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio,preferCurrentTab:r.preferCurrentTab}}function Tr(r){return r.split("/")[1].toLowerCase()}function Nk(r){const t=[];return r.forEach(i=>{i.track!==void 0&&t.push(new ih({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function Re(r){return"mediaStreamTrack"in r?{trackID:r.sid,source:r.source,muted:r.isMuted,enabled:r.mediaStreamTrack.enabled,kind:r.kind,streamID:r.mediaStreamID,streamTrackID:r.mediaStreamTrack.id}:{trackID:r.trackSid,enabled:r.isEnabled,muted:r.isMuted,trackInfo:Object.assign({mimeType:r.mimeType,name:r.trackName,encrypted:r.isEncrypted,kind:r.kind,source:r.source},r.track?Re(r.track):{})}}function Pk(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Lk(r,t){var i;r===void 0&&(r={}),t===void 0&&(t={});const a=[...Object.keys(t),...Object.keys(r)],o={};for(const l of a)r[l]!==t[l]&&(o[l]=(i=t[l])!==null&&i!==void 0?i:"");return o}function y0(r){const t=Object.assign({},r);let i,a;return typeof t.audio=="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(a=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:Rk(t)}}function Uk(r){switch(r){case ft.CAMERA:return F.Source.Camera;case ft.MICROPHONE:return F.Source.Microphone;case ft.SCREEN_SHARE:return F.Source.ScreenShare;case ft.SCREEN_SHARE_AUDIO:return F.Source.ScreenShareAudio;default:return F.Source.Unknown}}function gv(r,t){return r.width*r.height<t.width*t.height}function Ik(r,t){var i;return(i=r.layers)===null||i===void 0?void 0:i.find(a=>a.quality===t)}const jk=5e3,fr=[];var tn;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH"})(tn||(tn={}));class F extends Ln.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=F.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ce,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),jk):this.handleAppVisibilityChanged()},this.log=oi((o=a.loggerName)!==null&&o!==void 0?o:_n.Track),this.loggerContextCb=a.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=F.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Re(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let i="audio";this.kind===F.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===F.Kind.Video&&this.addAppVisibilityListener(),t||(i==="audio"&&(fr.forEach(l=>{l.parentElement===null&&!t&&(t=l)}),t&&fr.splice(fr.indexOf(t),1)),t||(t=document.createElement(i))),this.attachedElements.includes(t)||this.attachedElements.push(t),is(this.mediaStreamTrack,t);const a=t.srcObject.getTracks(),o=a.some(l=>l.kind==="audio");return t.play().then(()=>{this.emit(o?Q.AudioPlaybackStarted:Q.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?Q.AudioPlaybackFailed:Q.VideoPlaybackFailed,l):l.name==="AbortError"?Ce.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):Ce.warn("could not playback ".concat(o?"audio":"video"),l),o&&t&&a.some(h=>h.kind==="video")&&l.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(Q.ElementAttached,t),t}detach(t){try{if(t){ls(this.mediaStreamTrack,t);const a=this.attachedElements.indexOf(t);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(t),this.emit(Q.ElementDetached,t)),t}const i=[];return this.attachedElements.forEach(a=>{ls(this.mediaStreamTrack,a),i.push(a),this.recycleElement(a),this.emit(Q.ElementDetached,a)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=oi(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let i=!0;t.pause(),fr.forEach(a=>{a.parentElement||(i=!1)}),i&&fr.push(t)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===F.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ft()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ft()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function is(r,t){let i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;let a;r.kind==="audio"?a=i.getAudioTracks():a=i.getVideoTracks(),a.includes(r)||(a.forEach(o=>{i.removeTrack(o)}),i.addTrack(r)),(!ma()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(ma()||fa())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=i,t.play().catch(()=>{})},0))}function ls(r,t){if(t.srcObject instanceof MediaStream){const i=t.srcObject;i.removeTrack(r),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(r){let t;(function(p){p.Audio="audio",p.Video="video",p.Unknown="unknown"})(t=r.Kind||(r.Kind={}));let i;(function(p){p.Camera="camera",p.Microphone="microphone",p.ScreenShare="screen_share",p.ScreenShareAudio="screen_share_audio",p.Unknown="unknown"})(i=r.Source||(r.Source={}));let a;(function(p){p.Active="active",p.Paused="paused",p.Unknown="unknown"})(a=r.StreamState||(r.StreamState={}));function o(p){switch(p){case t.Audio:return Tn.AUDIO;case t.Video:return Tn.VIDEO;default:return Tn.DATA}}r.kindToProto=o;function l(p){switch(p){case Tn.AUDIO:return t.Audio;case Tn.VIDEO:return t.Video;default:return t.Unknown}}r.kindFromProto=l;function h(p){switch(p){case i.Camera:return ft.CAMERA;case i.Microphone:return ft.MICROPHONE;case i.ScreenShare:return ft.SCREEN_SHARE;case i.ScreenShareAudio:return ft.SCREEN_SHARE_AUDIO;default:return ft.UNKNOWN}}r.sourceToProto=h;function u(p){switch(p){case ft.CAMERA:return i.Camera;case ft.MICROPHONE:return i.Microphone;case ft.SCREEN_SHARE:return i.ScreenShare;case ft.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}r.sourceFromProto=u;function m(p){switch(p){case _d.ACTIVE:return a.Active;case _d.PAUSED:return a.Paused;default:return a.Unknown}}r.streamStateFromProto=m})(F||(F={}));const Bk="|",vv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function zk(r){const t=r.split(Bk);return t.length>1?[t[0],r.substr(t[0].length+1)]:[r,""]}function Rt(r){return new Vt(t=>_t.setTimeout(t,r))}function jd(){return"addTransceiver"in RTCPeerConnection.prototype}function Bd(){return"addTrack"in RTCPeerConnection.prototype}function qk(){if(!("getCapabilities"in RTCRtpSender)||ma()||fa())return!1;const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function Vk(){if(!("getCapabilities"in RTCRtpSender)||fa())return!1;if(ma()){const i=Ht();if(i?.version&&Pn(i.version,"16")<0||i?.os==="iOS"&&i?.osVersion&&Pn(i.osVersion,"16")<0)return!1}const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function kn(r){return r==="av1"||r==="vp9"}function zd(r){return!document||Or()?!1:(r||(r=document.createElement("audio")),"setSinkId"in r)}function Fk(){return typeof RTCPeerConnection>"u"?!1:jd()||Bd()}function fa(){var r;return((r=Ht())===null||r===void 0?void 0:r.name)==="Firefox"}function yv(){const r=Ht();return!!r&&r.name==="Chrome"&&r.os!=="iOS"}function ma(){var r;return((r=Ht())===null||r===void 0?void 0:r.name)==="Safari"}function Or(){const r=Ht();return r?.name==="Safari"||r?.os==="iOS"}function Hk(){const r=Ht();return r?.name==="Safari"&&r.version.startsWith("17.")||r?.os==="iOS"&&!!r?.osVersion&&Pn(r.osVersion,"17")>=0}function Gk(r){return r||(r=Ht()),r?.name==="Safari"&&Pn(r.version,"18.3")>0||r?.os==="iOS"&&!!r?.osVersion&&Pn(r.osVersion,"18.3")>0}function b0(){var r,t;return Ft()?(t=(r=navigator.userAgentData)===null||r===void 0?void 0:r.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Kk(){const r=Ht(),t="17.2";if(r)return r.name!=="Safari"&&r.os!=="iOS"||r.os==="iOS"&&r.osVersion&&Pn(r.osVersion,t)>=0?!0:r.name==="Safari"&&Pn(r.version,t)>=0}function Ft(){return typeof document<"u"}function Nn(){return navigator.product=="ReactNative"}function ms(r){return r.hostname.endsWith(".livekit.cloud")||r.hostname.endsWith(".livekit.run")}function ld(r){return ms(r)?r.hostname.split(".")[0]:null}function S0(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function T0(){if(!Nn())return;let r=S0();if(r)return r.platform}function bv(){if(Ft())return window.devicePixelRatio;if(Nn()){let r=S0();if(r)return r.devicePixelRatio}return 1}function Pn(r,t){const i=r.split("."),a=t.split("."),o=Math.min(i.length,a.length);for(let l=0;l<o;++l){const h=parseInt(i[l],10),u=parseInt(a[l],10);if(h>u)return 1;if(h<u)return-1;if(l===o-1&&h===u)return 0}return r===""&&t!==""?-1:t===""?1:i.length==a.length?0:i.length<a.length?-1:1}function Yk(r){for(const t of r)t.target.handleResize(t)}function Jk(r){for(const t of r)t.target.handleVisibilityChanged(t)}let ud=null;const Sv=()=>(ud||(ud=new ResizeObserver(Yk)),ud);let dd=null;const Tv=()=>(dd||(dd=new IntersectionObserver(Jk,{root:null,rootMargin:"0px"})),dd);function Qk(){var r;const t=new Ty({sdk:Cy.JS,protocol:Ek,version:kk});return Nn()&&(t.os=(r=T0())!==null&&r!==void 0?r:""),t}function Cv(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=r,o.height=t;const l=o.getContext("2d");l?.fillRect(0,0,o.width,o.height),a&&l&&(l.beginPath(),l.arc(r/2,t/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const h=o.captureStream(),[u]=h.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=i,u}let mr;function hd(){if(!mr){const r=new AudioContext,t=r.createOscillator(),i=r.createGain();i.gain.setValueAtTime(0,0);const a=r.createMediaStreamDestination();if(t.connect(i),i.connect(a),t.start(),[mr]=a.stream.getAudioTracks(),!mr)throw Error("Could not get empty media stream audio track");mr.enabled=!1}return mr.clone()}class pn{get isResolved(){return this._isResolved}constructor(t,i){this._isResolved=!1,this.onFinally=i,this.promise=new Promise((a,o)=>T(this,void 0,void 0,function*(){this.resolve=a,this.reject=o,t&&(yield t(a,o))})).finally(()=>{var a;this._isResolved=!0,(a=this.onFinally)===null||a===void 0||a.call(this)})}}function Xk(r){return Dk.includes(r)}function Bi(r){if(typeof r=="string"||typeof r=="number")return r;if(Array.isArray(r))return r[0];if(r.exact!==void 0)return Array.isArray(r.exact)?r.exact[0]:r.exact;if(r.ideal!==void 0)return Array.isArray(r.ideal)?r.ideal[0]:r.ideal;throw Error("could not unwrap constraint")}function Zk(r){return r.startsWith("http")?r.replace(/^(http)/,"ws"):r}function Dr(r){return r.startsWith("ws")?r.replace(/^(ws)/,"http"):r}function Wk(r,t){return r.segments.map(i=>{let{id:a,text:o,language:l,startTime:h,endTime:u,final:m}=i;var p;const g=(p=t.get(a))!==null&&p!==void 0?p:Date.now(),y=Date.now();return m?t.delete(a):t.set(a,g),{id:a,text:o,startTime:Number.parseInt(h.toString()),endTime:Number.parseInt(u.toString()),final:m,language:l,firstReceivedTime:g,lastReceivedTime:y}})}function $k(r){const{id:t,timestamp:i,message:a,editTimestamp:o}=r;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:a}}function kv(r){switch(r.reason){case Ke.LeaveRequest:return r.context;case Ke.Cancelled:return En.CLIENT_INITIATED;case Ke.NotAllowed:return En.USER_REJECTED;case Ke.ServerUnreachable:return En.JOIN_FAILURE;default:return En.UNKNOWN_REASON}}function uc(r){return r!==void 0?Number(r):void 0}function da(r){return r!==void 0?BigInt(r):void 0}function us(r){return!!r&&!(r instanceof MediaStreamTrack)&&r.isLocal}function xn(r){return!!r&&r.kind==F.Kind.Audio}function Fi(r){return!!r&&r.kind==F.Kind.Video}function Pi(r){return us(r)&&Fi(r)}function ti(r){return us(r)&&xn(r)}function qd(r){return!!r&&!r.isLocal}function eE(r){return!!r&&!r.isLocal}function fd(r){return qd(r)&&Fi(r)}function tE(r){return r.isLocal}function nE(r,t){const i=[];let a=new TextEncoder().encode(r);for(;a.length>t;){let o=t;for(;o>0;){const l=a[o];if(l!==void 0&&(l&192)!==128)break;o--}i.push(a.slice(0,o)),a=a.slice(o)}return a.length>0&&i.push(a),i}function iE(r){var t;const i=r.get("Cache-Control");if(i){const a=(t=i.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(a)return parseInt(a,10)}}function aE(r,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const a=sE(r,t);return i?a:fh(a,"v1")}function sE(r,t){const i=new URL(Zk(r));return t.forEach((a,o)=>{i.searchParams.set(o,a)}),fh(i,"rtc")}function rE(r){const t=new URL(Dr(r));return fh(t,"validate")}function C0(r){return r.endsWith("/")?r:"".concat(r,"/")}function fh(r,t){return r.pathname="".concat(C0(r.pathname)).concat(t),r}function Ev(r){if(typeof r=="string")return nv.fromJson(JSON.parse(r),{ignoreUnknownFields:!0});if(r instanceof ArrayBuffer)return nv.fromBinary(new Uint8Array(r));throw new Error("could not decode websocket message: ".concat(typeof r))}function oE(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(r instanceof AbortSignal))return t;const i=r.reason;switch(typeof i){case"string":return i;case"object":return i instanceof Error?i.message:t;default:return"toString"in i?i.toString():t}}const cE=10,pr="lk_e2ee",lE="LKFrameEncryptionKey",uE={sharedKey:!1,ratchetSalt:lE,ratchetWindowSize:8,failureTolerance:cE,keyringSize:16};var zi;(function(r){r.SetKey="setKey",r.RatchetRequest="ratchetRequest",r.KeyRatcheted="keyRatcheted"})(zi||(zi={}));var _v;(function(r){r.KeyRatcheted="keyRatcheted"})(_v||(_v={}));var Ii;(function(r){r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError"})(Ii||(Ii={}));var Rv;(function(r){r.Error="cryptorError"})(Rv||(Rv={}));function dE(){return hE()||Vd()}function Vd(){return typeof window.RTCRtpScriptTransform<"u"}function hE(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function fE(r){var t,i,a,o,l;if(((t=r.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((i=r.value)===null||i===void 0?void 0:i.case)!=="metrics"&&((a=r.value)===null||a===void 0?void 0:a.case)!=="speaker"&&((o=r.value)===null||o===void 0?void 0:o.case)!=="transcription"&&((l=r.value)===null||l===void 0?void 0:l.case)!=="encryptedPacket")return new my({value:r.value})}class l1 extends Ln.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,a,o)=>{Ce.debug("key ratcheted event received",{ratchetResult:i,participantId:a,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},uE),t),this.on(zi.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,i,a){const o={key:t,participantIdentity:i,keyIndex:a};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(a??0),o),this.emit(zi.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,i){this.emit(zi.RatchetRequest,t,i)}}var Ov;(function(r){r[r.InvalidKey=0]="InvalidKey",r[r.MissingKey=1]="MissingKey",r[r.InternalError=2]="InternalError"})(Ov||(Ov={}));class mE extends Ln.EventEmitter{constructor(t,i){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=a=>{var o,l;const{kind:h,data:u}=a.data;switch(h){case"error":if(Ce.error(u.error.message),u.uuid){const g=this.decryptDataRequests.get(u.uuid);if(g?.reject){g.reject(u.error);break}const y=this.encryptDataRequests.get(u.uuid);if(y?.reject){y.reject(u.error);break}}this.emit(Ii.EncryptionError,u.error,u.participantIdentity);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity))this.emit(Ii.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const g=(l=this.room)===null||l===void 0?void 0:l.getParticipantByIdentity(u.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(Ii.ParticipantEncryptionStatusChanged,u.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(zi.KeyRatcheted,u.ratchetResult,u.participantIdentity,u.keyIndex);break;case"decryptDataResponse":const m=this.decryptDataRequests.get(u.uuid);m?.resolve&&m.resolve(u);break;case"encryptDataResponse":const p=this.encryptDataRequests.get(u.uuid);p?.resolve&&p.resolve(u);break}},this.onWorkerError=a=>{Ce.error("e2ee worker encountered an error:",{error:a.error}),this.emit(Ii.EncryptionError,a.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=i}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!dE())throw new uh("tried to setup end-to-end encryption on an unsupported browser");if(Ce.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:ok.getLevel()}};this.worker&&(Ce.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(t,i){Ce.debug("set e2ee to ".concat(t," for participant ").concat(i)),this.postEnable(t,i)}setSifTrailer(t){!t||t.length===0?Ce.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(W.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(t,i){t.on(Y.TrackPublished,(a,o)=>this.setParticipantCryptorEnabled(a.trackInfo.encryption!==pt.NONE,o.identity)),t.on(Y.ConnectionStateChanged,a=>{a===Pe.Connected&&t.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==pt.NONE,o.identity)})})}).on(Y.TrackUnsubscribed,(a,o,l)=>{var h;const u={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:a.mediaStreamID}};(h=this.worker)===null||h===void 0||h.postMessage(u)}).on(Y.TrackSubscribed,(a,o,l)=>{this.setupE2EEReceiver(a,l.identity,o.trackInfo)}).on(Y.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");i.getKeys().forEach(a=>{this.postKey(a)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(ee.LocalSenderCreated,(a,o)=>T(this,void 0,void 0,function*(){this.setupE2EESender(o,a)})),t.localParticipant.on(ee.LocalTrackPublished,a=>{if(!Fi(a.track)||!Or())return;const o={kind:"updateCodec",data:{trackId:a.track.mediaStreamID,codec:Tr(a.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),i.on(zi.SetKey,a=>this.postKey(a)).on(zi.RatchetRequest,(a,o)=>this.postRatchetRequest(a,o))}encryptData(t){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const i=crypto.randomUUID(),a={kind:"encryptDataRequest",data:{uuid:i,payload:t,participantIdentity:this.room.localParticipant.identity}},o=new pn;return o.onFinally=()=>{this.encryptDataRequests.delete(i)},this.encryptDataRequests.set(i,o),this.worker.postMessage(a),o.promise})}handleEncryptedData(t,i,a,o){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const l=crypto.randomUUID(),h={kind:"decryptDataRequest",data:{uuid:l,payload:t,iv:i,participantIdentity:a,keyIndex:o}},u=new pn;return u.onFinally=()=>{this.decryptDataRequests.delete(l)},this.decryptDataRequests.set(l,u),this.worker.postMessage(h),u.promise}postRatchetRequest(t,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const a={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:i}};this.worker.postMessage(a)}postKey(t){let{key:i,participantIdentity:a,keyIndex:o}=t;var l;if(!this.worker)throw Error("could not set key, worker is missing");const h={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:i,keyIndex:o}};this.worker.postMessage(h)}postEnable(t,i){if(this.worker){const a={kind:"enable",data:{enabled:t,participantIdentity:i}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const a={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(i)}setupE2EEReceiver(t,i,a){if(t.receiver){if(!a?.mimeType||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,i,t.kind==="video"?Tr(a.mimeType):void 0)}}setupE2EESender(t,i){if(!us(t)||!i){i||Ce.warn("early return because sender is not ready");return}this.handleSender(i,t.mediaStreamID,void 0)}handleReceiver(t,i,a,o){return T(this,void 0,void 0,function*(){if(this.worker){if(Vd()&&!yv()){const l={kind:"decode",participantIdentity:a,trackId:i,codec:o};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(pr in t&&o){const m={kind:"updateCodec",data:{trackId:i,codec:o,participantIdentity:a}};this.worker.postMessage(m);return}let l=t.writableStream,h=t.readableStream;if(!l||!h){const m=t.createEncodedStreams();t.writableStream=m.writable,l=m.writable,t.readableStream=m.readable,h=m.readable}const u={kind:"decode",data:{readableStream:h,writableStream:l,trackId:i,codec:o,participantIdentity:a,isReuse:pr in t}};this.worker.postMessage(u,[h,l])}t[pr]=!0}})}handleSender(t,i,a){var o;if(!(pr in t||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Vd()&&!yv()){Ce.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:a};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{Ce.info("initialize encoded streams");const l=t.createEncodedStreams(),h={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:a,trackId:i,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(h,[l.readable,l.writable])}t[pr]=!0}}}const pE=500,gE=15e3;class ds{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new ds),this._instance}addFailedConnectionAttempt(t){var i;const a=new URL(t),o=ld(a);if(!o)return;let l=(i=this.failedConnectionAttempts.get(o))!==null&&i!==void 0?i:0;this.failedConnectionAttempts.set(o,l+1),this.backOffPromises.set(o,Rt(Math.min(pE*Math.pow(2,l),gE)))}getBackOffPromise(t){const i=new URL(t),a=i&&ld(i);return a&&this.backOffPromises.get(a)||Promise.resolve()}resetFailedConnectionAttempts(t){const i=new URL(t),a=i&&ld(i);a&&(this.failedConnectionAttempts.set(a,0),this.backOffPromises.set(a,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}ds._instance=null;const md="default";class bt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new bt),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=bt.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){Ce.debug("awaiting getUserMedia promise");try{i?yield bt.userMediaPromiseMap.get(i):yield Promise.all(bt.userMediaPromiseMap.values())}catch{Ce.warn("error waiting for media permissons")}}let h=yield navigator.mediaDevices.enumerateDevices();if(o&&!(ma()&&a.hasDeviceInUse(i))&&(h.filter(m=>m.kind===i).length===0||h.some(m=>{const p=m.label==="",g=i?m.kind===i:!0;return p&&g}))){const m={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"&&{deviceId:{ideal:"default"}}},p=yield navigator.mediaDevices.getUserMedia(m);h=yield navigator.mediaDevices.enumerateDevices(),p.getTracks().forEach(g=>{g.stop()})}return a._previousDevices=h,i&&(h=h.filter(u=>u.kind===i)),h})()})}normalizeDeviceId(t,i,a){return T(this,void 0,void 0,function*(){if(i!==md)return i;const o=yield this.getDevices(t),l=o.find(u=>u.deviceId===md);if(!l){Ce.warn("could not reliably determine default device");return}const h=o.find(u=>u.deviceId!==md&&u.groupId===(a??l.groupId));if(!h){Ce.warn("could not reliably determine default device");return}return h?.deviceId})}hasDeviceInUse(t){return t?bt.userMediaPromiseMap.has(t):bt.userMediaPromiseMap.size>0}}bt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];bt.userMediaPromiseMap=new Map;var Cr;(function(r){r[r.WAITING=0]="WAITING",r[r.RUNNING=1]="RUNNING",r[r.COMPLETED=2]="COMPLETED"})(Cr||(Cr={}));class vE{constructor(){this.pendingTasks=new Map,this.taskMutex=new xt,this.nextTaskIndex=0}run(t){return T(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Cr.WAITING};this.pendingTasks.set(i.id,i);const a=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=Cr.RUNNING,yield t()}finally{i.status=Cr.COMPLETED,this.pendingTasks.delete(i.id),a()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class yE{get readyState(){return this.ws.readyState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a,o;if(!((a=i.signal)===null||a===void 0)&&a.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const l=new WebSocket(t,(o=i.protocols)!==null&&o!==void 0?o:[]);l.binaryType="arraybuffer",this.ws=l;const h=function(){let{closeCode:u,reason:m}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l.close(u,m)};this.opened=new Vt((u,m)=>{const p=()=>{m(he.websocket("Encountered websocket error during connection establishment"))};l.onopen=()=>{u({readable:new ReadableStream({start(g){l.onmessage=y=>{let{data:S}=y;return g.enqueue(S)},l.onerror=y=>g.error(y)},cancel:h}),writable:new WritableStream({write(g){l.send(g)},abort(){l.close()},close:h}),protocol:l.protocol,extensions:l.extensions}),l.removeEventListener("error",p)},l.addEventListener("error",p)}),this.closed=new Vt((u,m)=>{const p=()=>T(this,void 0,void 0,function*(){const g=new Vt(S=>{l.readyState!==WebSocket.CLOSED&&l.addEventListener("close",k=>{S(k)},{once:!0})}),y=yield Vt.race([Rt(250),g]);y?u(y):m(he.websocket("Encountered unspecified websocket error without a timely close event"))});l.onclose=g=>{let{code:y,reason:S}=g;u({closeCode:y,reason:S}),l.removeEventListener("error",p)},l.addEventListener("error",p)}),i.signal&&(i.signal.onabort=()=>l.close()),this.close=h}}const bE=["syncState","trickle","offer","answer","simulate","leave"];function SE(r){const t=bE.indexOf(r.case)>=0;return Ce.trace("request allowed to bypass queue:",{canPass:t,req:r}),t}var Ge;(function(r){r[r.CONNECTING=0]="CONNECTING",r[r.CONNECTED=1]="CONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.DISCONNECTING=3]="DISCONNECTING",r[r.DISCONNECTED=4]="DISCONNECTED"})(Ge||(Ge={}));const TE=250;class mh{get currentState(){return this.state}get isDisconnected(){return this.state===Ge.DISCONNECTING||this.state===Ge.DISCONNECTED}get isEstablishingConnection(){return this.state===Ge.CONNECTING||this.state===Ge.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;this.rtt=0,this.state=Ge.DISCONNECTED,this.log=Ce,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=oi((a=i.loggerName)!==null&&a!==void 0?a:_n.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=t,this.requestQueue=new vE,this.queuedRequests=[],this.closingLock=new xt,this.connectionLock=new xt,this.state=Ge.DISCONNECTED}get logContext(){var t,i;return(i=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&i!==void 0?i:{}}join(t,i,a,o){return T(this,arguments,void 0,function(l,h,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return p.state=Ge.CONNECTING,p.options=u,yield p.connect(l,h,u,m,g)})()})}reconnect(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ge.RECONNECTING,this.clearPingInterval(),yield this.connect(t,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:a,reconnectReason:o}),void 0,this.useV0SignalPath)})}connect(t,i,a,o){return T(this,arguments,void 0,function(l,h,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const y=yield p.connectionLock.lock();p.connectOptions=u,p.useV0SignalPath=g;const S=Qk(),k=g?CE(h,S,u):kE(h,S,u),A=aE(l,k,g).toString(),R=rE(A).toString();return new Promise((G,I)=>T(p,void 0,void 0,function*(){var Z,X;try{let M=!1;const D=ie=>T(this,void 0,void 0,function*(){if(M)return;M=!0;const re=ie instanceof Event?ie.currentTarget:ie,ae=oE(re,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(ae)).catch(fe=>{this.log.error(fe),this.close()}):this.close(),z(),I(he.cancelled(ae))});m?.addEventListener("abort",D);const z=()=>{clearTimeout(K),m?.removeEventListener("abort",D)},K=setTimeout(()=>{D(he.timeout("room connection has timed out (signal)"))},u.websocketTimeout),se=(ie,re)=>{this.handleSignalConnected(ie,K,re)},ne=new URL(A);ne.searchParams.has("access_token")&&ne.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(ne),Object.assign({reconnect:u.reconnect,reconnectReason:u.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new yE(A);try{this.ws.closed.then(L=>{var J;this.isEstablishingConnection&&I(he.internal("Websocket got closed during a (re)connection attempt: ".concat(L.reason))),L.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:L.reason,code:L.closeCode,wasClean:L.closeCode===1e3,state:this.state})),this.state===Ge.CONNECTED&&this.handleOnClose((J=L.reason)!==null&&J!==void 0?J:"Unexpected WS error"))}).catch(L=>{this.isEstablishingConnection&&I(he.internal("Websocket error during a (re)connection attempt: ".concat(L)))});const ie=yield this.ws.opened.catch(L=>T(this,void 0,void 0,function*(){if(this.state!==Ge.CONNECTED){this.state=Ge.DISCONNECTED,clearTimeout(K);const J=yield this.handleConnectionError(L,R);I(J);return}this.handleWSError(L),I(L)}));if(clearTimeout(K),!ie)return;const re=ie.readable.getReader();this.streamWriter=ie.writable.getWriter();const ae=yield re.read();if(re.releaseLock(),!ae.value)throw he.internal("no message received as first message");const fe=Ev(ae.value),Fe=this.validateFirstMessage(fe,(Z=u.reconnect)!==null&&Z!==void 0?Z:!1);if(!Fe.isValid){I(Fe.error);return}((X=fe.message)===null||X===void 0?void 0:X.case)==="join"&&(this.pingTimeoutDuration=fe.message.value.pingTimeout,this.pingIntervalDuration=fe.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Qe=Fe.shouldProcessFirstMessage?fe:void 0;se(ie,Qe),G(Fe.response)}catch(ie){I(ie)}finally{z()}}finally{y()}}))})()})}startReadingLoop(t,i){return T(this,void 0,void 0,function*(){for(i&&this.handleSignalResponse(i);;){this.signalLatency&&(yield Rt(this.signalLatency));const{done:a,value:o}=yield t.read();if(a)break;const l=Ev(o);this.handleSignalResponse(l)}})}close(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Ge.DISCONNECTING||Ge.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const o=yield t.closingLock.lock();try{if(t.clearPingInterval(),i&&(t.state=Ge.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:a});const l=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([l,Rt(TE)])}}catch(l){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:l}))}finally{i&&(t.state=Ge.DISCONNECTED),o()}})()})}sendOffer(t,i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:as(t,i)})}sendAnswer(t,i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:as(t,i)})}sendIceCandidate(t,i){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new Rc({candidateInit:JSON.stringify(t),target:i})})}sendMuteTrack(t,i){return this.sendRequest({case:"mute",value:new Oc({sid:t,muted:i})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new sh({requestId:u,metadata:a,name:o,attributes:h})}),u})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,i){return this.sendRequest({case:"updateLayers",value:new Ay({trackSid:t,layers:i})})}sendUpdateSubscriptionPermissions(t,i){return this.sendRequest({case:"subscriptionPermission",value:new xy({allParticipants:t,trackPermissions:i})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:We.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ly({timestamp:We.parse(Date.now()),rtt:We.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,i){return this.sendRequest({case:"updateAudioTrack",value:new ah({trackSid:t,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ac({reason:En.CLIENT_INITIATED,action:rs.DISCONNECT})})}sendRequest(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!SE(i)&&a.state===Ge.RECONNECTING){a.queuedRequests.push(()=>T(a,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(o||(yield a.requestQueue.flush()),a.signalLatency&&(yield Rt(a.signalLatency)),a.isDisconnected){a.log.debug("skipping signal request (type: ".concat(i.case,") - SignalClient disconnected"));return}if(!a.streamWriter){a.log.error("cannot send signal request before connected, type: ".concat(i?.case),a.logContext);return}const h=new xC({message:i});try{a.useJSON?yield a.streamWriter.write(h.toJsonString()):yield a.streamWriter.write(h.toBinary())}catch(u){a.log.error("error sending signal message",Object.assign(Object.assign({},a.logContext),{error:u}))}})()})}handleSignalResponse(t){var i,a;const o=t.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const h=Dv(o.value);this.onAnswer&&this.onAnswer(h,o.value.id,o.value.midToTrackId)}else if(o.case==="offer"){const h=Dv(o.value);this.onOffer&&this.onOffer(h,o.value.id,o.value.midToTrackId)}else if(o.case==="trickle"){const h=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(h,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=o.value.participants)!==null&&i!==void 0?i:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=o.value.speakers)!==null&&a!==void 0?a:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):o.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(o.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return T(this,void 0,void 0,function*(){if(this.state===Ge.DISCONNECTED)return;const i=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),i&&i(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=_t.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&_t.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=_t.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&_t.clearInterval(this.pingInterval)}handleSignalConnected(t,i,a){this.state=Ge.CONNECTED,clearTimeout(i),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),a)}validateFirstMessage(t,i){var a,o,l,h,u;return((a=t.message)===null||a===void 0?void 0:a.case)==="join"?{isValid:!0,response:t.message.value}:this.state===Ge.RECONNECTING&&((o=t.message)===null||o===void 0?void 0:o.case)!=="leave"?((l=t.message)===null||l===void 0?void 0:l.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((h=t.message)===null||h===void 0?void 0:h.case)==="leave"?{isValid:!1,error:he.leaveRequest("Received leave request while trying to (re)connect",t.message.value.reason)}:i?{isValid:!1,error:he.internal("Unexpected first message")}:{isValid:!1,error:he.internal("did not receive join response, got ".concat((u=t.message)===null||u===void 0?void 0:u.case," instead"))}}handleConnectionError(t,i){return T(this,void 0,void 0,function*(){try{const a=yield fetch(i);switch(a.status){case 404:return he.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const o=yield a.text();return he.notAllowed(o,a.status);default:break}return t instanceof he?t:he.internal("Encountered unknown websocket error during connection: ".concat(t),{status:a.status,statusText:a.statusText})}catch(a){return a instanceof he?a:he.serverUnreachable(a instanceof Error?a.message:"server was not reachable")}})}}function Dv(r){const t={type:"offer",sdp:r.sdp};switch(r.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=r.type;break}return t}function as(r,t){return new Vi({sdp:r.sdp,type:r.type,id:t})}function CE(r,t,i){var a;const o=new URLSearchParams;return o.set("access_token",r),i.reconnect&&(o.set("reconnect","1"),i.sid&&o.set("sid",i.sid)),o.set("auto_subscribe",i.autoSubscribe?"1":"0"),o.set("sdk",Nn()?"reactnative":"js"),o.set("version",t.version),o.set("protocol",t.protocol.toString()),t.deviceModel&&o.set("device_model",t.deviceModel),t.os&&o.set("os",t.os),t.osVersion&&o.set("os_version",t.osVersion),t.browser&&o.set("browser",t.browser),t.browserVersion&&o.set("browser_version",t.browserVersion),i.adaptiveStream&&o.set("adaptive_stream","1"),i.reconnectReason&&o.set("reconnect_reason",i.reconnectReason.toString()),!((a=navigator.connection)===null||a===void 0)&&a.type&&o.set("network",navigator.connection.type),o}function kE(r,t,i){const a=new URLSearchParams;a.set("access_token",r);const o=new ek({clientInfo:t,connectionSettings:new Uy({autoSubscribe:!!i.autoSubscribe,adaptiveStream:!!i.adaptiveStream}),reconnect:!!i.reconnect,participantSid:i.sid?i.sid:void 0});i.reconnectReason&&(o.reconnectReason=i.reconnectReason);const l=new tk({joinRequest:o.toBinary()});return a.set("join_request",btoa(new TextDecoder("utf-8").decode(l.toBinary()))),a}class Av{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const i=this.buffer[0];if(this._totalSize-i.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class EE{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,i){const a=Date.now();a-this._lastCleanup>this.ttl/2&&this.cleanup();const o=a+this.ttl;return this._map.set(t,{value:i,expiresAt:o}),this}get(t){const i=this._map.get(t);if(i){if(i.expiresAt<Date.now()){this._map.delete(t);return}return i.value}}has(t){const i=this._map.get(t);return i?i.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[i,a]of this._map.entries())a.expiresAt<t&&this._map.delete(i);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t(a.value,i,this.asValueMap())}map(t){this.cleanup();const i=[],a=this.asValueMap();for(const[o,l]of a.entries())i.push(t(l,o,a));return i}asValueMap(){const t=new Map;for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t.set(i,a.value);return t}}var bn={},pd={},gd={exports:{}},Mv;function ph(){if(Mv)return gd.exports;Mv=1;var r=gd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(r).forEach(function(t){var i=r[t];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})}),gd.exports}var wv;function _E(){return wv||(wv=1,(function(r){var t=function(u){return String(Number(u))===u?Number(u):u},i=function(u,m,p,g){if(g&&!p)m[g]=t(u[1]);else for(var y=0;y<p.length;y+=1)u[y+1]!=null&&(m[p[y]]=t(u[y+1]))},a=function(u,m,p){var g=u.name&&u.names;u.push&&!m[u.push]?m[u.push]=[]:g&&!m[u.name]&&(m[u.name]={});var y=u.push?{}:g?m[u.name]:m;i(p.match(u.reg),y,u.names,u.name),u.push&&m[u.push].push(y)},o=ph(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(u){var m={},p=[],g=m;return u.split(/(\r\n|\r|\n)/).filter(l).forEach(function(y){var S=y[0],k=y.slice(2);S==="m"&&(p.push({rtp:[],fmtp:[]}),g=p[p.length-1]);for(var A=0;A<(o[S]||[]).length;A+=1){var R=o[S][A];if(R.reg.test(k))return a(R,g,k)}}),m.media=p,m};var h=function(u,m){var p=m.split(/=(.+)/,2);return p.length===2?u[p[0]]=t(p[1]):p.length===1&&m.length>1&&(u[p[0]]=void 0),u};r.parseParams=function(u){return u.split(/;\s?/).reduce(h,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(u){return u.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(u){for(var m=[],p=u.split(" ").map(t),g=0;g<p.length;g+=3)m.push({component:p[g],ip:p[g+1],port:p[g+2]});return m},r.parseImageAttributes=function(u){return u.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(h,{})})},r.parseSimulcastStreamList=function(u){return u.split(";").map(function(m){return m.split(",").map(function(p){var g,y=!1;return p[0]!=="~"?g=t(p):(g=t(p.substring(1,p.length)),y=!0),{scid:g,paused:y}})})}})(pd)),pd}var vd,xv;function RE(){if(xv)return vd;xv=1;var r=ph(),t=/%[sdv%]/g,i=function(h){var u=1,m=arguments,p=m.length;return h.replace(t,function(g){if(u>=p)return g;var y=m[u];switch(u+=1,g){case"%%":return"%";case"%s":return String(y);case"%d":return Number(y);case"%v":return""}})},a=function(h,u,m){var p=u.format instanceof Function?u.format(u.push?m:m[u.name]):u.format,g=[h+"="+p];if(u.names)for(var y=0;y<u.names.length;y+=1){var S=u.names[y];u.name?g.push(m[u.name][S]):g.push(m[u.names[y]])}else g.push(m[u.name]);return i.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return vd=function(h,u){u=u||{},h.version==null&&(h.version=0),h.name==null&&(h.name=" "),h.media.forEach(function(y){y.payloads==null&&(y.payloads="")});var m=u.outerOrder||o,p=u.innerOrder||l,g=[];return m.forEach(function(y){r[y].forEach(function(S){S.name in h&&h[S.name]!=null?g.push(a(y,S,h)):S.push in h&&h[S.push]!=null&&h[S.push].forEach(function(k){g.push(a(y,S,k))})})}),h.media.forEach(function(y){g.push(a("m",r.m[0],y)),p.forEach(function(S){r[S].forEach(function(k){k.name in y&&y[k.name]!=null?g.push(a(S,k,y)):k.push in y&&y[k.push]!=null&&y[k.push].forEach(function(A){g.push(a(S,k,A))})})})}),g.join(`\r
`)+`\r
`},vd}var Nv;function OE(){if(Nv)return bn;Nv=1;var r=_E(),t=RE(),i=ph();return bn.grammar=i,bn.write=t,bn.parse=r.parse,bn.parseParams=r.parseParams,bn.parseFmtpConfig=r.parseFmtpConfig,bn.parsePayloads=r.parsePayloads,bn.parseRemoteCandidates=r.parseRemoteCandidates,bn.parseImageAttributes=r.parseImageAttributes,bn.parseSimulcastStreamList=r.parseSimulcastStreamList,bn}var Li=OE();function gh(r,t,i){var a,o,l;t===void 0&&(t=50),i===void 0&&(i={});var h=(a=i.isImmediate)!=null&&a,u=(o=i.callback)!=null&&o,m=i.maxWait,p=Date.now(),g=[];function y(){if(m!==void 0){var k=Date.now()-p;if(k+t>=m)return m-k}return t}var S=function(){var k=[].slice.call(arguments),A=this;return new Promise(function(R,G){var I=h&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,p=Date.now(),!h){var X=r.apply(A,k);u&&u(X),g.forEach(function(M){return(0,M.resolve)(X)}),g=[]}},y()),I){var Z=r.apply(A,k);return u&&u(Z),R(Z)}g.push({resolve:R,reject:G})})};return S.cancel=function(k){l!==void 0&&clearTimeout(l),g.forEach(function(A){return(0,A.reject)(k)}),g=[]},S}const DE=.7,AE=20,hs={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Pv extends Ln.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;super(),this.log=Ce,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=gh(o=>T(this,void 0,void 0,function*(){this.emit(hs.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),AE),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=oi((a=i.loggerName)!==null&&a!==void 0?a:_n.PCTransport),this.loggerOptions=i,this.config=t,this._pc=this.createPC(),this.offerLock=new xt}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=i=>{var a;i.candidate&&((a=this.onIceCandidate)===null||a===void 0||a.call(this,i.candidate))},t.onicecandidateerror=i=>{var a;(a=this.onIceCandidateError)===null||a===void 0||a.call(this,i)},t.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,t.connectionState)},t.ondatachannel=i=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,i)},t.ontrack=i=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,i)},t}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,i){return T(this,void 0,void 0,function*(){var a;if(t.type==="answer"&&this.latestOfferId>0&&i>0&&i!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:i,latestOfferId:this.latestOfferId})),!1;let o;if(t.type==="offer"){let{stereoMids:l,nackMids:h}=ME(t);this.remoteStereoMids=l,this.remoteNackMids=h}else if(t.type==="answer"){const l=Li.parse((a=t.sdp)!==null&&a!==void 0?a:"");l.media.forEach(h=>{const u=vh(h.mid);h.type==="audio"&&this.trackBitrates.some(m=>{if(!m.transceiver||u!=m.transceiver.mid)return!1;let p=0;if(h.rtp.some(y=>y.codec.toUpperCase()===m.codec.toUpperCase()?(p=y.payload,!0):!1),p===0)return!0;let g=!1;for(const y of h.fmtp)if(y.payload===p){y.config=y.config.split(";").filter(S=>!S.includes("maxaveragebitrate")).join(";"),m.maxbr>0&&(y.config+=";maxaveragebitrate=".concat(m.maxbr*1e3)),g=!0;break}return g||m.maxbr>0&&h.fmtp.push({payload:p,config:"maxaveragebitrate=".concat(m.maxbr*1e3)}),!0})}),o=Li.write(l)}return yield this.setMungedSDP(t,o,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(hs.NegotiationComplete),t.sdp&&Li.parse(t.sdp).media.forEach(h=>{h.type==="video"&&this.emit(hs.RTPVideoPayloadTypes,h.rtp)})),!0})}createAndSendOffer(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(t?.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const l=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const h=Li.parse((i=l.sdp)!==null&&i!==void 0?i:"");if(h.media.forEach(u=>{Uv(u),u.type==="audio"?Lv(u,["all"],[]):u.type==="video"&&this.trackBitrates.some(m=>{if(!u.msid||!m.cid||!u.msid.includes(m.cid))return!1;let p=0;if(u.rtp.some(y=>y.codec.toUpperCase()===m.codec.toUpperCase()?(p=y.payload,!0):!1),p===0||(kn(m.codec)&&!ma()&&this.ensureVideoDDExtensionForSVC(u,h),!kn(m.codec)))return!0;const g=Math.round(m.maxbr*DE);for(const y of u.fmtp)if(y.payload===p){y.config.includes("x-google-start-bitrate")||(y.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(l,Li.write(h)),this.onOffer(l,this.latestOfferId)}finally{a()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pc.createAnswer(),a=Li.parse((t=i.sdp)!==null&&t!==void 0?t:"");return a.media.forEach(o=>{Uv(o),o.type==="audio"&&Lv(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,Li.write(a)),i})}createDataChannel(t,i){return this.pc.createDataChannel(t,i)}addTransceiver(t,i){return this.pc.addTransceiver(t,i)}addTransceiverOfKind(t,i){return this.pc.addTransceiver(t,i)}addTrack(t){if(!this._pc)throw new ot("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var i;if(!this._pc)throw new ot("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(t)}getConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var t;if(!this._pc)return;let i="";const a=new Map,o=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":i=u.selectedCandidatePairId;break;case"candidate-pair":i===""&&u.selected&&(i=u.id),a.set(u.id,u);break;case"remote-candidate":o.set(u.id,"".concat(u.address,":").concat(u.port));break}}),i==="")return;const h=(t=a.get(i))===null||t===void 0?void 0:t.remoteCandidateId;if(h!==void 0)return o.get(h)})}setMungedSDP(t,i,a){return T(this,void 0,void 0,function*(){if(i){const o=t.sdp;t.sdp=i;try{this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(l){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:i})),t.sdp=o}}try{a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const h={error:l,sdp:t.sdp};throw!a&&this.pc.remoteDescription&&(h.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:h})),new cs(l)}})}ensureVideoDDExtensionForSVC(t,i){var a,o;if(!((a=t.ext)===null||a===void 0?void 0:a.some(h=>h.uri===vv))){if(this.ddExtID===0){let h=0;i.media.forEach(u=>{var m;u.type==="video"&&((m=u.ext)===null||m===void 0||m.forEach(p=>{p.value>h&&(h=p.value)}))}),this.ddExtID=h+1}(o=t.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:vv})}}}function Lv(r,t,i){const a=vh(r.mid);let o=0;r.rtp.some(l=>l.codec==="opus"?(o=l.payload,!0):!1),o>0&&(r.rtcpFb||(r.rtcpFb=[]),i.includes(a)&&!r.rtcpFb.some(l=>l.payload===o&&l.type==="nack")&&r.rtcpFb.push({payload:o,type:"nack"}),(t.includes(a)||t.length===1&&t[0]==="all")&&r.fmtp.some(l=>l.payload===o?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function ME(r){var t;const i=[],a=[],o=Li.parse((t=r.sdp)!==null&&t!==void 0?t:"");let l=0;return o.media.forEach(h=>{var u;const m=vh(h.mid);h.type==="audio"&&(h.rtp.some(p=>p.codec==="opus"?(l=p.payload,!0):!1),!((u=h.rtcpFb)===null||u===void 0)&&u.some(p=>p.payload===l&&p.type==="nack")&&a.push(m),h.fmtp.some(p=>p.payload===l?(p.config.includes("sprop-stereo=1")&&i.push(m),!0):!1))}),{stereoMids:i,nackMids:a}}function Uv(r){if(r.connection){const t=r.connection.ip.indexOf(":")>=0;(r.connection.version===4&&t||r.connection.version===6&&!t)&&(r.connection.ip="0.0.0.0",r.connection.version=4)}}function vh(r){return typeof r=="number"?r.toFixed(0):r}const Fd="vp8",wE={audioPreset:Pd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:dh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Fd,backupCodec:!0,preConnectBuffer:!1},k0={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},E0={deviceId:{ideal:"default"},resolution:Rr.h720.resolution},xE={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new lk,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},yh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var tt;(function(r){r[r.NEW=0]="NEW",r[r.CONNECTING=1]="CONNECTING",r[r.CONNECTED=2]="CONNECTED",r[r.FAILED=3]="FAILED",r[r.CLOSING=4]="CLOSING",r[r.CLOSED=5]="CLOSED"})(tt||(tt={}));class NE{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(t,i,a){var o;this.peerConnectionTimeout=yh.peerConnectionTimeout,this.log=Ce,this.updateState=()=>{var l,h;const u=this.state,m=this.requiredTransports.map(p=>p.getConnectionState());m.every(p=>p==="connected")?this.state=tt.CONNECTED:m.some(p=>p==="failed")?this.state=tt.FAILED:m.some(p=>p==="connecting")?this.state=tt.CONNECTING:m.every(p=>p==="closed")?this.state=tt.CLOSED:m.some(p=>p==="closed")?this.state=tt.CLOSING:m.every(p=>p==="new")&&(this.state=tt.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat(tt[u]," to ").concat(tt[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),(h=this.subscriber)===null||h===void 0?void 0:h.getConnectionState()))},this.log=oi((o=a.loggerName)!==null&&o!==void 0?o:_n.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=i!=="subscriber-primary",this.isSubscriberConnectionRequired=i==="subscriber-primary",this.publisher=new Pv(t,a),this._mode=i,i!=="publisher-only"&&(this.subscriber=new Pv(t,a),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=l=>{var h;(h=this.onIceCandidate)===null||h===void 0||h.call(this,l,Cn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var h;(h=this.onDataChannel)===null||h===void 0||h.call(this,l)},this.subscriber.onTrack=l=>{var h;(h=this.onTrack)===null||h===void 0||h.call(this,l)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var h;(h=this.onIceCandidate)===null||h===void 0||h.call(this,l,Cn.PUBLISHER)},this.publisher.onTrack=l=>{var h;(h=this.onTrack)===null||h===void 0||h.call(this,l)},this.publisher.onOffer=(l,h)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,l,h)},this.state=tt.NEW,this.connectionLock=new xt,this.remoteOfferLock=new xt}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,i){return this.publisher.setRemoteDescription(t,i)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return T(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const i=this.publisher;for(const a of i.getSenders())try{i.canRemoveTrack()&&i.removeTrack(a)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,i){return T(this,void 0,void 0,function*(){var a;i===Cn.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(a=this.subscriber)===null||a===void 0?void 0:a.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,i){return T(this,void 0,void 0,function*(){var a,o,l;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(a=this.subscriber)===null||a===void 0?void 0:a.getSignallingState().toString()}));const h=yield this.remoteOfferLock.lock();try{return(yield(o=this.subscriber)===null||o===void 0?void 0:o.setRemoteDescription(t,i))?yield(l=this.subscriber)===null||l===void 0?void 0:l.createAndSetAnswer():void 0}finally{h()}})}updateConfiguration(t,i){var a;this.publisher.setConfiguration(t),(a=this.subscriber)===null||a===void 0||a.setConfiguration(t),i&&this.triggerIceRestart()}ensurePCTransportConnection(t,i){return T(this,void 0,void 0,function*(){var a;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((a=this.requiredTransports)===null||a===void 0?void 0:a.map(l=>this.ensureTransportConnected(l,t,i)))}finally{o()}})}negotiate(t){return T(this,void 0,void 0,function*(){return new Vt((i,a)=>T(this,void 0,void 0,function*(){const o=setTimeout(()=>{a(new cs("negotiation timed out"))},this.peerConnectionTimeout),l=()=>{clearTimeout(o),a(new cs("negotiation aborted"))};t.signal.addEventListener("abort",l),this.publisher.once(hs.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(hs.NegotiationComplete,()=>{clearTimeout(o),i()})}),yield this.publisher.negotiate(h=>{clearTimeout(o),h instanceof Error?a(h):a(new Error(String(h)))})}))})}addPublisherTransceiver(t,i){return this.publisher.addTransceiver(t,i)}addPublisherTransceiverOfKind(t,i){return this.publisher.addTransceiverOfKind(t,i)}getMidForReceiver(t){const a=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(o=>o.receiver===t);return a?.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,i){return this.publisher.createDataChannel(t,i)}getConnectedAddress(t){return t===Cn.PUBLISHER?this.publisher.getConnectedAddress():t===Cn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(a.getConnectionState()!=="connected")return new Promise((m,p)=>T(l,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),_t.clearTimeout(y),p(he.cancelled("room connection has been cancelled"))};o?.signal.aborted&&g(),o?.signal.addEventListener("abort",g);const y=_t.setTimeout(()=>{o?.signal.removeEventListener("abort",g),p(he.internal("could not establish pc connection"))},h);for(;this.state!==tt.CONNECTED;)if(yield Rt(50),o?.signal.aborted){p(he.cancelled("room connection has been cancelled"));return}_t.clearTimeout(y),o?.signal.removeEventListener("abort",g),m()}))})()})}}const _0=5e3,PE=3e4;class we{static fetchRegionSettings(t,i,a){return T(this,void 0,void 0,function*(){const o=yield we.fetchLock.lock();try{const l=yield fetch("".concat(LE(t),"/regions"),{headers:{authorization:"Bearer ".concat(i)},signal:a});if(l.ok){const h=iE(l.headers),u=h?h*1e3:_0;return{regionSettings:yield l.json(),updatedAtInMs:Date.now(),maxAgeInMs:u}}else throw l.status===401?he.notAllowed("Could not fetch region settings: ".concat(l.statusText),l.status):he.internal("Could not fetch region settings: ".concat(l.statusText))}catch(l){throw l instanceof he?l:a?.aborted?he.cancelled("Region fetching was aborted"):he.serverUnreachable("Could not fetch region settings, ".concat(l instanceof Error?"".concat(l.name,": ").concat(l.message):l))}finally{o()}})}static scheduleRefetch(t,i,a){return T(this,void 0,void 0,function*(){const o=we.settingsTimeouts.get(t.hostname);clearTimeout(o),we.settingsTimeouts.set(t.hostname,setTimeout(()=>T(this,void 0,void 0,function*(){try{const l=yield we.fetchRegionSettings(t,i);we.updateCachedRegionSettings(t,i,l)}catch(l){if(l instanceof he&&l.reason===Ke.NotAllowed){Ce.debug("token is not valid, cancelling auto region refresh");return}Ce.debug("auto refetching of region settings failed",{error:l}),we.scheduleRefetch(t,i,a)}}),a))})}static updateCachedRegionSettings(t,i,a){we.cache.set(t.hostname,a),we.scheduleRefetch(t,i,a.maxAgeInMs)}static stopRefetch(t){const i=we.settingsTimeouts.get(t);i&&(clearTimeout(i),we.settingsTimeouts.delete(t))}static scheduleCleanup(t){let i=we.connectionTrackers.get(t);i&&(i.cleanupTimeout&&clearTimeout(i.cleanupTimeout),i.cleanupTimeout=setTimeout(()=>{const a=we.connectionTrackers.get(t);a&&a.connectionCount===0&&(Ce.debug("stopping region refetch after disconnect delay",{hostname:t}),we.stopRefetch(t)),a&&(a.cleanupTimeout=void 0)},PE))}static cancelCleanup(t){const i=we.connectionTrackers.get(t);i?.cleanupTimeout&&(clearTimeout(i.cleanupTimeout),i.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let i=we.connectionTrackers.get(t);i||(i={connectionCount:0},we.connectionTrackers.set(t,i)),i.connectionCount++,we.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,i=we.connectionTrackers.get(t);i&&(i.connectionCount=Math.max(0,i.connectionCount-1),i.connectionCount===0&&we.scheduleCleanup(t))}constructor(t,i){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}updateToken(t){this.token=t}isCloud(){return ms(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return T(this,void 0,void 0,function*(){return we.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let i=we.cache.get(this.serverUrl.hostname);(!i||Date.now()-i.updatedAtInMs>i.maxAgeInMs)&&(i=yield this.fetchRegionSettings(t),we.updateCachedRegionSettings(this.serverUrl,this.token,i));const a=i.regionSettings.regions.filter(o=>!this.attemptedRegions.find(l=>l.url===o.url));if(a.length>0){const o=a[0];return this.attemptedRegions.push(o),Ce.debug("next region: ".concat(o.region)),o.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){we.updateCachedRegionSettings(this.serverUrl,this.token,t)}}we.cache=new Map;we.settingsTimeouts=new Map;we.connectionTrackers=new Map;we.fetchLock=new xt;function LE(r){return"".concat(r.protocol.replace("ws","http"),"//").concat(r.host,"/settings")}class it extends Error{constructor(t,i,a){super(i),this.code=t,this.message=Iv(i,it.MAX_MESSAGE_BYTES),this.data=a?Iv(a,it.MAX_DATA_BYTES):void 0}static fromProto(t){return new it(t.code,t.message,t.data)}toProto(){return new vy({code:this.code,message:this.message,data:this.data})}static builtIn(t,i){return new it(it.ErrorCode[t],it.ErrorMessage[t],i)}}it.MAX_MESSAGE_BYTES=256;it.MAX_DATA_BYTES=15360;it.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};it.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const R0=15360;function bh(r){return new TextEncoder().encode(r).length}function Iv(r,t){if(bh(r)<=t)return r;let i=0,a=r.length;const o=new TextEncoder;for(;i<a;){const l=Math.floor((i+a+1)/2);o.encode(r.slice(0,l)).length<=t?i=l:a=l-1}return r.slice(0,i)}const Sh=2e3;function wc(r,t){if(!t)return 0;let i,a;return"bytesReceived"in r?(i=r.bytesReceived,a=t.bytesReceived):"bytesSent"in r&&(i=r.bytesSent,a=t.bytesSent),i===void 0||a===void 0||r.timestamp===void 0||t.timestamp===void 0?0:(i-a)*8*1e3/(r.timestamp-t.timestamp)}const Th=typeof MediaRecorder<"u";class UE{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const IE=Th?MediaRecorder:UE;class jE extends IE{constructor(t,i){if(!Th)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),i);let a,o;const l=()=>o===void 0,h=()=>{this.removeEventListener("dataavailable",a),this.removeEventListener("stop",h),this.removeEventListener("error",u),o?.close(),o=void 0},u=m=>{o?.error(m),this.removeEventListener("dataavailable",a),this.removeEventListener("stop",h),this.removeEventListener("error",u),o=void 0};this.byteStream=new ReadableStream({start:m=>{o=m,a=p=>T(this,void 0,void 0,function*(){let g;if(p.data.arrayBuffer){const y=yield p.data.arrayBuffer();g=new Uint8Array(y)}else if(p.data.byteArray)g=p.data.byteArray;else throw new Error("no data available!");l()||m.enqueue(g)}),this.addEventListener("dataavailable",a)},cancel:()=>{h()}}),this.addEventListener("stop",h),this.addEventListener("error",u)}}function BE(){return Th}const zE=1e3,qE=1e4;class O0 extends F{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,i,a){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(t,i,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=gh(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Q.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new xt,this.pauseUpstreamLock=new xt,this.trackChangeLock=new xt,this.trackChangeLock.lock().then(h=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{h()}})),this._constraints=t.getConstraints(),a&&(this._constraints=a)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==F.Kind.Video)return;const{width:t,height:i}=this._mediaStreamTrack.getSettings();if(t&&i)return{width:t,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,i;return(i=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,i){return T(this,void 0,void 0,function*(){var a;if(t===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{ls(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let o;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(is(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((a=this.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(yield this.sender.replaceTrack(o??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{is(o??t,l)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zE;return(function*(){var a;if(t.kind===F.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((a=Ht())===null||a===void 0?void 0:a.os)==="iOS"&&(yield Rt(10));const o=Date.now();for(;Date.now()-o<i;){const l=t.dimensions;if(l)return l;yield Rt(50)}throw new ri("unable to get track dimensions after timeout")})()})}setDeviceId(t){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===Bi(t)||(this._constraints.deviceId=t,this.isMuted)?!0:(yield this.restartTrack(),Bi(t)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===F.Source.ScreenShare)return;const{deviceId:a,groupId:o}=t._mediaStreamTrack.getSettings(),l=t.kind===F.Kind.Audio?"audioinput":"videoinput";return i?bt.getInstance().normalizeDeviceId(l,a,o):a})()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,i){return T(this,void 0,void 0,function*(){const a=yield this.trackChangeLock.lock();try{if(!this.sender)throw new ri("unable to replace an unpublished track");let o,l;return typeof i=="boolean"?o=i:i!==void 0&&(o=i.userProvidedTrack,l=i.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{a()}})}restart(t){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:a,facingMode:o}=t,l=uk(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const h={audio:!1,video:!1};this.kind===F.Kind.Video?h.video=a||o?{deviceId:a,facingMode:o}:!0:h.audio=a?Object.assign({deviceId:a},l):!0,this.attachedElements.forEach(p=>{ls(this.mediaStreamTrack,p)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const m=(yield navigator.mediaDevices.getUserMedia(h)).getTracks()[0];return this.kind===F.Kind.Video&&(yield m.applyConstraints(l)),m.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(m),this._constraints=t,this.emit(Q.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?Q.Muted:Q.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),b0()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Q.UpstreamPaused,this);const a=Ht();if(a?.name==="Safari"&&Pn(a.version,"12.0")<0)throw new uh("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{i()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Q.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{i()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const h=yield a.trackChangeLock.lock();try{a.log.debug("setting up processor",a.logContext);const u=document.createElement(a.kind),m={kind:a.kind,track:a._mediaStreamTrack,element:u,audioContext:a.audioContext};if(yield i.init(m),a.log.debug("processor initialized",a.logContext),a.processor&&(yield a.internalStopProcessor()),a.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(is(a._mediaStreamTrack,u),u.muted=!0,u.play().catch(p=>{p instanceof DOMException&&p.name==="AbortError"?(a.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},a.logContext),{error:p})),setTimeout(()=>{u.play().catch(g=>{a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{err:g}))})},100)):a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:p}))}),a.processor=i,a.processorElement=u,a.processor.processedTrack){for(const p of a.attachedElements)p!==a.processorElement&&o&&(ls(a._mediaStreamTrack,p),is(a.processor.processedTrack,p));yield(l=a.sender)===null||l===void 0?void 0:l.replaceTrack(a.processor.processedTrack)}a.emit(Q.TrackProcessorUpdate,a.processor)}finally{h()}})()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const a=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(i)}finally{a()}})()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var a,o;t.processor&&(t.log.debug("stopping processor",t.logContext),(a=t.processor.processedTrack)===null||a===void 0||a.stop(),yield t.processor.destroy(),t.processor=void 0,i||((o=t.processorElement)===null||o===void 0||o.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(Q.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!BE()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let i="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(i)||(i="video/mp4"),this.localTrackRecorder=new jE(this,{mimeType:i})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},qE)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class bc extends O0{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(t,F.Kind.Audio,i,a,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let h;try{h=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}h&&this.prevStats&&(this._currentBitrate=wc(h,this.prevStats)),this.prevStats=h}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Q.AudioTrackFeatureUpdate,this,yt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Q.AudioTrackFeatureUpdate,this,yt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const a=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Bi(this._constraints.deviceId);return this.source===F.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||a)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{i()}})}restartTrack(t){return T(this,void 0,void 0,function*(){let i;if(t){const a=hh({audio:t});typeof a.audio!="boolean"&&(i=a.audio)}yield this.restart(i)})}restart(t){const i=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const a=yield i.restart.call(this,t);return this.checkForSilence(),a})}startMonitor(){Ft()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Sh)))}setProcessor(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.trackChangeLock.lock();try{if(!Nn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(o),this.processor=t,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Q.TrackProcessorUpdate,this.processor)}finally{a()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const i=yield this.sender.getStats();let a;return i.forEach(o=>{o.type==="outbound-rtp"&&(a={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),a})}checkForSilence(){return T(this,void 0,void 0,function*(){const t=yield g0(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(Q.AudioSilenceDetected)),t})}}function VE(r,t,i){switch(r.kind){case"audio":return new bc(r,t,!1,void 0,i);case"video":return new Sc(r,t,!1,i);default:throw new ri("unsupported track type: ".concat(r.kind))}}const FE=Object.values(Rr),HE=Object.values(Ld),GE=Object.values(dh),KE=[Rr.h180,Rr.h360],YE=[Ld.h180,Ld.h360],JE=r=>[{scaleResolutionDownBy:2,fps:r.encoding.maxFramerate}].map(i=>{var a,o;return new Ve(Math.floor(r.width/i.scaleResolutionDownBy),Math.floor(r.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(r.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((a=r.encoding.maxFramerate)!==null&&a!==void 0?a:30)/((o=i.fps)!==null&&o!==void 0?o:30))))),i.fps,r.encoding.priority)}),Hd=["q","h","f"];function Gd(r,t,i,a){var o,l;let h=a?.videoEncoding;r&&(h=a?.screenShareEncoding);const u=a?.simulcast,m=a?.scalabilityMode,p=a?.videoCodec;if(!h&&!u&&!m||!t||!i)return[{}];h||(h=XE(r,t,i,p),Ce.debug("using video encoding",h));const g=h.maxFramerate,y=new Ve(t,i,h.maxBitrate,h.maxFramerate,h.priority);if(m&&kn(p)){const A=new D0(m),R=[];if(A.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(m));const G=Ht();if(Or()||Nn()||G?.name==="Chrome"&&Pn(G?.version,"113")<0){const I=A.suffix=="h"?2:3,Z=Gk(G);for(let X=0;X<A.spatial;X+=1)R.push({rid:Hd[2-X],maxBitrate:h.maxBitrate/Math.pow(I,X),maxFramerate:y.encoding.maxFramerate,scaleResolutionDownBy:Z?Math.pow(2,X):void 0});R[0].scalabilityMode=m}else R.push({maxBitrate:h.maxBitrate,maxFramerate:y.encoding.maxFramerate,scalabilityMode:m});return y.encoding.priority&&(R[0].priority=y.encoding.priority,R[0].networkPriority=y.encoding.priority),Ce.debug("using svc encoding",{encodings:R}),R}if(!u)return[h];let S=[];r?S=(o=Bv(a?.screenShareSimulcastLayers))!==null&&o!==void 0?o:jv(r,y):S=(l=Bv(a?.videoSimulcastLayers))!==null&&l!==void 0?l:jv(r,y);let k;if(S.length>0){const A=S[0];S.length>1&&([,k]=S);const R=Math.max(t,i);if(R>=960&&k)return yd(t,i,[A,k,y],g);if(R>=480)return yd(t,i,[A,y],g)}return yd(t,i,[y])}function QE(r,t,i){var a,o,l,h;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;t!==i.backupCodec.codec&&Ce.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;const u=r.mediaStreamTrack.getSettings(),m=(a=u.width)!==null&&a!==void 0?a:(o=r.dimensions)===null||o===void 0?void 0:o.width,p=(l=u.height)!==null&&l!==void 0?l:(h=r.dimensions)===null||h===void 0?void 0:h.height;return r.source===F.Source.ScreenShare&&i.simulcast&&(i.simulcast=!1),Gd(r.source===F.Source.ScreenShare,m,p,i)}function XE(r,t,i,a){const o=ZE(r,t,i);let{encoding:l}=o[0];const h=Math.max(t,i);for(let u=0;u<o.length;u+=1){const m=o[u];if(l=m.encoding,m.width>=h)break}if(a)switch(a){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function ZE(r,t,i){if(r)return GE;const a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?FE:HE}function jv(r,t){if(r)return JE(t);const{width:i,height:a}=t,o=i>a?i/a:a/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?KE:YE}function yd(r,t,i,a){const o=[];if(i.forEach((l,h)=>{if(h>=Hd.length)return;const u=Math.min(r,t),p={rid:Hd[h],scaleResolutionDownBy:Math.max(1,u/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},g=a&&l.encoding.maxFramerate?Math.min(a,l.encoding.maxFramerate):l.encoding.maxFramerate;g&&(p.maxFramerate=g);const y=fa()||h===0;l.encoding.priority&&y&&(p.priority=l.encoding.priority,p.networkPriority=l.encoding.priority),o.push(p)}),Nn()&&T0()==="ios"){let l;o.forEach(u=>{l?u.maxFramerate&&u.maxFramerate>l&&(l=u.maxFramerate):l=u.maxFramerate});let h=!0;o.forEach(u=>{var m;u.maxFramerate!=l&&(h&&(h=!1,Ce.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ce.info('Setting framerate of encoding "'.concat((m=u.rid)!==null&&m!==void 0?m:"",'" to ').concat(l)),u.maxFramerate=l)})}return o}function Bv(r){if(r)return r.sort((t,i)=>{const{encoding:a}=t,{encoding:o}=i;return a.maxBitrate>o.maxBitrate?1:a.maxBitrate<o.maxBitrate?-1:a.maxBitrate===o.maxBitrate&&a.maxFramerate&&o.maxFramerate?a.maxFramerate>o.maxFramerate?1:-1:0})}class D0{constructor(t){const i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function WE(r){return r.source===F.Source.ScreenShare||r.constraints.height&&Bi(r.constraints.height)>=1080?"maintain-resolution":"balanced"}const $E=5e3;class Sc extends O0{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(t,F.Kind.Video,i,a,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(m){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:m}));return}const h=new Map(l.map(m=>[m.rid,m])),u=l.some(m=>m.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(Q.CpuConstrained)),this.prevStats){let m=0;h.forEach((p,g)=>{var y;const S=(y=this.prevStats)===null||y===void 0?void 0:y.get(g);m+=wc(p,S)}),this._currentBitrate=m}this.prevStats=h}),this.senderLock=new xt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var i;if(this.signalClient=t,!Ft())return;const a=(i=this.sender)===null||i===void 0?void 0:i.getParameters();a&&(this.encodings=a.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Sh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,h;yield t.pauseUpstream.call(this);try{for(var u=!0,m=si(this.simulcastCodecs.values()),p;p=yield m.next(),i=p.done,!i;u=!0)l=p.value,u=!1,yield(h=l.sender)===null||h===void 0?void 0:h.replaceTrack(null)}catch(g){a={error:g}}finally{try{!u&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,h;yield t.resumeUpstream.call(this);try{for(var u=!0,m=si(this.simulcastCodecs.values()),p;p=yield m.next(),i=p.done,!i;u=!0){l=p.value,u=!1;const g=l;yield(h=g.sender)===null||h===void 0?void 0:h.replaceTrack(g.mediaStreamTrack)}}catch(g){a={error:g}}finally{try{!u&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(t){super.setTrackMuted(t);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const i=[],a=yield this.sender.getStats();return a.forEach(o=>{var l;if(o.type==="outbound-rtp"){const h={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},u=a.get(o.remoteId);u&&(h.jitter=u.jitter,h.packetsLost=u.packetsLost,h.roundTripTime=u.roundTripTime),i.push(h)}}),i.sort((o,l)=>{var h,u;return((h=l.frameWidth)!==null&&h!==void 0?h:0)-((u=o.frameWidth)!==null&&u!==void 0?u:0)}),i})}setPublishingQuality(t){const i=[];for(let a=tn.LOW;a<=tn.HIGH;a+=1)i.push(new rh({quality:a,enabled:a<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(kn(this.codec),i)}restartTrack(t){return T(this,void 0,void 0,function*(){var i,a,o,l,h;let u;if(t){const y=hh({video:t});typeof y.video!="boolean"&&(u=y.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var m=!0,p=si(this.simulcastCodecs.values()),g;g=yield p.next(),i=g.done,!i;m=!0){l=g.value,m=!1;const y=l;y.sender&&((h=y.sender.transport)===null||h===void 0?void 0:h.state)!=="closed"&&(y.mediaStreamTrack=this.mediaStreamTrack.clone(),yield y.sender.replaceTrack(y.mediaStreamTrack))}}catch(y){a={error:y}}finally{try{!m&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}})}setProcessor(t){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(a){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var h,u,m,p,g,y;if(yield i.setProcessor.call(o,a,l),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var S=!0,k=si(o.simulcastCodecs.values()),A;A=yield k.next(),h=A.done,!h;S=!0)p=A.value,S=!1,yield(y=p.sender)===null||y===void 0?void 0:y.replaceTrack(o.processor.processedTrack)}catch(R){u={error:R}}finally{try{!S&&!h&&(m=k.return)&&(yield m.call(k))}finally{if(u)throw u.error}}})()})}setDegradationPreference(t){return T(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const i=this.sender.getParameters();i.degradationPreference=t,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(t,i){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const a={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(t,a),a}setSimulcastTrackSender(t,i){const a=this.simulcastCodecs.get(t);a&&(a.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},$E))}setPublishingCodecs(t){return T(this,void 0,void 0,function*(){var i,a,o,l,h,u,m;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(kn(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const p=[];try{for(i=!0,a=si(t);o=yield a.next(),l=o.done,!l;i=!0){m=o.value,i=!1;const g=m;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(kn(g.codec),g.qualities);else{const y=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:y})),!y||!y.sender){for(const S of g.qualities)if(S.enabled){p.push(g.codec);break}}else y.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield zv(y.sender,y.encodings,g.qualities,this.senderLock,kn(g.codec),this.log,this.logContext))}}}catch(g){h={error:g}}finally{try{!i&&!l&&(u=a.return)&&(yield u.call(a))}finally{if(h)throw h.error}}return p})}setPublishingLayers(t,i){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:i}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:i})),!(!this.sender||!this.encodings)&&(yield zv(this.sender,this.encodings,i,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const i=this.sender.getParameters();i.encodings=i.encodings.map((a,o)=>{var l;return Object.assign(Object.assign({},a),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:o===0&&kn(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?a.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:i.encodings})),this.encodings=i.encodings,yield this.sender.setParameters(i)}catch(i){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:i})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),b0()&&this.isInBackground&&this.source===F.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function zv(r,t,i,a,o,l,h){return T(this,void 0,void 0,function*(){const u=yield a.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},h),{sender:r,qualities:i,senderEncodings:t}));try{const m=r.getParameters(),{encodings:p}=m;if(!p)return;if(p.length!==t.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},h),{encodings:p,senderEncodings:t}));return}let g=!1;!1&&p[0].scalabilityMode||(o&&i.some(k=>k.enabled)&&i.forEach(k=>k.enabled=!0),p.forEach((S,k)=>{var A;let R=(A=S.rid)!==null&&A!==void 0?A:"";R===""&&(R="q");const G=A0(R),I=i.find(Z=>Z.quality===G);I&&S.active!==I.enabled&&(g=!0,S.active=I.enabled,l.debug("setting layer ".concat(I.quality," to ").concat(S.active?"enabled":"disabled"),h),fa()&&(I.enabled?(S.scaleResolutionDownBy=t[k].scaleResolutionDownBy,S.maxBitrate=t[k].maxBitrate,S.maxFrameRate=t[k].maxFrameRate):(S.scaleResolutionDownBy=4,S.maxBitrate=10,S.maxFrameRate=2)))})),g&&(m.encodings=p,l.debug("setting encodings",Object.assign(Object.assign({},h),{encodings:m.encodings})),yield r.setParameters(m))}finally{u()}})}function A0(r){switch(r){case"f":return tn.HIGH;case"h":return tn.MEDIUM;case"q":return tn.LOW;default:return tn.HIGH}}function qv(r,t,i,a){if(!i)return[new ji({quality:tn.HIGH,width:r,height:t,bitrate:0,ssrc:0})];if(a){const o=i[0].scalabilityMode,l=new D0(o),h=[],u=l.suffix=="h"?1.5:2,m=l.suffix=="h"?2:3;for(let p=0;p<l.spatial;p+=1)h.push(new ji({quality:Math.min(tn.HIGH,l.spatial-1)-p,width:Math.ceil(r/Math.pow(u,p)),height:Math.ceil(t/Math.pow(u,p)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(m,p)):0,ssrc:0}));return h}return i.map(o=>{var l,h,u;const m=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let p=A0((h=o.rid)!==null&&h!==void 0?h:"");return new ji({quality:p,width:Math.ceil(r/m),height:Math.ceil(t/m),bitrate:(u=o.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const Vv="_lossy",Fv="_reliable",e_=2*1e3,bd="leave-reconnect",t_=3e4,n_=8*1024,i_=256*1024;var fn;(function(r){r[r.New=0]="New",r[r.Connected=1]="Connected",r[r.Disconnected=2]="Disconnected",r[r.Reconnecting=3]="Reconnecting",r[r.Closed=4]="Closed"})(fn||(fn={}));class a_ extends Ln.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var i;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=yh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=fn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ce,this.reliableDataSequence=1,this.reliableMessageBuffer=new Av,this.reliableReceivedState=new EE(t_),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=a=>T(this,[a],void 0,function(o){var l=this;let{channel:h}=o;return(function*(){if(h){if(h.label===Fv)l.reliableDCSub=h;else if(h.label===Vv)l.lossyDCSub=h;else return;l.log.debug("on data channel ".concat(h.id,", ").concat(h.label),l.logContext),h.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=a=>T(this,void 0,void 0,function*(){var o,l,h,u,m;const p=yield this.dataProcessLock.lock();try{let g;if(a.data instanceof ArrayBuffer)g=a.data;else if(a.data instanceof Blob)g=yield a.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data}));return}const y=wt.fromBinary(new Uint8Array(g));if(y.sequence>0&&y.participantSid!==""){const S=this.reliableReceivedState.get(y.participantSid);if(S&&y.sequence<=S)return;this.reliableReceivedState.set(y.participantSid,y.sequence)}if(((o=y.value)===null||o===void 0?void 0:o.case)==="speaker")this.emit(W.ActiveSpeakersUpdate,y.value.value.speakers);else if(((l=y.value)===null||l===void 0?void 0:l.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const S=yield(h=this.e2eeManager)===null||h===void 0?void 0:h.handleEncryptedData(y.value.value.encryptedValue,y.value.value.iv,y.participantIdentity,y.value.value.keyIndex),k=my.fromBinary(S.payload),A=new wt({value:k.value,participantIdentity:y.participantIdentity,participantSid:y.participantSid});((u=A.value)===null||u===void 0?void 0:u.case)==="user"&&Hv(A,A.value.value),this.emit(W.DataPacketReceived,A,y.value.value.encryptionType)}else((m=y.value)===null||m===void 0?void 0:m.case)==="user"&&Hv(y,y.value.value),this.emit(W.DataPacketReceived,y,pt.NONE)}finally{p()}}),this.handleDataError=a=>{const l=a.currentTarget.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){const{error:h}=a.error;this.log.error("DataChannel error on ".concat(l,": ").concat(a.message),Object.assign(Object.assign({},this.logContext),{error:h}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:a}))},this.handleBufferedAmountLow=a=>{const l=a.currentTarget.maxRetransmits===0?ke.LOSSY:ke.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(a,o)=>{if(this._isClosed)return;this.log.warn("".concat(a," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=m=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(m,"ms. giving up"),this.logContext),this.emit(W.Disconnected),this.close()},h=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:h,retryCount:this.reconnectAttempts});if(u===null){l(h);return}a===bd&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=_t.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((a,o)=>{this.pcState===fn.Connected&&a();const l=()=>{this.off(W.Disconnected,h),a()},h=()=>{this.off(W.Restarted,l),o()};this.once(W.Restarted,l),this.once(W.Disconnected,h)}),this.updateAndEmitDCBufferStatus=a=>{if(a===ke.RELIABLE){const l=this.dataChannelForKind(a);l&&this.reliableMessageBuffer.alignBufferedAmount(l.bufferedAmount)}const o=this.isBufferStatusLow(a);typeof o<"u"&&o!==this.dcBufferStatus.get(a)&&(this.dcBufferStatus.set(a,o),this.emit(W.DCBufferStatusChanged,o,a))},this.isBufferStatusLow=a=>{const o=this.dataChannelForKind(a);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>T(this,void 0,void 0,function*(){!this.url||!(yield fetch(Dr(this.url),{method:"HEAD"}).then(o=>o.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ge.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ge.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ua.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>T(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Dr(this.url),{method:"HEAD"}),Rt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=oi((i=t.loggerName)!==null&&i!==void 0?i:_n.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new mh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new xt,this.dataProcessLock=new xt,this.dcBufferStatus=new Map([[ke.LOSSY,!0],[ke.RELIABLE,!0]]),this.client.onParticipantUpdate=a=>this.emit(W.ParticipantUpdate,a),this.client.onConnectionQuality=a=>this.emit(W.ConnectionQualityUpdate,a),this.client.onRoomUpdate=a=>this.emit(W.RoomUpdate,a),this.client.onSubscriptionError=a=>this.emit(W.SubscriptionError,a),this.client.onSubscriptionPermissionUpdate=a=>this.emit(W.SubscriptionPermissionUpdate,a),this.client.onSpeakersChanged=a=>this.emit(W.SpeakersChanged,a),this.client.onStreamStateUpdate=a=>this.emit(W.StreamStateChanged,a),this.client.onRequestResponse=a=>this.emit(W.SignalRequestResponse,a)}get logContext(){var t,i,a,o,l,h;return{room:(i=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||i===void 0?void 0:i.name,roomID:(o=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||o===void 0?void 0:o.sid,participant:(h=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||h===void 0?void 0:h.identity,pID:this.participantSid}}join(t,i,a,o){return T(this,arguments,void 0,function(l,h,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){p.url=l,p.token=h,p.signalOpts=u,p.maxJoinAttempts=u.maxRetries;try{p.joinAttempts+=1,p.setupSignalClientCallbacks();const y=yield p.client.join(l,h,u,m,g);return p._isClosed=!1,p.latestJoinResponse=y,p.subscriberPrimary=y.subscriberPrimary,p.pcManager||(yield p.configure(y,!g)),(!p.subscriberPrimary||y.fastPublish)&&p.negotiate().catch(S=>{Ce.error(S,p.logContext)}),p.registerOnLineListener(),p.clientConfiguration=y.clientConfiguration,p.emit(W.SignalConnected,y),y}catch(y){if(y instanceof he){if(y.reason===Ke.ServerUnreachable){if(p.log.warn("Couldn't connect to server, attempt ".concat(p.joinAttempts," of ").concat(p.maxJoinAttempts),p.logContext),p.joinAttempts<p.maxJoinAttempts)return p.join(l,h,u,m,g)}else if(y.reason===Ke.ServiceNotFound)return p.log.warn("Initial connection failed: ".concat(y.message,"  Retrying")),p.join(l,h,u,m,!0)}throw y}})()})}close(){return T(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(W.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const i=a=>{a&&(a.close(),a.onbufferedamountlow=null,a.onclose=null,a.onclosing=null,a.onerror=null,a.onmessage=null,a.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Av,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new ri("a track with the same ID has already been published");return new Promise((i,a)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],a(he.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:l=>{clearTimeout(o),i(l)},reject:()=>{clearTimeout(o),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(t,i){this.client.sendMuteTrack(t,i)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t,i){return T(this,void 0,void 0,function*(){var a,o;if(this.pcManager&&this.pcManager.currentState!==tt.NEW)return;this.participantSid=(a=t.participant)===null||a===void 0?void 0:a.sid;const l=this.makeRTCConfiguration(t);this.pcManager=new NE(l,i?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(W.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(h,u)=>{this.client.sendIceCandidate(h,u)},this.pcManager.onPublisherOffer=(h,u)=>{this.client.sendOffer(h,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(h,u,m)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(h),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),h===tt.CONNECTED){const y=this.pcState===fn.New;this.pcState=fn.Connected,y&&this.emit(W.Connected,t)}else h===tt.FAILED&&(this.pcState===fn.Connected||this.pcState===fn.Reconnecting)&&(this.pcState=fn.Disconnected,this.handleDisconnect("peerconnection failed",m==="failed"?ua.RR_SUBSCRIBER_FAILED:ua.RR_PUBLISHER_FAILED));const p=this.client.isDisconnected||this.client.currentState===Ge.RECONNECTING,g=[tt.FAILED,tt.CLOSING,tt.CLOSED].includes(h);p&&g&&!this._isClosed&&this.emit(W.Offline)}),this.pcManager.onTrack=h=>{h.streams.length!==0&&this.emit(W.MediaTrackAdded,h.track,h.streams[0],h.receiver)},s_((o=t.serverInfo)===null||o===void 0?void 0:o.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,i,a)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:a})),this.midToTrackId=a,yield this.pcManager.setPublisherAnswer(t,i))}),this.client.onTrickle=(t,i)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:i})),this.pcManager.addIceCandidate(t,i))},this.client.onOffer=(t,i,a)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=i,!this.pcManager)return;this.midToTrackId=a;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t,i);o&&this.client.sendAnswer(o,i)}),this.client.onLocalTrackPublished=t=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(i=t.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:a}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],a(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(W.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(W.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var i;this.token=t,(i=this.regionUrlProvider)===null||i===void 0||i.updateToken(t)},this.client.onRemoteMuteChanged=(t,i)=>{this.emit(W.RemoteMute,t,i)},this.client.onSubscribedQualityUpdate=t=>{this.emit(W.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var i;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(W.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var i,a;const o={direction:"recvonly"};for(let l=0;l<t.numAudios;l++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("audio",o);for(let l=0;l<t.numVideos;l++)(a=this.pcManager)===null||a===void 0||a.addPublisherTransceiverOfKind("video",o);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ua.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t?.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:_0,regionSettings:t.regions})),t.action){case rs.DISCONNECT:this.emit(W.Disconnected,t?.reason),this.close();break;case rs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(bd);break;case rs.RESUME:this.handleDisconnect(bd)}}}makeRTCConfiguration(t){var i;const a=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),t.iceServers&&!a.iceServers){const o=[];t.iceServers.forEach(l=>{const h={urls:l.urls};l.username&&(h.username=l.username),l.credential&&(h.credential=l.credential),o.push(h)}),a.iceServers=o}return t.clientConfiguration&&t.clientConfiguration.forceRelay===kr.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Vv,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Fv,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const t=this.dataChannelForKind(ke.LOSSY);if(t){const i=this.lossyDataStatByterate/10;t.bufferedAmountLowThreshold=Math.min(Math.max(i,n_),i_)}},1e3))}createSender(t,i,a){return T(this,void 0,void 0,function*(){if(jd())return yield this.createTransceiverRTCRtpSender(t,i,a);if(Bd())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new ot("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(jd())return this.createSimulcastTransceiverSender(t,i,a,o);if(Bd())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new ot("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,i,a){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ot("publisher is closed");const o=[];t.mediaStream&&o.push(t.mediaStream),Fi(t)&&(t.codec=i.videoCodec);const l={direction:"sendonly",streams:o};return a&&(l.sendEncodings=a),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ot("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const h=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,l);if(a.videoCodec)return t.setSimulcastTrackSender(a.videoCodec,h.sender),h.sender})}createRTCRtpSender(t){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ot("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return T(this,void 0,void 0,function*(){var i,a,o;if(!this._isClosed){if(this.attemptingReconnect){Ce.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===kr.DISABLED||((o=(a=this.pcManager)===null||a===void 0?void 0:a.currentState)!==null&&o!==void 0?o:tt.NEW)===tt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let h=!0;l instanceof ot?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),h=!1):l instanceof ts||(this.fullReconnectOnNext=!0),h?this.handleDisconnect("reconnect",ua.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(W.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(t){return T(this,void 0,void 0,function*(){var i,a,o;try{if(!this.url||!this.token)throw new ot("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(W.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ts;l=yield this.join(t??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(h){throw h instanceof he&&h.reason===Ke.NotAllowed?new ot("could not reconnect, token might be expired"):new ts}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(W.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==Ge.CONNECTED)throw new ts("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit(W.Restarted)}catch(l){const h=yield(a=this.regionUrlProvider)===null||a===void 0?void 0:a.getNextBestRegionUrl();if(h){yield this.restartConnection(h);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(t){return T(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new ot("could not reconnect, url or token not saved");if(!this.pcManager)throw new ot("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(W.Resuming);let a;try{this.setupSignalClientCallbacks(),a=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof he&&o.reason===Ke.NotAllowed?new ot("could not reconnect, token might be expired"):o instanceof he&&o.reason===Ke.LeaveRequest?o:new ts(l)}if(this.emit(W.SignalResumed),a){const o=this.makeRTCConfiguration(a);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=a.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ge.CONNECTED)throw new ts("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),a?.lastMessageSeq&&this.resendReliableMessagesForResume(a.lastMessageSeq),this.emit(W.Resumed)})}waitForPCInitialConnection(t,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ot("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,t)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=fn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Rt(e_),!this.pcManager)throw new ot("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=fn.Connected}catch(t){throw this.pcState=fn.Disconnected,he.internal("could not establish PC connection, ".concat(t.message))}})}publishRpcResponse(t,i,a,o){return T(this,void 0,void 0,function*(){const l=new wt({destinationIdentities:[t],kind:ke.RELIABLE,value:{case:"rpcResponse",value:new nh({requestId:i,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:a??""}})}});yield this.sendDataPacket(l,ke.RELIABLE)})}publishRpcAck(t,i){return T(this,void 0,void 0,function*(){const a=new wt({destinationIdentities:[t],kind:ke.RELIABLE,value:{case:"rpcAck",value:new th({requestId:i})}});yield this.sendDataPacket(a,ke.RELIABLE)})}sendDataPacket(t,i){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(i),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const l=fE(t);if(l){const h=yield this.e2eeManager.encryptData(l.toBinary());t.value={case:"encryptedPacket",value:new fy({encryptedValue:h.payload,iv:h.iv,keyIndex:h.keyIndex})}}}i===ke.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const a=t.toBinary(),o=this.dataChannelForKind(i);if(o){if(i===ke.RELIABLE)yield this.waitForBufferStatusLow(i),this.reliableMessageBuffer.push({data:a,sequence:t.sequence});else{if(!this.isBufferStatusLow(i)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=a.byteLength}if(this.attemptingReconnect)return;o.send(a)}this.updateAndEmitDCBufferStatus(i)})}resendReliableMessagesForResume(t){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ke.RELIABLE);const i=this.dataChannelForKind(ke.RELIABLE);i&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(a=>{i.send(a.data)})),this.updateAndEmitDCBufferStatus(ke.RELIABLE)})}waitForBufferStatusLow(t){return new Vt((i,a)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))i();else{const o=()=>a(new ot("engine closed"));for(this.once(W.Closing,o);!this.dcBufferStatus.get(t);)yield Rt(10);this.off(W.Closing,o),i()}}))}ensureDataTransportConnected(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!a.pcManager)throw new ot("PC manager is closed");const h=o?a.pcManager.subscriber:a.pcManager.publisher,u=o?"Subscriber":"Publisher";if(!h)throw he.internal("".concat(u," connection not set"));let m=!1;!o&&!a.dataChannelForKind(i,o)&&(a.createDataChannels(),m=!0),!m&&!o&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(m=!0),m&&a.negotiate().catch(y=>{Ce.error(y,a.logContext)});const p=a.dataChannelForKind(i,o);if(p?.readyState==="open")return;const g=new Date().getTime()+a.peerConnectionTimeout;for(;new Date().getTime()<g;){if(h.isICEConnected&&((l=a.dataChannelForKind(i,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield Rt(50)}throw he.internal("could not establish ".concat(u," connection, state: ").concat(h.getICEConnectionState()))})()})}ensurePublisherConnected(t){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==tt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Vt((t,i)=>T(this,void 0,void 0,function*(){if(!this.pcManager){i(new cs("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const a=new AbortController,o=()=>{a.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&i(new cs("cannot negotiate on closed engine")),this.on(W.Closing,o),this.pcManager.publisher.once(hs.RTPVideoPayloadTypes,l=>{const h=new Map;l.forEach(u=>{const m=u.codec.toLowerCase();Xk(m)&&h.set(u.payload,m)}),this.emit(W.RTPVideoMapUpdate,h)});try{yield this.pcManager.negotiate(a),t()}catch(l){l instanceof cs&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ua.RR_UNKNOWN),l instanceof Error?i(l):i(new Error(String(l)))}finally{this.off(W.Closing,o)}}))})}dataChannelForKind(t,i){if(i){if(t===ke.LOSSY)return this.lossyDCSub;if(t===ke.RELIABLE)return this.reliableDCSub}else{if(t===ke.LOSSY)return this.lossyDC;if(t===ke.RELIABLE)return this.reliableDC}}sendSyncState(t,i){var a,o,l,h;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const u=this.pcManager.publisher.getLocalDescription(),m=this.pcManager.publisher.getRemoteDescription(),p=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getRemoteDescription(),g=(o=this.pcManager.subscriber)===null||o===void 0?void 0:o.getLocalDescription(),y=(h=(l=this.signalOpts)===null||l===void 0?void 0:l.autoSubscribe)!==null&&h!==void 0?h:!0,S=new Array,k=new Array;t.forEach(A=>{A.isDesired!==y&&S.push(A.trackSid),A.isEnabled||k.push(A.trackSid)}),this.client.sendSyncState(new oh({answer:this.pcManager.mode==="publisher-only"?m?as({sdp:m.sdp,type:m.type}):void 0:g?as({sdp:g.sdp,type:g.type}):void 0,offer:this.pcManager.mode==="publisher-only"?u?as({sdp:u.sdp,type:u.type}):void 0:p?as({sdp:p.sdp,type:p.type}):void 0,subscription:new Dc({trackSids:S,subscribe:!y,participantTracks:[]}),publishTracks:Nk(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:k,datachannelReceiveStates:this.reliableReceivedState.map((A,R)=>new Ny({publisherSid:R,lastSeq:A}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],i=(a,o)=>{a?.id!==void 0&&a.id!==null&&t.push(new Py({label:a.label,id:a.id,target:o}))};return i(this.dataChannelForKind(ke.LOSSY),Cn.PUBLISHER),i(this.dataChannelForKind(ke.RELIABLE),Cn.PUBLISHER),i(this.dataChannelForKind(ke.LOSSY,!0),Cn.SUBSCRIBER),i(this.dataChannelForKind(ke.RELIABLE,!0),Cn.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&_t.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ft()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Ft()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var i;const a=(i=this.pcManager)===null||i===void 0?void 0:i.getMidForReceiver(t);if(a){const o=Object.entries(this.midToTrackId).find(l=>{let[h]=l;return h===a});if(o)return o[1]}}}function s_(r){return r!==void 0&&r>13}function Hv(r,t){const i=r.participantIdentity?r.participantIdentity:t.participantIdentity;r.participantIdentity=i,t.participantIdentity=i;const a=r.destinationIdentities.length!==0?r.destinationIdentities:t.destinationIdentities;r.destinationIdentities=a,t.destinationIdentities=a}class M0{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new mn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Mt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new mn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Mt.LengthExceeded)}}constructor(t,i,a,o){this.reader=i,this.totalByteSize=a,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class r_ extends M0{handleChunkReceived(t){var i;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,a)}[Symbol.asyncIterator](){const t=this.reader.getReader();let i=new pn,a=null,o=null;if(this.signal){const h=this.signal;o=()=>{var u;(u=i.reject)===null||u===void 0||u.call(i,h.reason)},h.addEventListener("abort",o),a=h}const l=()=>{t.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var h,u;try{const{done:m,value:p}=yield Promise.race([t.read(),i.promise,(u=(h=this.outOfBandFailureRejectingFuture)===null||h===void 0?void 0:h.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return m?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(p),{done:!1,value:p.content})}catch(m){throw l(),m}}),return(){return T(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,h;let u=new Set;const m=i.signal?t.withAbortSignal(i.signal):t;try{for(var p=!0,g=si(m),y;y=yield g.next(),a=y.done,!a;p=!0){h=y.value,p=!1;const S=h;u.add(S)}}catch(S){o={error:S}}finally{try{!p&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return Array.from(u)})()})}}class o_ extends M0{constructor(t,i,a,o){super(t,i,a,o),this.receivedChunks=new Map}handleChunkReceived(t){var i;const a=uc(t.chunkIndex),o=this.receivedChunks.get(a);if(o&&o.version>t.version)return;this.receivedChunks.set(a,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,l)}[Symbol.asyncIterator](){const t=this.reader.getReader(),i=new TextDecoder("utf-8",{fatal:!0});let a=new pn,o=null,l=null;if(this.signal){const u=this.signal;l=()=>{var m;(m=a.reject)===null||m===void 0||m.call(a,u.reason)},u.addEventListener("abort",l),o=u}const h=()=>{t.releaseLock(),o&&l&&o.removeEventListener("abort",l),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var u,m;try{const{done:p,value:g}=yield Promise.race([t.read(),a.promise,(m=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&m!==void 0?m:new Promise(()=>{})]);if(p)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let y;try{y=i.decode(g.content)}catch(S){throw new mn("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(S),Mt.DecodeFailed)}return{done:!1,value:y}}}catch(p){throw h(),p}}),return(){return T(this,void 0,void 0,function*(){return h(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,h;let u="";const m=i.signal?t.withAbortSignal(i.signal):t;try{for(var p=!0,g=si(m),y;y=yield g.next(),a=y.done,!a;p=!0)h=y.value,p=!1,u+=h}catch(S){o={error:S}}finally{try{!p&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return u})()})}}class c_{constructor(){this.log=Ce,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,i){if(this.textStreamHandlers.has(t))throw new mn('A text stream handler for topic "'.concat(t,'" has already been set.'),Mt.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,i)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,i){if(this.byteStreamHandlers.has(t))throw new mn('A byte stream handler for topic "'.concat(t,'" has already been set.'),Mt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,i)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var i,a,o,l;const h=Array.from(this.textStreamControllers.entries()).filter(m=>m[1].sendingParticipantIdentity===t),u=Array.from(this.byteStreamControllers.entries()).filter(m=>m[1].sendingParticipantIdentity===t);if(h.length>0||u.length>0){const m=new mn("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),Mt.AbnormalEnd);for(const[p,g]of u)(a=(i=g.outOfBandFailureRejectingFuture).reject)===null||a===void 0||a.call(i,m),this.byteStreamControllers.delete(p);for(const[p,g]of h)(l=(o=g.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(o,m),this.textStreamControllers.delete(p)}}handleDataStreamPacket(t,i){return T(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,i);case"streamChunk":return this.handleStreamChunk(t.value.value,i);case"streamTrailer":return this.handleStreamTrailer(t.value.value,i);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,i,a){return T(this,void 0,void 0,function*(){var o;if(t.contentHeader.case==="byteHeader"){const l=this.byteStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let h;const u=new pn;u.promise.catch(g=>{this.log.error(g)});const m={id:t.streamId,name:(o=t.contentHeader.value.name)!==null&&o!==void 0?o:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:uc(t.timestamp),attributes:t.attributes,encryptionType:a},p=new ReadableStream({start:g=>{if(h=g,this.textStreamControllers.has(t.streamId))throw new mn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Mt.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:m,controller:h,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:u})}});l(new r_(m,p,uc(t.totalLength),u),{identity:i})}else if(t.contentHeader.case==="textHeader"){const l=this.textStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let h;const u=new pn;u.promise.catch(g=>{this.log.error(g)});const m={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:a},p=new ReadableStream({start:g=>{if(h=g,this.textStreamControllers.has(t.streamId))throw new mn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Mt.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:m,controller:h,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:u})}});l(new o_(m,p,uc(t.totalLength),u),{identity:i})}})}handleStreamChunk(t,i){const a=this.byteStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?(a.controller.error(new mn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Mt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&a.controller.enqueue(t));const o=this.textStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?(o.controller.error(new mn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Mt.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&o.controller.enqueue(t))}handleStreamTrailer(t,i){const a=this.textStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?a.controller.error(new mn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Mt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),t.attributes),a.controller.close(),this.textStreamControllers.delete(t.streamId)));const o=this.byteStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?o.controller.error(new mn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Mt.EncryptionTypeMismatch)):(o.info.attributes=Object.assign(Object.assign({},o.info.attributes),t.attributes),o.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class w0{constructor(t,i,a){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=a,this.info=i}write(t){return this.defaultWriter.write(t)}close(){return T(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class l_ extends w0{}class u_ extends w0{}const Gv=15e3;class d_{constructor(t,i){this.engine=t,this.log=i}setupEngine(t){this.engine=t}sendText(t,i){return T(this,void 0,void 0,function*(){var a;const o=crypto.randomUUID(),h=new TextEncoder().encode(t).byteLength,u=(a=i?.attachments)===null||a===void 0?void 0:a.map(()=>crypto.randomUUID()),m=new Array(u?u.length+1:1).fill(0),p=(y,S)=>{var k;m[S]=y;const A=m.reduce((R,G)=>R+G,0);(k=i?.onProgress)===null||k===void 0||k.call(i,A)},g=yield this.streamText({streamId:o,totalSize:h,destinationIdentities:i?.destinationIdentities,topic:i?.topic,attachedStreamIds:u,attributes:i?.attributes});return yield g.write(t),p(1,0),yield g.close(),i?.attachments&&u&&(yield Promise.all(i.attachments.map((y,S)=>T(this,void 0,void 0,function*(){return this._sendFile(u[S],y,{topic:i.topic,mimeType:y.type,onProgress:k=>{p(k,S+1)}})})))),g.info})}streamText(t){return T(this,void 0,void 0,function*(){var i,a,o;const l=(i=t?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),h={id:l,mimeType:"text/plain",timestamp:Date.now(),topic:(a=t?.topic)!==null&&a!==void 0?a:"",size:t?.totalSize,attributes:t?.attributes,encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?pt.GCM:pt.NONE},u=new pc({streamId:l,mimeType:h.mimeType,topic:h.topic,timestamp:da(h.timestamp),totalLength:da(t?.totalSize),attributes:h.attributes,contentHeader:{case:"textHeader",value:new _y({version:t?.version,attachedStreamIds:t?.attachedStreamIds,replyToStreamId:t?.replyToStreamId,operationType:t?.type==="update"?Ed.UPDATE:Ed.CREATE})}}),m=t?.destinationIdentities,p=new wt({destinationIdentities:m,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(p,ke.RELIABLE);let g=0;const y=this.engine,S=new WritableStream({write(R){return T(this,void 0,void 0,function*(){for(const G of nE(R,Gv)){const I=new gc({content:G,streamId:l,chunkIndex:da(g)}),Z=new wt({destinationIdentities:m,value:{case:"streamChunk",value:I}});yield y.sendDataPacket(Z,ke.RELIABLE),g+=1}})},close(){return T(this,void 0,void 0,function*(){const R=new vc({streamId:l}),G=new wt({destinationIdentities:m,value:{case:"streamTrailer",value:R}});yield y.sendDataPacket(G,ke.RELIABLE)})},abort(R){console.log("Sink error:",R)}});let k=()=>T(this,void 0,void 0,function*(){yield A.close()});y.once(W.Closing,k);const A=new l_(S,h,()=>this.engine.off(W.Closing,k));return A})}sendFile(t,i){return T(this,void 0,void 0,function*(){const a=crypto.randomUUID();return yield this._sendFile(a,t,i),{id:a}})}_sendFile(t,i,a){return T(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:t,totalSize:i.size,name:i.name,mimeType:(o=a?.mimeType)!==null&&o!==void 0?o:i.type,topic:a?.topic,destinationIdentities:a?.destinationIdentities}),h=i.stream().getReader();for(;;){const{done:u,value:m}=yield h.read();if(u)break;yield l.write(m)}return yield l.close(),l.info})}streamBytes(t){return T(this,void 0,void 0,function*(){var i,a,o,l,h,u;const m=(i=t?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),p=t?.destinationIdentities,g={id:m,mimeType:(a=t?.mimeType)!==null&&a!==void 0?a:"application/octet-stream",topic:(o=t?.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:t?.attributes,size:t?.totalSize,name:(l=t?.name)!==null&&l!==void 0?l:"unknown",encryptionType:!((h=this.engine.e2eeManager)===null||h===void 0)&&h.isDataChannelEncryptionEnabled?pt.GCM:pt.NONE},y=new pc({totalLength:da((u=g.size)!==null&&u!==void 0?u:0),mimeType:g.mimeType,streamId:m,topic:g.topic,timestamp:da(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new Ry({name:g.name})}}),S=new wt({destinationIdentities:p,value:{case:"streamHeader",value:y}});yield this.engine.sendDataPacket(S,ke.RELIABLE);let k=0;const A=new xt,R=this.engine,G=this.log,I=new WritableStream({write(X){return T(this,void 0,void 0,function*(){const M=yield A.lock();let D=0;try{for(;D<X.byteLength;){const z=X.slice(D,D+Gv),K=new wt({destinationIdentities:p,value:{case:"streamChunk",value:new gc({content:z,streamId:m,chunkIndex:da(k)})}});yield R.sendDataPacket(K,ke.RELIABLE),k+=1,D+=z.byteLength}}finally{M()}})},close(){return T(this,void 0,void 0,function*(){const X=new vc({streamId:m}),M=new wt({destinationIdentities:p,value:{case:"streamTrailer",value:X}});yield R.sendDataPacket(M,ke.RELIABLE)})},abort(X){G.error("Sink error:",X)}});return new u_(I,g)})}}class x0 extends F{constructor(t,i,a,o,l){super(t,a,l),this.sid=i,this.receiver=o}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?Q.Muted:Q.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const i=a=>{a.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Q.Ended,this))};t.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Sh)),Pk()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>t());const a=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(a){const{timestamp:o,rtpTimestamp:l}=a;l&&this.rtpTimestamp!==l&&(this.emit(Q.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};t()}}class h_ extends x0{constructor(t,i,a,o,l,h){super(t,i,F.Kind.Audio,a,h),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=wc(u,this.prevStats)),this.prevStats=u}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(t){var i;for(const a of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(t,0,.1):a.volume=t;Nn()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(Nn())return 1;let t=0;return this.attachedElements.forEach(i=>{i.volume>t&&(t=i.volume)}),t}setSinkId(t){return T(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(i=>{if(zd(i))return i.setSinkId(t)}))})}attach(t){const i=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&zd(t)&&t.setSinkId(this.sinkId).catch(a=>{this.log.error("Failed to set sink id on remote audio track",a,this.logContext)}),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let i;return t?(i=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,i){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(i.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{a.connect(o),a=o}),this.gainNode=t.createGain(),a.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(Q.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(Q.AudioPlaybackFailed,o)})}disconnectWebAudio(){var t,i;(t=this.gainNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i;return t.forEach(a=>{a.type==="inbound-rtp"&&(i={type:"audio",streamId:a.id,timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),i})}}const Sd=100;class f_ extends x0{constructor(t,i,a,o,l){super(t,i,F.Kind.Video,a,l),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const h=yield this.getReceiverStats();h&&this.prevStats&&this.receiver&&(this._currentBitrate=wc(h,this.prevStats)),this.prevStats=h}),this.debouncedHandleResize=gh(()=>{this.updateDimensions()},Sd),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===F.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(i=>{t?ls(this._mediaStreamTrack,i):is(this._mediaStreamTrack,i)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===t)===void 0){const i=new m_(t);this.observeElementInfo(i)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(a=>a===t);for(const a of i)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let i=[];if(t)return this.stopObservingElement(t),super.detach(t);i=super.detach();for(const a of i)this.stopObservingElement(a);return i}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i,a="",o=new Map;return t.forEach(l=>{l.type==="inbound-rtp"?(a=l.codecId,i={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),i&&a!==""&&o.get(a)&&(i.mimeType=o.get(a).mimeType),i})}stopObservingElement(t){const i=this.elementInfos.filter(a=>a.element===t);for(const a of i)this.stopObservingElementInfo(a)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var i,a;const o=this.elementInfos.reduce((m,p)=>Math.max(m,p.visibilityChangedAt||0),0),l=!((a=(i=this.adaptiveStreamSettings)===null||i===void 0?void 0:i.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,h=this.elementInfos.some(m=>m.pictureInPicture),u=this.elementInfos.some(m=>m.visible)&&!l||h;if(!(this.lastVisible===u&&!t)){if(!u&&Date.now()-o<Sd){_t.setTimeout(()=>{this.updateVisibility()},Sd);return}this.lastVisible=u,this.emit(Q.VisibilityChanged,u,this)}}updateDimensions(){var t,i;let a=0,o=0;const l=this.getPixelDensity();for(const h of this.elementInfos){const u=h.width()*l,m=h.height()*l;u+m>a+o&&(a=u,o=m)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===a&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===o||(this.lastDimensions={width:a,height:o},this.emit(Q.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return i==="screen"?bv():i||(bv()>2?2:1)}}class m_{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,i){this.onVisibilityChanged=a=>{var o;const{target:l,isIntersecting:h}=a;l===this.element&&(this.isIntersecting=h,this.isPiP=gr(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var a,o,l;(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=gr(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var a;this.isPiP=gr(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.element=t,this.isIntersecting=i??Kd(t),this.isPiP=Ft()&&gr(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,i,a;this.isIntersecting=Kd(this.element),this.isPiP=gr(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Tv().observe(this.element),Sv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,i,a,o,l;(t=Tv())===null||t===void 0||t.unobserve(this.element),(i=Sv())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(a=window.documentPictureInPicture)===null||a===void 0||a.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function gr(r){var t,i;return document.pictureInPictureElement===r?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Kd(r,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Kd(r,t){const i=t||window;let a=r.offsetTop,o=r.offsetLeft;const l=r.offsetWidth,h=r.offsetHeight,{hidden:u}=r,{display:m}=getComputedStyle(r);for(;r.offsetParent;)r=r.offsetParent,a+=r.offsetTop,o+=r.offsetLeft;return a<i.pageYOffset+i.innerHeight&&o<i.pageXOffset+i.innerWidth&&a+h>i.pageYOffset&&o+l>i.pageXOffset&&!u&&m!=="none"}class ni extends Ln.EventEmitter{constructor(t,i,a,o){var l;super(),this.metadataMuted=!1,this.encryption=pt.NONE,this.log=Ce,this.handleMuted=()=>{this.emit(Q.Muted)},this.handleUnmuted=()=>{this.emit(Q.Unmuted)},this.log=oi((l=o?.loggerName)!==null&&l!==void 0?l:_n.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=i,this.trackName=a,this.source=F.Source.Unknown}setTrack(t){this.track&&(this.track.off(Q.Muted,this.handleMuted),this.track.off(Q.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(Q.Muted,this.handleMuted),t.on(Q.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Re(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==pt.NONE}get audioTrack(){if(xn(this.track))return this.track}get videoTrack(){if(Fi(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=F.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===F.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(r){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(r.SubscriptionStatus||(r.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(r.PermissionStatus||(r.PermissionStatus={}))})(ni||(ni={}));class Yd extends ni{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Q.Ended)},this.handleCpuConstrained=()=>{this.track&&Fi(this.track)&&this.emit(Q.CpuConstrained,this.track)},this.updateInfo(i),this.setTrack(a)}setTrack(t){this.track&&(this.track.off(Q.Ended,this.handleTrackEnded),this.track.off(Q.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(Q.Ended,this.handleTrackEnded),t.on(Q.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(xn(this.track)){const i=this.track.getSourceTrackSettings(),a=new Set;return i.autoGainControl&&a.add(yt.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&a.add(yt.TF_ECHO_CANCELLATION),i.noiseSuppression&&a.add(yt.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&a.add(yt.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||a.add(yt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(yt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}function xc(r,t){return T(this,void 0,void 0,function*(){r??(r={});let i=!1;const{audioProcessor:a,videoProcessor:o,optionsWithoutProcessor:l}=y0(r);let h=l.audio,u=l.video;if(a&&typeof l.audio=="object"&&(l.audio.processor=a),o&&typeof l.video=="object"&&(l.video.processor=o),r.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const y=l.audio.deviceId;l.audio.deviceId={exact:y},i=!0,h=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:y}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const y=l.video.deviceId;l.video.deviceId={exact:y},i=!0,u=Object.assign(Object.assign({},l.video),{deviceId:{ideal:y}})}l.audio===!0?l.audio={deviceId:"default"}:typeof l.audio=="object"&&l.audio!==null&&(l.audio=Object.assign(Object.assign({},l.audio),{deviceId:l.audio.deviceId||"default"})),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const m=p0(l,k0,E0),p=hh(m),g=navigator.mediaDevices.getUserMedia(p);l.audio&&(bt.userMediaPromiseMap.set("audioinput",g),g.catch(()=>bt.userMediaPromiseMap.delete("audioinput"))),l.video&&(bt.userMediaPromiseMap.set("videoinput",g),g.catch(()=>bt.userMediaPromiseMap.delete("videoinput")));try{const y=yield g;return yield Promise.all(y.getTracks().map(S=>T(this,void 0,void 0,function*(){const k=S.kind==="audio";let A=k?m.audio:m.video;(typeof A=="boolean"||!A)&&(A={});let R;const G=k?p.audio:p.video;typeof G!="boolean"&&(R=G);const I=S.getSettings().deviceId;R?.deviceId&&Bi(R.deviceId)!==I?R.deviceId=I:R||(R={deviceId:I});const Z=VE(S,R,t);return Z.kind===F.Kind.Video?Z.source=F.Source.Camera:Z.kind===F.Kind.Audio&&(Z.source=F.Source.Microphone),Z.mediaStream=y,xn(Z)&&a?yield Z.setProcessor(a):Fi(Z)&&o&&(yield Z.setProcessor(o)),Z})))}catch(y){if(!i)throw y;return xc(Object.assign(Object.assign({},r),{audio:h,video:u}),t)}})}function p_(r){return T(this,void 0,void 0,function*(){return(yield xc({audio:!1,video:!0}))[0]})}function g_(r){return T(this,void 0,void 0,function*(){return(yield xc({audio:!0,video:!1}))[0]})}var Ui;(function(r){r.Excellent="excellent",r.Good="good",r.Poor="poor",r.Lost="lost",r.Unknown="unknown"})(Ui||(Ui={}));function v_(r){switch(r){case vr.EXCELLENT:return Ui.Excellent;case vr.GOOD:return Ui.Good;case vr.POOR:return Ui.Poor;case vr.LOST:return Ui.Lost;default:return Ui.Unknown}}class N0 extends Ln.EventEmitter{get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===Er.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===ss.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,i,a,o,l,h){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Er.STANDARD;var m;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ui.Unknown,this.log=Ce,this.log=oi((m=h?.loggerName)!==null&&m!==void 0?m:_n.Participant),this.loggerOptions=h,this.setMaxListeners(100),this.sid=t,this.identity=i,this.name=a,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,i]of this.trackPublications)if(i.source===t)return i}getTrackPublicationByName(t){for(const[,i]of this.trackPublications)if(i.trackName===t)return i}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new pn,this.once(ee.Active,()=>{var t,i;(i=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const i=this.getTrackPublication(F.Source.Camera);return!(!((t=i?.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const i=this.getTrackPublication(F.Source.Microphone);return!(!((t=i?.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(F.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var i;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===ss.ACTIVE&&((i=this.participantInfo)===null||i===void 0?void 0:i.state)!==ss.ACTIVE&&this.emit(ee.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const i=this.metadata!==t,a=this.metadata;this.metadata=t,i&&this.emit(ee.ParticipantMetadataChanged,a)}_setName(t){const i=this.name!==t;this.name=t,i&&this.emit(ee.ParticipantNameChanged,t)}_setAttributes(t){const i=Lk(this.attributes,t);this._attributes=t,Object.keys(i).length>0&&this.emit(ee.AttributesChanged,i)}setPermissions(t){var i,a,o,l,h,u;const m=this.permissions,p=t.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||t.canSubscribe!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribe)||t.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||t.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||t.recorder!==((h=this.permissions)===null||h===void 0?void 0:h.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((g,y)=>{var S;return g!==((S=this.permissions)===null||S===void 0?void 0:S.canPublishSources[y])})||t.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=t,p&&this.emit(ee.ParticipantPermissionsChanged,m),p}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ee.IsSpeakingChanged,t))}setConnectionQuality(t){const i=this._connectionQuality;this._connectionQuality=v_(t),i!==this._connectionQuality&&this.emit(ee.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,i;this.activeFuture&&((i=(t=this.activeFuture).reject)===null||i===void 0||i.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(i=>xn(i.track)&&i.track.setAudioContext(t))}addTrackPublication(t){t.on(Q.Muted,()=>{this.emit(ee.TrackMuted,t)}),t.on(Q.Unmuted,()=>{this.emit(ee.TrackUnmuted,t)});const i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case F.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case F.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function y_(r){var t,i,a;if(!r.participantSid&&!r.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new wy({participantIdentity:(t=r.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=r.participantSid)!==null&&i!==void 0?i:"",allTracks:(a=r.allowAll)!==null&&a!==void 0?a:!1,trackSids:r.allowedTrackSids||[]})}class b_ extends N0{constructor(t,i,a,o,l,h){super(t,i,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=pt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new pn)},this.handleReconnected=()=>{var u,m;(m=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||m===void 0||m.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,m,p,g,y,S;this.reconnectFuture&&(this.reconnectFuture.promise.catch(k=>this.log.warn(k.message,this.logContext)),(m=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||m===void 0||m.call(u,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(p=this.signalConnectedFuture).reject)===null||g===void 0||g.call(p,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(S=(y=this.activeAgentFuture)===null||y===void 0?void 0:y.reject)===null||S===void 0||S.call(y,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var m,p;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new pn),(p=(m=this.signalConnectedFuture).resolve)===null||p===void 0||p.call(m)},this.handleSignalRequestResponse=u=>{const{requestId:m,reason:p,message:g}=u,y=this.pendingSignalRequests.get(m);y&&(p!==ch.OK&&y.reject(new mv(g,p)),this.pendingSignalRequests.delete(m))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let m=u.value.value,p=null,g=null;m.value.case==="payload"?p=m.value.value:m.value.case==="error"&&(g=it.fromProto(m.value.value)),this.handleIncomingRpcResponse(m.requestId,p,g);break;case"rpcAck":let y=u.value.value;this.handleIncomingRpcAck(y.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>y_(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,m)=>{if(m===void 0&&(m=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Re(u)));return}this.engine.updateMuteStatus(u.sid,m)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Re(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Re(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const m=this.audioTrackPublications.get(u.sid);if(!m){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(m.trackSid,m.getTrackFeatures())},this.onTrackCpuConstrained=(u,m)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Re(m))),this.emit(ee.LocalTrackCpuConstrained,u,m)},this.handleSubscribedQualityUpdate=u=>T(this,void 0,void 0,function*(){var m,p,g,y,S;if(!(!((S=this.roomOptions)===null||S===void 0)&&S.dynacast))return;const k=this.videoTrackPublications.get(u.trackSid);if(!k){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!k.videoTrack)return;const A=yield k.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var R=!0,G=si(A),I;I=yield G.next(),m=I.done,!m;R=!0){y=I.value,R=!1;const Z=y;Mk(Z)&&(this.log.debug("publish ".concat(Z," for ").concat(k.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Re(k))),yield this.publishAdditionalCodecForTrack(k.videoTrack,Z,k.options))}}catch(Z){p={error:Z}}finally{try{!R&&!m&&(g=G.return)&&(yield g.call(G))}finally{if(p)throw p.error}}}),this.handleLocalTrackUnpublished=u=>{const m=this.trackPublications.get(u.trackSid);if(!m){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(m.track)},this.handleTrackEnded=u=>T(this,void 0,void 0,function*(){if(u.source===F.Source.ScreenShare||u.source===F.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Re(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(ti(u)||Pi(u))try{if(Ft())try{const m=yield navigator?.permissions.query({name:u.source===F.Source.Camera?"camera":"microphone"});if(m&&m.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Re(u))),m.onchange=()=>{m.state!=="denied"&&(u.isMuted||u.restartTrack(),m.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Re(u))),ti(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Re(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=a,this.roomOptions=o,this.setupEngine(a),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=h}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==pt.NONE}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setupEngine(t){var i;this.engine=t,this.engine.on(W.RemoteMute,(a,o)=>{const l=this.trackPublications.get(a);!l||!l.track||(o?l.mute():l.unmute())}),!((i=this.signalConnectedFuture)===null||i===void 0)&&i.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(W.Connected,this.handleReconnected).on(W.SignalConnected,this.handleSignalConnected).on(W.SignalRestarted,this.handleReconnected).on(W.SignalResumed,this.handleReconnected).on(W.Restarting,this.handleReconnecting).on(W.Resuming,this.handleReconnecting).on(W.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(W.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(W.Closing,this.handleClosing).on(W.SignalRequestResponse,this.handleSignalRequestResponse).on(W.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return T(this,arguments,void 0,function(i){var a=this;let{metadata:o,name:l,attributes:h}=i;return(function*(){return new Vt((u,m)=>T(a,void 0,void 0,function*(){var p,g;try{let y=!1;const S=yield this.engine.client.sendUpdateLocalMetadata((p=o??this.metadata)!==null&&p!==void 0?p:"",(g=l??this.name)!==null&&g!==void 0?g:"",h),k=performance.now();for(this.pendingSignalRequests.set(S,{resolve:u,reject:A=>{m(A),y=!0},values:{name:l,metadata:o,attributes:h}});performance.now()-k<5e3&&!y;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!h||Object.entries(h).every(A=>{let[R,G]=A;return this.attributes[R]===G||G===""&&!this.attributes[R]}))){this.pendingSignalRequests.delete(S),u();return}yield Rt(50)}m(new mv("Request to update local metadata timed out","TimeoutError"))}catch(y){y instanceof Error?m(y):m(new Error(String(y)))}}))})()})}setCameraEnabled(t,i,a){return this.setTrackEnabled(F.Source.Camera,t,i,a)}setMicrophoneEnabled(t,i,a){return this.setTrackEnabled(F.Source.Microphone,t,i,a)}setScreenShareEnabled(t,i,a){return this.setTrackEnabled(F.Source.ScreenShare,t,i,a)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){this.encryptionType=t?pt.GCM:pt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,i,a,o){return T(this,void 0,void 0,function*(){var l,h;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:i})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(t);if(i)if(u)yield u.unmute();else{let m;if(this.pendingPublishing.has(t)){const p=yield this.waitForPendingPublicationOfSource(t);return p||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield p?.unmute(),p}this.pendingPublishing.add(t);try{switch(t){case F.Source.Camera:m=yield this.createTracks({video:(l=a)!==null&&l!==void 0?l:!0});break;case F.Source.Microphone:m=yield this.createTracks({audio:(h=a)!==null&&h!==void 0?h:!0});break;case F.Source.ScreenShare:m=yield this.createScreenTracks(Object.assign({},a));break;default:throw new ri(t)}}catch(p){throw m?.forEach(g=>{g.stop()}),p instanceof Error&&this.emit(ee.MediaDevicesError,p,Id(t)),this.pendingPublishing.delete(t),p}for(const p of m){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),a);t===F.Source.Microphone&&xn(p)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),p.startPreConnectBuffer())}try{const p=[];for(const y of m)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Re(y))),p.push(this.publishTrack(y,o));[u]=yield Promise.all(p)}catch(p){throw m?.forEach(g=>{g.stop()}),p}finally{this.pendingPublishing.delete(t)}}else if(!u?.track&&this.pendingPublishing.has(t)&&(u=yield this.waitForPendingPublicationOfSource(t),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),u&&u.track)if(t===F.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const m=this.getTrackPublication(F.Source.ScreenShareAudio);m&&m.track&&this.unpublishTrack(m.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(F.Source.Camera)||this.pendingPublishing.has(F.Source.Microphone))){this.pendingPublishing.add(F.Source.Camera),this.pendingPublishing.add(F.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(F.Source.Camera),this.pendingPublishing.delete(F.Source.Microphone)}}})}createTracks(t){return T(this,void 0,void 0,function*(){var i,a;t??(t={});const o=p0(t,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(a=this.roomOptions)===null||a===void 0?void 0:a.videoCaptureDefaults);try{return(yield xc(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(xn(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=F.Source.Microphone,this.emit(ee.AudioStreamAcquired)),Fi(u)&&(this.cameraError=void 0,u.source=F.Source.Camera),u))}catch(l){throw l instanceof Error&&(t.audio&&(this.microphoneError=l),t.video&&(this.cameraError=l)),l}})}createScreenTracks(t){return T(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new uh("getDisplayMedia not supported");t.resolution===void 0&&!Hk()&&(t.resolution=dh.h1080fps30.resolution);const i=xk(t),a=yield navigator.mediaDevices.getDisplayMedia(i),o=a.getVideoTracks();if(o.length===0)throw new ri("no video track found");const l=new Sc(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=F.Source.ScreenShare,t.contentHint&&(l.mediaStreamTrack.contentHint=t.contentHint);const h=[l];if(a.getAudioTracks().length>0){this.emit(ee.AudioStreamAcquired);const u=new bc(a.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=F.Source.ScreenShareAudio,h.push(u)}return h})}publishTrack(t,i){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,i)})}publishOrRepublishTrack(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,m,p,g;ti(a)&&a.setAudioContext(l.audioContext),yield(u=l.reconnectFuture)===null||u===void 0?void 0:u.promise,l.republishPromise&&!h&&(yield l.republishPromise),us(a)&&l.pendingPublishPromises.has(a)&&(yield l.pendingPublishPromises.get(a));let y;if(a instanceof MediaStreamTrack)y=a.getConstraints();else{y=a.constraints;let I;switch(a.source){case F.Source.Microphone:I="audioinput";break;case F.Source.Camera:I="videoinput"}I&&l.activeDeviceMap.has(I)&&(y=Object.assign(Object.assign({},y),{deviceId:l.activeDeviceMap.get(I)}))}if(a instanceof MediaStreamTrack)switch(a.kind){case"audio":a=new bc(a,y,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":a=new Sc(a,y,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new ri("unsupported MediaStreamTrack kind ".concat(a.kind))}else a.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let S;if(l.trackPublications.forEach(I=>{I.track&&I.track===a&&(S=I)}),S)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Re(S))),S;const k=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o),A="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,R=(m=k.forceStereo)!==null&&m!==void 0?m:A;R&&(k.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Re(a))),k.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(p=k.dtx)!==null&&p!==void 0||(k.dtx=!1),(g=k.red)!==null&&g!==void 0||(k.red=!1)),!Kk()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),k.simulcast=!1),k.source&&(a.source=k.source);const G=new Promise((I,Z)=>T(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ge.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Re(a)}));let X=!1;const M=setTimeout(()=>{X=!0,a.stop(),Z(new fv("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(M),X)return;const D=yield this.publish(a,k,R);I(D)}else try{const X=yield this.publish(a,k,R);I(X)}catch(X){Z(X)}}catch(X){Z(X)}}));l.pendingPublishPromises.set(a,G);try{return yield G}catch(I){throw I}finally{l.pendingPublishPromises.delete(a)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new pn),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Re(t))),!1;const{canPublish:i,canPublishSources:a}=this.permissions;return i&&(a.length===0||a.map(o=>Uk(o)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Re(t))),!1)}publish(t,i,a){return T(this,void 0,void 0,function*(){var o,l,h,u,m,p,g,y,S,k;if(!this.hasPermissionsToPublish(t))throw new fv("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(ne=>us(t)&&ne.source===t.source)&&t.source!==F.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),Re(t))),i.stopMicTrackOnMute&&xn(t)&&(t.stopOnMute=!0),t.source===F.Source.ScreenShare&&fa()&&(i.simulcast=!1),i.videoCodec==="av1"&&!qk()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!Vk()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=Fd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(ne=>i.videoCodec===Tr(ne.mime))||(i.videoCodec=Tr(this.enabledPublishVideoCodecs[0].mime)));const R=i.videoCodec;t.on(Q.Muted,this.onTrackMuted),t.on(Q.Unmuted,this.onTrackUnmuted),t.on(Q.Ended,this.handleTrackEnded),t.on(Q.UpstreamPaused,this.onTrackUpstreamPaused),t.on(Q.UpstreamResumed,this.onTrackUpstreamResumed),t.on(Q.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const G=[],I=!(!((o=i.dtx)!==null&&o!==void 0)||o),Z=t.getSourceTrackSettings();Z.autoGainControl&&G.push(yt.TF_AUTO_GAIN_CONTROL),Z.echoCancellation&&G.push(yt.TF_ECHO_CANCELLATION),Z.noiseSuppression&&G.push(yt.TF_NOISE_SUPPRESSION),Z.channelCount&&Z.channelCount>1&&G.push(yt.TF_STEREO),I&&G.push(yt.TF_NO_DTX),ti(t)&&t.hasPreConnectBuffer&&G.push(yt.TF_PRECONNECT_BUFFER);const X=new _r({cid:t.mediaStreamTrack.id,name:i.name,type:F.kindToProto(t.kind),muted:t.isMuted,source:F.sourceToProto(t.source),disableDtx:I,encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((l=i.red)!==null&&l!==void 0)||l),stream:i?.stream,backupCodecPolicy:i?.backupCodecPolicy,audioFeatures:G});let M;if(t.kind===F.Kind.Video){let ne={width:0,height:0};try{ne=yield t.waitForDimensions()}catch{const re=(u=(h=this.roomOptions.videoCaptureDefaults)===null||h===void 0?void 0:h.resolution)!==null&&u!==void 0?u:Rr.h720.resolution;ne={width:re.width,height:re.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Re(t)),{dims:ne}))}X.width=ne.width,X.height=ne.height,Pi(t)&&(kn(R)&&(t.source===F.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Re(t))))),i.scalabilityMode=(m=i.scalabilityMode)!==null&&m!==void 0?m:"L3T3_KEY"),X.simulcastCodecs=[new Rd({codec:R,cid:t.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:Fd}),i.backupCodec&&R!==i.backupCodec.codec&&X.encryption===pt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),X.simulcastCodecs.push(new Rd({codec:i.backupCodec.codec,cid:""})))),M=Gd(t.source===F.Source.ScreenShare,X.width,X.height,i),X.layers=qv(X.width,X.height,M,kn(i.videoCodec))}else t.kind===F.Kind.Audio&&(M=[{maxBitrate:(p=i.audioPreset)===null||p===void 0?void 0:p.maxBitrate,priority:(y=(g=i.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&y!==void 0?y:"high",networkPriority:(k=(S=i.audioPreset)===null||S===void 0?void 0:S.priority)!==null&&k!==void 0?k:"high"}]);if(!this.engine||this.engine.isClosed)throw new ot("cannot publish track when not connected");const D=()=>T(this,void 0,void 0,function*(){var ne,ie,re;if(!this.engine.pcManager)throw new ot("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,i,M),this.emit(ee.LocalSenderCreated,t.sender,t),Pi(t)&&((ne=i.degradationPreference)!==null&&ne!==void 0||(i.degradationPreference=WE(t)),t.setDegradationPreference(i.degradationPreference)),M)if(fa()&&t.kind===F.Kind.Audio){let ae;for(const fe of this.engine.pcManager.publisher.getTransceivers())if(fe.sender===t.sender){ae=fe;break}ae&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ae,codec:"opus",maxbr:!((ie=M[0])===null||ie===void 0)&&ie.maxBitrate?M[0].maxBitrate/1e3:0})}else t.codec&&kn(t.codec)&&(!((re=M[0])===null||re===void 0)&&re.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:X.cid,codec:t.codec,maxbr:M[0].maxBitrate/1e3});yield this.engine.negotiate()});let z;const K=new Promise((ne,ie)=>T(this,void 0,void 0,function*(){var re;try{z=yield this.engine.addTrack(X),ne(z)}catch(ae){t.sender&&(!((re=this.engine.pcManager)===null||re===void 0)&&re.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(fe=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Re(t)),{error:fe}))})),ie(ae)}}));if(this.enabledPublishVideoCodecs.length>0)z=(yield Promise.all([K,D()]))[0];else{z=yield K;let ne;if(z.codecs.forEach(ie=>{ne===void 0&&(ne=ie.mimeType)}),ne&&t.kind===F.Kind.Video){const ie=Tr(ne);ie!==R&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Re(t)),{codec:ie})),i.videoCodec=ie,M=Gd(t.source===F.Source.ScreenShare,X.width,X.height,i))}yield D()}const se=new Yd(t.kind,z,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(se.on(Q.CpuConstrained,ne=>this.onTrackCpuConstrained(ne,se)),se.options=i,t.sid=z.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:M,trackInfo:z})),Pi(t)?t.startMonitor(this.engine.client):ti(t)&&t.startMonitor(),this.addTrackPublication(se),this.emit(ee.LocalTrackPublished,se),ti(t)&&z.audioFeatures.includes(yt.TF_PRECONNECT_BUFFER)){const ne=t.getPreConnectBuffer(),ie=t.getPreConnectBufferMimeType();this.on(ee.LocalTrackSubscribed,re=>{if(re.trackSid===z.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Re(t))),t.stopPreConnectBuffer()}}),ne&&new Promise((ae,fe)=>T(this,void 0,void 0,function*(){var Fe,Qe,L,J,$,me;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Re(t)));const te=setTimeout(()=>{fe(new Error("agent not active within 10 seconds"))},1e4),ce=yield this.waitUntilActiveAgentPresent();clearTimeout(te),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Re(t)));const pe=yield this.streamBytes({name:"preconnect-buffer",mimeType:ie,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ce.identity],attributes:{trackId:se.trackSid,sampleRate:String(($=Z.sampleRate)!==null&&$!==void 0?$:"48000"),channels:String((me=Z.channelCount)!==null&&me!==void 0?me:"1")}});try{for(var ve=!0,_=si(ne),q;q=yield _.next(),Fe=q.done,!Fe;ve=!0){J=q.value,ve=!1;const be=J;yield pe.write(be)}}catch(be){Qe={error:be}}finally{try{!ve&&!Fe&&(L=_.return)&&(yield L.call(_))}finally{if(Qe)throw Qe.error}}yield pe.close(),ae()}catch(te){fe(te)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Re(t)))}).catch(ae=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Re(t)),{error:ae}))})}return se})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,i,a){return T(this,void 0,void 0,function*(){var o;if(this.encryptionType!==pt.NONE)return;let l;if(this.trackPublications.forEach(k=>{k.track&&k.track===t&&(l=k)}),!l)throw new ri("track is not published");if(!Pi(t))throw new ri("track is not a video track");const h=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),a),u=QE(t,i,h);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Re(t)));return}const m=t.addSimulcastTrack(i,u);if(!m)return;const p=new _r({cid:m.mediaStreamTrack.id,type:F.kindToProto(t.kind),muted:t.isMuted,source:F.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:h.videoCodec,cid:m.mediaStreamTrack.id}]});if(p.layers=qv(p.width,p.height,u),!this.engine||this.engine.isClosed)throw new ot("cannot publish track when not connected");const g=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,m,h,u),yield this.engine.negotiate()}),S=(yield Promise.all([this.engine.addTrack(p),g()]))[0];this.log.debug("published ".concat(i," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:S}))})}unpublishTrack(t,i){return T(this,void 0,void 0,function*(){var a,o;if(us(t)){const p=this.pendingPublishPromises.get(t);p&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Re(t))),yield p)}const l=this.getPublicationForTrack(t),h=l?Re(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),h)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),h));return}t=l.track,t.off(Q.Muted,this.onTrackMuted),t.off(Q.Unmuted,this.onTrackUnmuted),t.off(Q.Ended,this.handleTrackEnded),t.off(Q.UpstreamPaused,this.onTrackUpstreamPaused),t.off(Q.UpstreamResumed,this.onTrackUpstreamResumed),t.off(Q.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(o=(a=this.roomOptions)===null||a===void 0?void 0:a.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),i?t.stop():t.stopMonitor();let u=!1;const m=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<tt.FAILED&&m)try{for(const p of this.engine.pcManager.publisher.getTransceivers())p.sender===m&&(p.direction="inactive",u=!0);if(this.engine.removeTrack(m)&&(u=!0),Pi(t)){for(const[,p]of t.simulcastCodecs)p.sender&&(this.engine.removeTrack(p.sender)&&(u=!0),p.sender=void 0);t.simulcastCodecs.clear()}}catch(p){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),h),{error:p}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case F.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case F.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(ee.LocalTrackUnpublished,l),l.setTrack(void 0),u&&(yield this.engine.negotiate()),l})}unpublishTracks(t){return T(this,void 0,void 0,function*(){return(yield Promise.all(t.map(a=>this.unpublishTrack(a)))).filter(a=>!!a)})}republishAllTracks(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){a.republishPromise&&(yield a.republishPromise),a.republishPromise=new Vt((l,h)=>T(a,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(m=>{m.track&&(i&&(m.options=Object.assign(Object.assign({},m.options),i)),u.push(m))}),yield Promise.all(u.map(m=>T(this,void 0,void 0,function*(){const p=m.track;yield this.unpublishTrack(p,!1),o&&!p.isMuted&&p.source!==F.Source.ScreenShare&&p.source!==F.Source.ScreenShareAudio&&(ti(p)||Pi(p))&&!p.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:m.trackSid})),yield p.restartTrack()),yield this.publishOrRepublishTrack(p,m.options,!0)}))),l()}catch(u){u instanceof Error?h(u):h(new Error(String(u)))}finally{this.republishPromise=void 0}})),yield a.republishPromise})()})}publishData(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=o.reliable?ke.RELIABLE:ke.LOSSY,h=o.destinationIdentities,u=o.topic;let m=new $d({participantIdentity:a.identity,payload:i,destinationIdentities:h,topic:u});const p=new wt({kind:l,value:{case:"user",value:m}});yield a.engine.sendDataPacket(p,l)})()})}publishDtmf(t,i){return T(this,void 0,void 0,function*(){const a=new wt({kind:ke.RELIABLE,value:{case:"sipDtmf",value:new gy({code:t,digit:i})}});yield this.engine.sendDataPacket(a,ke.RELIABLE)})}sendChatMessage(t,i){return T(this,void 0,void 0,function*(){const a={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:i?.attachments},o=new wt({value:{case:"chatMessage",value:new mc(Object.assign(Object.assign({},a),{timestamp:We.parse(a.timestamp)}))}});return yield this.engine.sendDataPacket(o,ke.RELIABLE),this.emit(ee.ChatMessage,a),a})}editChatMessage(t,i){return T(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},i),{message:t,editTimestamp:Date.now()}),o=new wt({value:{case:"chatMessage",value:new mc(Object.assign(Object.assign({},a),{timestamp:We.parse(a.timestamp),editTimestamp:We.parse(a.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,ke.RELIABLE),this.emit(ee.ChatMessage,a),a})}sendText(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,i)})}streamText(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,i)})}streamBytes(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){let{destinationIdentity:i,method:a,payload:o,responseTimeout:l=15e3}=t;const h=7e3,u=h+1e3;return new Vt((m,p)=>T(this,void 0,void 0,function*(){var g,y,S,k;if(bh(o)>R0){p(it.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((y=(g=this.engine.latestJoinResponse)===null||g===void 0?void 0:g.serverInfo)===null||y===void 0)&&y.version&&Pn((k=(S=this.engine.latestJoinResponse)===null||S===void 0?void 0:S.serverInfo)===null||k===void 0?void 0:k.version,"1.8.0")<0){p(it.builtIn("UNSUPPORTED_SERVER"));return}const A=Math.max(l,u),R=crypto.randomUUID();yield this.publishRpcRequest(i,R,a,o,A);const G=setTimeout(()=>{this.pendingAcks.delete(R),p(it.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(R),clearTimeout(I)},h);this.pendingAcks.set(R,{resolve:()=>{clearTimeout(G)},participantIdentity:i});const I=setTimeout(()=>{this.pendingResponses.delete(R),p(it.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(R,{resolve:(Z,X)=>{clearTimeout(I),this.pendingAcks.has(R)&&(this.log.warn("RPC response received before ack",R),this.pendingAcks.delete(R),clearTimeout(G)),X?p(X):m(Z??"")},participantIdentity:i})}))}registerRpcMethod(t,i){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const i=this.pendingAcks.get(t);i?(i.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,i,a){const o=this.pendingResponses.get(t);o?(o.resolve(i,a),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,i,a,o,l){return T(this,void 0,void 0,function*(){const h=new wt({destinationIdentities:[t],kind:ke.RELIABLE,value:{case:"rpcRequest",value:new eh({id:i,method:a,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(h,ke.RELIABLE)})}handleParticipantDisconnected(t){for(const[i,{participantIdentity:a}]of this.pendingAcks)a===t&&this.pendingAcks.delete(i);for(const[i,{participantIdentity:a,resolve:o}]of this.pendingResponses)a===t&&(o(null,it.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(i))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(i=>i.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(i=>{var a,o;const l=this.trackPublications.get(i.sid);if(l){const h=l.isMuted||((o=(a=l.track)===null||a===void 0?void 0:a.isUpstreamPaused)!==null&&o!==void 0?o:!1);h!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Re(l)),{mutedOnServer:h})),this.engine.client.sendMuteTrack(i.sid,h))}}),!0):!1}setActiveAgent(t){var i,a,o,l;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(a=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.resolve)===null||a===void 0||a.call(i,t):(l=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new pn),this.activeAgentFuture.promise)}getPublicationForTrack(t){let i;return this.trackPublications.forEach(a=>{const o=a.track;o&&(t instanceof MediaStreamTrack?(ti(o)||Pi(o))&&o.mediaStreamTrack===t&&(i=a):t===o&&(i=a))}),i}waitForPendingPublicationOfSource(t){return T(this,void 0,void 0,function*(){const a=Date.now();for(;Date.now()<a+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[h]=l;return h.source===t});if(o)return o[1];yield Rt(20)}})}}class S_ extends ni{constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(Q.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=a,this.updateInfo(i)}setSubscribed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const o=new Dc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new yy({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Q.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?ni.SubscriptionStatus.Unsubscribed:super.isSubscribed?ni.SubscriptionStatus.Subscribed:ni.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ni.PermissionStatus.Allowed:ni.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var i,a;this.isManualOperationAllowed()&&(((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.width)===t.width&&((a=this.requestedVideoDimensions)===null||a===void 0?void 0:a.height)===t.height||(fd(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&fd(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:tn.HIGH}setTrack(t){const i=this.subscriptionStatus,a=this.permissionStatus,o=this.track;o!==t&&(o&&(o.off(Q.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(Q.VisibilityChanged,this.handleVisibilityChange),o.off(Q.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(Q.Unsubscribed,o)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(Q.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(Q.VisibilityChanged,this.handleVisibilityChange),t.on(Q.Ended,this.handleEnded),this.emit(Q.Subscribed,t)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(t){this.emit(Q.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?Q.Muted:Q.Unmuted)}emitSubscriptionUpdateIfChanged(t){const i=this.subscriptionStatus;t!==i&&this.emit(Q.SubscriptionStatusChanged,i,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(Q.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return fd(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new Oy({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===F.Kind.Video){let i=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(i)gv(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const a=Ik(this.trackInfo,this.requestedMaxQuality);a&&gv(this.videoDimensionsAdaptiveStream,a)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream;i?(t.width=Math.ceil(i.width),t.height=Math.ceil(i.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:tn.HIGH})),t.quality=tn.HIGH)}this.emit(Q.UpdateSettings,t)}}class Tc extends N0{static fromParticipantInfo(t,i,a){return new Tc(t,i.sid,i.identity,i.name,i.metadata,i.attributes,a,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,i,a,o,l,h,u){let m=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Er.STANDARD;super(i,a||"",o,l,h,u,m),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(Q.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Re(t)),{settings:i})),this.signalClient.sendUpdateTrackSettings(i)}),t.on(Q.UpdateSubscription,i=>{i.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),t.on(Q.SubscriptionPermissionChanged,i=>{this.emit(ee.TrackSubscriptionPermissionChanged,t,i)}),t.on(Q.SubscriptionStatusChanged,i=>{this.emit(ee.TrackSubscriptionStatusChanged,t,i)}),t.on(Q.Subscribed,i=>{this.emit(ee.TrackSubscribed,i,t)}),t.on(Q.Unsubscribed,i=>{this.emit(ee.TrackUnsubscribed,i,t)}),t.on(Q.SubscriptionFailed,i=>{this.emit(ee.TrackSubscriptionFailed,t.trackSid,i)})}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setVolume(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:F.Source.Microphone;this.volumeMap.set(i,t);const a=this.getTrackPublication(i);a&&a.track&&a.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F.Source.Microphone;const i=this.getTrackPublication(t);return i&&i.track?i.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,i,a,o,l,h){let u=this.getTrackPublicationBySid(i);if(u||i.startsWith("TR")||this.trackPublications.forEach(g=>{!u&&t.kind===g.kind.toString()&&(u=g)}),!u){if(h===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(ee.TrackSubscriptionFailed,i);return}h===void 0&&(h=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,i,a,o,l,h-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Re(u))),this.emit(ee.TrackSubscriptionFailed,i);return}const m=t.kind==="video";let p;return m?p=new f_(t,i,o,l):p=new h_(t,i,o,this.audioContext,this.audioOutput),p.source=u.source,p.isMuted=u.isMuted,p.setMediaStream(a),p.start(),u.setTrack(p),this.volumeMap.has(u.source)&&qd(p)&&xn(p)&&p.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const i=new Map,a=new Map;return t.tracks.forEach(o=>{var l,h;let u=this.getTrackPublicationBySid(o.sid);if(u)u.updateInfo(o);else{const m=F.kindFromProto(o.type);if(!m)return;u=new S_(m,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(h=this.loggerOptions)===null||h===void 0?void 0:h.loggerName}),u.updateInfo(o),a.set(o.sid,u);const p=Array.from(this.trackPublications.values()).find(g=>g.source===u?.source);p&&u.source!==F.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Re(p),newTrack:Re(u)})),this.addTrackPublication(u)}i.set(o.sid,u)}),this.trackPublications.forEach(o=>{i.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Re(o))),this.unpublishTrack(o.trackSid,!0))}),a.forEach(o=>{this.emit(ee.TrackPublished,o)}),!0}unpublishTrack(t,i){const a=this.trackPublications.get(t);if(!a)return;const{track:o}=a;switch(o&&(o.stop(),a.setTrack(void 0)),this.trackPublications.delete(t),a.kind){case F.Kind.Audio:this.audioTrackPublications.delete(t);break;case F.Kind.Video:this.videoTrackPublications.delete(t);break}i&&this.emit(ee.TrackUnpublished,a)}setAudioOutput(t){return T(this,void 0,void 0,function*(){this.audioOutput=t;const i=[];this.audioTrackPublications.forEach(a=>{var o;xn(a.track)&&qd(a.track)&&i.push(a.track.setSinkId((o=t.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(i)})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:a})),super.emit(t,...a)}}var Pe;(function(r){r.Disconnected="disconnected",r.Connecting="connecting",r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting"})(Pe||(Pe={}));const T_=4*1e3;class ps extends Ln.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var i,a,o,l,h;if(super(),i=this,this.state=Pe.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ce,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,m,p)=>T(this,void 0,void 0,function*(){var g;if(!Fk())throw Nn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const y=yield this.disconnectLock.lock();if(this.state===Pe.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),y(),Promise.resolve();if(this.connectFuture)return y(),this.connectFuture.promise;this.setAndEmitConnectionState(Pe.Connecting),((g=this.regionUrlProvider)===null||g===void 0?void 0:g.getServerUrl().toString())!==C0(u)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),ms(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new we(u,m):this.regionUrlProvider.updateToken(m),this.regionUrlProvider.fetchRegionSettings().then(A=>{var R;(R=this.regionUrlProvider)===null||R===void 0||R.setServerReportedRegions(A)}).catch(A=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:A}))}));const S=(A,R,G)=>T(this,void 0,void 0,function*(){var I,Z;this.abortController&&this.abortController.abort();const X=new AbortController;this.abortController=X,y?.();try{if(yield ds.getInstance().getBackOffPromise(u),X.signal.aborted)throw he.cancelled("Connection attempt aborted");yield this.attemptConnection(G??u,m,p,X),this.abortController=void 0,A()}catch(M){if(this.regionUrlProvider&&M instanceof he&&M.reason!==Ke.Cancelled&&M.reason!==Ke.NotAllowed){let D=null;try{this.log.debug("Fetching next region"),D=yield this.regionUrlProvider.getNextBestRegionUrl((I=this.abortController)===null||I===void 0?void 0:I.signal)}catch(z){if(z instanceof he&&(z.status===401||z.reason===Ke.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),R(z);return}}[Ke.InternalError,Ke.ServerUnreachable,Ke.Timeout].includes(M.reason)&&(this.log.debug("Adding failed connection attempt to back off"),ds.getInstance().addFailedConnectionAttempt(u)),D&&!(!((Z=this.abortController)===null||Z===void 0)&&Z.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(M.message,". Retrying with another region: ").concat(D),this.logContext),this.recreateEngine(),yield S(A,R,D)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,kv(M)),R(M))}else{let D=En.UNKNOWN_REASON;M instanceof he&&(D=kv(M)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,D),R(M)}}}),k=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new pn((A,R)=>{S(A,R,k)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,m,p,g,y,S)=>T(this,void 0,void 0,function*(){var k,A,R;const G=yield p.join(u,m,{autoSubscribe:g.autoSubscribe,adaptiveStream:typeof y.adaptiveStream=="object"?!0:y.adaptiveStream,maxRetries:g.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:g.websocketTimeout},S.signal,!y.singlePeerConnection);let I=G.serverInfo;if(I||(I={version:G.serverVersion,region:G.serverRegion}),this.serverInfo=I,this.log.debug("connected to Livekit Server ".concat(Object.entries(I).map(Z=>{let[X,M]=Z;return"".concat(X,": ").concat(M)}).join(", ")),{room:(k=G.room)===null||k===void 0?void 0:k.name,roomSid:(A=G.room)===null||A===void 0?void 0:A.sid,identity:(R=G.participant)===null||R===void 0?void 0:R.identity}),!I.version)throw new _k("unknown server version");return I.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),y.dynacast=!1),G}),this.applyJoinResponse=u=>{const m=u.participant;if(this.localParticipant.sid=m.sid,this.localParticipant.identity=m.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(p){this.log.error(p instanceof Error?p.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:p}))}this.handleParticipantUpdates([m,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,m,p,g)=>T(this,void 0,void 0,function*(){var y,S;this.state===Pe.Reconnecting||this.isResuming||!((y=this.engine)===null||y===void 0)&&y.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((S=this.regionUrlProvider)===null||S===void 0)&&S.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},yh),p),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const k=yield this.connectSignal(u,m,this.engine,this.connOptions,this.options,g);this.applyJoinResponse(k),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected)}catch(k){yield this.engine.close(),this.recreateEngine();const A=g.signal.aborted?he.cancelled("Signal connection aborted"):he.serverUnreachable("could not establish signal connection");throw k instanceof Error&&(A.message="".concat(A.message,": ").concat(k.message)),k instanceof he&&(A.reason=k.reason,A.status=k.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:k})),A}if(g.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),he.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,g)}catch(k){throw yield this.engine.close(),this.recreateEngine(),k}Ft()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ft()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Pe.Connected),this.emit(Y.Connected),ds.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,m=new Array(u),p=0;p<u;p++)m[p]=arguments[p];return T(i,[...m],void 0,function(){var g=this;let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var S,k,A;const R=yield g.disconnectLock.lock();try{if(g.state===Pe.Disconnected){g.log.debug("already disconnected",g.logContext);return}if(g.log.info("disconnect from room",Object.assign({},g.logContext)),g.state===Pe.Connecting||g.state===Pe.Reconnecting||g.isResuming){const G="Abort connection attempt due to user initiated disconnect";g.log.warn(G,g.logContext),(S=g.abortController)===null||S===void 0||S.abort(G),(A=(k=g.connectFuture)===null||k===void 0?void 0:k.reject)===null||A===void 0||A.call(k,he.cancelled("Client initiated disconnect")),g.connectFuture=void 0}g.engine&&(g.engine.client.isDisconnected||(yield g.engine.client.sendLeave()),yield g.engine.close()),g.handleDisconnect(y,En.CLIENT_INITIATED),g.engine=void 0}finally{R()}})()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const u=[],m=Ht();if(m&&m.os==="iOS"){const p="livekit-dummy-audio-el";let g=document.getElementById(p);if(!g){g=document.createElement("audio"),g.id=p,g.autoplay=!0,g.hidden=!0;const y=hd();y.enabled=!0;const S=new MediaStream([y]);g.srcObject=S,document.addEventListener("visibilitychange",()=>{g&&(g.srcObject=document.hidden?null:S,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(g),this.once(Y.Disconnected,()=>{g?.remove(),g=null})}u.push(g)}this.remoteParticipants.forEach(p=>{p.audioTrackPublications.forEach(g=>{g.track&&g.track.attachedElements.forEach(y=>{u.push(y)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(p=>(p.muted=!1,p.play()))]),this.handleAudioPlaybackStarted()}catch(p){throw this.handleAudioPlaybackFailed(p),p}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const u=[];for(const m of this.remoteParticipants.values())m.videoTrackPublications.forEach(p=>{var g;(g=p.track)===null||g===void 0||g.attachedElements.forEach(y=>{u.includes(y)||u.push(y)})});yield Promise.all(u.map(m=>m.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(m=>{m.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Pe.Reconnecting)&&this.emit(Y.Reconnecting)},this.handleSignalRestarted=u=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(m){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:m}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Pe.Connected),this.emit(Y.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(m=>{var p;if(m.identity===this.localParticipant.identity){this.localParticipant.updateInfo(m);return}m.identity===""&&(m.identity=(p=this.sidToIdentity.get(m.sid))!==null&&p!==void 0?p:"");let g=this.remoteParticipants.get(m.identity);m.state===ss.DISCONNECTED?this.handleParticipantDisconnected(m.identity,g):g=this.getOrCreateParticipant(m.identity,m)})},this.handleActiveSpeakersUpdate=u=>{const m=[],p={};u.forEach(g=>{if(p[g.sid]=!0,g.sid===this.localParticipant.sid)this.localParticipant.audioLevel=g.level,this.localParticipant.setIsSpeaking(!0),m.push(this.localParticipant);else{const y=this.getRemoteParticipantBySid(g.sid);y&&(y.audioLevel=g.level,y.setIsSpeaking(!0),m.push(y))}}),p[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(g=>{p[g.sid]||(g.audioLevel=0,g.setIsSpeaking(!1))}),this.activeSpeakers=m,this.emitWhenConnected(Y.ActiveSpeakersChanged,m)},this.handleSpeakersChanged=u=>{const m=new Map;this.activeSpeakers.forEach(g=>{const y=this.remoteParticipants.get(g.identity);y&&y.sid!==g.sid||m.set(g.sid,g)}),u.forEach(g=>{let y=this.getRemoteParticipantBySid(g.sid);g.sid===this.localParticipant.sid&&(y=this.localParticipant),y&&(y.audioLevel=g.level,y.setIsSpeaking(g.active),g.active?m.set(g.sid,y):m.delete(g.sid))});const p=Array.from(m.values());p.sort((g,y)=>y.audioLevel-g.audioLevel),this.activeSpeakers=p,this.emitWhenConnected(Y.ActiveSpeakersChanged,p)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(m=>{const p=this.getRemoteParticipantBySid(m.participantSid);if(!p)return;const g=p.getTrackPublicationBySid(m.trackSid);if(!g||!g.track)return;const y=F.streamStateFromProto(m.state);g.track.setStreamState(y),y!==g.track.streamState&&(p.emit(ee.TrackStreamStateChanged,g,g.track.streamState),this.emitWhenConnected(Y.TrackStreamStateChanged,g,g.track.streamState,p))})},this.handleSubscriptionPermissionUpdate=u=>{const m=this.getRemoteParticipantBySid(u.participantSid);if(!m)return;const p=m.getTrackPublicationBySid(u.trackSid);p&&p.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const m=Array.from(this.remoteParticipants.values()).find(g=>g.trackPublications.has(u.trackSid));if(!m)return;const p=m.getTrackPublicationBySid(u.trackSid);p&&p.setSubscriptionError(u.err)},this.handleDataPacket=(u,m)=>{const p=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(p,u.value.value,u.kind,m);else if(u.value.case==="transcription")this.handleTranscription(p,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(p,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(p,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,p);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,m);else if(u.value.case==="rpcRequest"){const g=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,g.id,g.method,g.payload,g.responseTimeoutMs,g.version)}},this.handleUserPacket=(u,m,p,g)=>{this.emit(Y.DataReceived,m.payload,u,p,m.topic,g),u?.emit(ee.DataReceived,m.payload,p,g)},this.handleSipDtmf=(u,m)=>{this.emit(Y.SipDTMFReceived,m,u),u?.emit(ee.SipDTMFReceived,m)},this.handleTranscription=(u,m)=>{const p=m.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(m.transcribedParticipantIdentity),g=p?.trackPublications.get(m.trackId),y=Wk(m,this.transcriptionReceivedTimes);g?.emit(Q.TranscriptionReceived,y),p?.emit(ee.TranscriptionReceived,y,g),this.emit(Y.TranscriptionReceived,y,p,g)},this.handleChatMessage=(u,m)=>{const p=$k(m);this.emit(Y.ChatMessage,p,u)},this.handleMetrics=(u,m)=>{this.emit(Y.MetricsReceived,u,m)},this.handleDataStream=(u,m)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,m)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Y.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Y.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Y.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Y.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var u;((u=Ht())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Y.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const m=this.roomInfo;this.roomInfo=u,m&&m.metadata!==u.metadata&&this.emitWhenConnected(Y.RoomMetadataChanged,u.metadata),m?.activeRecording!==u.activeRecording&&this.emitWhenConnected(Y.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(m=>{if(m.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(m.quality);return}const p=this.getRemoteParticipantBySid(m.participantSid);p&&p.setConnectionQuality(m.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(Y.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(Y.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(Y.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(Y.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(Y.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var m;(m=u?.onPublish)===null||m===void 0||m.call(u,this)},this.onLocalTrackPublished=u=>T(this,void 0,void 0,function*(){var m,p,g,y,S,k;(m=u.track)===null||m===void 0||m.on(Q.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.on(Q.Restarted,this.onLocalTrackRestarted),(S=(y=(g=u.track)===null||g===void 0?void 0:g.getProcessor())===null||y===void 0?void 0:y.onPublish)===null||S===void 0||S.call(y,this),this.emit(Y.LocalTrackPublished,u,this.localParticipant),ti(u.track)&&(yield u.track.checkForSilence())&&this.emit(Y.LocalAudioSilenceDetected,u);const A=yield(k=u.track)===null||k===void 0?void 0:k.getDeviceId(!1),R=Id(u.source);R&&A&&A!==this.localParticipant.activeDeviceMap.get(R)&&(this.localParticipant.activeDeviceMap.set(R,A),this.emit(Y.ActiveDeviceChanged,R,A))}),this.onLocalTrackUnpublished=u=>{var m,p;(m=u.track)===null||m===void 0||m.off(Q.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.off(Q.Restarted,this.onLocalTrackRestarted),this.emit(Y.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>T(this,void 0,void 0,function*(){const m=yield u.getDeviceId(!1),p=Id(u.source);p&&m&&m!==this.localParticipant.activeDeviceMap.get(p)&&(this.log.debug("local track restarted, setting ".concat(p," ").concat(m," active"),this.logContext),this.localParticipant.activeDeviceMap.set(p,m),this.emit(Y.ActiveDeviceChanged,p,m))}),this.onLocalConnectionQualityChanged=u=>{this.emit(Y.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,m)=>{this.emit(Y.MediaDevicesError,u,m)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(Y.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(Y.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},xE),t),this.log=oi((a=this.options.loggerName)!==null&&a!==void 0?a:_n.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},k0),t?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},E0),t?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},wE),t?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new c_,this.outgoingDataStreamManager=new d_(this.engine,this.log),this.disconnectLock=new xt,this.localParticipant=new b_("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Bi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Bi(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",Bi(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Ft()){const u=new AbortController;(h=(l=navigator.mediaDevices)===null||l===void 0?void 0:l.addEventListener)===null||h===void 0||h.call(l,"devicechange",this.handleDeviceChange,{signal:u.signal}),ps.cleanupRegistry&&ps.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(t,i){return this.incomingDataStreamManager.registerTextStreamHandler(t,i)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,i){return this.incomingDataStreamManager.registerByteStreamHandler(t,i)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,i){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const i=!!this.options.encryption,a=this.options.encryption||this.options.e2ee;a&&("e2eeManager"in a?(this.e2eeManager=a.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=i):this.e2eeManager=new mE(a,i),this.e2eeManager.on(Ii.ParticipantEncryptionStatusChanged,(o,l)=>{tE(l)&&(this.isE2EEEnabled=o),this.emit(Y.ParticipantEncryptionStatusChanged,o,l)}),this.e2eeManager.on(Ii.EncryptionError,(o,l)=>{const h=l?this.getParticipantByIdentity(l):void 0;this.emit(Y.EncryptionError,o,h)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return this.state===Pe.Disconnected?Vt.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?Vt.resolve(this.roomInfo.sid):new Vt((t,i)=>{const a=o=>{o.sid!==""&&(this.engine.off(W.RoomUpdate,a),t(o.sid))};this.engine.on(W.RoomUpdate,a),this.once(Y.Disconnected,()=>{this.engine.off(W.RoomUpdate,a),i(new ot("Room disconnected before room server id was available"))})})}get name(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&i!==void 0?i:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new a_(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(W.ParticipantUpdate,this.handleParticipantUpdates).on(W.RoomUpdate,this.handleRoomUpdate).on(W.SpeakersChanged,this.handleSpeakersChanged).on(W.StreamStateChanged,this.handleStreamStateUpdate).on(W.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(W.SubscriptionError,this.handleSubscriptionError).on(W.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(W.MediaTrackAdded,(t,i,a)=>{this.onTrackAdded(t,i,a)}).on(W.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(W.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(W.DataPacketReceived,this.handleDataPacket).on(W.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Pe.SignalReconnecting)&&this.emit(Y.SignalReconnecting)}).on(W.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Pe.Connected)&&this.emit(Y.Reconnected)}).on(W.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Pe.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(W.Restarting,this.handleRestarting).on(W.SignalRestarted,this.handleSignalRestarted).on(W.Offline,()=>{this.setAndEmitConnectionState(Pe.Reconnecting)&&this.emit(Y.Reconnecting)}).on(W.DCBufferStatusChanged,(t,i)=>{this.emit(Y.DCBufferStatusChanged,t,i)}).on(W.LocalTrackSubscribed,t=>{const i=this.localParticipant.getTrackPublications().find(a=>{let{trackSid:o}=a;return o===t});if(!i){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ee.LocalTrackSubscribed,i),this.emitWhenConnected(Y.LocalTrackSubscribed,i,this.localParticipant)}).on(W.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((i,a)=>{this.handleParticipantDisconnected(a,i)}),this.emit(Y.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return bt.getInstance().getDevices(t,i)}prepareConnection(t,i){return T(this,void 0,void 0,function*(){if(this.state===Pe.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(ms(new URL(t))&&i){this.regionUrlProvider=new we(t,i);const a=yield this.regionUrlProvider.getNextBestRegionUrl();a&&this.state===Pe.Disconnected&&(this.regionUrl=a,yield fetch(Dr(a),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(a),this.logContext))}else yield fetch(Dr(t),{method:"HEAD"})}catch(a){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,i){return T(this,void 0,void 0,function*(){let a=()=>T(this,void 0,void 0,function*(){}),o;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new Mn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new Mn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new Mn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new Mn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Mn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Mn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new Mn({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),a=()=>T(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Ac({reason:En.CLIENT_INITIATED,action:rs.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new Mn({scenario:{case:"subscriberBandwidth",value:da(i)}});break;case"leave-full-reconnect":o=new Mn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield a())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,m,p,g,y,S,k;let A=!0,R=!1;const G=h?{exact:o}:o;if(a==="audioinput"){R=l.localParticipant.audioTrackPublications.size===0;const I=(u=l.getActiveDevice(a))!==null&&u!==void 0?u:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=G;const Z=Array.from(l.localParticipant.audioTrackPublications.values()).filter(M=>M.source===F.Source.Microphone);try{A=(yield Promise.all(Z.map(M=>{var D;return(D=M.audioTrack)===null||D===void 0?void 0:D.setDeviceId(G)}))).every(M=>M===!0)}catch(M){throw l.options.audioCaptureDefaults.deviceId=I,M}const X=Z.some(M=>{var D,z;return(z=(D=M.track)===null||D===void 0?void 0:D.isMuted)!==null&&z!==void 0?z:!1});A&&X&&(R=!0)}else if(a==="videoinput"){R=l.localParticipant.videoTrackPublications.size===0;const I=(m=l.getActiveDevice(a))!==null&&m!==void 0?m:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=G;const Z=Array.from(l.localParticipant.videoTrackPublications.values()).filter(M=>M.source===F.Source.Camera);try{A=(yield Promise.all(Z.map(M=>{var D;return(D=M.videoTrack)===null||D===void 0?void 0:D.setDeviceId(G)}))).every(M=>M===!0)}catch(M){throw l.options.videoCaptureDefaults.deviceId=I,M}const X=Z.some(M=>{var D,z;return(z=(D=M.track)===null||D===void 0?void 0:D.isMuted)!==null&&z!==void 0?z:!1});A&&X&&(R=!0)}else if(a==="audiooutput"){if(R=!0,!zd()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(o=(p=yield bt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&p!==void 0?p:""),(g=(k=l.options).audioOutput)!==null&&g!==void 0||(k.audioOutput={});const I=(y=l.getActiveDevice(a))!==null&&y!==void 0?y:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((S=l.audioContext)===null||S===void 0||S.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(Z=>Z.setAudioOutput({deviceId:o})))}catch(Z){throw l.options.audioOutput.deviceId=I,Z}}return R&&(l.localParticipant.activeDeviceMap.set(a,o),l.emit(Y.ActiveDeviceChanged,a,o)),A})()})}setupLocalParticipantEvents(){this.localParticipant.on(ee.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ee.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ee.AttributesChanged,this.onLocalAttributesChanged).on(ee.TrackMuted,this.onLocalTrackMuted).on(ee.TrackUnmuted,this.onLocalTrackUnmuted).on(ee.LocalTrackPublished,this.onLocalTrackPublished).on(ee.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ee.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ee.MediaDevicesError,this.onMediaDevicesError).on(ee.AudioStreamAcquired,this.startAudio).on(ee.ChatMessage,this.onLocalChatMessageSent).on(ee.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,i,a){if(this.state===Pe.Connecting||this.state===Pe.Reconnecting){const y=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:i.id,tracksInStream:i.getTracks().map(k=>k.id)}),this.onTrackAdded(t,i,a),S()},S=()=>{this.off(Y.Reconnected,y),this.off(Y.Connected,y),this.off(Y.Disconnected,S)};this.once(Y.Reconnected,y),this.once(Y.Connected,y),this.once(Y.Disconnected,S);return}if(this.state===Pe.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=zk(i.id),l=o[0];let h=o[1],u=t.id;if(h&&h.startsWith("TR")&&(u=h),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const m=Array.from(this.remoteParticipants.values()).find(y=>y.sid===l);if(!m){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}if(!u.startsWith("TR")){const y=this.engine.getTrackIdForReceiver(a);if(!y){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(l),this.logContext);return}u=y}u.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(l,", streamId: ").concat(h,", trackId: ").concat(u),Object.assign(Object.assign({},this.logContext),{rpID:l,streamId:h,trackId:u}));let p;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?p=this.options.adaptiveStream:p={});const g=m.addSubscribedMediaTrack(t,u,i,a,p);g?.isEncrypted&&!this.e2eeManager&&this.emit(Y.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(m.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var a,o;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Pe.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(l=>{l.trackPublications.forEach(h=>{l.unpublishTrack(h.trackSid)})}),this.localParticipant.trackPublications.forEach(l=>{var h,u,m;l.track&&this.localParticipant.unpublishTrack(l.track,t),t?((h=l.track)===null||h===void 0||h.detach(),(u=l.track)===null||u===void 0||u.stop()):(m=l.track)===null||m===void 0||m.stopMonitor()}),this.localParticipant.off(ee.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ee.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ee.AttributesChanged,this.onLocalAttributesChanged).off(ee.TrackMuted,this.onLocalTrackMuted).off(ee.TrackUnmuted,this.onLocalTrackUnmuted).off(ee.LocalTrackPublished,this.onLocalTrackPublished).off(ee.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ee.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ee.MediaDevicesError,this.onMediaDevicesError).off(ee.AudioStreamAcquired,this.startAudio).off(ee.ChatMessage,this.onLocalChatMessageSent).off(ee.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ft()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(o=(a=navigator.mediaDevices)===null||a===void 0?void 0:a.removeEventListener)===null||o===void 0||o.call(a,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Pe.Disconnected),this.emit(Y.Disconnected,i)}}}handleParticipantDisconnected(t,i){var a;this.remoteParticipants.delete(t),i&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),i.trackPublications.forEach(o=>{i.unpublishTrack(o.trackSid,!0)}),this.emit(Y.ParticipantDisconnected,i),i.setDisconnected(),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(i.identity))}handleIncomingRpcRequest(t,i,a,o,l,h){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,i),h!==1){yield this.engine.publishRpcResponse(t,i,null,it.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(a);if(!u){yield this.engine.publishRpcResponse(t,i,null,it.builtIn("UNSUPPORTED_METHOD"));return}let m=null,p=null;try{const g=yield u({requestId:i,callerIdentity:t,payload:o,responseTimeout:l});bh(g)>R0?(m=it.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(a))):p=g}catch(g){g instanceof it?m=g:(this.log.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),g),m=it.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,i,p,m)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var t,i,a;const o=bt.getInstance().previousDevices,l=yield bt.getInstance().getDevices(void 0,!1),h=Ht();if(h?.name==="Chrome"&&h.os!=="iOS")for(let m of l){const p=o.find(g=>g.deviceId===m.deviceId);p&&p.label!==""&&p.kind===m.kind&&p.label!==m.label&&this.getActiveDevice(m.kind)==="default"&&this.emit(Y.ActiveDeviceChanged,m.kind,m.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let m of u){const p=wk(m),g=this.localParticipant.getTrackPublication(p);if(g&&(!((t=g.track)===null||t===void 0)&&t.isUserProvided))continue;const y=l.filter(k=>k.kind===m),S=this.getActiveDevice(m);if(S===((i=o.filter(k=>k.kind===m)[0])===null||i===void 0?void 0:i.deviceId)&&y.length>0&&((a=y[0])===null||a===void 0?void 0:a.deviceId)!==S){yield this.switchActiveDevice(m,y[0].deviceId);continue}m==="audioinput"&&!Or()||m==="videoinput"||y.length>0&&!y.find(k=>k.deviceId===this.getActiveDevice(m))&&(m!=="audiooutput"||!Or())&&(yield this.switchActiveDevice(m,y[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var t,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=v0())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Rt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const a=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";a!==this.canPlaybackAudio&&(this.audioEnabled=a,this.emit(Y.AudioPlaybackStatusChanged,a))})}createParticipant(t,i){var a;let o;return i?o=Tc.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new Tc(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(t,i){if(this.remoteParticipants.has(t)){const o=this.remoteParticipants.get(t);return i&&o.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),o}const a=this.createParticipant(t,i);return this.remoteParticipants.set(t,a),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(Y.ParticipantConnected,a),a.on(ee.TrackPublished,o=>{this.emitWhenConnected(Y.TrackPublished,o,a)}).on(ee.TrackSubscribed,(o,l)=>{o.kind===F.Kind.Audio?(o.on(Q.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(Q.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===F.Kind.Video&&(o.on(Q.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(Q.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Y.TrackSubscribed,o,l,a)}).on(ee.TrackUnpublished,o=>{this.emit(Y.TrackUnpublished,o,a)}).on(ee.TrackUnsubscribed,(o,l)=>{this.emit(Y.TrackUnsubscribed,o,l,a)}).on(ee.TrackMuted,o=>{this.emitWhenConnected(Y.TrackMuted,o,a)}).on(ee.TrackUnmuted,o=>{this.emitWhenConnected(Y.TrackUnmuted,o,a)}).on(ee.ParticipantMetadataChanged,o=>{this.emitWhenConnected(Y.ParticipantMetadataChanged,o,a)}).on(ee.ParticipantNameChanged,o=>{this.emitWhenConnected(Y.ParticipantNameChanged,o,a)}).on(ee.AttributesChanged,o=>{this.emitWhenConnected(Y.ParticipantAttributesChanged,o,a)}).on(ee.ConnectionQualityChanged,o=>{this.emitWhenConnected(Y.ConnectionQualityChanged,o,a)}).on(ee.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(Y.ParticipantPermissionsChanged,o,a)}).on(ee.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(Y.TrackSubscriptionStatusChanged,o,l,a)}).on(ee.TrackSubscriptionFailed,(o,l)=>{this.emit(Y.TrackSubscriptionFailed,o,a,l)}).on(ee.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(Y.TrackSubscriptionPermissionChanged,o,l,a)}).on(ee.Active,()=>{this.emitWhenConnected(Y.ParticipantActive,a),a.kind===Er.AGENT&&this.localParticipant.setActiveAgent(a)}),i&&a.updateInfo(i),a}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((a,o)=>(a.push(...o.getTrackPublications()),a),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,i)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const i of t.videoTrackPublications.values())i.isSubscribed&&eE(i)&&i.emitTrackUpdate()}getRemoteParticipantBySid(t){const i=this.sidToIdentity.get(t);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=_t.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,En.STATE_MISMATCH))):t=0},T_)}clearConnectionReconcile(){this.connectionReconcileInterval&&_t.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(Y.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[i,a]=t;this.emit(i,...a)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(this.state===Pe.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,a]);else if(this.state===Pe.Connected)return this.emit(t,...a);return!1}simulateParticipants(t){return T(this,void 0,void 0,function*(){var i,a,o,l;const h=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),u=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new _c({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:We.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ha({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected),this.emit(Y.Connected),this.setAndEmitConnectionState(Pe.Connected),h.video){const m=new Yd(F.Kind.Video,new ns({source:ft.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tn.AUDIO,name:"video-dummy"}),new Sc(h.useRealTracks&&(!((i=window.navigator.mediaDevices)===null||i===void 0)&&i.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Cv(160*((a=u.aspectRatios[0])!==null&&a!==void 0?a:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(m),this.localParticipant.emit(ee.LocalTrackPublished,m)}if(h.audio){const m=new Yd(F.Kind.Audio,new ns({source:ft.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tn.AUDIO}),new bc(h.useRealTracks&&(!((o=navigator.mediaDevices)===null||o===void 0)&&o.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:hd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(m),this.localParticipant.emit(ee.LocalTrackPublished,m)}for(let m=0;m<u.count-1;m+=1){let p=new ha({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(m),state:ss.ACTIVE,tracks:[],joinedAt:We.parse(Date.now())});const g=this.getOrCreateParticipant(p.identity,p);if(u.video){const y=Cv(160*((l=u.aspectRatios[m%u.aspectRatios.length])!==null&&l!==void 0?l:1),160,!1,!0),S=new ns({source:ft.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tn.AUDIO});g.addSubscribedMediaTrack(y,S.sid,new MediaStream([y]),new RTCRtpReceiver),p.tracks=[...p.tracks,S]}if(u.audio){const y=hd(),S=new ns({source:ft.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tn.AUDIO});g.addSubscribedMediaTrack(y,S.sid,new MediaStream([y]),new RTCRtpReceiver),p.tracks=[...p.tracks,S]}g.updateInfo(p)}})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(t!==Y.ActiveSpeakersChanged&&t!==Y.TranscriptionReceived){const l=P0(a).filter(h=>h!==void 0);(t===Y.TrackSubscribed||t===Y.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l}))}return super.emit(t,...a)}}ps.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(r=>{r()});function P0(r){return r.map(t=>{if(t)return Array.isArray(t)?P0(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var Sn;(function(r){r[r.IDLE=0]="IDLE",r[r.RUNNING=1]="RUNNING",r[r.SKIPPED=2]="SKIPPED",r[r.SUCCESS=3]="SUCCESS",r[r.FAILED=4]="FAILED"})(Sn||(Sn={}));class Hi extends Ln.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Sn.IDLE,this.logs=[],this.options={},this.url=t,this.token=i,this.name=this.constructor.name,this.room=new ps(a.roomOptions),this.connectOptions=a.connectOptions,this.options=a}run(t){return T(this,void 0,void 0,function*(){if(this.status!==Sn.IDLE)throw Error("check is running already");this.setStatus(Sn.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==Sn.SKIPPED&&this.setStatus(this.isSuccess()?Sn.SUCCESS:Sn.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return T(this,void 0,void 0,function*(){return this.room.state===Pe.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==Pe.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(Sn.SKIPPED)}switchProtocol(t){return T(this,void 0,void 0,function*(){let i=!1,a=!1;if(this.room.on(Y.Reconnecting,()=>{i=!0}),this.room.once(Y.Reconnected,()=>{a=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(l=>setTimeout(l,1e3)),!i)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(a)return;yield Rt(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class C_ extends Hi{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const t=new we(this.url,this.token);if(!t.isCloud()){this.skip();return}const i=[],a=new Set;for(let l=0;l<3;l++){const h=yield t.getNextBestRegionUrl();if(!h)break;if(a.has(h))continue;a.add(h);const u=yield this.checkCloudRegion(h);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),i.push(u)}i.sort((l,h)=>(l.duration-h.duration)*.5+(l.rtt-h.rtt)*.5);const o=i[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return T(this,void 0,void 0,function*(){var i,a;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(i=this.room.serverInfo)===null||i===void 0?void 0:i.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),h=1e3,m=1e6/h,p="A".repeat(h),g=Date.now();for(let A=0;A<m;A++)yield l.write(p);yield l.close();const y=Date.now(),S=yield(a=this.room.engine.pcManager)===null||a===void 0?void 0:a.publisher.getStats(),k={region:o,rtt:1e4,duration:y-g};return S?.forEach(A=>{A.type==="candidate-pair"&&A.nominated&&(k.rtt=A.currentRoundTripTime*1e3)}),yield this.disconnect(),k})}}const Td=1e4;class k_ extends Hi{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),i=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-i.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-i.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=i):this.appendMessage("best connection quality via udp");const a=this.bestStats;this.appendMessage("upstream bitrate: ".concat((a.bitrateTotal/a.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((a.rttTotal/a.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((a.jitterTotal/a.count*1e3).toFixed(2)," ms")),a.packetsLost>0&&this.appendWarning("packets lost: ".concat((a.packetsLost/a.packetsSent*100).toFixed(2),"%")),a.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((a.qualityLimitationDurations.bandwidth/(Td/1e3)*100).toFixed(2),"%")),a.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((a.qualityLimitationDurations.cpu/(Td/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return T(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const i=document.createElement("canvas");i.width=1280,i.height=720;const a=i.getContext("2d");if(!a)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,a.fillStyle="hsl(".concat(o,", 100%, 50%)"),a.fillRect(0,0,i.width,i.height),requestAnimationFrame(l)};l();const u=i.captureStream(30).getVideoTracks()[0],p=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},y=setInterval(()=>T(this,void 0,void 0,function*(){const S=yield p.getRTCStatsReport();S?.forEach(k=>{k.type==="outbound-rtp"?(g.packetsSent=k.packetsSent,g.qualityLimitationDurations=k.qualityLimitationDurations,g.bitrateTotal+=k.targetBitrate,g.count++):k.type==="remote-inbound-rtp"&&(g.packetsLost=k.packetsLost,g.rttTotal+=k.roundTripTime,g.jitterTotal+=k.jitter)})}),1e3);return yield new Promise(S=>setTimeout(S,Td)),clearInterval(y),u.stop(),i.remove(),yield this.disconnect(),g})}}class E_ extends Hi{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield g_();if(yield g0(a,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),i.localParticipant.publishTrack(a),yield new Promise(u=>setTimeout(u,3e3));const l=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!l)throw new Error("Could not get RTCStats");let h=0;if(l.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(h=u.packetsSent)}),h===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(h," audio packets"))})}}class __ extends Hi{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield p_();yield this.checkForVideo(a.mediaStreamTrack),i.localParticipant.publishTrack(a),yield new Promise(h=>setTimeout(h,5e3));const o=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(h=>{h.type==="outbound-rtp"&&(h.kind==="video"||!h.kind&&h.mediaType==="video")&&(l+=h.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(t){return T(this,void 0,void 0,function*(){const i=new MediaStream;i.addTrack(t.clone());const a=document.createElement("video");a.srcObject=i,a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.setAttribute("playsinline","true"),document.body.appendChild(a),yield new Promise(o=>{a.onplay=()=>{setTimeout(()=>{var l,h,u,m;const p=document.createElement("canvas"),g=t.getSettings(),y=(h=(l=g.width)!==null&&l!==void 0?l:a.videoWidth)!==null&&h!==void 0?h:1280,S=(m=(u=g.height)!==null&&u!==void 0?u:a.videoHeight)!==null&&m!==void 0?m:720;p.width=y,p.height=S;const k=p.getContext("2d");k.drawImage(a,0,0);const R=k.getImageData(0,0,p.width,p.height).data;let G=!0;for(let I=0;I<R.length;I+=4)if(R[I]!==0||R[I+1]!==0||R[I+2]!==0){G=!1;break}G?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},a.play()}),i.getTracks().forEach(o=>o.stop()),a.remove()})}}class R_ extends Hi{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect();let a=!1,o=!1,l;const h=new Promise(p=>{setTimeout(p,5e3),l=p}),u=()=>{a=!0};i.on(Y.SignalReconnecting,u).on(Y.Reconnecting,u).on(Y.Reconnected,()=>{o=!0,l(!0)}),(t=i.engine.client.ws)===null||t===void 0||t.close();const m=i.engine.client.onClose;if(m&&m(""),yield h,a){if(!o||i.state!==Pe.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class O_ extends Hi{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;ms(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(t=yield new we(this.url,this.token).getNextBestRegionUrl())!==null&&t!==void 0?t:this.url);const o=new mh,l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let h=!1,u=!1,m=!1;for(let p of l.iceServers)for(let g of p.urls)g.startsWith("turn:")?(u=!0,m=!0):g.startsWith("turns:")&&(u=!0,m=!0,h=!0),g.startsWith("stun:")&&(m=!0);m?u&&!h&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield o.close(),!((a=(i=this.connectOptions)===null||i===void 0?void 0:i.rtcConfig)===null||a===void 0)&&a.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(p=>setTimeout(p,0)))})}}class D_ extends Hi{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let t=!1,i=!1;this.room.on(Y.SignalConnected,()=>{var a;const o=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(l,h)=>{if(l.candidate){const u=new RTCIceCandidate(l);let m="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(A_(u.address)?m+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(t=!0,m+=" (passive)"):u.protocol==="udp"&&(i=!0)),this.appendMessage(m)}o&&o(l,h)},!((a=this.room.engine.pcManager)===null||a===void 0)&&a.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=l=>{l instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})});try{yield this.connect(),Ce.info("now the room is connected")}catch(a){throw this.appendWarning("ports need to be open on firewall in order to connect."),a}t||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function A_(r){const t=r.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}class M_ extends Hi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new mh,l;try{l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(h){if(ms(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(h.message,". Retrying with region fallback"));const m=yield new we(this.url,this.token).getNextBestRegionUrl();m&&(l=yield o.join(m,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}l?(this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((t=l.serverInfo)===null||t===void 0?void 0:t.edition)===Sy.Cloud&&(!((i=l.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((a=l.serverInfo)===null||a===void 0?void 0:a.region))):this.appendError("Websocket connection could not be established"),yield o.close()})}}class u1 extends Ln.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=i,this.options=a}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:Sn.IDLE,name:"",description:""}),t}updateCheck(t,i){this.checkResults.set(t,i),this.emit("checkUpdate",t,i)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==Sn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return T(this,void 0,void 0,function*(){const i=this.getNextCheckId(),a=new t(this.url,this.token,this.options),o=h=>{this.updateCheck(i,h)};a.on("update",o);const l=yield a.run();return a.off("update",o),l})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(M_)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(D_)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(O_)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(R_)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(E_)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(__)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(k_);if(t.data&&"protocol"in t.data){const i=t.data;this.options.protocol=i.protocol}return t})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(C_)})}}function Oe(r,t,i){return(t=x_(t))in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function w_(r,t){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var a=i.call(r,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function x_(r){var t=w_(r,"string");return typeof t=="symbol"?t:t+""}new TextEncoder;new TextDecoder;class Nt extends Error{constructor(t,i){var a;super(t,i),Oe(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(a=Error.captureStackTrace)===null||a===void 0||a.call(Error,this,this.constructor)}}Oe(Nt,"code","ERR_JOSE_GENERIC");class N_ extends Nt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),Oe(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Oe(this,"claim",void 0),Oe(this,"reason",void 0),Oe(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}Oe(N_,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class P_ extends Nt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),Oe(this,"code","ERR_JWT_EXPIRED"),Oe(this,"claim",void 0),Oe(this,"reason",void 0),Oe(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}Oe(P_,"code","ERR_JWT_EXPIRED");class L_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Oe(L_,"code","ERR_JOSE_ALG_NOT_ALLOWED");class U_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Oe(U_,"code","ERR_JOSE_NOT_SUPPORTED");class I_ extends Nt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),Oe(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Oe(I_,"code","ERR_JWE_DECRYPTION_FAILED");class j_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JWE_INVALID")}}Oe(j_,"code","ERR_JWE_INVALID");class B_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JWS_INVALID")}}Oe(B_,"code","ERR_JWS_INVALID");class z_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JWT_INVALID")}}Oe(z_,"code","ERR_JWT_INVALID");class q_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JWK_INVALID")}}Oe(q_,"code","ERR_JWK_INVALID");class V_ extends Nt{constructor(){super(...arguments),Oe(this,"code","ERR_JWKS_INVALID")}}Oe(V_,"code","ERR_JWKS_INVALID");class F_ extends Nt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),Oe(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Oe(F_,"code","ERR_JWKS_NO_MATCHING_KEY");class H_ extends Nt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),Oe(this,Symbol.asyncIterator,void 0),Oe(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Oe(H_,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class G_ extends Nt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",i=arguments.length>1?arguments[1]:void 0;super(t,i),Oe(this,"code","ERR_JWKS_TIMEOUT")}}Oe(G_,"code","ERR_JWKS_TIMEOUT");class K_ extends Nt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),Oe(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Oe(K_,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Cc(){return Cc=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)({}).hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},Cc.apply(null,arguments)}const Kv=new Uint8Array(0);class Ar{static getFullOptions(t){return Cc({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{}},t)}constructor(t,i){var a=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=1,this.canSendFeedback=!1,this.endSessionWithDetails=async function(o){a.status!=="connected"&&a.status!=="connecting"||(a.updateStatus("disconnecting"),await a.handleEndSession(),a.updateStatus("disconnected"),a.options.onDisconnect(o))},this.onMessage=async function(o){switch(o.type){case"interruption":return void a.handleInterruption(o);case"agent_response":return void a.handleAgentResponse(o);case"user_transcript":return void a.handleUserTranscript(o);case"internal_tentative_agent_response":return void a.handleTentativeAgentResponse(o);case"client_tool_call":return void await a.handleClientToolCall(o);case"audio":return void a.handleAudio(o);case"ping":return void a.connection.sendMessage({type:"pong",event_id:o.ping_event.event_id});default:return void a.options.onDebug(o)}},this.setVolume=({volume:o})=>{this.volume=o},this.options=t,this.connection=i,this.options.onConnect({conversationId:i.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(t){t!==this.mode&&(this.mode=t,this.options.onModeChange({mode:t}))}updateStatus(t){t!==this.status&&(this.status=t,this.options.onStatusChange({status:t}))}updateCanSendFeedback(){const t=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==t&&(this.canSendFeedback=t,this.options.onCanSendFeedbackChange({canSendFeedback:t}))}handleInterruption(t){t.interruption_event&&(this.lastInterruptTimestamp=t.interruption_event.event_id)}handleAgentResponse(t){this.options.onMessage({source:"ai",message:t.agent_response_event.agent_response})}handleUserTranscript(t){this.options.onMessage({source:"user",message:t.user_transcription_event.user_transcript})}handleTentativeAgentResponse(t){this.options.onDebug({type:"tentative_agent_response",response:t.tentative_agent_response_internal_event.tentative_agent_response})}async handleClientToolCall(t){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,t.client_tool_call.tool_name))try{var i;const a=(i=await this.options.clientTools[t.client_tool_call.tool_name](t.client_tool_call.parameters))!=null?i:"Client tool execution successful.",o=typeof a=="object"?JSON.stringify(a):String(a);this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:o,is_error:!1})}catch(a){this.onError(`Client tool execution failed with following error: ${a?.message}`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool execution failed: ${a?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(t.client_tool_call);this.onError(`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(t){}onError(t,i){console.error(t,i),this.options.onError(t,i)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(t){}getInputByteFrequencyData(){return Kv}getOutputByteFrequencyData(){return Kv}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(t){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:t?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(t){this.connection.sendMessage({type:"contextual_update",text:t})}sendUserMessage(t){this.connection.sendMessage({type:"user_message",text:t})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(t,i){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:t,is_approved:i})}}class L0{constructor(t={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onDebug=void 0,this.onDebug=t.onDebug}debug(t){this.onDebug&&this.onDebug(t)}onMessage(t){this.onMessageCallback=t;const i=this.queue;this.queue=[],i.length>0&&queueMicrotask(()=>{i.forEach(t)})}onDisconnect(t){this.onDisconnectCallback=t;const i=this.disconnectionDetails;i&&queueMicrotask(()=>{t(i)})}disconnect(t){var i;this.disconnectionDetails||(this.disconnectionDetails=t,(i=this.onDisconnectCallback)==null||i.call(this,t))}handleMessage(t){this.onMessageCallback?this.onMessageCallback(t):this.queue.push(t)}}function kc(r){const[t,i]=r.split("_");if(!["pcm","ulaw"].includes(t))throw new Error(`Invalid format: ${r}`);const a=Number.parseInt(i);if(Number.isNaN(a))throw new Error(`Invalid sample rate: ${i}`);return{format:t,sampleRate:a}}const U0="0.4.0";function Jd(r){return!!r.type}const I0="conversation_initiation_client_data";function j0(r){const t={type:I0};var i,a,o,l,h;return r.overrides&&(t.conversation_config_override={agent:{prompt:(i=r.overrides.agent)==null?void 0:i.prompt,first_message:(a=r.overrides.agent)==null?void 0:a.firstMessage,language:(o=r.overrides.agent)==null?void 0:o.language},tts:{voice_id:(l=r.overrides.tts)==null?void 0:l.voiceId},conversation:{text_only:(h=r.overrides.conversation)==null?void 0:h.textOnly}}),r.customLlmExtraBody&&(t.custom_llm_extra_body=r.customLlmExtraBody),r.dynamicVariables&&(t.dynamic_variables=r.dynamicVariables),r.userId&&(t.user_id=r.userId),t}class Ch extends L0{constructor(t,i,a,o){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=t,this.conversationId=i,this.inputFormat=a,this.outputFormat=o,this.socket.addEventListener("error",l=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:l}),0)}),this.socket.addEventListener("close",l=>{this.disconnect(l.code===1e3?{reason:"agent",context:l}:{reason:"error",message:l.reason||"The connection was closed by the server.",context:l})}),this.socket.addEventListener("message",l=>{try{const h=JSON.parse(l.data);if(!Jd(h))return;this.handleMessage(h)}catch{}})}static async create(t){let i=null;try{var a,o,l;const u=(a=t.origin)!=null?a:"wss://api.elevenlabs.io";let m;const p=((o=t.overrides)==null||(o=o.client)==null?void 0:o.version)||U0,g=((l=t.overrides)==null||(l=l.client)==null?void 0:l.source)||"js_sdk";if(t.signedUrl){const Z=t.signedUrl.includes("?")?"&":"?";m=`${t.signedUrl}${Z}source=${g}&version=${p}`}else m=`${u}/v1/convai/conversation?agent_id=${t.agentId}&source=${g}&version=${p}`;const y=["convai"];t.authorization&&y.push(`bearer.${t.authorization}`),i=new WebSocket(m,y);const S=await new Promise((Z,X)=>{i.addEventListener("open",()=>{var M;const D=j0(t);(M=i)==null||M.send(JSON.stringify(D))},{once:!0}),i.addEventListener("error",M=>{setTimeout(()=>X(M),0)}),i.addEventListener("close",X),i.addEventListener("message",M=>{const D=JSON.parse(M.data);Jd(D)&&(D.type==="conversation_initiation_metadata"?Z(D.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:k,agent_output_audio_format:A,user_input_audio_format:R}=S,G=kc(R??"pcm_16000"),I=kc(A);return new Ch(i,k,G,I)}catch(u){var h;throw(h=i)==null||h.close(),u}}close(){this.socket.close()}sendMessage(t){this.socket.send(JSON.stringify(t))}}class kh extends L0{constructor(t,i,a,o,l={}){super(l),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.room=t,this.conversationId=i,this.inputFormat=a,this.outputFormat=o,this.setupRoomEventListeners()}static async create(t){let i;if("conversationToken"in t&&t.conversationToken)i=t.conversationToken;else{if(!("agentId"in t)||!t.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var a,o;const h=((a=t.overrides)==null||(a=a.client)==null?void 0:a.version)||U0,u=((o=t.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk",m=`https://api.elevenlabs.io/v1/convai/conversation/token?agent_id=${t.agentId}&source=${u}&version=${h}`,p=await fetch(m);if(!p.ok)throw new Error(`ElevenLabs API returned ${p.status} ${p.statusText}`);if(i=(await p.json()).token,!i)throw new Error("No conversation token received from API")}catch(h){let u=h instanceof Error?h.message:String(h);throw h instanceof Error&&h.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${t.agentId}: ${u}`)}}const l=new ps;try{const h=`webrtc-${Date.now()}`,u=kc("pcm_48000"),m=kc("pcm_48000"),p=new kh(l,h,u,m,t),g=t.livekitUrl||"wss://livekit.rtc.elevenlabs.io";await l.connect(g,i),await new Promise(S=>{if(p.isConnected)S();else{const k=()=>{l.off(Y.Connected,k),S()};l.on(Y.Connected,k)}}),l.name&&(p.conversationId=l.name),await l.localParticipant.setMicrophoneEnabled(!0);const y=j0(t);return p.debug({type:I0,message:y}),await p.sendMessage(y),p}catch(h){throw await l.disconnect(),h}}setupRoomEventListeners(){var t=this;this.room.on(Y.Connected,async function(){t.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(Y.Disconnected,i=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:i?.toString()})})}),this.room.on(Y.ConnectionStateChanged,i=>{i===Pe.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${i}`,context:new Event("connection_state_changed")}))}),this.room.on(Y.DataReceived,(i,a)=>{try{const o=JSON.parse(new TextDecoder().decode(i));if(o.type==="audio")return;Jd(o)?this.handleMessage(o):console.warn("Invalid socket event received:",o)}catch(o){console.warn("Failed to parse incoming data message:",o),console.warn("Raw payload:",new TextDecoder().decode(i))}}),this.room.on(Y.TrackSubscribed,async function(i,a,o){if(i.kind===F.Kind.Audio&&o.identity.includes("agent")){const l=i.attach();l.autoplay=!0,l.controls=!1,l.style.display="none",document.body.appendChild(l)}})}close(){this.isConnected&&this.room.disconnect()}async sendMessage(t){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in t))try{const i=new TextEncoder().encode(JSON.stringify(t));await this.room.localParticipant.publishData(i,{reliable:!0})}catch(i){this.debug({type:"send_message_error",message:{message:t,error:i}}),console.error("Failed to send message via WebRTC:",i)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}}async function B0(r){const t=(function(i){return i.connectionType?i.connectionType:"conversationToken"in i&&i.conversationToken?"webrtc":"websocket"})(r);switch(t){case"websocket":return Ch.create(r);case"webrtc":return kh.create(r);default:throw new Error(`Unknown connection type: ${t}`)}}function z0(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function q0(r={default:0,android:3e3}){let t=r.default;var i;if(/android/i.test(navigator.userAgent))t=(i=r.android)!=null?i:t;else if(z0()){var a;t=(a=r.ios)!=null?a:t}t>0&&await new Promise(o=>setTimeout(o,t))}class Eh extends Ar{static async startSession(t){const i=Ar.getFullOptions(t);i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange({canSendFeedback:!1});let a=null;try{return await q0(i.connectionDelay),a=await B0(t),new Eh(i,a)}catch(l){var o;throw i.onStatusChange({status:"disconnected"}),(o=a)==null||o.close(),l}}}function Y_(r){const t=new Uint8Array(r);return window.btoa(String.fromCharCode(...t))}function J_(r){const t=window.atob(r),i=t.length,a=new Uint8Array(i);for(let o=0;o<i;o++)a[o]=t.charCodeAt(o);return a.buffer}const Cd=new Map;function V0(r,t){return async i=>{const a=Cd.get(r);if(a)return i.addModule(a);const o=new Blob([t],{type:"application/javascript"}),l=URL.createObjectURL(o);try{return await i.addModule(l),void Cd.set(r,l)}catch{URL.revokeObjectURL(l)}try{const h=`data:application/javascript;base64,${btoa(t)}`;await i.addModule(h),Cd.set(r,h)}catch{throw new Error(`Failed to load the ${r} worklet module. Make sure the browser supports AudioWorklets.`)}}}const Q_=V0("raw-audio-processor",`
const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("raw-audio-processor", RawAudioProcessor);
`);class _h{static async create({sampleRate:t,format:i,preferHeadphonesForIosDevices:a}){let o=null,l=null;try{const m={sampleRate:{ideal:t},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0}};if(z0()&&a){const k=(await window.navigator.mediaDevices.enumerateDevices()).find(A=>A.kind==="audioinput"&&["airpod","headphone","earphone"].find(R=>A.label.toLowerCase().includes(R)));k&&(m.deviceId={ideal:k.deviceId})}const p=navigator.mediaDevices.getSupportedConstraints().sampleRate;o=new window.AudioContext(p?{sampleRate:t}:{});const g=o.createAnalyser();p||await o.audioWorklet.addModule("https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js"),await Q_(o.audioWorklet),l=await navigator.mediaDevices.getUserMedia({audio:m});const y=o.createMediaStreamSource(l),S=new AudioWorkletNode(o,"raw-audio-processor");return S.port.postMessage({type:"setFormat",format:i,sampleRate:t}),y.connect(g),g.connect(S),await o.resume(),new _h(o,g,S,l)}catch(m){var h,u;throw(h=l)==null||h.getTracks().forEach(p=>p.stop()),(u=o)==null||u.close(),m}}constructor(t,i,a,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.context=t,this.analyser=i,this.worklet=a,this.inputStream=o}async close(){this.inputStream.getTracks().forEach(t=>t.stop()),await this.context.close()}setMuted(t){this.worklet.port.postMessage({type:"setMuted",isMuted:t})}}const X_=V0("audio-concat-processor",`
const decodeTable = [0,132,396,924,1980,4092,8316,16764];

export function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audio-concat-processor", AudioConcatProcessor);
`);class Rh{static async create({sampleRate:t,format:i}){let a=null;try{a=new AudioContext({sampleRate:t});const l=a.createAnalyser(),h=a.createGain();h.connect(l),l.connect(a.destination),await X_(a.audioWorklet);const u=new AudioWorkletNode(a,"audio-concat-processor");return u.port.postMessage({type:"setFormat",format:i}),u.connect(h),await a.resume(),new Rh(a,l,h,u)}catch(l){var o;throw(o=a)==null||o.close(),l}}constructor(t,i,a,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.context=t,this.analyser=i,this.gain=a,this.worklet=o}async close(){await this.context.close()}}class Oh extends Ar{static async startSession(t){var i;const a=Ar.getFullOptions(t);a.onStatusChange({status:"connecting"}),a.onCanSendFeedbackChange({canSendFeedback:!1});let o=null,l=null,h=null,u=null,m=null;if((i=t.useWakeLock)==null||i)try{m=await navigator.wakeLock.request("screen")}catch{}try{var p;return u=await navigator.mediaDevices.getUserMedia({audio:!0}),await q0(a.connectionDelay),l=await B0(t),[o,h]=await Promise.all([_h.create(Cc({},l.inputFormat,{preferHeadphonesForIosDevices:t.preferHeadphonesForIosDevices})),Rh.create(l.outputFormat)]),(p=u)==null||p.getTracks().forEach(R=>R.stop()),u=null,new Oh(a,l,o,h,m)}catch(R){var g,y,S,k;a.onStatusChange({status:"disconnected"}),(g=u)==null||g.getTracks().forEach(G=>G.stop()),(y=l)==null||y.close(),await((S=o)==null?void 0:S.close()),await((k=h)==null?void 0:k.close());try{var A;await((A=m)==null?void 0:A.release()),m=null}catch{}throw R}}constructor(t,i,a,o,l){super(t,i),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=h=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:Y_(h.data[0].buffer)})},this.onOutputWorkletMessage=({data:h})=>{h.type==="process"&&this.updateMode(h.finished?"listening":"speaking")},this.addAudioBase64Chunk=h=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:J_(h)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=h=>{if(h.length===0)return 0;let u=0;for(let m=0;m<h.length;m++)u+=h[m]/255;return u/=h.length,u<0?0:u>1?1:u},this.input=a,this.output=o,this.wakeLock=l,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var t;await((t=this.wakeLock)==null?void 0:t.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(t){super.handleInterruption(t),this.fadeOutAudio()}handleAudio(t){this.lastInterruptTimestamp<=t.audio_event.event_id&&(this.options.onAudio(t.audio_event.audio_base_64),this.addAudioBase64Chunk(t.audio_event.audio_base_64),this.currentEventId=t.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(t){this.input.setMuted(t)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}}class Z_ extends Ar{static startSession(t){return t.textOnly?Eh.startSession(t):Oh.startSession(t)}}const F0=Ze.createContext(void 0),Mr=()=>{const r=Ze.useContext(F0);if(!r)throw new Error("useConversation must be used within a ConversationProvider");return r},W_=({children:r})=>{const[t,i]=Ze.useState(null),[a,o]=Ze.useState(!1),[l,h]=Ze.useState([]),[u,m]=Ze.useState("disconnected"),[p,g]=Ze.useState("Disconnected"),[y,S]=Ze.useState(!1),[k,A]=Ze.useState(null),[R,G]=Ze.useState(!1),I=Ze.useRef(!1),Z=Ze.useRef(!1),X=Ze.useRef(null),M=Ze.useCallback((ae,fe)=>{const Fe={id:`${Date.now()}-${Math.random()}`,role:ae,content:fe,timestamp:new Date};h(Qe=>[...Qe,Fe])},[]),D=Ze.useCallback((ae,fe)=>{m(ae),g(fe)},[]),z=Ze.useCallback(ae=>{I.current=ae,S(ae)},[]),K=Ze.useCallback(ae=>{switch(ae){case"speaking":D("speaking","Speaking");break;case"listening":D("listening","Listening");break;case"thinking":D("thinking","Thinking");break;default:D("connected","Active")}},[D]),se=Ze.useCallback(async()=>{if(a){console.log("Conversation already active, skipping");return}try{console.log("=== STARTING CONVERSATION ==="),G(!1),Z.current=!1,D("connecting","Connecting");const ae=window.electronAPI;I.current=!0,S(!0);let fe="";try{console.log("Capturing initial screen context..."),fe=(await ae.vision.captureAndDescribe()).description,console.log("Initial screen context:",fe),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H1",location:"ConversationContext.tsx:114",message:"initial screen context captured",data:{hasContext:!!fe,contextLength:fe.length},timestamp:Date.now()})}).catch(()=>{})}catch($){console.error("Failed to capture initial screen:",$),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H1",location:"ConversationContext.tsx:118",message:"initial screen context capture failed",data:{error:!0},timestamp:Date.now()})}).catch(()=>{})}const Fe=await ae.conversation.getSignedUrl(),Qe=await ae.conversation.getConfig();A(fe);const L={};Qe.voiceId&&(L.tts={voiceId:Qe.voiceId}),console.log("Starting conversation, initial screen context stored");const J=await Z_.startSession({signedUrl:Fe,...Object.keys(L).length>0?{overrides:L}:{},clientTools:{view_screen:async $=>{console.log("=== TOOL CALL RECEIVED: view_screen ==="),console.log("Tool params:",$),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:141",message:"view_screen tool called",data:{questionProvided:!!$.question,initialContextLength:fe.length},timestamp:Date.now()})}).catch(()=>{});try{if($.question){const ve=await ae.vision.analyzeScreen($.question);return fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:147",message:"view_screen returned from analyzeScreen",data:{resultLength:ve.length,disabled:ve.includes("disabled")},timestamp:Date.now()})}).catch(()=>{}),console.log("=== TOOL CALL COMPLETED: view_screen (fresh) ==="),ve}if(fe)return console.log("Using pre-captured screen context"),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:154",message:"view_screen returned cached context",data:{contextLength:fe.length},timestamp:Date.now()})}).catch(()=>{}),console.log("=== TOOL CALL COMPLETED: view_screen (cached) ==="),fe;const me=await ae.vision.analyzeScreen();return fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:159",message:"view_screen returned from analyzeScreen fallback",data:{resultLength:me.length,disabled:me.includes("disabled")},timestamp:Date.now()})}).catch(()=>{}),console.log("=== TOOL CALL COMPLETED: view_screen (fallback) ==="),me}catch(me){return console.error("Error in view_screen tool:",me),console.log("=== TOOL CALL FAILED: view_screen ==="),"Unable to analyze screen at this moment."}}},onUnhandledClientToolCall:$=>{console.warn("=== UNHANDLED TOOL CALL ===",$),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H3",location:"ConversationContext.tsx:170",message:"unhandled tool call",data:{toolName:$?.toolName||$?.name},timestamp:Date.now()})}).catch(()=>{})},onConnect:()=>{console.log("Connected to ElevenLabs conversation"),console.log("Agent has initial screen context:",!!fe),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H3",location:"ConversationContext.tsx:196",message:"conversation connected",data:{hasScreenContext:!!fe,screenContextLength:fe.length},timestamp:Date.now()})}).catch(()=>{}),o(!0),D("connected","Active")},onDisconnect:$=>{console.log("=== DISCONNECTED ===",$),o(!1),i(null),A(null),S(!1),I.current=!1,Z.current?D("disconnected","Ended"):D("error","Disconnected")},onMessage:$=>{const me=$.source||$.role||"unknown",ve=$.message||$.text||"";fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H5",location:"ConversationContext.tsx:193",message:"onMessage received",data:{role:me,hasText:!!ve,mentionsTool:typeof ve=="string"&&ve.toLowerCase().includes("tool"),mentionsCannotSee:typeof ve=="string"&&ve.toLowerCase().includes("can't see")},timestamp:Date.now()})}).catch(()=>{}),ve&&M(me==="user"?"user":"agent",ve)},onError:$=>{console.error("Conversation error:",$),D("error","Error"),o(!1)},onModeChange:async $=>{if(console.log("Mode changed:",$.mode),$.mode==="listening"&&!k)try{const me=await ae.vision.captureAndDescribe();A(me.description),typeof X.current?.sendUserMessage=="function"&&X.current.sendUserMessage(`[SCREEN_CONTEXT_UPDATE] ${me.description}`)}catch(me){console.error("Failed to capture screen context:",me),A(null)}K($.mode)}});if(X.current=J,i(J),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:257",message:"checking conversation methods",data:{hasSendUserMessage:typeof J.sendUserMessage=="function",methods:Object.getOwnPropertyNames(Object.getPrototypeOf(J))},timestamp:Date.now()})}).catch(()=>{}),typeof J.sendUserMessage=="function")try{J.sendUserMessage('[SYSTEM] Screen permission already granted. Do not ask for permission. When asked about the screen, immediately call view_screen({ question: "what should I help with?" }).'),J.sendUserMessage(`[SCREEN_CONTEXT] ${fe||"Unable to capture screen. Help the user verbally."}`),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H4",location:"ConversationContext.tsx:236",message:"sent system + screen context messages",data:{contextLength:fe.length},timestamp:Date.now()})}).catch(()=>{})}catch($){console.error("Failed to send screen context to agent:",$),fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:278",message:"sendUserMessage threw error",data:{error:String($)},timestamp:Date.now()})}).catch(()=>{})}else fetch("http://127.0.0.1:7254/ingest/9783cea7-141f-45fd-bc2e-dc110810f23f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"debug-session",runId:"run1",hypothesisId:"H2",location:"ConversationContext.tsx:283",message:"sendUserMessage NOT available on conversation object",data:{available:!1},timestamp:Date.now()})}).catch(()=>{})}catch(ae){console.error("Failed to start conversation:",ae),D("error","Error")}},[a,D,M,K]),ne=Ze.useCallback(()=>{if(t)try{console.log("Interrupting agent..."),typeof t.interrupt=="function"&&t.interrupt(),D("listening","Listening")}catch(ae){console.error("Error interrupting agent:",ae)}},[t,D]),ie=Ze.useCallback(async()=>{if(t)try{console.log("Ending conversation..."),G(!0),Z.current=!0,await t.endSession(),i(null),o(!1),S(!1),I.current=!1,D("disconnected","Ended"),console.log("Conversation ended successfully")}catch(ae){console.error("Error ending conversation:",ae)}else console.log("No active conversation to end")},[t,D]),re={conversation:t,isCallActive:a,messages:l,connectionStatus:u,statusText:p,screenViewPermissionGranted:y,currentScreenContext:k,startConversation:se,endConversation:ie,interruptAgent:ne,addMessage:M,updateStatus:D,setScreenViewPermission:z,handleModeChange:K};return Te.jsx(F0.Provider,{value:re,children:r})},$_=()=>Te.jsx("div",{className:"titlebar",children:Te.jsx("span",{className:"titlebar-title",children:"Granny"})}),e1=()=>{const{connectionStatus:r,statusText:t}=Mr();return Te.jsxs("div",{id:"connection-status",className:`status-indicator ${r}`,children:[Te.jsx("div",{className:"status-dot"}),Te.jsx("span",{id:"status-text",children:t})]})},t1=({message:r})=>{const{role:t,content:i}=r,a=t==="user",o=t==="system",l=o?"system":a?"user":"agent",h=a?"You":o?"System":"Granny's Helper";return Te.jsx("div",{className:`message-row ${l}`,children:Te.jsxs("div",{className:`message-bubble ${o?"system-message":""}`,children:[Te.jsx("div",{className:"message-label",children:h}),Te.jsx("div",{className:"message-content",children:i})]})})},n1=()=>{const{messages:r}=Mr(),t=Ze.useRef(null);return Ze.useEffect(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[r]),Te.jsx("div",{ref:t,id:"chat-area",className:"chat-area",children:r.map(i=>Te.jsx(t1,{message:i},i.id))})},i1=()=>{const{isCallActive:r,connectionStatus:t}=Mr();if(!r)return null;const i=`voice-visualizer ${t==="speaking"?"speaking":""} ${t==="listening"?"listening":""}`;return Te.jsxs("div",{id:"voice-visualizer",className:i,children:[Te.jsx("div",{className:"bar"}),Te.jsx("div",{className:"bar"}),Te.jsx("div",{className:"bar"}),Te.jsx("div",{className:"bar"}),Te.jsx("div",{className:"bar"})]})},a1=()=>{const{isCallActive:r,startConversation:t,endConversation:i}=Mr();return Te.jsxs("div",{className:"bottom-controls",children:[Te.jsx(i1,{}),r?Te.jsx("button",{id:"end-call-btn",className:"voice-btn end-call",onClick:i,title:"End conversation",children:Te.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Te.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Te.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}):Te.jsx("button",{id:"call-btn",className:"voice-btn",onClick:t,title:"Start voice conversation",children:Te.jsxs("svg",{className:"mic-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Te.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),Te.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),Te.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),Te.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})})]})},s1=()=>{const{startConversation:r,addMessage:t,isCallActive:i}=Mr();return Ze.useEffect(()=>{let a=!1;(async()=>{try{const u=await window.electronAPI.permission.getScreenStatus();console.log("Screen recording permission:",u),u!=="granted"&&t("system"," Screen recording permission not granted. Screen sharing features will be limited.")}catch(h){console.error("Failed to check permissions:",h)}})();const l=setTimeout(()=>{!a&&!i&&(console.log("Auto-starting conversation"),a=!0,r())},500);return()=>{clearTimeout(l),a=!0}},[]),Te.jsxs(Te.Fragment,{children:[Te.jsx($_,{}),Te.jsx(e1,{}),Te.jsxs("div",{className:"app-container",children:[Te.jsx(n1,{}),Te.jsx(a1,{})]})]})},r1=()=>Te.jsx(W_,{children:Te.jsx(s1,{})}),H0=document.getElementById("root");if(!H0)throw new Error("Root element not found");const o1=_T.createRoot(H0);o1.render(Te.jsx(yT.StrictMode,{children:Te.jsx(r1,{})}));
